{
  "version": 3,
  "sources": ["../../../../../../AppData/Roaming/npm/node_modules/wrangler/node_modules/unenv/dist/runtime/_internal/utils.mjs", "../../../../../../AppData/Roaming/npm/node_modules/wrangler/node_modules/unenv/dist/runtime/node/internal/perf_hooks/performance.mjs", "../../../../../../AppData/Roaming/npm/node_modules/wrangler/node_modules/unenv/dist/runtime/node/perf_hooks.mjs", "../../../../../../AppData/Roaming/npm/node_modules/wrangler/node_modules/@cloudflare/unenv-preset/dist/runtime/polyfill/performance.mjs", "../../../../../../AppData/Roaming/npm/node_modules/wrangler/node_modules/unenv/dist/runtime/mock/noop.mjs", "../../../../../../AppData/Roaming/npm/node_modules/wrangler/node_modules/unenv/dist/runtime/node/console.mjs", "../../../../../../AppData/Roaming/npm/node_modules/wrangler/node_modules/@cloudflare/unenv-preset/dist/runtime/node/console.mjs", "../../../../../../AppData/Roaming/npm/node_modules/wrangler/_virtual_unenv_global_polyfill-@cloudflare-unenv-preset-node-console", "../../../../../../AppData/Roaming/npm/node_modules/wrangler/node_modules/unenv/dist/runtime/node/internal/process/hrtime.mjs", "../../../../../../AppData/Roaming/npm/node_modules/wrangler/node_modules/unenv/dist/runtime/node/internal/tty/read-stream.mjs", "../../../../../../AppData/Roaming/npm/node_modules/wrangler/node_modules/unenv/dist/runtime/node/internal/tty/write-stream.mjs", "../../../../../../AppData/Roaming/npm/node_modules/wrangler/node_modules/unenv/dist/runtime/node/tty.mjs", "../../../../../../AppData/Roaming/npm/node_modules/wrangler/node_modules/unenv/dist/runtime/node/internal/process/node-version.mjs", "../../../../../../AppData/Roaming/npm/node_modules/wrangler/node_modules/unenv/dist/runtime/node/internal/process/process.mjs", "../../../../../../AppData/Roaming/npm/node_modules/wrangler/node_modules/@cloudflare/unenv-preset/dist/runtime/node/process.mjs", "../../../../../../AppData/Roaming/npm/node_modules/wrangler/_virtual_unenv_global_polyfill-@cloudflare-unenv-preset-node-process", "../../../worker/src/index.js", "../../../worker/node_modules/hono/dist/index.js", "../../../worker/node_modules/hono/dist/hono.js", "../../../worker/node_modules/hono/dist/hono-base.js", "../../../worker/node_modules/hono/dist/compose.js", "../../../worker/node_modules/hono/dist/context.js", "../../../worker/node_modules/hono/dist/request.js", "../../../worker/node_modules/hono/dist/http-exception.js", "../../../worker/node_modules/hono/dist/request/constants.js", "../../../worker/node_modules/hono/dist/utils/body.js", "../../../worker/node_modules/hono/dist/utils/url.js", "../../../worker/node_modules/hono/dist/utils/html.js", "../../../worker/node_modules/hono/dist/router.js", "../../../worker/node_modules/hono/dist/utils/constants.js", "../../../worker/node_modules/hono/dist/router/reg-exp-router/index.js", "../../../worker/node_modules/hono/dist/router/reg-exp-router/router.js", "../../../worker/node_modules/hono/dist/router/reg-exp-router/matcher.js", "../../../worker/node_modules/hono/dist/router/reg-exp-router/node.js", "../../../worker/node_modules/hono/dist/router/reg-exp-router/trie.js", "../../../worker/node_modules/hono/dist/router/reg-exp-router/prepared-router.js", "../../../worker/node_modules/hono/dist/router/smart-router/index.js", "../../../worker/node_modules/hono/dist/router/smart-router/router.js", "../../../worker/node_modules/hono/dist/router/trie-router/index.js", "../../../worker/node_modules/hono/dist/router/trie-router/router.js", "../../../worker/node_modules/hono/dist/router/trie-router/node.js", "../../../node_modules/bcryptjs/index.js", "../../../worker/src/utils/recurring.js", "../../../worker/src/email-templates/event-reminder.js", "../../../worker/src/auth-utils.js"],
  "sourceRoot": "C:\\Users\\nickc\\Desktop\\Dev\\DiceBastion\\.wrangler\\tmp\\deploy-tgnFUh",
  "sourcesContent": ["/* @__NO_SIDE_EFFECTS__ */\nexport function rawHeaders(headers) {\n\tconst rawHeaders = [];\n\tfor (const key in headers) {\n\t\tif (Array.isArray(headers[key])) {\n\t\t\tfor (const h of headers[key]) {\n\t\t\t\trawHeaders.push(key, h);\n\t\t\t}\n\t\t} else {\n\t\t\trawHeaders.push(key, headers[key]);\n\t\t}\n\t}\n\treturn rawHeaders;\n}\n/* @__NO_SIDE_EFFECTS__ */\nexport function mergeFns(...functions) {\n\treturn function(...args) {\n\t\tfor (const fn of functions) {\n\t\t\tfn(...args);\n\t\t}\n\t};\n}\n/* @__NO_SIDE_EFFECTS__ */\nexport function createNotImplementedError(name) {\n\treturn new Error(`[unenv] ${name} is not implemented yet!`);\n}\n/* @__NO_SIDE_EFFECTS__ */\nexport function notImplemented(name) {\n\tconst fn = () => {\n\t\tthrow createNotImplementedError(name);\n\t};\n\treturn Object.assign(fn, { __unenv__: true });\n}\n/* @__NO_SIDE_EFFECTS__ */\nexport function notImplementedAsync(name) {\n\tconst fn = notImplemented(name);\n\tfn.__promisify__ = () => notImplemented(name + \".__promisify__\");\n\tfn.native = fn;\n\treturn fn;\n}\n/* @__NO_SIDE_EFFECTS__ */\nexport function notImplementedClass(name) {\n\treturn class {\n\t\t__unenv__ = true;\n\t\tconstructor() {\n\t\t\tthrow new Error(`[unenv] ${name} is not implemented yet!`);\n\t\t}\n\t};\n}\n", "import { createNotImplementedError } from \"../../../_internal/utils.mjs\";\nconst _timeOrigin = globalThis.performance?.timeOrigin ?? Date.now();\nconst _performanceNow = globalThis.performance?.now ? globalThis.performance.now.bind(globalThis.performance) : () => Date.now() - _timeOrigin;\nconst nodeTiming = {\n\tname: \"node\",\n\tentryType: \"node\",\n\tstartTime: 0,\n\tduration: 0,\n\tnodeStart: 0,\n\tv8Start: 0,\n\tbootstrapComplete: 0,\n\tenvironment: 0,\n\tloopStart: 0,\n\tloopExit: 0,\n\tidleTime: 0,\n\tuvMetricsInfo: {\n\t\tloopCount: 0,\n\t\tevents: 0,\n\t\teventsWaiting: 0\n\t},\n\tdetail: undefined,\n\ttoJSON() {\n\t\treturn this;\n\t}\n};\n// PerformanceEntry\nexport class PerformanceEntry {\n\t__unenv__ = true;\n\tdetail;\n\tentryType = \"event\";\n\tname;\n\tstartTime;\n\tconstructor(name, options) {\n\t\tthis.name = name;\n\t\tthis.startTime = options?.startTime || _performanceNow();\n\t\tthis.detail = options?.detail;\n\t}\n\tget duration() {\n\t\treturn _performanceNow() - this.startTime;\n\t}\n\ttoJSON() {\n\t\treturn {\n\t\t\tname: this.name,\n\t\t\tentryType: this.entryType,\n\t\t\tstartTime: this.startTime,\n\t\t\tduration: this.duration,\n\t\t\tdetail: this.detail\n\t\t};\n\t}\n}\n// PerformanceMark\nexport const PerformanceMark = class PerformanceMark extends PerformanceEntry {\n\tentryType = \"mark\";\n\tconstructor() {\n\t\t// @ts-ignore\n\t\tsuper(...arguments);\n\t}\n\tget duration() {\n\t\treturn 0;\n\t}\n};\n// PerformanceMark\nexport class PerformanceMeasure extends PerformanceEntry {\n\tentryType = \"measure\";\n}\n// PerformanceResourceTiming\nexport class PerformanceResourceTiming extends PerformanceEntry {\n\tentryType = \"resource\";\n\tserverTiming = [];\n\tconnectEnd = 0;\n\tconnectStart = 0;\n\tdecodedBodySize = 0;\n\tdomainLookupEnd = 0;\n\tdomainLookupStart = 0;\n\tencodedBodySize = 0;\n\tfetchStart = 0;\n\tinitiatorType = \"\";\n\tname = \"\";\n\tnextHopProtocol = \"\";\n\tredirectEnd = 0;\n\tredirectStart = 0;\n\trequestStart = 0;\n\tresponseEnd = 0;\n\tresponseStart = 0;\n\tsecureConnectionStart = 0;\n\tstartTime = 0;\n\ttransferSize = 0;\n\tworkerStart = 0;\n\tresponseStatus = 0;\n}\n// PerformanceObserverEntryList\nexport class PerformanceObserverEntryList {\n\t__unenv__ = true;\n\tgetEntries() {\n\t\treturn [];\n\t}\n\tgetEntriesByName(_name, _type) {\n\t\treturn [];\n\t}\n\tgetEntriesByType(type) {\n\t\treturn [];\n\t}\n}\n// Performance\nexport class Performance {\n\t__unenv__ = true;\n\ttimeOrigin = _timeOrigin;\n\teventCounts = new Map();\n\t_entries = [];\n\t_resourceTimingBufferSize = 0;\n\tnavigation = undefined;\n\ttiming = undefined;\n\ttimerify(_fn, _options) {\n\t\tthrow createNotImplementedError(\"Performance.timerify\");\n\t}\n\tget nodeTiming() {\n\t\treturn nodeTiming;\n\t}\n\teventLoopUtilization() {\n\t\treturn {};\n\t}\n\tmarkResourceTiming() {\n\t\t// TODO: create a new PerformanceResourceTiming entry\n\t\t// so that performance.getEntries, getEntriesByName, and getEntriesByType return it\n\t\t// see: https://nodejs.org/api/perf_hooks.html#performancemarkresourcetimingtiminginfo-requestedurl-initiatortype-global-cachemode-bodyinfo-responsestatus-deliverytype\n\t\treturn new PerformanceResourceTiming(\"\");\n\t}\n\tonresourcetimingbufferfull = null;\n\tnow() {\n\t\t// https://developer.mozilla.org/en-US/docs/Web/API/Performance/now\n\t\tif (this.timeOrigin === _timeOrigin) {\n\t\t\treturn _performanceNow();\n\t\t}\n\t\treturn Date.now() - this.timeOrigin;\n\t}\n\tclearMarks(markName) {\n\t\tthis._entries = markName ? this._entries.filter((e) => e.name !== markName) : this._entries.filter((e) => e.entryType !== \"mark\");\n\t}\n\tclearMeasures(measureName) {\n\t\tthis._entries = measureName ? this._entries.filter((e) => e.name !== measureName) : this._entries.filter((e) => e.entryType !== \"measure\");\n\t}\n\tclearResourceTimings() {\n\t\tthis._entries = this._entries.filter((e) => e.entryType !== \"resource\" || e.entryType !== \"navigation\");\n\t}\n\tgetEntries() {\n\t\treturn this._entries;\n\t}\n\tgetEntriesByName(name, type) {\n\t\treturn this._entries.filter((e) => e.name === name && (!type || e.entryType === type));\n\t}\n\tgetEntriesByType(type) {\n\t\treturn this._entries.filter((e) => e.entryType === type);\n\t}\n\tmark(name, options) {\n\t\t// @ts-expect-error constructor is not protected\n\t\tconst entry = new PerformanceMark(name, options);\n\t\tthis._entries.push(entry);\n\t\treturn entry;\n\t}\n\tmeasure(measureName, startOrMeasureOptions, endMark) {\n\t\tlet start;\n\t\tlet end;\n\t\tif (typeof startOrMeasureOptions === \"string\") {\n\t\t\tstart = this.getEntriesByName(startOrMeasureOptions, \"mark\")[0]?.startTime;\n\t\t\tend = this.getEntriesByName(endMark, \"mark\")[0]?.startTime;\n\t\t} else {\n\t\t\tstart = Number.parseFloat(startOrMeasureOptions?.start) || this.now();\n\t\t\tend = Number.parseFloat(startOrMeasureOptions?.end) || this.now();\n\t\t}\n\t\tconst entry = new PerformanceMeasure(measureName, {\n\t\t\tstartTime: start,\n\t\t\tdetail: {\n\t\t\t\tstart,\n\t\t\t\tend\n\t\t\t}\n\t\t});\n\t\tthis._entries.push(entry);\n\t\treturn entry;\n\t}\n\tsetResourceTimingBufferSize(maxSize) {\n\t\tthis._resourceTimingBufferSize = maxSize;\n\t}\n\taddEventListener(type, listener, options) {\n\t\tthrow createNotImplementedError(\"Performance.addEventListener\");\n\t}\n\tremoveEventListener(type, listener, options) {\n\t\tthrow createNotImplementedError(\"Performance.removeEventListener\");\n\t}\n\tdispatchEvent(event) {\n\t\tthrow createNotImplementedError(\"Performance.dispatchEvent\");\n\t}\n\ttoJSON() {\n\t\treturn this;\n\t}\n}\n// PerformanceObserver\nexport class PerformanceObserver {\n\t__unenv__ = true;\n\tstatic supportedEntryTypes = [];\n\t_callback = null;\n\tconstructor(callback) {\n\t\tthis._callback = callback;\n\t}\n\ttakeRecords() {\n\t\treturn [];\n\t}\n\tdisconnect() {\n\t\tthrow createNotImplementedError(\"PerformanceObserver.disconnect\");\n\t}\n\tobserve(options) {\n\t\tthrow createNotImplementedError(\"PerformanceObserver.observe\");\n\t}\n\tbind(fn) {\n\t\treturn fn;\n\t}\n\trunInAsyncScope(fn, thisArg, ...args) {\n\t\treturn fn.call(thisArg, ...args);\n\t}\n\tasyncId() {\n\t\treturn 0;\n\t}\n\ttriggerAsyncId() {\n\t\treturn 0;\n\t}\n\temitDestroy() {\n\t\treturn this;\n\t}\n}\n// workerd implements a subset of globalThis.performance (as of last check, only timeOrigin set to 0 + now() implemented)\n// We already use performance.now() from globalThis.performance, if provided (see top of this file)\n// If we detect this condition, we can just use polyfill instead.\nexport const performance = globalThis.performance && \"addEventListener\" in globalThis.performance ? globalThis.performance : new Performance();\n", "import { IntervalHistogram, RecordableHistogram } from \"./internal/perf_hooks/histogram.mjs\";\nimport { performance, Performance, PerformanceEntry, PerformanceMark, PerformanceMeasure, PerformanceObserverEntryList, PerformanceObserver, PerformanceResourceTiming } from \"./internal/perf_hooks/performance.mjs\";\nexport * from \"./internal/perf_hooks/performance.mjs\";\n// prettier-ignore\nimport { NODE_PERFORMANCE_GC_MAJOR, NODE_PERFORMANCE_GC_MINOR, NODE_PERFORMANCE_GC_INCREMENTAL, NODE_PERFORMANCE_GC_WEAKCB, NODE_PERFORMANCE_GC_FLAGS_NO, NODE_PERFORMANCE_GC_FLAGS_CONSTRUCT_RETAINED, NODE_PERFORMANCE_GC_FLAGS_FORCED, NODE_PERFORMANCE_GC_FLAGS_SYNCHRONOUS_PHANTOM_PROCESSING, NODE_PERFORMANCE_GC_FLAGS_ALL_AVAILABLE_GARBAGE, NODE_PERFORMANCE_GC_FLAGS_ALL_EXTERNAL_MEMORY, NODE_PERFORMANCE_GC_FLAGS_SCHEDULE_IDLE, NODE_PERFORMANCE_ENTRY_TYPE_GC, NODE_PERFORMANCE_ENTRY_TYPE_HTTP, NODE_PERFORMANCE_ENTRY_TYPE_HTTP2, NODE_PERFORMANCE_ENTRY_TYPE_NET, NODE_PERFORMANCE_ENTRY_TYPE_DNS, NODE_PERFORMANCE_MILESTONE_TIME_ORIGIN_TIMESTAMP, NODE_PERFORMANCE_MILESTONE_TIME_ORIGIN, NODE_PERFORMANCE_MILESTONE_ENVIRONMENT, NODE_PERFORMANCE_MILESTONE_NODE_START, NODE_PERFORMANCE_MILESTONE_V8_START, NODE_PERFORMANCE_MILESTONE_LOOP_START, NODE_PERFORMANCE_MILESTONE_LOOP_EXIT, NODE_PERFORMANCE_MILESTONE_BOOTSTRAP_COMPLETE } from \"./internal/perf_hooks/constants.mjs\";\n// prettier-ignore\nexport const constants = {\n\tNODE_PERFORMANCE_GC_MAJOR,\n\tNODE_PERFORMANCE_GC_MINOR,\n\tNODE_PERFORMANCE_GC_INCREMENTAL,\n\tNODE_PERFORMANCE_GC_WEAKCB,\n\tNODE_PERFORMANCE_GC_FLAGS_NO,\n\tNODE_PERFORMANCE_GC_FLAGS_CONSTRUCT_RETAINED,\n\tNODE_PERFORMANCE_GC_FLAGS_FORCED,\n\tNODE_PERFORMANCE_GC_FLAGS_SYNCHRONOUS_PHANTOM_PROCESSING,\n\tNODE_PERFORMANCE_GC_FLAGS_ALL_AVAILABLE_GARBAGE,\n\tNODE_PERFORMANCE_GC_FLAGS_ALL_EXTERNAL_MEMORY,\n\tNODE_PERFORMANCE_GC_FLAGS_SCHEDULE_IDLE,\n\tNODE_PERFORMANCE_ENTRY_TYPE_GC,\n\tNODE_PERFORMANCE_ENTRY_TYPE_HTTP,\n\tNODE_PERFORMANCE_ENTRY_TYPE_HTTP2,\n\tNODE_PERFORMANCE_ENTRY_TYPE_NET,\n\tNODE_PERFORMANCE_ENTRY_TYPE_DNS,\n\tNODE_PERFORMANCE_MILESTONE_TIME_ORIGIN_TIMESTAMP,\n\tNODE_PERFORMANCE_MILESTONE_TIME_ORIGIN,\n\tNODE_PERFORMANCE_MILESTONE_ENVIRONMENT,\n\tNODE_PERFORMANCE_MILESTONE_NODE_START,\n\tNODE_PERFORMANCE_MILESTONE_V8_START,\n\tNODE_PERFORMANCE_MILESTONE_LOOP_START,\n\tNODE_PERFORMANCE_MILESTONE_LOOP_EXIT,\n\tNODE_PERFORMANCE_MILESTONE_BOOTSTRAP_COMPLETE\n};\nexport const monitorEventLoopDelay = function(_options) {\n\treturn new IntervalHistogram();\n};\nexport const createHistogram = function(_options) {\n\treturn new RecordableHistogram();\n};\nexport default {\n\tPerformance,\n\tPerformanceMark,\n\tPerformanceEntry,\n\tPerformanceMeasure,\n\tPerformanceObserverEntryList,\n\tPerformanceObserver,\n\tPerformanceResourceTiming,\n\tperformance,\n\tconstants,\n\tcreateHistogram,\n\tmonitorEventLoopDelay\n};\n", "import {\n  performance,\n  Performance,\n  PerformanceEntry,\n  PerformanceMark,\n  PerformanceMeasure,\n  PerformanceObserver,\n  PerformanceObserverEntryList,\n  PerformanceResourceTiming\n} from \"node:perf_hooks\";\nglobalThis.performance = performance;\nglobalThis.Performance = Performance;\nglobalThis.PerformanceEntry = PerformanceEntry;\nglobalThis.PerformanceMark = PerformanceMark;\nglobalThis.PerformanceMeasure = PerformanceMeasure;\nglobalThis.PerformanceObserver = PerformanceObserver;\nglobalThis.PerformanceObserverEntryList = PerformanceObserverEntryList;\nglobalThis.PerformanceResourceTiming = PerformanceResourceTiming;\n", "export default Object.assign(() => {}, { __unenv__: true });\n", "import { Writable } from \"node:stream\";\nimport noop from \"../mock/noop.mjs\";\nimport { notImplemented, notImplementedClass } from \"../_internal/utils.mjs\";\nconst _console = globalThis.console;\n// undocumented public APIs\nexport const _ignoreErrors = true;\nexport const _stderr = new Writable();\nexport const _stdout = new Writable();\nexport const log = _console?.log ?? noop;\nexport const info = _console?.info ?? log;\nexport const trace = _console?.trace ?? info;\nexport const debug = _console?.debug ?? log;\nexport const table = _console?.table ?? log;\nexport const error = _console?.error ?? log;\nexport const warn = _console?.warn ?? error;\n// https://developer.chrome.com/docs/devtools/console/api#createtask\nexport const createTask = _console?.createTask ?? /* @__PURE__ */ notImplemented(\"console.createTask\");\nexport const assert = /* @__PURE__ */ notImplemented(\"console.assert\");\n// noop\nexport const clear = _console?.clear ?? noop;\nexport const count = _console?.count ?? noop;\nexport const countReset = _console?.countReset ?? noop;\nexport const dir = _console?.dir ?? noop;\nexport const dirxml = _console?.dirxml ?? noop;\nexport const group = _console?.group ?? noop;\nexport const groupEnd = _console?.groupEnd ?? noop;\nexport const groupCollapsed = _console?.groupCollapsed ?? noop;\nexport const profile = _console?.profile ?? noop;\nexport const profileEnd = _console?.profileEnd ?? noop;\nexport const time = _console?.time ?? noop;\nexport const timeEnd = _console?.timeEnd ?? noop;\nexport const timeLog = _console?.timeLog ?? noop;\nexport const timeStamp = _console?.timeStamp ?? noop;\nexport const Console = _console?.Console ?? /* @__PURE__ */ notImplementedClass(\"console.Console\");\nexport const _times = /* @__PURE__ */ new Map();\nexport function context() {\n\t// TODO: Should be Console with all the methods\n\treturn _console;\n}\nexport const _stdoutErrorHandler = noop;\nexport const _stderrErrorHandler = noop;\nexport default {\n\t_times,\n\t_ignoreErrors,\n\t_stdoutErrorHandler,\n\t_stderrErrorHandler,\n\t_stdout,\n\t_stderr,\n\tassert,\n\tclear,\n\tConsole,\n\tcount,\n\tcountReset,\n\tdebug,\n\tdir,\n\tdirxml,\n\terror,\n\tcontext,\n\tcreateTask,\n\tgroup,\n\tgroupEnd,\n\tgroupCollapsed,\n\tinfo,\n\tlog,\n\tprofile,\n\tprofileEnd,\n\ttable,\n\ttime,\n\ttimeEnd,\n\ttimeLog,\n\ttimeStamp,\n\ttrace,\n\twarn\n};\n", "import {\n  _ignoreErrors,\n  _stderr,\n  _stderrErrorHandler,\n  _stdout,\n  _stdoutErrorHandler,\n  _times,\n  Console\n} from \"unenv/node/console\";\nexport {\n  Console,\n  _ignoreErrors,\n  _stderr,\n  _stderrErrorHandler,\n  _stdout,\n  _stdoutErrorHandler,\n  _times\n} from \"unenv/node/console\";\nconst workerdConsole = globalThis[\"console\"];\nexport const {\n  assert,\n  clear,\n  // @ts-expect-error undocumented public API\n  context,\n  count,\n  countReset,\n  // @ts-expect-error undocumented public API\n  createTask,\n  debug,\n  dir,\n  dirxml,\n  error,\n  group,\n  groupCollapsed,\n  groupEnd,\n  info,\n  log,\n  profile,\n  profileEnd,\n  table,\n  time,\n  timeEnd,\n  timeLog,\n  timeStamp,\n  trace,\n  warn\n} = workerdConsole;\nObject.assign(workerdConsole, {\n  Console,\n  _ignoreErrors,\n  _stderr,\n  _stderrErrorHandler,\n  _stdout,\n  _stdoutErrorHandler,\n  _times\n});\nexport default workerdConsole;\n", "import { default as defaultExport } from \"@cloudflare/unenv-preset/node/console\";\nglobalThis.console = defaultExport;", "// https://nodejs.org/api/process.html#processhrtime\nexport const hrtime = /* @__PURE__ */ Object.assign(function hrtime(startTime) {\n\tconst now = Date.now();\n\t// millis to seconds\n\tconst seconds = Math.trunc(now / 1e3);\n\t// convert millis to nanos\n\tconst nanos = now % 1e3 * 1e6;\n\tif (startTime) {\n\t\tlet diffSeconds = seconds - startTime[0];\n\t\tlet diffNanos = nanos - startTime[0];\n\t\tif (diffNanos < 0) {\n\t\t\tdiffSeconds = diffSeconds - 1;\n\t\t\tdiffNanos = 1e9 + diffNanos;\n\t\t}\n\t\treturn [diffSeconds, diffNanos];\n\t}\n\treturn [seconds, nanos];\n}, { bigint: function bigint() {\n\t// Convert milliseconds to nanoseconds\n\treturn BigInt(Date.now() * 1e6);\n} });\n", "export class ReadStream {\n\tfd;\n\tisRaw = false;\n\tisTTY = false;\n\tconstructor(fd) {\n\t\tthis.fd = fd;\n\t}\n\tsetRawMode(mode) {\n\t\tthis.isRaw = mode;\n\t\treturn this;\n\t}\n}\n", "export class WriteStream {\n\tfd;\n\tcolumns = 80;\n\trows = 24;\n\tisTTY = false;\n\tconstructor(fd) {\n\t\tthis.fd = fd;\n\t}\n\tclearLine(dir, callback) {\n\t\tcallback && callback();\n\t\treturn false;\n\t}\n\tclearScreenDown(callback) {\n\t\tcallback && callback();\n\t\treturn false;\n\t}\n\tcursorTo(x, y, callback) {\n\t\tcallback && typeof callback === \"function\" && callback();\n\t\treturn false;\n\t}\n\tmoveCursor(dx, dy, callback) {\n\t\tcallback && callback();\n\t\treturn false;\n\t}\n\tgetColorDepth(env) {\n\t\treturn 1;\n\t}\n\thasColors(count, env) {\n\t\treturn false;\n\t}\n\tgetWindowSize() {\n\t\treturn [this.columns, this.rows];\n\t}\n\twrite(str, encoding, cb) {\n\t\tif (str instanceof Uint8Array) {\n\t\t\tstr = new TextDecoder().decode(str);\n\t\t}\n\t\ttry {\n\t\t\tconsole.log(str);\n\t\t} catch {}\n\t\tcb && typeof cb === \"function\" && cb();\n\t\treturn false;\n\t}\n}\n", "import { ReadStream } from \"./internal/tty/read-stream.mjs\";\nimport { WriteStream } from \"./internal/tty/write-stream.mjs\";\nexport { ReadStream } from \"./internal/tty/read-stream.mjs\";\nexport { WriteStream } from \"./internal/tty/write-stream.mjs\";\nexport const isatty = function() {\n\treturn false;\n};\nexport default {\n\tReadStream,\n\tWriteStream,\n\tisatty\n};\n", "// Extracted from .nvmrc\nexport const NODE_VERSION = \"22.14.0\";\n", "import { EventEmitter } from \"node:events\";\nimport { ReadStream, WriteStream } from \"node:tty\";\nimport { notImplemented, createNotImplementedError } from \"../../../_internal/utils.mjs\";\n// node-version.ts is generated at build time\nimport { NODE_VERSION } from \"./node-version.mjs\";\nexport class Process extends EventEmitter {\n\tenv;\n\thrtime;\n\tnextTick;\n\tconstructor(impl) {\n\t\tsuper();\n\t\tthis.env = impl.env;\n\t\tthis.hrtime = impl.hrtime;\n\t\tthis.nextTick = impl.nextTick;\n\t\tfor (const prop of [...Object.getOwnPropertyNames(Process.prototype), ...Object.getOwnPropertyNames(EventEmitter.prototype)]) {\n\t\t\tconst value = this[prop];\n\t\t\tif (typeof value === \"function\") {\n\t\t\t\tthis[prop] = value.bind(this);\n\t\t\t}\n\t\t}\n\t}\n\t// --- event emitter ---\n\temitWarning(warning, type, code) {\n\t\tconsole.warn(`${code ? `[${code}] ` : \"\"}${type ? `${type}: ` : \"\"}${warning}`);\n\t}\n\temit(...args) {\n\t\t// @ts-ignore\n\t\treturn super.emit(...args);\n\t}\n\tlisteners(eventName) {\n\t\treturn super.listeners(eventName);\n\t}\n\t// --- stdio (lazy initializers) ---\n\t#stdin;\n\t#stdout;\n\t#stderr;\n\tget stdin() {\n\t\treturn this.#stdin ??= new ReadStream(0);\n\t}\n\tget stdout() {\n\t\treturn this.#stdout ??= new WriteStream(1);\n\t}\n\tget stderr() {\n\t\treturn this.#stderr ??= new WriteStream(2);\n\t}\n\t// --- cwd ---\n\t#cwd = \"/\";\n\tchdir(cwd) {\n\t\tthis.#cwd = cwd;\n\t}\n\tcwd() {\n\t\treturn this.#cwd;\n\t}\n\t// --- dummy props and getters ---\n\tarch = \"\";\n\tplatform = \"\";\n\targv = [];\n\targv0 = \"\";\n\texecArgv = [];\n\texecPath = \"\";\n\ttitle = \"\";\n\tpid = 200;\n\tppid = 100;\n\tget version() {\n\t\treturn `v${NODE_VERSION}`;\n\t}\n\tget versions() {\n\t\treturn { node: NODE_VERSION };\n\t}\n\tget allowedNodeEnvironmentFlags() {\n\t\treturn new Set();\n\t}\n\tget sourceMapsEnabled() {\n\t\treturn false;\n\t}\n\tget debugPort() {\n\t\treturn 0;\n\t}\n\tget throwDeprecation() {\n\t\treturn false;\n\t}\n\tget traceDeprecation() {\n\t\treturn false;\n\t}\n\tget features() {\n\t\treturn {};\n\t}\n\tget release() {\n\t\treturn {};\n\t}\n\tget connected() {\n\t\treturn false;\n\t}\n\tget config() {\n\t\treturn {};\n\t}\n\tget moduleLoadList() {\n\t\treturn [];\n\t}\n\tconstrainedMemory() {\n\t\treturn 0;\n\t}\n\tavailableMemory() {\n\t\treturn 0;\n\t}\n\tuptime() {\n\t\treturn 0;\n\t}\n\tresourceUsage() {\n\t\treturn {};\n\t}\n\t// --- noop methods ---\n\tref() {\n\t\t// noop\n\t}\n\tunref() {\n\t\t// noop\n\t}\n\t// --- unimplemented methods ---\n\tumask() {\n\t\tthrow createNotImplementedError(\"process.umask\");\n\t}\n\tgetBuiltinModule() {\n\t\treturn undefined;\n\t}\n\tgetActiveResourcesInfo() {\n\t\tthrow createNotImplementedError(\"process.getActiveResourcesInfo\");\n\t}\n\texit() {\n\t\tthrow createNotImplementedError(\"process.exit\");\n\t}\n\treallyExit() {\n\t\tthrow createNotImplementedError(\"process.reallyExit\");\n\t}\n\tkill() {\n\t\tthrow createNotImplementedError(\"process.kill\");\n\t}\n\tabort() {\n\t\tthrow createNotImplementedError(\"process.abort\");\n\t}\n\tdlopen() {\n\t\tthrow createNotImplementedError(\"process.dlopen\");\n\t}\n\tsetSourceMapsEnabled() {\n\t\tthrow createNotImplementedError(\"process.setSourceMapsEnabled\");\n\t}\n\tloadEnvFile() {\n\t\tthrow createNotImplementedError(\"process.loadEnvFile\");\n\t}\n\tdisconnect() {\n\t\tthrow createNotImplementedError(\"process.disconnect\");\n\t}\n\tcpuUsage() {\n\t\tthrow createNotImplementedError(\"process.cpuUsage\");\n\t}\n\tsetUncaughtExceptionCaptureCallback() {\n\t\tthrow createNotImplementedError(\"process.setUncaughtExceptionCaptureCallback\");\n\t}\n\thasUncaughtExceptionCaptureCallback() {\n\t\tthrow createNotImplementedError(\"process.hasUncaughtExceptionCaptureCallback\");\n\t}\n\tinitgroups() {\n\t\tthrow createNotImplementedError(\"process.initgroups\");\n\t}\n\topenStdin() {\n\t\tthrow createNotImplementedError(\"process.openStdin\");\n\t}\n\tassert() {\n\t\tthrow createNotImplementedError(\"process.assert\");\n\t}\n\tbinding() {\n\t\tthrow createNotImplementedError(\"process.binding\");\n\t}\n\t// --- attached interfaces ---\n\tpermission = { has: /* @__PURE__ */ notImplemented(\"process.permission.has\") };\n\treport = {\n\t\tdirectory: \"\",\n\t\tfilename: \"\",\n\t\tsignal: \"SIGUSR2\",\n\t\tcompact: false,\n\t\treportOnFatalError: false,\n\t\treportOnSignal: false,\n\t\treportOnUncaughtException: false,\n\t\tgetReport: /* @__PURE__ */ notImplemented(\"process.report.getReport\"),\n\t\twriteReport: /* @__PURE__ */ notImplemented(\"process.report.writeReport\")\n\t};\n\tfinalization = {\n\t\tregister: /* @__PURE__ */ notImplemented(\"process.finalization.register\"),\n\t\tunregister: /* @__PURE__ */ notImplemented(\"process.finalization.unregister\"),\n\t\tregisterBeforeExit: /* @__PURE__ */ notImplemented(\"process.finalization.registerBeforeExit\")\n\t};\n\tmemoryUsage = Object.assign(() => ({\n\t\tarrayBuffers: 0,\n\t\trss: 0,\n\t\texternal: 0,\n\t\theapTotal: 0,\n\t\theapUsed: 0\n\t}), { rss: () => 0 });\n\t// --- undefined props ---\n\tmainModule = undefined;\n\tdomain = undefined;\n\t// optional\n\tsend = undefined;\n\texitCode = undefined;\n\tchannel = undefined;\n\tgetegid = undefined;\n\tgeteuid = undefined;\n\tgetgid = undefined;\n\tgetgroups = undefined;\n\tgetuid = undefined;\n\tsetegid = undefined;\n\tseteuid = undefined;\n\tsetgid = undefined;\n\tsetgroups = undefined;\n\tsetuid = undefined;\n\t// internals\n\t_events = undefined;\n\t_eventsCount = undefined;\n\t_exiting = undefined;\n\t_maxListeners = undefined;\n\t_debugEnd = undefined;\n\t_debugProcess = undefined;\n\t_fatalException = undefined;\n\t_getActiveHandles = undefined;\n\t_getActiveRequests = undefined;\n\t_kill = undefined;\n\t_preload_modules = undefined;\n\t_rawDebug = undefined;\n\t_startProfilerIdleNotifier = undefined;\n\t_stopProfilerIdleNotifier = undefined;\n\t_tickCallback = undefined;\n\t_disconnect = undefined;\n\t_handleQueue = undefined;\n\t_pendingMessage = undefined;\n\t_channel = undefined;\n\t_send = undefined;\n\t_linkedBinding = undefined;\n}\n", "import { hrtime as UnenvHrTime } from \"unenv/node/internal/process/hrtime\";\nimport { Process as UnenvProcess } from \"unenv/node/internal/process/process\";\nconst globalProcess = globalThis[\"process\"];\nexport const getBuiltinModule = globalProcess.getBuiltinModule;\nconst workerdProcess = getBuiltinModule(\"node:process\");\nconst isWorkerdProcessV2 = globalThis.Cloudflare.compatibilityFlags.enable_nodejs_process_v2;\nconst unenvProcess = new UnenvProcess({\n  env: globalProcess.env,\n  // `hrtime` is only available from workerd process v2\n  hrtime: isWorkerdProcessV2 ? workerdProcess.hrtime : UnenvHrTime,\n  // `nextTick` is available from workerd process v1\n  nextTick: workerdProcess.nextTick\n});\nexport const { exit, features, platform } = workerdProcess;\nexport const {\n  // Always implemented by workerd\n  env,\n  // Only implemented in workerd v2\n  hrtime,\n  // Always implemented by workerd\n  nextTick\n} = unenvProcess;\nexport const {\n  _channel,\n  _disconnect,\n  _events,\n  _eventsCount,\n  _handleQueue,\n  _maxListeners,\n  _pendingMessage,\n  _send,\n  assert,\n  disconnect,\n  mainModule\n} = unenvProcess;\nexport const {\n  // @ts-expect-error `_debugEnd` is missing typings\n  _debugEnd,\n  // @ts-expect-error `_debugProcess` is missing typings\n  _debugProcess,\n  // @ts-expect-error `_exiting` is missing typings\n  _exiting,\n  // @ts-expect-error `_fatalException` is missing typings\n  _fatalException,\n  // @ts-expect-error `_getActiveHandles` is missing typings\n  _getActiveHandles,\n  // @ts-expect-error `_getActiveRequests` is missing typings\n  _getActiveRequests,\n  // @ts-expect-error `_kill` is missing typings\n  _kill,\n  // @ts-expect-error `_linkedBinding` is missing typings\n  _linkedBinding,\n  // @ts-expect-error `_preload_modules` is missing typings\n  _preload_modules,\n  // @ts-expect-error `_rawDebug` is missing typings\n  _rawDebug,\n  // @ts-expect-error `_startProfilerIdleNotifier` is missing typings\n  _startProfilerIdleNotifier,\n  // @ts-expect-error `_stopProfilerIdleNotifier` is missing typings\n  _stopProfilerIdleNotifier,\n  // @ts-expect-error `_tickCallback` is missing typings\n  _tickCallback,\n  abort,\n  addListener,\n  allowedNodeEnvironmentFlags,\n  arch,\n  argv,\n  argv0,\n  availableMemory,\n  // @ts-expect-error `binding` is missing typings\n  binding,\n  channel,\n  chdir,\n  config,\n  connected,\n  constrainedMemory,\n  cpuUsage,\n  cwd,\n  debugPort,\n  dlopen,\n  // @ts-expect-error `domain` is missing typings\n  domain,\n  emit,\n  emitWarning,\n  eventNames,\n  execArgv,\n  execPath,\n  exitCode,\n  finalization,\n  getActiveResourcesInfo,\n  getegid,\n  geteuid,\n  getgid,\n  getgroups,\n  getMaxListeners,\n  getuid,\n  hasUncaughtExceptionCaptureCallback,\n  // @ts-expect-error `initgroups` is missing typings\n  initgroups,\n  kill,\n  listenerCount,\n  listeners,\n  loadEnvFile,\n  memoryUsage,\n  // @ts-expect-error `moduleLoadList` is missing typings\n  moduleLoadList,\n  off,\n  on,\n  once,\n  // @ts-expect-error `openStdin` is missing typings\n  openStdin,\n  permission,\n  pid,\n  ppid,\n  prependListener,\n  prependOnceListener,\n  rawListeners,\n  // @ts-expect-error `reallyExit` is missing typings\n  reallyExit,\n  ref,\n  release,\n  removeAllListeners,\n  removeListener,\n  report,\n  resourceUsage,\n  send,\n  setegid,\n  seteuid,\n  setgid,\n  setgroups,\n  setMaxListeners,\n  setSourceMapsEnabled,\n  setuid,\n  setUncaughtExceptionCaptureCallback,\n  sourceMapsEnabled,\n  stderr,\n  stdin,\n  stdout,\n  throwDeprecation,\n  title,\n  traceDeprecation,\n  umask,\n  unref,\n  uptime,\n  version,\n  versions\n} = isWorkerdProcessV2 ? workerdProcess : unenvProcess;\nconst _process = {\n  abort,\n  addListener,\n  allowedNodeEnvironmentFlags,\n  hasUncaughtExceptionCaptureCallback,\n  setUncaughtExceptionCaptureCallback,\n  loadEnvFile,\n  sourceMapsEnabled,\n  arch,\n  argv,\n  argv0,\n  chdir,\n  config,\n  connected,\n  constrainedMemory,\n  availableMemory,\n  cpuUsage,\n  cwd,\n  debugPort,\n  dlopen,\n  disconnect,\n  emit,\n  emitWarning,\n  env,\n  eventNames,\n  execArgv,\n  execPath,\n  exit,\n  finalization,\n  features,\n  getBuiltinModule,\n  getActiveResourcesInfo,\n  getMaxListeners,\n  hrtime,\n  kill,\n  listeners,\n  listenerCount,\n  memoryUsage,\n  nextTick,\n  on,\n  off,\n  once,\n  pid,\n  platform,\n  ppid,\n  prependListener,\n  prependOnceListener,\n  rawListeners,\n  release,\n  removeAllListeners,\n  removeListener,\n  report,\n  resourceUsage,\n  setMaxListeners,\n  setSourceMapsEnabled,\n  stderr,\n  stdin,\n  stdout,\n  title,\n  throwDeprecation,\n  traceDeprecation,\n  umask,\n  uptime,\n  version,\n  versions,\n  // @ts-expect-error old API\n  domain,\n  initgroups,\n  moduleLoadList,\n  reallyExit,\n  openStdin,\n  assert,\n  binding,\n  send,\n  exitCode,\n  channel,\n  getegid,\n  geteuid,\n  getgid,\n  getgroups,\n  getuid,\n  setegid,\n  seteuid,\n  setgid,\n  setgroups,\n  setuid,\n  permission,\n  mainModule,\n  _events,\n  _eventsCount,\n  _exiting,\n  _maxListeners,\n  _debugEnd,\n  _debugProcess,\n  _fatalException,\n  _getActiveHandles,\n  _getActiveRequests,\n  _kill,\n  _preload_modules,\n  _rawDebug,\n  _startProfilerIdleNotifier,\n  _stopProfilerIdleNotifier,\n  _tickCallback,\n  _disconnect,\n  _handleQueue,\n  _pendingMessage,\n  _channel,\n  _send,\n  _linkedBinding\n};\nexport default _process;\n", "import { default as defaultExport } from \"@cloudflare/unenv-preset/node/process\";\nglobalThis.process = defaultExport;", "import { Hono } from 'hono'\r\nimport bcrypt from 'bcryptjs'\r\nimport { createHmac } from 'crypto'\r\nimport { calculateNextOccurrence } from './utils/recurring.js'\r\nimport { getEventReminderEmail, shouldSendEventReminder } from './email-templates/event-reminder.js'\r\nimport {\r\n  createEmailVerificationToken,\r\n  verifyEmailVerificationToken,\r\n  getUserEmailPreferences,\r\n  updateUserEmailPreferences,\r\n  validateEmailPreferencesSession,\r\n  checkEmailVerificationRateLimit,\r\n  generateVerificationLink\r\n} from './auth-utils.js'\r\n\r\n// Replace generic cors with strict configurable CORS + debug logging\r\nconst app = new Hono()\r\napp.use('*', async (c, next) => {\r\n  const allowed = (c.env.ALLOWED_ORIGIN || '').split(',').map(s=>s.trim()).filter(Boolean)\r\n  const origin = c.req.header('Origin')\r\n  const debugMode = ['1','true','yes'].includes(String(c.req.query('debug') || c.env.DEBUG || '').toLowerCase())\r\n  \r\n  // Allow 'null' origin for local file testing (file:// protocol)\r\n  let allowOrigin = ''\r\n  if (origin === 'null' && c.env.ALLOW_LOCAL_TESTING === 'true') {\r\n    allowOrigin = '*'  // Allow any origin for local testing\r\n  } else if (origin && allowed.includes(origin)) {\r\n    allowOrigin = origin\r\n  }\r\n  \r\n  if (allowOrigin) c.res.headers.set('Access-Control-Allow-Origin', allowOrigin)\r\n  c.res.headers.set('Vary','Origin')\r\n  c.res.headers.set('Access-Control-Allow-Headers','Content-Type, Idempotency-Key, X-Session-Token, X-Admin-Key')\r\n  c.res.headers.set('Access-Control-Allow-Methods','GET,POST,PUT,DELETE,OPTIONS')\r\n  if (debugMode) {\r\n    try { console.log('CORS', { origin, allowOrigin, allowed }) } catch {}\r\n    c.res.headers.set('X-Debug-Origin', origin || '')\r\n    c.res.headers.set('X-Debug-Allow', allowOrigin || '')\r\n  }\r\n  if (c.req.method === 'OPTIONS') return new Response('', { headers: c.res.headers })\r\n  await next()\r\n})\r\n\r\n// Helpers\r\nconst addMonths = (date, months) => {\r\n  const d = new Date(date)\r\n  const day = d.getUTCDate()\r\n  const target = new Date(Date.UTC(d.getUTCFullYear(), d.getUTCMonth() + months + 1, 0))\r\n  const clampedDay = Math.min(day, target.getUTCDate())\r\n  return new Date(Date.UTC(d.getUTCFullYear(), d.getUTCMonth() + months, clampedDay, d.getUTCHours(), d.getUTCMinutes(), d.getUTCSeconds()))\r\n}\r\n\r\nconst toIso = (d) => new Date(d).toISOString()\r\n\r\n// Rate limiting storage (in-memory for this worker instance)\r\nconst checkoutRateLimits = new Map()\r\nconst membershipCheckoutRateLimits = new Map()\r\nconst eventCheckoutRateLimits = new Map()\r\n\r\n// Rate limiting helper function\r\nfunction checkRateLimit(ip, rateLimitMap, limit, windowMinutes) {\r\n  const now = Date.now()\r\n  const windowMs = windowMinutes * 60 * 1000\r\n  \r\n  if (rateLimitMap.has(ip)) {\r\n    const [timestamp, count] = rateLimitMap.get(ip)\r\n    \r\n    // Reset count if outside the time window\r\n    if (now - timestamp > windowMs) {\r\n      rateLimitMap.set(ip, [now, 1])\r\n      return true\r\n    }\r\n    \r\n    // Check if limit exceeded\r\n    if (count >= limit) {\r\n      return false\r\n    }\r\n    \r\n    // Increment count\r\n    rateLimitMap.set(ip, [timestamp, count + 1])\r\n    return true\r\n  }\r\n  \r\n  // First request from this IP\r\n  rateLimitMap.set(ip, [now, 1])\r\n  return true\r\n}\r\n\r\n// Webhook signature verification helper\r\nfunction verifySumUpWebhookSignature(payload, signature, webhookSecret) {\r\n  if (!signature || !webhookSecret) {\r\n    console.warn('Missing signature or webhook secret for verification')\r\n    return false\r\n  }\r\n  \r\n  try {\r\n    const expectedSignature = createHmac('sha256', webhookSecret)\r\n      .update(payload)\r\n      .digest('hex')\r\n    \r\n    // SumUp sends signature in format: sha256=hexdigest\r\n    const actualSignature = signature.startsWith('sha256=') \r\n      ? signature.substring(7) \r\n      : signature\r\n      \r\n    return expectedSignature === actualSignature\r\n  } catch (error) {\r\n    console.error('Webhook signature verification error:', error)\r\n    return false\r\n  }\r\n}\r\n\r\n// Webhook duplicate prevention helper\r\nasync function checkAndMarkWebhookProcessed(db, webhookId, entityType, entityId) {\r\n  try {\r\n    // Create webhook_logs table if it doesn't exist\r\n    await db.prepare(`\r\n      CREATE TABLE IF NOT EXISTS webhook_logs (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        webhook_id TEXT NOT NULL,\r\n        entity_type TEXT NOT NULL,\r\n        entity_id INTEGER NOT NULL,\r\n        processed_at TEXT NOT NULL DEFAULT (strftime('%Y-%m-%dT%H:%M:%fZ','now')),\r\n        payload TEXT,\r\n        UNIQUE(webhook_id, entity_type, entity_id)\r\n      )\r\n    `).run().catch(() => {})\r\n    \r\n    // Check if this webhook has already been processed\r\n    const existing = await db.prepare(\r\n      'SELECT * FROM webhook_logs WHERE webhook_id = ? AND entity_type = ? AND entity_id = ?'\r\n    ).bind(webhookId, entityType, entityId).first()\r\n    \r\n    if (existing) {\r\n      console.log(`Duplicate webhook detected (ID: ${webhookId}, Type: ${entityType}, Entity: ${entityId})`)\r\n      return true // Already processed\r\n    }\r\n    \r\n    // Mark this webhook as processed\r\n    await db.prepare(\r\n      'INSERT INTO webhook_logs (webhook_id, entity_type, entity_id, payload) VALUES (?, ?, ?, ?)'\r\n    ).bind(webhookId, entityType, entityId, JSON.stringify({ webhookId, entityType, entityId })).run()\r\n    \r\n    return false // Not a duplicate\r\n  } catch (error) {\r\n    console.error('Error checking webhook duplicate:', error)\r\n    return false // Continue processing if there's an error\r\n  }\r\n}\r\n\r\n// Stock reservation helper functions\r\nasync function reserveStock(db, productId, quantity) {\r\n  try {\r\n    // Create stock_reservations table if it doesn't exist\r\n    await db.prepare(`\r\n      CREATE TABLE IF NOT EXISTS stock_reservations (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        product_id INTEGER NOT NULL,\r\n        quantity INTEGER NOT NULL,\r\n        order_id INTEGER,\r\n        checkout_id TEXT,\r\n        status TEXT NOT NULL DEFAULT 'reserved',\r\n        created_at TEXT NOT NULL DEFAULT (strftime('%Y-%m-%dT%H:%M:%fZ','now')),\r\n        expires_at TEXT NOT NULL,\r\n        UNIQUE(product_id, order_id)\r\n      )\r\n    `).run().catch(() => {})\r\n    \r\n    // Check available stock\r\n    const product = await db.prepare('SELECT stock_quantity FROM products WHERE id = ?').bind(productId).first()\r\n    if (!product) {\r\n      throw new Error('Product not found')\r\n    }\r\n    \r\n    // Check if there's enough stock available (considering existing reservations)\r\n    const existingReservations = await db.prepare(\r\n      'SELECT SUM(quantity) as reserved FROM stock_reservations WHERE product_id = ? AND status = \"reserved\"'\r\n    ).bind(productId).first()\r\n    \r\n    const reservedQuantity = existingReservations?.reserved || 0\r\n    const availableStock = product.stock_quantity - reservedQuantity\r\n    \r\n    if (availableStock < quantity) {\r\n      throw new Error(`Insufficient available stock: ${availableStock} available, ${quantity} requested`)\r\n    }\r\n    \r\n    // Reserve the stock\r\n    const expiresAt = new Date(Date.now() + 1 * 60 * 60 * 1000).toISOString() // 1 hour reservation\r\n    await db.prepare(\r\n      'INSERT INTO stock_reservations (product_id, quantity, status, expires_at) VALUES (?, ?, ?, ?)'\r\n    ).bind(productId, quantity, 'reserved', expiresAt).run()\r\n    \r\n    return true\r\n  } catch (error) {\r\n    console.error('Stock reservation error:', error)\r\n    throw error\r\n  }\r\n}\r\n\r\nasync function releaseStockReservation(db, productId, orderId) {\r\n  try {\r\n    await db.prepare(\r\n      'UPDATE stock_reservations SET status = \"released\" WHERE product_id = ? AND order_id = ? AND status = \"reserved\"'\r\n    ).bind(productId, orderId).run()\r\n  } catch (error) {\r\n    console.error('Stock release error:', error)\r\n    // Don't throw to avoid breaking the flow\r\n  }\r\n}\r\n\r\nasync function commitStockReservation(db, productId, orderId) {\r\n  try {\r\n    // Update reservation status\r\n    await db.prepare(\r\n      'UPDATE stock_reservations SET status = \"committed\" WHERE product_id = ? AND order_id = ? AND status = \"reserved\"'\r\n    ).bind(productId, orderId).run()\r\n    \r\n    // Reduce actual stock\r\n    const reservation = await db.prepare(\r\n      'SELECT quantity FROM stock_reservations WHERE product_id = ? AND order_id = ? AND status = \"committed\"'\r\n    ).bind(productId, orderId).first()\r\n    \r\n    if (reservation) {\r\n      await db.prepare(\r\n        'UPDATE products SET stock_quantity = stock_quantity - ? WHERE id = ?'\r\n      ).bind(reservation.quantity, productId).run()\r\n    }\r\n  } catch (error) {\r\n    console.error('Stock commitment error:', error)\r\n    throw error\r\n  }\r\n}\r\n\r\n// Cleanup expired stock reservations (should be called periodically)\r\nasync function cleanupExpiredStockReservations(db) {\r\n  try {\r\n    const now = new Date().toISOString()\r\n    const expiredReservations = await db.prepare(\r\n      'SELECT * FROM stock_reservations WHERE status = \"reserved\" AND expires_at < ?'\r\n    ).bind(now).all()\r\n    \r\n    for (const reservation of expiredReservations.results || []) {\r\n      await db.prepare(\r\n        'UPDATE stock_reservations SET status = \"expired\" WHERE id = ?'\r\n      ).bind(reservation.id).run()\r\n    }\r\n    \r\n    return expiredReservations.results?.length || 0\r\n  } catch (error) {\r\n    console.error('Stock reservation cleanup error:', error)\r\n    return 0\r\n  }\r\n}\r\n\r\n// --- Schema compatibility helpers ---\r\nlet __schemaCache\r\nasync function getSchema(db){\r\n  if (__schemaCache) return __schemaCache\r\n  // Current schema uses user_id for all foreign keys\r\n  const fkColumn = 'user_id'\r\n  const identityTable = 'users'\r\n  const idColumn = 'user_id'\r\n  __schemaCache = { fkColumn, identityTable, idColumn }\r\n  return __schemaCache\r\n}\r\n\r\nasync function ensureSchema(db, fkColumn){\r\n  // memberships columns only (assume tickets already has user_id from migrations)\r\n  try {\r\n    const mc = await db.prepare('PRAGMA table_info(memberships)').all().catch(()=>({ results: [] }))\r\n    const mnames = new Set((mc?.results||[]).map(r => String(r.name||'').toLowerCase()))\r\n    const alter = []\r\n    if (!mnames.has('amount')) alter.push('ALTER TABLE memberships ADD COLUMN amount TEXT')\r\n    if (!mnames.has('currency')) alter.push('ALTER TABLE memberships ADD COLUMN currency TEXT')\r\n    if (!mnames.has('consent_at')) alter.push('ALTER TABLE memberships ADD COLUMN consent_at TEXT')\r\n    if (!mnames.has('idempotency_key')) alter.push('ALTER TABLE memberships ADD COLUMN idempotency_key TEXT')\r\n    if (!mnames.has('payment_status')) alter.push('ALTER TABLE memberships ADD COLUMN payment_status TEXT')\r\n    if (!mnames.has('payment_instrument_id')) alter.push('ALTER TABLE memberships ADD COLUMN payment_instrument_id TEXT')\r\n    if (!mnames.has('renewal_failed_at')) alter.push('ALTER TABLE memberships ADD COLUMN renewal_failed_at TEXT')\r\n    if (!mnames.has('renewal_attempts')) alter.push('ALTER TABLE memberships ADD COLUMN renewal_attempts INTEGER DEFAULT 0')\r\n    if (!mnames.has('renewal_warning_sent')) alter.push('ALTER TABLE memberships ADD COLUMN renewal_warning_sent INTEGER DEFAULT 0')\r\n    for (const sql of alter) { await db.prepare(sql).run().catch(()=>{}) }\r\n  } catch {}\r\n  // tickets columns (post consolidation, expect user_id)\r\n  try {\r\n    const tc = await db.prepare('PRAGMA table_info(tickets)').all().catch(()=>({ results: [] }))\r\n    const tnames = new Set((tc?.results||[]).map(r => String(r.name||'').toLowerCase()))\r\n    const talter = []\r\n    if (!tnames.has('amount')) talter.push('ALTER TABLE tickets ADD COLUMN amount TEXT')\r\n    if (!tnames.has('currency')) talter.push('ALTER TABLE tickets ADD COLUMN currency TEXT')\r\n    if (!tnames.has('consent_at')) talter.push('ALTER TABLE tickets ADD COLUMN consent_at TEXT')\r\n    if (!tnames.has('idempotency_key')) talter.push('ALTER TABLE tickets ADD COLUMN idempotency_key TEXT')\r\n    if (!tnames.has('payment_status')) talter.push('ALTER TABLE tickets ADD COLUMN payment_status TEXT')\r\n    if (!tnames.has('created_at')) talter.push('ALTER TABLE tickets ADD COLUMN created_at TEXT')\r\n    for (const sql of talter) { await db.prepare(sql).run().catch(()=>{}) }\r\n  } catch {}\r\n  // Create payment_instruments table if not exists\r\n  try {\r\n    await db.prepare(`\r\n      CREATE TABLE IF NOT EXISTS payment_instruments (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        user_id INTEGER NOT NULL,\r\n        instrument_id TEXT NOT NULL,\r\n        card_type TEXT,\r\n        last_4 TEXT,\r\n        expiry_month INTEGER,\r\n        expiry_year INTEGER,\r\n        created_at TEXT NOT NULL,\r\n        updated_at TEXT NOT NULL,\r\n        is_active INTEGER DEFAULT 1,\r\n        UNIQUE(user_id, instrument_id)\r\n      )\r\n    `).run().catch(()=>{})\r\n  } catch {}\r\n  // Create renewal_log table for tracking renewal attempts\r\n  try {\r\n    await db.prepare(`\r\n      CREATE TABLE IF NOT EXISTS renewal_log (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        membership_id INTEGER NOT NULL,\r\n        attempt_date TEXT NOT NULL,\r\n        status TEXT NOT NULL,\r\n        payment_id TEXT,\r\n        error_message TEXT,\r\n        amount TEXT,\r\n        currency TEXT\r\n      )\r\n    `).run().catch(()=>{})\r\n  } catch {}\r\n  // Create transactions table for all payment records\r\n  try {\r\n    await db.prepare(`\r\n      CREATE TABLE IF NOT EXISTS transactions (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        transaction_type TEXT NOT NULL,\r\n        reference_id INTEGER,\r\n        user_id INTEGER,\r\n        email TEXT,\r\n        name TEXT,\r\n        order_ref TEXT UNIQUE,\r\n        checkout_id TEXT,\r\n        payment_id TEXT,\r\n        amount TEXT,\r\n        currency TEXT,\r\n        payment_status TEXT,\r\n        idempotency_key TEXT,\r\n        consent_at TEXT,\r\n        created_at TEXT NOT NULL DEFAULT (strftime('%Y-%m-%dT%H:%M:%fZ','now')),\r\n        updated_at TEXT\r\n      )\r\n    `).run().catch(()=>{})\r\n  } catch {}\r\n  \r\n  // Create products table for shop items\r\n  try {\r\n    await db.prepare(`\r\n      CREATE TABLE IF NOT EXISTS products (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        name TEXT NOT NULL,\r\n        slug TEXT UNIQUE NOT NULL,\r\n        description TEXT,\r\n        price INTEGER NOT NULL,\r\n        currency TEXT DEFAULT 'GBP',\r\n        stock_quantity INTEGER DEFAULT 0,\r\n        image_url TEXT,\r\n        category TEXT,\r\n        is_active INTEGER DEFAULT 1,\r\n        created_at TEXT NOT NULL DEFAULT (strftime('%Y-%m-%dT%H:%M:%fZ','now')),\r\n        updated_at TEXT NOT NULL DEFAULT (strftime('%Y-%m-%dT%H:%M:%fZ','now'))\r\n      )\r\n    `).run().catch(()=>{})\r\n  } catch {}\r\n  \r\n  // Create orders table for shop purchases\r\n  try {\r\n    await db.prepare(`\r\n      CREATE TABLE IF NOT EXISTS orders (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        order_number TEXT UNIQUE NOT NULL,\r\n        user_id INTEGER,\r\n        email TEXT NOT NULL,\r\n        name TEXT NOT NULL,\r\n        status TEXT DEFAULT 'pending',\r\n        subtotal INTEGER NOT NULL,\r\n        tax INTEGER DEFAULT 0,\r\n        shipping INTEGER DEFAULT 0,\r\n        total INTEGER NOT NULL,\r\n        currency TEXT DEFAULT 'GBP',\r\n        checkout_id TEXT,\r\n        payment_id TEXT,\r\n        payment_status TEXT,\r\n        shipping_address TEXT,\r\n        billing_address TEXT,\r\n        notes TEXT,\r\n        created_at TEXT NOT NULL DEFAULT (strftime('%Y-%m-%dT%H:%M:%fZ','now')),\r\n        updated_at TEXT NOT NULL DEFAULT (strftime('%Y-%m-%dT%H:%M:%fZ','now')),\r\n        completed_at TEXT\r\n      )\r\n    `).run().catch(()=>{})\r\n  } catch {}\r\n  \r\n  // Create order_items table for items in each order\r\n  try {\r\n    await db.prepare(`\r\n      CREATE TABLE IF NOT EXISTS order_items (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        order_id INTEGER NOT NULL,\r\n        product_id INTEGER NOT NULL,\r\n        product_name TEXT NOT NULL,\r\n        quantity INTEGER NOT NULL,\r\n        unit_price INTEGER NOT NULL,\r\n        subtotal INTEGER NOT NULL,\r\n        FOREIGN KEY (order_id) REFERENCES orders(id),\r\n        FOREIGN KEY (product_id) REFERENCES products(id)\r\n      )\r\n    `).run().catch(()=>{})\r\n  } catch {}\r\n  \r\n  // Create cart_items table for temporary shopping carts\r\n  try {\r\n    await db.prepare(`\r\n      CREATE TABLE IF NOT EXISTS cart_items (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        session_id TEXT NOT NULL,\r\n        product_id INTEGER NOT NULL,\r\n        quantity INTEGER NOT NULL DEFAULT 1,\r\n        created_at TEXT NOT NULL DEFAULT (strftime('%Y-%m-%dT%H:%M:%fZ','now')),\r\n        updated_at TEXT NOT NULL DEFAULT (strftime('%Y-%m-%dT%H:%M:%fZ','now')),\r\n        UNIQUE(session_id, product_id),\r\n        FOREIGN KEY (product_id) REFERENCES products(id)\r\n      )\r\n    `).run().catch(()=>{})\r\n  } catch {}\r\n  \r\n  // Create email_history table for tracking sent emails\r\n  try {\r\n    await db.prepare(`\r\n      CREATE TABLE IF NOT EXISTS email_history (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        email_type TEXT NOT NULL,\r\n        recipient_email TEXT NOT NULL,\r\n        recipient_name TEXT,\r\n        subject TEXT NOT NULL,\r\n        template_used TEXT NOT NULL,\r\n        related_id INTEGER,\r\n        related_type TEXT,\r\n        sent_at TEXT NOT NULL DEFAULT (strftime('%Y-%m-%dT%H:%M:%fZ','now')),\r\n        status TEXT DEFAULT 'sent',\r\n        error_message TEXT,\r\n        metadata TEXT\r\n      )\r\n    `).run().catch(()=>{})\r\n  } catch {}\r\n}\r\n\r\n// One-time migration: copy payment data from memberships/tickets to transactions\r\nasync function migrateToTransactions(db) {\r\n  try {\r\n    // Check if migration already ran\r\n    const check = await db.prepare('SELECT COUNT(*) as count FROM transactions').first()\r\n    if (check && check.count > 0) {\r\n      console.log('Transactions table already has data, skipping migration')\r\n      return\r\n    }\r\n    \r\n    console.log('Starting migration to transactions table...')\r\n    \r\n    // Migrate memberships\r\n    const memberships = await db.prepare(`\r\n      SELECT id, user_id, email, name, order_ref, checkout_id, payment_id, amount, currency, \r\n             payment_status, idempotency_key, consent_at, created_at\r\n      FROM memberships\r\n      WHERE order_ref IS NOT NULL OR checkout_id IS NOT NULL\r\n    `).all()\r\n    \r\n    for (const m of (memberships.results || [])) {\r\n      await db.prepare(`\r\n        INSERT INTO transactions (transaction_type, reference_id, user_id, email, name, order_ref, \r\n                                  checkout_id, payment_id, amount, currency, payment_status, \r\n                                  idempotency_key, consent_at, created_at)\r\n        VALUES ('membership', ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\r\n      `).bind(\r\n        m.id, m.user_id, m.email, m.name, m.order_ref, m.checkout_id, m.payment_id,\r\n        m.amount, m.currency, m.payment_status, m.idempotency_key, m.consent_at,\r\n        m.created_at || toIso(new Date())\r\n      ).run().catch(e => console.error('Failed to migrate membership', m.id, e))\r\n    }\r\n    \r\n    // Migrate tickets\r\n    const tickets = await db.prepare(`\r\n      SELECT id, user_id, order_ref, checkout_id, payment_id, amount, currency,\r\n             payment_status, idempotency_key, consent_at, created_at\r\n      FROM tickets\r\n      WHERE order_ref IS NOT NULL OR checkout_id IS NOT NULL\r\n    `).all()\r\n    \r\n    for (const t of (tickets.results || [])) {\r\n      // Get email/name from user if available\r\n      let email = null, name = null\r\n      if (t.user_id) {\r\n        const user = await db.prepare('SELECT email, name FROM users WHERE user_id = ?').bind(t.user_id).first()\r\n        email = user?.email\r\n        name = user?.name\r\n      }\r\n      \r\n      await db.prepare(`\r\n        INSERT INTO transactions (transaction_type, reference_id, user_id, email, name, order_ref,\r\n                                  checkout_id, payment_id, amount, currency, payment_status,\r\n                                  idempotency_key, consent_at, created_at)\r\n        VALUES ('ticket', ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\r\n      `).bind(\r\n        t.id, t.user_id, email, name, t.order_ref, t.checkout_id, t.payment_id,\r\n        t.amount, t.currency, t.payment_status, t.idempotency_key, t.consent_at,\r\n        t.created_at || toIso(new Date())\r\n      ).run().catch(e => console.error('Failed to migrate ticket', t.id, e))\r\n    }\r\n    \r\n    console.log(`Migrated ${memberships.results?.length || 0} memberships and ${tickets.results?.length || 0} tickets to transactions`)\r\n  } catch (e) {\r\n    console.error('Migration to transactions failed:', e)\r\n  }\r\n}\r\n\r\nasync function findIdentityByEmail(db, email){\r\n  const s = await getSchema(db)\r\n  // Use case-insensitive email lookup\r\n  const row = await db.prepare(`SELECT * FROM ${s.identityTable} WHERE LOWER(email) = LOWER(?)`).bind(email).first()\r\n  if (!row) return null\r\n  if (typeof row.id === 'undefined') row.id = row[s.idColumn]\r\n  return row\r\n}\r\n\r\nasync function getOrCreateIdentity(db, email, name){\r\n  const s = await getSchema(db)\r\n  // Normalize email to lowercase for case-insensitive comparison\r\n  const normalizedEmail = email?.toLowerCase()\r\n  \r\n  let existing = await db.prepare(`SELECT * FROM ${s.identityTable} WHERE LOWER(email) = LOWER(?)`).bind(email).first()\r\n  if (existing){ \r\n    if (typeof existing.id === 'undefined') existing.id = existing[s.idColumn]; \r\n    return existing \r\n  }\r\n  \r\n  // Store the original email but use normalized version for lookups\r\n  await db.prepare(`INSERT INTO ${s.identityTable} (email, name) VALUES (?, ?)`).bind(email, name || null).run()\r\n  existing = await db.prepare(`SELECT * FROM ${s.identityTable} WHERE LOWER(email) = LOWER(?)`).bind(email).first()\r\n  if (existing && typeof existing.id === 'undefined') existing.id = existing[s.idColumn]\r\n  return existing\r\n}\r\n\r\nasync function getActiveMembership(db, identityId) {\r\n  const now = new Date().toISOString()\r\n  return await db.prepare(`SELECT * FROM memberships WHERE user_id = ? AND status = \"active\" AND end_date >= ? ORDER BY end_date DESC LIMIT 1`).bind(identityId, now).first()\r\n}\r\n\r\n// Fetch pricing/details for a plan from the services table\r\nasync function getServiceForPlan(db, planCode) {\r\n  return await db.prepare('SELECT * FROM services WHERE code = ? AND active = 1 LIMIT 1').bind(planCode).first()\r\n}\r\n\r\n// Obtain SumUp OAuth token to verify payments server-side\r\nasync function sumupToken(env, scopes = 'payments') {\r\n  const body = new URLSearchParams({ grant_type: 'client_credentials', client_id: env.SUMUP_CLIENT_ID, client_secret: env.SUMUP_CLIENT_SECRET, scope: scopes })\r\n  const res = await fetch('https://api.sumup.com/token', { method: 'POST', headers: { 'Content-Type': 'application/x-www-form-urlencoded' }, body })\r\n  if (!res.ok) { const txt = await res.text().catch(()=>{}); throw new Error(`Failed to get SumUp token (${res.status}): ${txt}`) }\r\n  const json = await res.json(); \r\n  const granted = (json.scope||'').split(/\\s+/).filter(Boolean)\r\n  const required = scopes.split(/\\s+/).filter(Boolean)\r\n  const missing = required.filter(s => !granted.includes(s))\r\n  if (missing.length > 0) { throw new Error(`SumUp OAuth token missing required scopes: ${missing.join(', ')} (granted: [${granted.join(', ')}])`) }\r\n  return json\r\n}\r\n\r\n// Create or get SumUp customer for a user\r\nasync function getOrCreateSumUpCustomer(env, user) {\r\n  console.log('getOrCreateSumUpCustomer called with user:', JSON.stringify(user))\r\n  const { access_token } = await sumupToken(env, 'payments payment_instruments')\r\n  const userId = user.user_id || user.id\r\n  console.log('Resolved userId:', userId, 'from user.user_id:', user.user_id, 'or user.id:', user.id)\r\n  const customerId = `USER-${userId}`\r\n  console.log('Customer ID to use:', customerId)\r\n  \r\n  // Try to get existing customer first\r\n  const getRes = await fetch(`https://api.sumup.com/v0.1/customers/${customerId}`, {\r\n    headers: { \r\n      'Authorization': `Bearer ${access_token}`,\r\n      'Content-Type': 'application/json'\r\n    }\r\n  })\r\n  \r\n  if (getRes.ok) {\r\n    const customer = await getRes.json()\r\n    console.log('Found existing SumUp customer:', customerId)\r\n    return customer.customer_id\r\n  }\r\n  \r\n  // Customer doesn't exist, create new one\r\n  console.log('Creating new SumUp customer:', customerId)\r\n  const createRes = await fetch('https://api.sumup.com/v0.1/customers', {\r\n    method: 'POST',\r\n    headers: {\r\n      'Authorization': `Bearer ${access_token}`,\r\n      'Content-Type': 'application/json'\r\n    },\r\n    body: JSON.stringify({\r\n      customer_id: customerId,\r\n      personal_details: {\r\n        email: user.email,\r\n        first_name: user.name ? user.name.split(' ')[0] : 'Customer',\r\n        last_name: user.name ? user.name.split(' ').slice(1).join(' ') || 'Member' : 'Member'\r\n      }\r\n    })\r\n  })\r\n  \r\n  if (!createRes.ok) {\r\n    const txt = await createRes.text()\r\n    console.error('Failed to create SumUp customer:', createRes.status, txt)\r\n    throw new Error(`Failed to create SumUp customer (${createRes.status}): ${txt}`)\r\n  }\r\n  \r\n  const customer = await createRes.json()\r\n  console.log('Created SumUp customer - Full response:', JSON.stringify(customer))\r\n  console.log('Returning customer_id:', customer.customer_id)\r\n  return customer.customer_id\r\n}\r\n\r\nasync function createCheckout(env, { amount, currency, orderRef, title, description, savePaymentInstrument = false, customerId = null }) {\r\n  const { access_token } = await sumupToken(env, savePaymentInstrument ? 'payments payment_instruments' : 'payments')\r\n  const body = { \r\n    amount: Number(amount), \r\n    currency, \r\n    checkout_reference: orderRef, \r\n    merchant_code: env.SUMUP_MERCHANT_CODE, \r\n    description: description || title\r\n  }\r\n  \r\n  // Add return_url if RETURN_URL is configured (for hosted checkout, not needed for widget)\r\n  if (env.RETURN_URL) {\r\n    try {\r\n      const returnUrl = new URL(env.RETURN_URL)\r\n      returnUrl.searchParams.set('orderRef', orderRef)\r\n      body.return_url = returnUrl.toString()\r\n    } catch (e) {\r\n      console.warn('Invalid RETURN_URL, skipping return_url in checkout:', e.message)\r\n    }\r\n  }\r\n  // Request card tokenization using SumUp's recurring payment flow\r\n  if (savePaymentInstrument && customerId) {\r\n    body.purpose = 'SETUP_RECURRING_PAYMENT'\r\n    body.customer_id = customerId\r\n  }\r\n  const res = await fetch('https://api.sumup.com/v0.1/checkouts', { method: 'POST', headers: { 'Authorization': `Bearer ${access_token}`, 'Content-Type': 'application/json' }, body: JSON.stringify(body) })\r\n  if (!res.ok) { const txt = await res.text(); throw new Error(`Create checkout failed: ${txt}`) }\r\n  const json = await res.json()\r\n  if (!json || !json.id) throw new Error('missing_checkout_id')\r\n  return json\r\n}\r\n\r\nasync function fetchPayment(env, paymentId) {\r\n  const { access_token } = await sumupToken(env, 'payments')\r\n  const res = await fetch(`https://api.sumup.com/v0.1/checkouts/${paymentId}`, { headers: { Authorization: `Bearer ${access_token}` } })\r\n  if (!res.ok) throw new Error('Failed to fetch payment')\r\n  return res.json()\r\n}\r\n\r\n// Save payment instrument from a successful payment\r\nasync function savePaymentInstrument(db, userId, checkoutId, env) {\r\n  try {\r\n    const { access_token } = await sumupToken(env, 'payments payment_instruments')\r\n    \r\n    // Get the checkout details\r\n    const checkoutRes = await fetch(`https://api.sumup.com/v0.1/checkouts/${checkoutId}`, {\r\n      headers: { Authorization: `Bearer ${access_token}` }\r\n    })\r\n    if (!checkoutRes.ok) {\r\n      console.error('Failed to fetch checkout:', checkoutRes.status, await checkoutRes.text())\r\n      return null\r\n    }\r\n    const checkout = await checkoutRes.json()\r\n    console.log('Checkout response for tokenization:', JSON.stringify(checkout))\r\n    \r\n    // With purpose=SETUP_RECURRING_PAYMENT, the payment_instrument should be in the response\r\n    if (checkout.payment_instrument) {\r\n      const instrument = checkout.payment_instrument\r\n      console.log('Found payment_instrument:', JSON.stringify(instrument))\r\n      \r\n      const now = toIso(new Date())\r\n      const instrumentId = instrument.token || instrument.id\r\n      \r\n      if (!instrumentId) {\r\n        console.error('Payment instrument missing token/id')\r\n        return null\r\n      }\r\n      \r\n      // Deactivate old instruments\r\n      await db.prepare('UPDATE payment_instruments SET is_active = 0 WHERE user_id = ?').bind(userId).run()\r\n      \r\n      // Save new instrument\r\n      await db.prepare(`\r\n        INSERT INTO payment_instruments (user_id, instrument_id, card_type, last_4, expiry_month, expiry_year, created_at, updated_at, is_active)\r\n        VALUES (?, ?, ?, ?, ?, ?, ?, ?, 1)\r\n        ON CONFLICT(user_id, instrument_id) DO UPDATE SET is_active = 1, updated_at = ?\r\n      `).bind(\r\n        userId,\r\n        instrumentId,\r\n        instrument.type || instrument.card_type || null,\r\n        instrument.last_4_digits || instrument.last_4 || null,\r\n        instrument.expiry_month || null,\r\n        instrument.expiry_year || null,\r\n        now,\r\n        now,\r\n        now\r\n      ).run()\r\n      \r\n      console.log('Successfully saved payment instrument:', instrumentId)\r\n      return instrumentId\r\n    }\r\n    \r\n    console.warn('No payment_instrument found in checkout response')\r\n    console.warn('Ensure purpose=SETUP_RECURRING_PAYMENT and customer_id were set in checkout creation')\r\n    return null\r\n  } catch (e) {\r\n    console.error('Failed to save payment instrument:', e)\r\n    return null\r\n  }\r\n}\r\n\r\n// Charge a saved payment instrument\r\nasync function chargePaymentInstrument(env, userId, instrumentId, amount, currency, orderRef, description, db = null) {\r\n  try {\r\n    const { access_token } = await sumupToken(env, 'payments payment_instruments')\r\n    \r\n    // Verify customer exists in SumUp Customer API, create if missing\r\n    const customerId = `USER-${userId}`\r\n    const customerCheckRes = await fetch(`https://api.sumup.com/v0.1/customers/${customerId}`, {\r\n      headers: {\r\n        'Authorization': `Bearer ${access_token}`,\r\n        'Content-Type': 'application/json'\r\n      }\r\n    })\r\n    \r\n    if (!customerCheckRes.ok) {\r\n      console.log(`Customer ${customerId} not found in SumUp Customer API, attempting to create...`)\r\n      \r\n      // Get user details for customer creation\r\n      if (!db) {\r\n        throw new Error('Database connection required to create customer')\r\n      }\r\n      \r\n      const user = await db.prepare('SELECT email, name FROM users WHERE user_id = ?')\r\n        .bind(userId).first()\r\n      \r\n      if (!user) {\r\n        throw new Error(`User ${userId} not found in database`)\r\n      }\r\n      \r\n      // Create customer in SumUp\r\n      const nameParts = (user.name || 'Customer').split(' ')\r\n      const createCustomerRes = await fetch('https://api.sumup.com/v0.1/customers', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Authorization': `Bearer ${access_token}`,\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({\r\n          customer_id: customerId,\r\n          personal_details: {\r\n            email: user.email,\r\n            first_name: nameParts[0] || 'Customer',\r\n            last_name: nameParts.slice(1).join(' ') || ''\r\n          }\r\n        })\r\n      })\r\n      \r\n      if (!createCustomerRes.ok) {\r\n        const txt = await createCustomerRes.text()\r\n        throw new Error(`Failed to create customer in SumUp: ${txt}`)\r\n      }\r\n      \r\n      console.log(`Successfully created customer ${customerId} in SumUp`)\r\n    }\r\n    \r\n    // Create checkout\r\n    const checkoutBody = {\r\n      amount: Number(amount),\r\n      currency,\r\n      checkout_reference: orderRef,\r\n      merchant_code: env.SUMUP_MERCHANT_CODE,\r\n      description\r\n    }\r\n    \r\n    const checkoutRes = await fetch('https://api.sumup.com/v0.1/checkouts', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${access_token}`,\r\n        'Content-Type': 'application/json'\r\n      },\r\n      body: JSON.stringify(checkoutBody)\r\n    })\r\n    \r\n    if (!checkoutRes.ok) {\r\n      const txt = await checkoutRes.text()\r\n      throw new Error(`Checkout creation failed: ${txt}`)\r\n    }\r\n    \r\n    const checkout = await checkoutRes.json()\r\n    console.log('Created checkout for renewal:', checkout.id)\r\n    \r\n    // Process payment with the saved token\r\n    // Per SumUp documentation: Both token and customer_id fields are required for recurring payments\r\n    // The customer_id must match the customer that was used during SETUP_RECURRING_PAYMENT\r\n    const paymentBody = {\r\n      payment_type: 'card',\r\n      token: instrumentId,\r\n      customer_id: customerId\r\n    }\r\n    \r\n    const paymentRes = await fetch(`https://api.sumup.com/v0.1/checkouts/${checkout.id}`, {\r\n      method: 'PUT',\r\n      headers: {\r\n        'Authorization': `Bearer ${access_token}`,\r\n        'Content-Type': 'application/json'\r\n      },\r\n      body: JSON.stringify(paymentBody)\r\n    })\r\n    \r\n    if (!paymentRes.ok) {\r\n      const txt = await paymentRes.text()\r\n      throw new Error(`Payment processing failed: ${txt}`)\r\n    }\r\n    \r\n    const payment = await paymentRes.json()\r\n    console.log('Processed recurring payment:', payment.id, payment.status)\r\n    return payment\r\n  } catch (e) {\r\n    console.error('Charge payment instrument error:', e)\r\n    throw e\r\n  }\r\n}\r\n\r\n// Get active payment instrument for user\r\nasync function getActivePaymentInstrument(db, userId) {\r\n  return await db.prepare('SELECT * FROM payment_instruments WHERE user_id = ? AND is_active = 1 ORDER BY created_at DESC LIMIT 1')\r\n    .bind(userId).first()\r\n}\r\n\r\n// Process renewal for a single membership\r\nasync function processMembershipRenewal(db, membership, env) {\r\n  const s = await getSchema(db)\r\n  const userId = membership.user_id\r\n  \r\n  // Get payment instrument\r\n  const instrument = await getActivePaymentInstrument(db, userId)\r\n  if (!instrument) {\r\n    await db.prepare('UPDATE memberships SET renewal_failed_at = ?, renewal_attempts = renewal_attempts + 1 WHERE id = ?')\r\n      .bind(toIso(new Date()), membership.id).run()\r\n    await db.prepare('INSERT INTO renewal_log (membership_id, attempt_date, status, error_message) VALUES (?, ?, ?, ?)')\r\n      .bind(membership.id, toIso(new Date()), 'failed', 'No active payment instrument').run()\r\n    return { success: false, error: 'no_instrument' }\r\n  }\r\n  \r\n  // Get service details\r\n  const svc = await getServiceForPlan(db, membership.plan)\r\n  if (!svc) {\r\n    return { success: false, error: 'plan_not_found' }\r\n  }\r\n  \r\n  const amount = Number(svc.amount)\r\n  const currency = svc.currency || env.CURRENCY || 'GBP'\r\n  const orderRef = `RENEWAL-${membership.id}-${crypto.randomUUID()}`\r\n    try {\r\n    // Charge the payment instrument\r\n    const payment = await chargePaymentInstrument(\r\n      env,\r\n      userId,\r\n      instrument.instrument_id,\r\n      amount,\r\n      currency,\r\n      orderRef,\r\n      `Renewal: Dice Bastion ${membership.plan} membership`,\r\n      db  // Pass database connection for customer creation if needed\r\n    )\r\n    \r\n    // If successful, extend membership\r\n    if (payment && (payment.status === 'PAID' || payment.status === 'SUCCESSFUL')) {\r\n      const months = Number(svc.months || 0)\r\n      const currentEnd = new Date(membership.end_date)\r\n      const newEnd = addMonths(currentEnd, months)\r\n      \r\n      // Update membership\r\n      await db.prepare(`\r\n        UPDATE memberships \r\n        SET end_date = ?, \r\n            renewal_failed_at = NULL, \r\n            renewal_attempts = 0,\r\n            renewal_warning_sent = 0\r\n        WHERE id = ?\r\n      `).bind(toIso(newEnd), membership.id).run()\r\n      \r\n      // Create transaction record for renewal\r\n      const user = await db.prepare('SELECT email, name FROM users WHERE user_id = ?').bind(userId).first()\r\n      await db.prepare(`\r\n        INSERT INTO transactions (transaction_type, reference_id, user_id, email, name, order_ref,\r\n                                  payment_id, amount, currency, payment_status)\r\n        VALUES ('renewal', ?, ?, ?, ?, ?, ?, ?, ?, 'PAID')\r\n      `).bind(membership.id, userId, user?.email, user?.name, orderRef, payment.id, String(amount), currency).run()\r\n      \r\n      // Log renewal attempt\r\n      await db.prepare('INSERT INTO renewal_log (membership_id, attempt_date, status, payment_id, amount, currency) VALUES (?, ?, ?, ?, ?, ?)')\r\n        .bind(membership.id, toIso(new Date()), 'success', payment.id, String(amount), currency).run()\r\n      \r\n      // Send renewal success email\r\n      if (user) {\r\n        const emailContent = getRenewalSuccessEmail(membership, user, toIso(newEnd))\r\n        await sendEmail(env, { \r\n          to: user.email, \r\n          ...emailContent,\r\n          emailType: 'membership_renewal_success',\r\n          relatedId: membership.id,\r\n          relatedType: 'membership',\r\n          metadata: { plan: membership.plan, new_end_date: toIso(newEnd) }\r\n        }).catch(err => {\r\n          console.error('Renewal success email error:', err)\r\n        })\r\n      }\r\n      \r\n      return { success: true, newEndDate: toIso(newEnd), paymentId: payment.id }\r\n    } else {\r\n      throw new Error(`Payment not successful: ${payment?.status || 'UNKNOWN'}`)\r\n    }\r\n  } catch (e) {\r\n    const currentAttempts = (membership.renewal_attempts || 0) + 1\r\n    const errorMessage = String(e.message || e)\r\n    \r\n    // Check if error is due to invalid/expired token\r\n    const isTokenError = errorMessage.toLowerCase().includes('invalid') || \r\n                         errorMessage.toLowerCase().includes('expired') ||\r\n                         errorMessage.toLowerCase().includes('token') ||\r\n                         errorMessage.toLowerCase().includes('card')\r\n    \r\n    // Log the error\r\n    await db.prepare('UPDATE memberships SET renewal_failed_at = ?, renewal_attempts = ? WHERE id = ?')\r\n      .bind(toIso(new Date()), currentAttempts, membership.id).run()\r\n    await db.prepare('INSERT INTO renewal_log (membership_id, attempt_date, status, error_message, amount, currency) VALUES (?, ?, ?, ?, ?, ?)')\r\n      .bind(membership.id, toIso(new Date()), 'failed', errorMessage, String(amount), currency).run()\r\n    \r\n    // If token error, deactivate the instrument\r\n    if (isTokenError) {\r\n      console.log(`Deactivating expired/invalid payment instrument ${instrument.instrument_id} for user ${userId}`)\r\n      await db.prepare('UPDATE payment_instruments SET is_active = 0 WHERE instrument_id = ?')\r\n        .bind(instrument.instrument_id).run()\r\n      \r\n      // Disable auto-renewal since payment method is invalid\r\n      await db.prepare('UPDATE memberships SET auto_renew = 0 WHERE id = ?')\r\n        .bind(membership.id).run()\r\n    }\r\n    \r\n    // Get user for email notification\r\n    const user = await db.prepare('SELECT * FROM users WHERE user_id = ?').bind(userId).first()\r\n    \r\n    // If token error or 3rd failure, send final notice\r\n    if ((isTokenError || currentAttempts >= 3) && user) {\r\n      // Ensure auto-renew is disabled\r\n      await db.prepare('UPDATE memberships SET auto_renew = 0 WHERE id = ?').bind(membership.id).run()\r\n      \r\n      const emailContent = isTokenError \r\n        ? getExpiredPaymentMethodEmail(membership, user)\r\n        : getRenewalFailedFinalEmail(membership, user)\r\n        \r\n      await sendEmail(env, { \r\n        to: user.email, \r\n        ...emailContent,\r\n        emailType: isTokenError ? 'payment_method_expired' : 'membership_renewal_final_failed',\r\n        relatedId: membership.id,\r\n        relatedType: 'membership',\r\n        metadata: { plan: membership.plan, attempts: currentAttempts, token_error: isTokenError }\r\n      }).catch(err => {\r\n        console.error('Renewal failure email error:', err)\r\n      })\r\n    } else if (user) {\r\n      // Send regular failure notification (attempts 1 or 2)\r\n      const emailContent = getRenewalFailedEmail(membership, user, currentAttempts)\r\n      await sendEmail(env, { \r\n        to: user.email, \r\n        ...emailContent,\r\n        emailType: 'membership_renewal_failed',\r\n        relatedId: membership.id,\r\n        relatedType: 'membership',\r\n        metadata: { plan: membership.plan, attempt_number: currentAttempts }\r\n      }).catch(err => {\r\n        console.error('Renewal failed email error:', err)\r\n      })\r\n    }\r\n    \r\n    return { success: false, error: errorMessage, attempts: currentAttempts, token_error: isTokenError }\r\n  }\r\n}\r\n\r\n// Turnstile verification with optional debug logging\r\nasync function verifyTurnstile(env, token, ip, debug){\r\n  if (!env.TURNSTILE_SECRET) { if (debug) console.log('turnstile: secret missing -> bypass'); return true }\r\n  if (!token) { if (debug) console.log('turnstile: missing token'); return false }\r\n  \r\n  // Allow test bypass for local development\r\n  if (token === 'test-bypass' && env.ALLOW_TEST_BYPASS === 'true') {\r\n    if (debug) console.log('turnstile: test-bypass token accepted')\r\n    return true\r\n  }\r\n  \r\n  const form = new URLSearchParams(); form.set('secret', env.TURNSTILE_SECRET); form.set('response', token); if (ip) form.set('remoteip', ip)\r\n  let res, j = {};\r\n  try {\r\n    res = await fetch('https://challenges.cloudflare.com/turnstile/v0/siteverify', { method:'POST', body: form })\r\n    j = await res.json().catch(()=>({}))\r\n  } catch (e) {\r\n    if (debug) console.log('turnstile: siteverify fetch error', String(e))\r\n    return false\r\n  }\r\n  if (debug) console.log('turnstile: siteverify', { status: res?.status, success: j?.['success'], errors: j?.['error-codes'], hostname: j?.hostname })\r\n  return !!j.success\r\n}\r\n\r\nconst EMAIL_RE = /^[^@\\s]+@[^@\\s]+\\.[^@\\s]+$/\r\nconst UUID_RE = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i\r\nconst EVT_UUID_RE = /^EVT-\\d+-[0-9a-f\\-]{36}$/i\r\n\r\nfunction clampStr(v, max){ return (v||'').substring(0, max) }\r\n\r\n// Log email to history database\r\nasync function logEmailHistory(db, emailData) {\r\n  try {\r\n    await db.prepare(`\r\n      INSERT INTO email_history (\r\n        email_type, recipient_email, recipient_name, subject, template_used,\r\n        related_id, related_type, status, error_message, metadata\r\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\r\n    `).bind(\r\n      emailData.email_type,\r\n      emailData.recipient_email,\r\n      emailData.recipient_name || null,\r\n      emailData.subject,\r\n      emailData.template_used,\r\n      emailData.related_id || null,\r\n      emailData.related_type || null,\r\n      emailData.status || 'sent',\r\n      emailData.error_message || null,\r\n      emailData.metadata ? JSON.stringify(emailData.metadata) : null\r\n    ).run()\r\n    \r\n    return { success: true }\r\n  } catch (e) {\r\n    console.error('Email history logging error:', e)\r\n    return { success: false, error: String(e) }\r\n  }\r\n}\r\n\r\n// MailerSend email helper\r\nasync function sendEmail(env, { to, subject, html, text, emailType = 'transactional', relatedId = null, relatedType = null, metadata = null }) {\r\n  if (!env.MAILERSEND_API_KEY) {\r\n    console.warn('MAILERSEND_API_KEY not configured, skipping email')\r\n    return { skipped: true }\r\n  }\r\n  \r\n  try {\r\n    const body = {\r\n      from: { email: env.MAILERSEND_FROM_EMAIL || 'noreply@dicebastion.com', name: env.MAILERSEND_FROM_NAME || 'Dice Bastion' },\r\n      to: [{ email: to }],\r\n      subject,\r\n      html,\r\n      text: text || html.replace(/<[^>]*>/g, '')\r\n    }\r\n    \r\n    const res = await fetch('https://api.mailersend.com/v1/email', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${env.MAILERSEND_API_KEY}`,\r\n        'Content-Type': 'application/json'\r\n      },\r\n      body: JSON.stringify(body)\r\n    })\r\n    \r\n    if (!res.ok) {\r\n      const txt = await res.text()\r\n      console.error('MailerSend error:', txt)\r\n      \r\n      // Log failed email attempt\r\n      await logEmailHistory(env.DB, {\r\n        email_type: emailType,\r\n        recipient_email: to,\r\n        subject: subject,\r\n        template_used: emailType,\r\n        related_id: relatedId,\r\n        related_type: relatedType,\r\n        status: 'failed',\r\n        error_message: txt,\r\n        metadata: metadata\r\n      })\r\n      \r\n      return { success: false, error: txt }\r\n    }\r\n    \r\n    // Log successful email\r\n    await logEmailHistory(env.DB, {\r\n      email_type: emailType,\r\n      recipient_email: to,\r\n      subject: subject,\r\n      template_used: emailType,\r\n      related_id: relatedId,\r\n      related_type: relatedType,\r\n      status: 'sent',\r\n      metadata: metadata\r\n    })\r\n    \r\n    return { success: true }\r\n  } catch (e) {\r\n    console.error('Email send error:', e)\r\n    \r\n    // Log failed email attempt\r\n    await logEmailHistory(env.DB, {\r\n      email_type: emailType,\r\n      recipient_email: to,\r\n      subject: subject,\r\n      template_used: emailType,\r\n      related_id: relatedId,\r\n      related_type: relatedType,\r\n      status: 'failed',\r\n      error_message: String(e),\r\n      metadata: metadata\r\n    })\r\n    \r\n    return { success: false, error: String(e) }\r\n  }\r\n}\r\n\r\n// UTM Parameter Helper\r\nfunction addUtmParams(url, source = 'email', medium = 'transactional', campaign = null) {\r\n  try {\r\n    const baseUrl = new URL(url.startsWith('http') ? url : `https://${url}`)\r\n    baseUrl.searchParams.set('utm_source', source)\r\n    baseUrl.searchParams.set('utm_medium', medium)\r\n    if (campaign) baseUrl.searchParams.set('utm_campaign', campaign)\r\n    return baseUrl.toString()\r\n  } catch (e) {\r\n    console.error('UTM parameter error:', e)\r\n    return url\r\n  }\r\n}\r\n\r\n// Handle email preferences opt-in (only if user explicitly consents)\r\nasync function handleEmailPreferencesOptIn(db, userId, marketingConsent) {\r\n  if (!marketingConsent) return\r\n  \r\n  const now = toIso(new Date())\r\n  // Check if user already has preferences\r\n  const existingPrefs = await db.prepare(`\r\n    SELECT * FROM email_preferences WHERE user_id = ?\r\n  `).bind(userId).first()\r\n  \r\n  // Only create/update if no existing consent or explicitly opting in\r\n  if (!existingPrefs || !existingPrefs.consent_given) {\r\n    await db.prepare(`\r\n      INSERT OR REPLACE INTO email_preferences \r\n      (user_id, essential_emails, marketing_emails, consent_given, consent_date, last_updated)\r\n      VALUES (?, 1, 1, 1, ?, ?)\r\n    `).bind(userId, now, now).run()\r\n  }\r\n}\r\n\r\n// Generate admin notification email\r\nfunction getAdminNotificationEmail(purchaseType, details) {\r\n  const formatPrice = (pence) => `\u00A3${(pence / 100).toFixed(2)}`\r\n  \r\n  let subject, htmlContent, textContent\r\n  \r\n  switch (purchaseType) {\r\n    case 'membership':\r\n      subject = `\uD83D\uDCC8 New Membership Purchase: ${details.plan} Plan`\r\n      htmlContent = `\r\n        <h2>New Membership Purchase</h2>\r\n        <p><strong>Plan:</strong> ${details.plan}</p>\r\n        <p><strong>Customer:</strong> ${details.customerName} (${details.customerEmail})</p>\r\n        <p><strong>Amount:</strong> ${formatPrice(details.amount)}</p>\r\n        <p><strong>Auto-Renewal:</strong> ${details.autoRenew ? 'Yes' : 'No'}</p>\r\n        <p><strong>Purchase Date:</strong> ${new Date().toLocaleString('en-GB')}</p>\r\n        <p><strong>Membership ID:</strong> ${details.membershipId}</p>\r\n        <p><strong>Order Reference:</strong> ${details.orderRef}</p>\r\n      `\r\n      textContent = `\r\nNew Membership Purchase\r\n\r\nPlan: ${details.plan}\r\nCustomer: ${details.customerName} (${details.customerEmail})\r\nAmount: ${formatPrice(details.amount)}\r\nAuto-Renewal: ${details.autoRenew ? 'Yes' : 'No'}\r\nPurchase Date: ${new Date().toLocaleString('en-GB')}\r\nMembership ID: ${details.membershipId}\r\nOrder Reference: ${details.orderRef}\r\n      `.trim()\r\n      break\r\n    \r\n    case 'shop_order':\r\n      subject = `\uD83D\uDED2 New Shop Order: ${details.orderNumber}`\r\n      const itemsHtml = details.items.map(item => \r\n        `<li>${item.product_name} x ${item.quantity} - ${formatPrice(item.subtotal)}</li>`\r\n      ).join('')\r\n      \r\n      htmlContent = `\r\n        <h2>New Shop Order</h2>\r\n        <p><strong>Order Number:</strong> ${details.orderNumber}</p>\r\n        <p><strong>Customer:</strong> ${details.customerName} (${details.customerEmail})</p>\r\n        <p><strong>Total Amount:</strong> ${formatPrice(details.total)}</p>\r\n        <p><strong>Delivery Method:</strong> ${details.deliveryMethod}</p>\r\n        <p><strong>Purchase Date:</strong> ${new Date().toLocaleString('en-GB')}</p>\r\n        <p><strong>Items Ordered:</strong></p>\r\n        <ul>${itemsHtml}</ul>\r\n      `\r\n      textContent = `\r\nNew Shop Order\r\n\r\nOrder Number: ${details.orderNumber}\r\nCustomer: ${details.customerName} (${details.customerEmail})\r\nTotal Amount: ${formatPrice(details.total)}\r\nDelivery Method: ${details.deliveryMethod}\r\nPurchase Date: ${new Date().toLocaleString('en-GB')}\r\n\r\nItems Ordered:\r\n${details.items.map(item => `\u2022 ${item.product_name} x ${item.quantity} - ${formatPrice(item.subtotal)}`).join('\\n')}\r\n      `.trim()\r\n      break\r\n    \r\n    case 'event_ticket':\r\n      subject = `\uD83C\uDF9F\uFE0F New Event Ticket Purchase: ${details.eventName}`\r\n      htmlContent = `\r\n        <h2>New Event Ticket Purchase</h2>\r\n        <p><strong>Event:</strong> ${details.eventName}</p>\r\n        <p><strong>Customer:</strong> ${details.customerName} (${details.customerEmail})</p>\r\n        <p><strong>Amount:</strong> ${formatPrice(details.amount)}</p>\r\n        <p><strong>Event Date:</strong> ${new Date(details.eventDate).toLocaleString('en-GB')}</p>\r\n        <p><strong>Purchase Date:</strong> ${new Date().toLocaleString('en-GB')}</p>\r\n        <p><strong>Ticket ID:</strong> ${details.ticketId}</p>\r\n        <p><strong>Order Reference:</strong> ${details.orderRef}</p>\r\n      `\r\n      textContent = `\r\nNew Event Ticket Purchase\r\n\r\nEvent: ${details.eventName}\r\nCustomer: ${details.customerName} (${details.customerEmail})\r\nAmount: ${formatPrice(details.amount)}\r\nEvent Date: ${new Date(details.eventDate).toLocaleString('en-GB')}\r\nPurchase Date: ${new Date().toLocaleString('en-GB')}\r\nTicket ID: ${details.ticketId}\r\nOrder Reference: ${details.orderRef}\r\n      `.trim()\r\n      break\r\n    \r\n    default:\r\n      subject = `\uD83D\uDCB0 New Purchase Notification`\r\n      htmlContent = `\r\n        <h2>New Purchase Notification</h2>\r\n        <p><strong>Type:</strong> ${purchaseType}</p>\r\n        <p><strong>Customer:</strong> ${details.customerName} (${details.customerEmail})</p>\r\n        <p><strong>Amount:</strong> ${formatPrice(details.amount)}</p>\r\n        <p><strong>Purchase Date:</strong> ${new Date().toLocaleString('en-GB')}</p>\r\n      `\r\n      textContent = `\r\nNew Purchase Notification\r\n\r\nType: ${purchaseType}\r\nCustomer: ${details.customerName} (${details.customerEmail})\r\nAmount: ${formatPrice(details.amount)}\r\nPurchase Date: ${new Date().toLocaleString('en-GB')}\r\n      `.trim()\r\n  }\r\n  \r\n  return {\r\n    subject: `\uD83D\uDD14 ADMIN ALERT: ${subject}`,\r\n    html: `\r\n      <!DOCTYPE html>\r\n      <html>\r\n      <head>\r\n        <meta charset=\"utf-8\">\r\n        <title>${subject}</title>\r\n        <style>\r\n          body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\r\n          .header { background: #dc2626; color: white; padding: 1rem; text-align: center; }\r\n          .content { padding: 1rem; }\r\n          .footer { margin-top: 1rem; padding: 1rem; background: #f3f4f6; text-align: center; font-size: 0.9rem; color: #666; }\r\n          .alert-badge { display: inline-block; background: #dc2626; color: white; padding: 0.25rem 0.75rem; border-radius: 4px; font-size: 0.875rem; font-weight: bold; }\r\n        </style>\r\n      </head>\r\n      <body>\r\n        <div class=\"header\">\r\n          <h1>\uD83D\uDD14 DICE BASTION ADMIN ALERT</h1>\r\n          <div class=\"alert-badge\">NEW PURCHASE</div>\r\n        </div>\r\n        <div class=\"content\">\r\n          ${htmlContent}\r\n          <p style=\"margin-top: 1.5rem; font-size: 0.9rem; color: #666;\">\r\n            This is an automated notification from Dice Bastion. \r\n            Please do not reply to this email.\r\n          </p>\r\n        </div>\r\n        <div class=\"footer\">\r\n          <p>\u00A9 ${new Date().getFullYear()} Dice Bastion Gibraltar | Admin Dashboard: <a href=\"https://dicebastion.com/admin\">dicebastion.com/admin</a></p>\r\n        </div>\r\n      </body>\r\n      </html>\r\n    `,\r\n    text: `ADMIN ALERT: ${textContent}\\n\\nThis is an automated notification from Dice Bastion.`\r\n  }\r\n}\r\n\r\n// Generate email templates\r\nfunction getRenewalSuccessEmail(membership, user, newEndDate) {\r\n  const planNames = { monthly: 'Monthly', quarterly: 'Quarterly', annual: 'Annual' }\r\n  const planName = planNames[membership.plan] || membership.plan\r\n  \r\n  return {\r\n    subject: `Your Dice Bastion ${planName} Membership Has Been Renewed`,\r\n    html: `\r\n      <h2>Membership Renewed Successfully</h2>\r\n      <p>Hi ${user.name || 'there'},</p>\r\n      <p>Great news! Your <strong>${planName} Membership</strong> has been automatically renewed.</p>\r\n      <ul>\r\n        <li><strong>Plan:</strong> ${planName}</li>\r\n        <li><strong>Amount:</strong> \u00A3${membership.amount}</li>\r\n        <li><strong>New End Date:</strong> ${new Date(newEndDate).toLocaleDateString('en-GB', { year: 'numeric', month: 'long', day: 'numeric' })}</li>\r\n      </ul>\r\n      <p>Your membership will continue uninterrupted. If you wish to cancel auto-renewal, you can do so from your <a href=\"${addUtmParams('https://dicebastion.com/account', 'email', 'transactional', 'membership_renewal')}\">account page</a>.</p>\r\n      <p>Thank you for being a valued member!</p>\r\n      <p>\u2014 The Dice Bastion Team</p>\r\n    `\r\n  }\r\n}\r\n\r\nfunction getUpcomingRenewalEmail(membership, user, daysUntil) {\r\n  const planNames = { monthly: 'Monthly', quarterly: 'Quarterly', annual: 'Annual' }\r\n  const planName = planNames[membership.plan] || membership.plan\r\n  const renewalDate = new Date(membership.end_date).toLocaleDateString('en-GB', { \r\n    year: 'numeric', \r\n    month: 'long', \r\n    day: 'numeric' \r\n  })\r\n  \r\n  return {\r\n    subject: `Dice Bastion: Your ${planName} Membership Renews in ${daysUntil} Days`,\r\n    html: `\r\n      <h2>Your Membership Renews Soon</h2>\r\n      <p>Hi ${user.name || 'there'},</p>\r\n      <p>This is a friendly reminder that your <strong>${planName} Membership</strong> will automatically renew on <strong>${renewalDate}</strong>.</p>\r\n      <p><strong>Your membership details:</strong></p>\r\n      <ul>\r\n        <li>Plan: ${planName}</li>\r\n        <li>Renewal Date: ${renewalDate}</li>\r\n        <li>Payment Method: Card ending in ${membership.payment_instrument_last_4 || '\u2022\u2022\u2022\u2022'}</li>\r\n      </ul>\r\n      <p>Your card will be charged automatically, and your membership will continue uninterrupted.</p>\r\n      <p><strong>Need to make changes?</strong></p>\r\n      <ul>\r\n        <li>Update your payment method at <a href=\"${addUtmParams('https://dicebastion.com/memberships', 'email', 'transactional', 'renewal_reminder')}\">dicebastion.com/memberships</a></li>\r\n        <li>Cancel auto-renewal if you don't wish to continue</li>\r\n      </ul>\r\n      <p>Thank you for being part of the Dice Bastion community!</p>\r\n      <p>\u2014 The Dice Bastion Team</p>\r\n    `,\r\n    text: `Hi ${user.name || 'there'},\\n\\nYour ${planName} Membership will automatically renew on ${renewalDate}.\\n\\nYour card will be charged automatically. If you need to update your payment method or cancel auto-renewal, visit dicebastion.com/memberships.\\n\\nThank you!\\n\u2014 The Dice Bastion Team`\r\n  }\r\n}\r\n\r\nfunction getRenewalFailedEmail(membership, user, attemptNumber = 1) {\r\n  const planNames = { monthly: 'Monthly', quarterly: 'Quarterly', annual: 'Annual' }\r\n  const planName = planNames[membership.plan] || membership.plan\r\n  const attemptsRemaining = 3 - attemptNumber\r\n  \r\n  return {\r\n    subject: `Action Required: Dice Bastion Membership Renewal Failed (Attempt ${attemptNumber}/3)`,\r\n    html: `\r\n      <h2>Membership Renewal Payment Failed</h2>\r\n      <p>Hi ${user.name || 'there'},</p>\r\n      <p>We attempted to automatically renew your <strong>${planName} Membership</strong>, but the payment was unsuccessful.</p>\r\n      <p><strong>Important:</strong> Your membership expires on <strong>${new Date(membership.end_date).toLocaleDateString('en-GB', { year: 'numeric', month: 'long', day: 'numeric' })}</strong>.</p>\r\n      ${attemptsRemaining > 0 ? `\r\n        <p>We will automatically retry ${attemptsRemaining} more time${attemptsRemaining > 1 ? 's' : ''} before your expiration date. However, to ensure uninterrupted access, please update your payment method now.</p>\r\n      ` : ''}\r\n      <p><strong>What to do next:</strong></p>\r\n      <ul>\r\n        <li><strong>Recommended:</strong> Update your payment method at <a href=\"${addUtmParams('https://dicebastion.com/memberships', 'email', 'transactional', 'payment_failed')}\">dicebastion.com/memberships</a></li>\r\n        <li>Or purchase a new membership at <a href=\"${addUtmParams('https://dicebastion.com/memberships', 'email', 'transactional', 'payment_failed')}\">dicebastion.com/memberships</a></li>\r\n        <li>Contact us if you need help: <a href=\"mailto:support@dicebastion.com\">support@dicebastion.com</a></li>\r\n      </ul>\r\n      <p><strong>Common reasons for payment failure:</strong></p>\r\n      <ul>\r\n        <li>Card expired or was replaced</li>\r\n        <li>Insufficient funds</li>\r\n        <li>Card was reported lost/stolen</li>\r\n        <li>Bank declined the charge</li>\r\n      </ul>\r\n      <p>Thank you for your understanding!</p>\r\n      <p>\u2014 The Dice Bastion Team</p>\r\n    `,\r\n    text: `Hi ${user.name || 'there'},\\n\\nWe attempted to renew your ${planName} Membership, but the payment failed (attempt ${attemptNumber}/3).\\n\\nYour membership expires on ${new Date(membership.end_date).toLocaleDateString('en-GB')}.\\n\\nPlease update your payment method at dicebastion.com/memberships to avoid interruption.\\n\\n\u2014 The Dice Bastion Team`\r\n  }\r\n}\r\n\r\nfunction getRenewalFailedFinalEmail(membership, user) {\r\n  const planNames = { monthly: 'Monthly', quarterly: 'Quarterly', annual: 'Annual' }\r\n  const planName = planNames[membership.plan] || membership.plan\r\n  \r\n  return {\r\n    subject: `Urgent: Dice Bastion Membership Auto-Renewal Disabled`,\r\n    html: `\r\n      <h2>Auto-Renewal Disabled - Action Required</h2>\r\n      <p>Hi ${user.name || 'there'},</p>\r\n      <p>After 3 unsuccessful attempts to charge your payment method, we've <strong>disabled auto-renewal</strong> for your ${planName} Membership.</p>\r\n      <p><strong>Your membership will expire on ${new Date(membership.end_date).toLocaleDateString('en-GB', { year: 'numeric', month: 'long', day: 'numeric' })}</strong> and will not automatically renew.</p>\r\n      <div style=\"background: #fff3cd; border-left: 4px solid #856404; padding: 16px; margin: 20px 0;\">\r\n        <strong>\u26A0\uFE0F To continue your membership:</strong>\r\n        <p style=\"margin: 8px 0 0 0;\">You'll need to purchase a new membership after your current one expires.</p>\r\n      </div>\r\n      <p><strong>What to do now:</strong></p>\r\n      <ul>\r\n        <li><strong>Option 1:</strong> Purchase a new membership at <a href=\"${addUtmParams('https://dicebastion.com/memberships', 'email', 'transactional', 'auto_renewal_disabled')}\">dicebastion.com/memberships</a> (you can do this now or when your current membership expires)</li>\r\n        <li><strong>Option 2:</strong> Update your payment method and contact us to re-enable auto-renewal</li>\r\n        <li><strong>Need help?</strong> Email us at <a href=\"mailto:support@dicebastion.com\">support@dicebastion.com</a></li>\r\n      </ul>\r\n      <p>We'd love to keep you as a member! If you're experiencing payment issues, please reach out and we'll help resolve them.</p>\r\n      <p>\u2014 The Dice Bastion Team</p>\r\n    `,\r\n    text: `Hi ${user.name || 'there'},\\n\\nAfter 3 unsuccessful payment attempts, we've disabled auto-renewal for your ${planName} Membership.\\n\\nYour membership expires on ${new Date(membership.end_date).toLocaleDateString('en-GB')} and will NOT automatically renew.\\n\\nTo continue your membership, purchase a new one at dicebastion.com/memberships or contact us to re-enable auto-renewal.\\n\\n\u2014 The Dice Bastion Team`\r\n  }\r\n}\r\n\r\nfunction getExpiredPaymentMethodEmail(membership, user) {\r\n  const planNames = { monthly: 'Monthly', quarterly: 'Quarterly', annual: 'Annual' }\r\n  const planName = planNames[membership.plan] || membership.plan\r\n  \r\n  return {\r\n    subject: `Action Required: Update Your Payment Method - Dice Bastion`,\r\n    html: `\r\n      <h2>Payment Method Update Required</h2>\r\n      <p>Hi ${user.name || 'there'},</p>\r\n      <p>We attempted to renew your ${planName} Membership, but <strong>your saved payment method is no longer valid</strong>.</p>\r\n      <p>This could happen if your card:</p>\r\n      <ul>\r\n        <li>Has expired</li>\r\n        <li>Was cancelled or replaced by your bank</li>\r\n        <li>Has insufficient funds</li>\r\n      </ul>\r\n      <div style=\"background: #fff3cd; border-left: 4px solid #856404; padding: 16px; margin: 20px 0;\">\r\n        <strong>\u26A0\uFE0F Auto-renewal has been disabled</strong>\r\n        <p style=\"margin: 8px 0 0 0;\">Your membership will expire on <strong>${new Date(membership.end_date).toLocaleDateString('en-GB', { year: 'numeric', month: 'long', day: 'numeric' })}</strong> unless you take action.</p>\r\n      </div>\r\n      <p><strong>To continue your membership:</strong></p>\r\n      <ol>\r\n        <li>Visit <a href=\"${addUtmParams('https://dicebastion.com/memberships', 'email', 'transactional', 'payment_method_expired')}\">dicebastion.com/memberships</a></li>\r\n        <li>Purchase a new membership with your updated payment details</li>\r\n        <li>Enable auto-renewal during checkout to save your new payment method</li>\r\n      </ol>\r\n      <p><strong>Need help?</strong> Contact us at <a href=\"mailto:support@dicebastion.com\">support@dicebastion.com</a></p>\r\n      <p>We'd love to keep you as a member!</p>\r\n      <p>\u2014 The Dice Bastion Team</p>\r\n    `,\r\n    text: `Hi ${user.name || 'there'},\\n\\nWe couldn't renew your ${planName} Membership because your saved payment method is no longer valid.\\n\\nAuto-renewal has been disabled. Your membership expires on ${new Date(membership.end_date).toLocaleDateString('en-GB')}.\\n\\nTo continue: Visit dicebastion.com/memberships and purchase a new membership with your updated payment details.\\n\\nNeed help? Email support@dicebastion.com\\n\\n\u2014 The Dice Bastion Team`\r\n  }\r\n}\r\n\r\nfunction getTicketConfirmationEmail(event, user, transaction) {\r\n  const eventDate = new Date(event.event_date).toLocaleDateString('en-GB', { \r\n    weekday: 'long', \r\n    year: 'numeric', \r\n    month: 'long', \r\n    day: 'numeric' \r\n  })\r\n  const eventTime = event.event_time || 'TBC'\r\n  const amount = transaction.amount || '0.00'\r\n  const currency = transaction.currency || 'GBP'\r\n  const sym = currency === 'GBP' ? '\u00A3' : currency === 'EUR' ? '\u20AC' : '$'\r\n  \r\n  return {\r\n    subject: `Ticket Confirmed: ${event.event_name}`,\r\n    html: `\r\n      <h2>Your Ticket is Confirmed!</h2>\r\n      <p>Hi ${user.name || 'there'},</p>\r\n      <p>Thank you for purchasing a ticket to <strong>${event.event_name}</strong>!</p>\r\n      \r\n      <h3>Event Details:</h3>\r\n      <ul>\r\n        <li><strong>Event:</strong> ${event.event_name}</li>\r\n        <li><strong>Date:</strong> ${eventDate}</li>\r\n        <li><strong>Time:</strong> ${eventTime}</li>\r\n        <li><strong>Location:</strong> ${event.location || 'Dice Bastion'}</li>\r\n        ${event.description ? `<li><strong>Description:</strong> ${event.description}</li>` : ''}\r\n      </ul>\r\n      \r\n      <h3>Payment Details:</h3>\r\n      <ul>\r\n        <li><strong>Amount Paid:</strong> ${sym}${amount}</li>\r\n        <li><strong>Order Reference:</strong> ${transaction.order_ref}</li>\r\n      </ul>\r\n      \r\n      <p>Please bring this email or show your order reference at the event check-in.</p>\r\n      \r\n      ${event.additional_info ? `<p><strong>Important Information:</strong><br>${event.additional_info}</p>` : ''}\r\n      \r\n      <p>Looking forward to seeing you there!</p>\r\n      <p>\u2014 The Dice Bastion Team</p>\r\n    `,\r\n    text: `\r\nYour Ticket is Confirmed!\r\n\r\nHi ${user.name || 'there'},\r\n\r\nThank you for purchasing a ticket to ${event.event_name}!\r\n\r\nEVENT DETAILS:\r\n- Event: ${event.event_name}\r\n- Date: ${eventDate}\r\n- Time: ${eventTime}\r\n- Location: ${event.location || 'Dice Bastion'}\r\n${event.description ? `- Description: ${event.description}` : ''}\r\n\r\nPAYMENT DETAILS:\r\n- Amount Paid: ${sym}${amount}\r\n- Order Reference: ${transaction.order_ref}\r\n\r\nPlease bring this email or show your order reference at the event check-in.\r\n\r\n${event.additional_info ? `Important Information: ${event.additional_info}` : ''}\r\n\r\nLooking forward to seeing you there!\r\n\r\n\u2014 The Dice Bastion Team\r\n    `\r\n  }\r\n}\r\n\r\nfunction getWelcomeEmail(membership, user, autoRenew) {\r\n  const planNames = { monthly: 'Monthly', quarterly: 'Quarterly', annual: 'Annual' }\r\n  const planName = planNames[membership.plan] || membership.plan\r\n  \r\n  return {\r\n    subject: `Welcome to Dice Bastion ${planName} Membership!`,\r\n    html: `\r\n      <h2>Welcome to Dice Bastion!</h2>\r\n      <p>Hi ${user.name || 'there'},</p>\r\n      <p>Thank you for becoming a <strong>${planName} Member</strong>!</p>\r\n      <ul>\r\n        <li><strong>Plan:</strong> ${planName}</li>\r\n        <li><strong>Valid Until:</strong> ${new Date(membership.end_date).toLocaleDateString('en-GB', { year: 'numeric', month: 'long', day: 'numeric' })}</li>\r\n        <li><strong>Auto-Renewal:</strong> ${autoRenew ? 'Enabled \u2713' : 'Disabled'}</li>\r\n      </ul>\r\n      ${autoRenew ? '<p>Your membership will automatically renew before expiration. You can manage this at any time from your <a href=\"' + addUtmParams('https://dicebastion.com/account', 'email', 'transactional', 'welcome') + '\">account page</a>.</p>' : '<p>Remember to renew your membership before it expires to continue enjoying member benefits!</p>'}\r\n      <p><strong>Member Benefits:</strong></p>\r\n      <ul>\r\n        <li>Discounted event tickets</li>\r\n        <li>Priority booking for tournaments</li>\r\n        <li>Exclusive member events</li>\r\n        <li>And much more!</li>\r\n      </ul>\r\n      <p>See you at the club!</p>\r\n      <p>\u2014 The Dice Bastion Team</p>\r\n    `\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// GENERAL USER LOGIN/LOGOUT ENDPOINTS (for all users)\r\n// ============================================================================\r\n\r\n// General login endpoint - works for both admin and non-admin users\r\napp.post('/login', async c => {\r\n  try {\r\n    console.log('[User Login] Request received')\r\n    const { email, password } = await c.req.json()\r\n    console.log('[User Login] Email:', email)\r\n    \r\n    if (!email || !password) {\r\n      console.log('[User Login] Missing email or password')\r\n      return c.json({ error: 'email_and_password_required' }, 400)\r\n    }\r\n    \r\n    // Find user by email (any active user, not just admins)\r\n    console.log('[User Login] Querying database for user...')\r\n    const user = await c.env.DB.prepare(`\r\n      SELECT user_id, email, password_hash, name, is_admin, is_active\r\n      FROM users\r\n      WHERE email = ? AND is_active = 1\r\n    `).bind(email).first()\r\n    \r\n    if (!user) {\r\n      console.log('[User Login] User not found or inactive')\r\n      return c.json({ error: 'invalid_credentials' }, 401)\r\n    }\r\n    \r\n    console.log('[User Login] User found:', user.email, '| Admin:', user.is_admin === 1)\r\n    \r\n    // Verify password\r\n    console.log('[User Login] Verifying password...')\r\n    const passwordMatch = await bcrypt.compare(password, user.password_hash)\r\n    if (!passwordMatch) {\r\n      console.log('[User Login] Password mismatch')\r\n      return c.json({ error: 'invalid_credentials' }, 401)\r\n    }\r\n    \r\n    console.log('[User Login] Password verified')\r\n    \r\n    // Create session token\r\n    const sessionToken = crypto.randomUUID()\r\n    const now = new Date()\r\n    const expiresAt = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000) // 7 days\r\n    \r\n    console.log('[User Login] Creating user_sessions table if needed...')\r\n    // Create user_sessions table if it doesn't exist\r\n    await c.env.DB.prepare(`\r\n      CREATE TABLE IF NOT EXISTS user_sessions (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        user_id INTEGER NOT NULL,\r\n        session_token TEXT NOT NULL UNIQUE,\r\n        created_at TEXT NOT NULL,\r\n        expires_at TEXT NOT NULL,\r\n        last_activity TEXT NOT NULL,\r\n        FOREIGN KEY (user_id) REFERENCES users(user_id)\r\n      )\r\n    `).run().catch(err => {\r\n      console.log('[User Login] Table creation error (might already exist):', err.message)\r\n    })\r\n    \r\n    console.log('[User Login] Storing session...')\r\n    // Store session\r\n    await c.env.DB.prepare(`\r\n      INSERT INTO user_sessions (user_id, session_token, created_at, expires_at, last_activity)\r\n      VALUES (?, ?, ?, ?, ?)\r\n    `).bind(\r\n      user.user_id,\r\n      sessionToken,\r\n      toIso(now),\r\n      toIso(expiresAt),\r\n      toIso(now)\r\n    ).run()\r\n    \r\n    console.log('[User Login] Success! Session created for', user.email)\r\n    return c.json({\r\n      success: true,\r\n      session_token: sessionToken,\r\n      user: {\r\n        id: user.user_id,\r\n        email: user.email,\r\n        name: user.name,\r\n        is_admin: user.is_admin === 1\r\n      }\r\n    })\r\n  } catch (error) {\r\n    console.error('[User Login] ERROR:', error)\r\n    console.error('[User Login] Stack:', error.stack)\r\n    return c.json({ error: 'internal_error', message: error.message }, 500)\r\n  }\r\n})\r\n\r\n// General logout endpoint - works for all users\r\napp.post('/logout', async c => {\r\n  try {\r\n    const sessionToken = c.req.header('X-Session-Token')\r\n    \r\n    if (!sessionToken) {\r\n      return c.json({ error: 'no_session_token' }, 400)\r\n    }\r\n    \r\n    // Delete the session\r\n    await c.env.DB.prepare(`\r\n      DELETE FROM user_sessions WHERE session_token = ?\r\n    `).bind(sessionToken).run()\r\n    \r\n    console.log('[Logout] Session invalidated')\r\n    return c.json({ success: true })\r\n  } catch (error) {\r\n    console.error('[Logout] ERROR:', error)\r\n    return c.json({ error: 'internal_error' }, 500)  }\r\n})\r\n\r\n// ============================================================================\r\n// LEGACY ADMIN ENDPOINTS (kept for backward compatibility - redirect to universal endpoints)\r\n// ============================================================================\r\n\r\n// Admin login - legacy endpoint, redirects to universal /login\r\napp.post('/admin/login', async c => {\r\n  // Just call the universal login endpoint\r\n  return app.fetch(new Request(new URL('/login', c.req.url), {\r\n    method: 'POST',\r\n    headers: c.req.raw.headers,\r\n    body: c.req.raw.body\r\n  }), c.env)\r\n})\r\n\r\n// Admin logout - legacy endpoint, redirects to universal /logout\r\napp.post('/admin/logout', async c => {\r\n  // Just call the universal logout endpoint\r\n  return app.fetch(new Request(new URL('/logout', c.req.url), {\r\n    method: 'POST',\r\n    headers: c.req.raw.headers,\r\n    body: c.req.raw.body\r\n  }), c.env)\r\n})\r\n\r\n// Admin session verification endpoint\r\napp.get('/admin/verify', async c => {\r\n  try {\r\n    const sessionToken = c.req.header('X-Session-Token')\r\n    \r\n    if (!sessionToken) {\r\n      return c.json({ error: 'no_session_token' }, 401)\r\n    }\r\n    \r\n    const now = toIso(new Date())\r\n    const session = await c.env.DB.prepare(`\r\n      SELECT s.*, u.email, u.name, u.is_admin, u.is_active\r\n      FROM user_sessions s\r\n      JOIN users u ON s.user_id = u.user_id\r\n      WHERE s.session_token = ? AND s.expires_at > ? AND u.is_active = 1 AND u.is_admin = 1\r\n    `).bind(sessionToken, now).first()\r\n    \r\n    if (!session) {\r\n      return c.json({ error: 'invalid_session' }, 401)\r\n    }\r\n    \r\n    // Update last activity\r\n    await c.env.DB.prepare(`\r\n      UPDATE user_sessions SET last_activity = ? WHERE session_token = ?\r\n    `).bind(now, sessionToken).run()\r\n    \r\n    return c.json({\r\n      success: true,\r\n      user: {\r\n        id: session.user_id,\r\n        email: session.email,\r\n        name: session.name,\r\n        is_admin: true\r\n      }\r\n    })\r\n  } catch (error) {\r\n    console.error('[Admin Verify] ERROR:', error)\r\n    return c.json({ error: 'internal_error' }, 500)\r\n  }\r\n})\r\n\r\n// ============================================================================\r\n// ADMIN EVENT MANAGEMENT ENDPOINTS\r\n// ============================================================================\r\n\r\n// Middleware: Require admin authentication (session-based or legacy admin key)\r\nasync function requireAdmin(c, next) {\r\n  // Try session-based auth first\r\n  const sessionToken = c.req.header('X-Session-Token')\r\n  if (sessionToken) {\r\n    const now = toIso(new Date())\r\n    const session = await c.env.DB.prepare(`\r\n      SELECT s.*, u.email, u.name, u.is_admin, u.is_active\r\n      FROM user_sessions s\r\n      JOIN users u ON s.user_id = u.user_id\r\n      WHERE s.session_token = ? AND s.expires_at > ? AND u.is_active = 1 AND u.is_admin = 1\r\n    `).bind(sessionToken, now).first()\r\n    \r\n    if (session) {\r\n      c.set('adminUser', { id: session.user_id, email: session.email, name: session.name })\r\n      return await next()\r\n    }\r\n  }\r\n  \r\n  // Fallback to legacy admin key (for backward compatibility)\r\n  const adminKey = c.req.header('X-Admin-Key')\r\n  if (adminKey && adminKey === c.env.ADMIN_KEY) {\r\n    c.set('adminUser', { legacy: true })\r\n    return await next()\r\n  }\r\n  \r\n  return c.json({ error: 'unauthorized' }, 401)\r\n}\r\n\r\n// Membership checkout with idempotency + Turnstile\r\napp.post('/membership/checkout', async (c) => {\r\n  try {\r\n    const ip = c.req.header('CF-Connecting-IP')\r\n    const debugMode = ['1','true','yes'].includes(String(c.req.query('debug') || c.env.DEBUG || '').toLowerCase())\r\n      // Rate limiting: 3 requests per minute per IP (more restrictive for memberships)\r\n    if (!checkRateLimit(ip, membershipCheckoutRateLimits, 3, 1)) {\r\n      return c.json({ error: 'rate_limit_exceeded', message: 'Too many membership checkout requests. Please try again in a minute.' }, 429)\r\n    }\r\n    \r\n    const idem = c.req.header('Idempotency-Key')?.trim()\r\n    const { email, name, plan, privacyConsent, marketingConsent, turnstileToken, autoRenew, amount: customAmount } = await c.req.json()\r\n    if (!email || !plan) return c.json({ error: 'missing_fields' }, 400)\r\n    if (!EMAIL_RE.test(email) || email.length > 320) return c.json({ error:'invalid_email' },400)\r\n    if (!privacyConsent) return c.json({ error: 'privacy_consent_required' }, 400)\r\n    if (name && name.length > 200) return c.json({ error:'name_too_long' },400)\r\n    const tsOk = await verifyTurnstile(c.env, turnstileToken, ip, debugMode)\r\n    if (!tsOk) return c.json({ error:'turnstile_failed' },403)\r\n    \r\n    const ident = await getOrCreateIdentity(c.env.DB, email, clampStr(name,200))\r\n    const svc = await getServiceForPlan(c.env.DB, plan)\r\n    \r\n    // Allow custom amount override for testing (works with any valid plan)\r\n    // This lets you test with \u00A31 instead of the full plan price\r\n    let amount, currency\r\n    if (customAmount) {\r\n      // Custom amount provided - use it (for testing purposes)\r\n      amount = Number(customAmount)\r\n      currency = 'GBP'\r\n      if (!Number.isFinite(amount) || amount <= 0) return c.json({ error:'invalid_amount' },400)\r\n      console.log(`Using custom test amount: \u00A3${amount} for plan: ${plan}`)\r\n    } else {\r\n      // Normal flow - use service pricing\r\n      if (!svc) return c.json({ error: 'unknown_plan' }, 400)\r\n      amount = Number(svc.amount)\r\n      if (!Number.isFinite(amount) || amount <= 0) return c.json({ error:'invalid_amount' },400)\r\n      currency = svc.currency || c.env.CURRENCY || 'GBP'\r\n    }\r\n    const s = await getSchema(c.env.DB)\r\n\r\n    // Ensure schema is up to date\r\n    await ensureSchema(c.env.DB, s.fkColumn)\r\n    await migrateToTransactions(c.env.DB)\r\n\r\n    // Idempotency check in transactions table\r\n    const order_ref = crypto.randomUUID()\r\n    if (idem){\r\n      const existing = await c.env.DB.prepare(`\r\n        SELECT t.*, m.id as membership_id FROM transactions t\r\n        JOIN memberships m ON m.id = t.reference_id\r\n        WHERE t.transaction_type = 'membership' AND t.user_id = ? AND t.idempotency_key = ?\r\n        ORDER BY t.id DESC LIMIT 1\r\n      `).bind(ident.id, idem).first()\r\n      if (existing && existing.checkout_id){\r\n        return c.json({ orderRef: existing.order_ref, checkoutId: existing.checkout_id, reused: true })\r\n      }\r\n    }    const autoRenewValue = autoRenew ? 1 : 0\r\n    \r\n    // Insert minimal membership record (business logic only)\r\n    const cols = ['user_id', 'plan','status','auto_renew','order_ref']\r\n    const vals = [ident.id, plan,'pending', autoRenewValue, order_ref]\r\n    const placeholders = cols.map(()=>'?').join(',')\r\n    const mResult = await c.env.DB.prepare(`INSERT INTO memberships (${cols.join(',')}) VALUES (${placeholders}) RETURNING id`).bind(...vals).first()\r\n    const membershipId = mResult?.id || (await c.env.DB.prepare('SELECT last_insert_rowid() as id').first()).id\r\n\r\n    let checkout\r\n    let customerId = null\r\n    try {\r\n      // Create or get SumUp customer if auto-renewal enabled\r\n      if (autoRenewValue === 1) {\r\n        customerId = await getOrCreateSumUpCustomer(c.env, ident)\r\n        console.log('Using SumUp customer ID for auto-renewal:', customerId)\r\n      }\r\n      \r\n      checkout = await createCheckout(c.env, { \r\n        amount, \r\n        currency, \r\n        orderRef: order_ref, \r\n        title: `Dice Bastion ${plan} membership`, \r\n        description: `Membership for ${plan}`,\r\n        savePaymentInstrument: autoRenewValue === 1,\r\n        customerId\r\n      })\r\n    } catch (err) {\r\n      console.error('sumup checkout error', err)\r\n      return c.json({ error: 'sumup_checkout_failed', message: String(err?.message || err) }, 502)\r\n    }\r\n    if (!checkout.id) {\r\n      console.error('membership checkout missing id', checkout)\r\n      return c.json({ error: 'sumup_missing_id' }, 502)\r\n    }    // Store payment details in transactions table\r\n    console.log('Creating transaction record with order_ref:', order_ref, 'checkout_id:', checkout.id)\r\n    await c.env.DB.prepare(`\r\n      INSERT INTO transactions (transaction_type, reference_id, user_id, email, name, order_ref, \r\n                                checkout_id, amount, currency, payment_status, idempotency_key, consent_at)\r\n      VALUES ('membership', ?, ?, ?, ?, ?, ?, ?, ?, 'pending', ?, ?)\r\n    `).bind(membershipId, ident.id, email, clampStr(name,200), order_ref, checkout.id, \r\n            String(amount), currency, idem || null, toIso(new Date())).run()\r\n    console.log('Transaction record created successfully')\r\n    \r\n    // Handle email preferences opt-in\r\n    await handleEmailPreferencesOptIn(c.env.DB, ident.id, marketingConsent)\r\n    \r\n    return c.json({ \r\n      orderRef: order_ref, \r\n      checkoutId: checkout.id,\r\n      membershipId,\r\n      userId: ident.id,\r\n      amount,\r\n      currency,\r\n      customerId: customerId || null\r\n    })\r\n  } catch (e) {\r\n    const debugMode = ['1','true','yes'].includes(String(c.req.query('debug') || c.env.DEBUG || '').toLowerCase())\r\n    console.error('membership checkout error', e)\r\n    return c.json(debugMode ? { error: 'internal_error', detail: String(e), stack: String(e?.stack||'') } : { error: 'internal_error' }, 500)\r\n  }\r\n})\r\n\r\napp.get('/membership/status', async (c) => {\r\n  const email = c.req.query('email')\r\n  if (!email) return c.json({ error: 'email required' }, 400)\r\n  const ident = await findIdentityByEmail(c.env.DB, email)\r\n  if (!ident) return c.json({ active: false })\r\n  const active = await getActiveMembership(c.env.DB, ident.id)\r\n  if (!active) return c.json({ active: false })\r\n  return c.json({ active: true, plan: active.plan, endDate: active.end_date })\r\n})\r\n\r\n// Expose active plans/prices for frontend labeling\r\napp.get('/membership/plans', async (c) => {\r\n  const rows = await c.env.DB.prepare('SELECT code, name, description, amount, currency, months FROM services WHERE active = 1 ORDER BY id').all()\r\n  return c.json({ plans: rows.results || [] })\r\n})\r\n\r\napp.get('/membership/confirm', async (c) => {\r\n  const orderRef = c.req.query('orderRef')\r\n  console.log('=== /membership/confirm called with orderRef:', orderRef)\r\n  if (!orderRef || !UUID_RE.test(orderRef)) return c.json({ ok:false, error:'invalid_orderRef' },400)\r\n  \r\n  // Get transaction record\r\n  console.log('Querying transactions table for order_ref:', orderRef)\r\n  const transaction = await c.env.DB.prepare('SELECT * FROM transactions WHERE order_ref = ? AND transaction_type = \"membership\"').bind(orderRef).first()\r\n  console.log('Transaction query result:', transaction ? 'FOUND' : 'NOT FOUND', transaction)\r\n  if (!transaction) return c.json({ ok:false, error:'order_not_found' },404)\r\n  \r\n  // Get membership record\r\n  const pending = await c.env.DB.prepare('SELECT * FROM memberships WHERE id = ?').bind(transaction.reference_id).first()\r\n  if (!pending) return c.json({ ok:false, error:'membership_not_found' },404)\r\n  if (pending.status === 'active') {\r\n    // Get card details if auto-renewal is enabled\r\n    let cardLast4 = null\r\n    if (pending.auto_renew === 1 && pending.payment_instrument_id) {\r\n      const instrument = await c.env.DB.prepare('SELECT last_4 FROM payment_instruments WHERE instrument_id = ?')\r\n        .bind(pending.payment_instrument_id).first()\r\n      cardLast4 = instrument?.last_4 || null\r\n    }\r\n    return c.json({ \r\n      ok: true, \r\n      status: 'already_active',\r\n      plan: pending.plan,\r\n      endDate: pending.end_date,\r\n      amount: transaction.amount,\r\n      currency: transaction.currency || 'GBP',\r\n      autoRenew: pending.auto_renew === 1,\r\n      cardLast4\r\n    })\r\n  }\r\n  \r\n  // Verify payment with SumUp\r\n  let payment; \r\n  try { payment = await fetchPayment(c.env, transaction.checkout_id) } \r\n  catch { return c.json({ ok:false, error:'verify_failed' },400) }\r\n  \r\n  const paid = payment && (payment.status === 'PAID' || payment.status === 'SUCCESSFUL')\r\n  if (!paid) return c.json({ ok:false, status: payment?.status || 'PENDING' })\r\n  \r\n  // Verify amount/currency\r\n  if (payment.amount != Number(transaction.amount) || (transaction.currency && payment.currency !== transaction.currency)) {\r\n    return c.json({ ok:false, error:'payment_mismatch' },400)\r\n  }\r\n    const s = await getSchema(c.env.DB)\r\n  const identityId = pending.user_id\r\n  const activeExisting = await getActiveMembership(c.env.DB, identityId)\r\n  const svc = await getServiceForPlan(c.env.DB, pending.plan)\r\n  if (!svc) return c.json({ ok:false, error:'plan_not_configured' },400)\r\n  const months = Number(svc.months || 0)\r\n  const baseStart = activeExisting ? new Date(activeExisting.end_date) : new Date()\r\n  const end = addMonths(baseStart, months)\r\n  \r\n  // Save payment instrument for auto-renewal ONLY if auto_renew is enabled\r\n  let instrumentId = null\r\n  if (pending.auto_renew === 1) {\r\n    instrumentId = await savePaymentInstrument(c.env.DB, identityId, transaction.checkout_id, c.env)\r\n  }\r\n  \r\n  // Update membership status\r\n  await c.env.DB.prepare(`\r\n    UPDATE memberships \r\n    SET status = \"active\", \r\n        start_date = ?, \r\n        end_date = ?, \r\n        payment_instrument_id = ?\r\n    WHERE id = ?\r\n  `).bind(toIso(baseStart), toIso(end), instrumentId, pending.id).run()\r\n  \r\n  // Update transaction status\r\n  await c.env.DB.prepare(`\r\n    UPDATE transactions \r\n    SET payment_status = \"PAID\",\r\n        payment_id = ?,\r\n        updated_at = ?\r\n    WHERE id = ?\r\n  `).bind(payment.id, toIso(new Date()), transaction.id).run()\r\n  \r\n  // Get user details and send welcome email\r\n  const user = await c.env.DB.prepare('SELECT * FROM users WHERE user_id = ?').bind(identityId).first()\r\n  if (user) {\r\n    const updatedMembership = { ...pending, end_date: toIso(end) }\r\n    const emailContent = getWelcomeEmail(updatedMembership, user, pending.auto_renew === 1)\r\n    await sendEmail(c.env, { \r\n      to: user.email, \r\n      ...emailContent,\r\n      emailType: 'membership_welcome',\r\n      relatedId: pending.id,\r\n      relatedType: 'membership',\r\n      metadata: { plan: pending.plan, auto_renew: pending.auto_renew }\r\n    })\r\n  }\r\n    // Send admin notification\r\n  try {\r\n    const adminEmailContent = getAdminNotificationEmail('membership', {\r\n      plan: pending.plan,\r\n      customerName: user?.name || 'Customer',\r\n      customerEmail: user?.email || 'unknown@example.com',\r\n      amount: transaction.amount,\r\n      autoRenew: pending.auto_renew === 1,\r\n      membershipId: pending.id,\r\n      orderRef: orderRef\r\n    })\r\n    \r\n    await sendEmail(c.env, { \r\n      to: 'admin@dicebastion.com',\r\n      ...adminEmailContent,\r\n      emailType: 'admin_membership_notification',\r\n      relatedId: pending.id,\r\n      relatedType: 'membership',\r\n      metadata: { plan: pending.plan, amount: transaction.amount }\r\n    })\r\n  } catch (adminEmailError) {\r\n    console.error('Failed to send admin notification for membership:', adminEmailError)\r\n    // Don't fail the main transaction if admin email fails\r\n  }\r\n  \r\n  // Get payment instrument details for display\r\n  let cardLast4 = null\r\n  if (instrumentId) {\r\n    const instrument = await c.env.DB.prepare('SELECT last_4 FROM payment_instruments WHERE instrument_id = ? AND user_id = ?')\r\n      .bind(instrumentId, identityId).first()\r\n    cardLast4 = instrument?.last_4 || null\r\n  }\r\n  \r\n  return c.json({ \r\n    ok: true, \r\n    status: 'active',\r\n    plan: pending.plan,\r\n    endDate: toIso(end),\r\n    amount: transaction.amount,\r\n    currency: transaction.currency || 'GBP',\r\n    autoRenew: pending.auto_renew === 1,\r\n    cardLast4\r\n  })\r\n})\r\n\r\napp.post('/webhooks/sumup', async (c) => {\r\n  const signature = c.req.header('SumUp-Signature')\r\n  const payload = await c.req.json()\r\n  const { id: paymentId, checkout_reference: orderRef, currency } = payload\r\n  \r\n  // Verify webhook signature\r\n  if (!verifySumUpWebhookSignature(JSON.stringify(payload), signature, c.env.SUMUP_WEBHOOK_SECRET)) {\r\n    console.warn('Invalid webhook signature for membership webhook')\r\n    return c.json({ error: 'invalid_signature' }, 401)\r\n  }\r\n  \r\n  if (!paymentId || !orderRef) return c.json({ ok: false }, 400)\r\n\r\n  // Check for duplicate webhook processing\r\n  const webhookId = `${paymentId}-${orderRef}` // Create unique webhook ID\r\n  const isDuplicate = await checkAndMarkWebhookProcessed(c.env.DB, webhookId, 'membership', orderRef)\r\n  if (isDuplicate) {\r\n    console.log('Duplicate membership webhook received, skipping processing')\r\n    return c.json({ ok: true, status: 'already_processed' })\r\n  }\r\n\r\n  let payment\r\n  try { payment = await fetchPayment(c.env, paymentId) } catch (e) { return c.json({ ok: false, error: 'verify_failed' }, 400) }\r\n  if (!payment || payment.status !== 'PAID') return c.json({ ok: true })\r\n\r\n  const pending = await c.env.DB.prepare('SELECT * FROM memberships WHERE order_ref = ?').bind(orderRef).first()\r\n  if (!pending) return c.json({ ok: false, error: 'order_not_found' }, 404)\r\n\r\n  const svc = await getServiceForPlan(c.env.DB, pending.plan)\r\n  if (!svc) return c.json({ ok: false, error: 'plan_not_configured' }, 400)\r\n  if (currency && svc.currency && currency !== svc.currency) return c.json({ ok: false, error: 'currency_mismatch' }, 400)\r\n  const now = new Date()\r\n  const s = await getSchema(c.env.DB)\r\n  const identityId = pending.user_id\r\n  const memberActive = await getActiveMembership(c.env.DB, identityId)\r\n  const baseStart = memberActive ? new Date(memberActive.end_date) : now\r\n  const months = Number(svc.months || 0)\r\n  const start = baseStart\r\n  const end = addMonths(baseStart, months)\r\n  await c.env.DB.prepare('UPDATE memberships SET status = \"active\", start_date = ?, end_date = ?, payment_id = ? WHERE id = ?').bind(toIso(start), toIso(end), paymentId, pending.id).run()\r\n  \r\n  // Save payment instrument if auto-renewal is enabled\r\n  if (pending.auto_renew === 1) {\r\n    console.log('Auto-renewal enabled, attempting to save payment instrument for checkout:', paymentId)\r\n    const instrumentId = await savePaymentInstrument(c.env.DB, identityId, paymentId, c.env)\r\n    if (instrumentId) {\r\n      console.log('Payment instrument saved successfully:', instrumentId)\r\n      // Store instrument ID in membership record for reference\r\n      await c.env.DB.prepare('UPDATE memberships SET payment_instrument_id = ? WHERE id = ?')\r\n        .bind(instrumentId, pending.id).run()\r\n    } else {\r\n      console.warn('Failed to save payment instrument, but membership activation will continue')\r\n    }\r\n  }\r\n  \r\n  // Send welcome email (critical - works even if user closed browser)\r\n  const user = await c.env.DB.prepare('SELECT * FROM users WHERE user_id = ?').bind(identityId).first()\r\n  if (user) {\r\n    const updatedMembership = { ...pending, end_date: toIso(end) }\r\n    const emailContent = getWelcomeEmail(updatedMembership, user, pending.auto_renew === 1)\r\n    await sendEmail(c.env, { \r\n      to: user.email, \r\n      ...emailContent,\r\n      emailType: 'membership_welcome',\r\n      relatedId: pending.id,\r\n      relatedType: 'membership',\r\n      metadata: { plan: pending.plan, auto_renew: pending.auto_renew }\r\n    }).catch(err => {\r\n      console.error('Webhook email failed:', err)\r\n      // Don't fail webhook if email fails\r\n    })\r\n  }\r\n    // Send admin notification\r\n  try {\r\n    const adminEmailContent = getAdminNotificationEmail('membership', {\r\n      plan: pending.plan,\r\n      customerName: user?.name || 'Customer',\r\n      customerEmail: user?.email || 'unknown@example.com',\r\n      amount: payment.amount,\r\n      autoRenew: pending.auto_renew === 1,\r\n      membershipId: pending.id,\r\n      orderRef: orderRef\r\n    })\r\n    \r\n    await sendEmail(c.env, { \r\n      to: 'admin@dicebastion.com',\r\n      ...adminEmailContent,\r\n      emailType: 'admin_membership_notification',\r\n      relatedId: pending.id,\r\n      relatedType: 'membership',\r\n      metadata: { plan: pending.plan, amount: payment.amount }\r\n    }).catch(err => {\r\n      console.error('Webhook admin email failed:', err)\r\n      // Don't fail webhook if admin email fails\r\n    })\r\n  } catch (adminEmailError) {\r\n    console.error('Failed to send admin notification for membership (webhook):', adminEmailError)\r\n  }\r\n  \r\n  return c.json({ ok: true })\r\n})\r\n\r\n// ============================================================================\r\n// PUBLIC EVENT ENDPOINTS\r\n// ============================================================================\r\n\r\n// Get all active events (public endpoint)\r\napp.get('/events', async c => {\r\n  try {\r\n    const { results } = await c.env.DB.prepare(`\r\n      SELECT \r\n        event_id as id,\r\n        event_name as title,\r\n        slug,\r\n        description,\r\n        full_description,\r\n        event_datetime,\r\n        location,\r\n        membership_price,\r\n        non_membership_price,\r\n        capacity,\r\n        tickets_sold,\r\n        image_url,\r\n        requires_purchase,\r\n        is_recurring,\r\n        recurrence_pattern\r\n      FROM events \r\n      WHERE is_active = 1 \r\n        AND (event_datetime >= datetime('now') OR is_recurring = 1)\r\n      ORDER BY event_datetime ASC\r\n    `).all()\r\n    \r\n    return c.json(results || [])\r\n  } catch (err) {\r\n    console.error('Error fetching events:', err)\r\n    return c.json({ error: 'failed_to_fetch_events' }, 500)  }\r\n})\r\n\r\n// Confirm ticket purchase - MUST come before /events/:slug route!\r\napp.get('/events/confirm', async c => {\r\n  try {\r\n    const orderRef = c.req.query('orderRef')\r\n    if (!orderRef || !EVT_UUID_RE.test(orderRef)) return c.json({ ok:false, error:'invalid_orderRef' },400)\r\n  \r\n    // Get transaction record\r\n    const transaction = await c.env.DB.prepare('SELECT * FROM transactions WHERE order_ref = ? AND transaction_type = \"ticket\"').bind(orderRef).first()\r\n    if (!transaction) {\r\n      console.log('[events/confirm] Transaction not found for orderRef:', orderRef)\r\n      return c.json({ ok:false, error:'order_not_found' },404)\r\n    }\r\n    \r\n    console.log('[events/confirm] Transaction found:', { \r\n      id: transaction.id, \r\n      checkout_id: transaction.checkout_id, \r\n      payment_status: transaction.payment_status,\r\n      reference_id: transaction.reference_id \r\n    })\r\n    \r\n    // Get ticket record\r\n    const ticket = await c.env.DB.prepare('SELECT * FROM tickets WHERE id = ?').bind(transaction.reference_id).first()\r\n    if (!ticket) {\r\n      console.log('[events/confirm] Ticket not found for reference_id:', transaction.reference_id)\r\n      return c.json({ ok:false, error:'ticket_not_found' },404)\r\n    }\r\n    \r\n    console.log('[events/confirm] Ticket found:', { id: ticket.id, status: ticket.status, event_id: ticket.event_id })\r\n    \r\n    if (ticket.status === 'active') {\r\n      const ev = await c.env.DB.prepare('SELECT event_name, event_datetime FROM events WHERE event_id = ?').bind(ticket.event_id).first()\r\n      return c.json({ \r\n        ok: true, \r\n        status: 'already_active',\r\n        eventName: ev?.event_name,\r\n        eventDate: ev?.event_datetime,\r\n        ticketCount: 1,\r\n        amount: transaction.amount,\r\n        currency: transaction.currency || 'GBP'\r\n      })\r\n    }\r\n    \r\n    // Verify payment with SumUp\r\n    let payment\r\n    try { \r\n      payment = await fetchPayment(c.env, transaction.checkout_id)\r\n      console.log('[events/confirm] SumUp payment status:', payment?.status, 'checkout_id:', transaction.checkout_id)\r\n    } \r\n    catch (err) { \r\n      console.error('[events/confirm] Failed to fetch payment from SumUp:', err)\r\n      return c.json({ ok:false, error:'verify_failed' },400) \r\n    }\r\n    \r\n    const paid = payment && (payment.status === 'PAID' || payment.status === 'SUCCESSFUL')\r\n    if (!paid) {\r\n      console.log('[events/confirm] Payment not yet paid, status:', payment?.status || 'PENDING')\r\n      return c.json({ ok:false, status: payment?.status || 'PENDING' })\r\n    }\r\n    \r\n    console.log('[events/confirm] Payment verified as PAID')\r\n    \r\n    // Verify amount/currency\r\n    if (payment.amount != Number(transaction.amount) || (transaction.currency && payment.currency !== transaction.currency)) {\r\n      console.log('[events/confirm] Payment mismatch - payment:', payment.amount, payment.currency, 'transaction:', transaction.amount, transaction.currency)\r\n      return c.json({ ok:false, error:'payment_mismatch' },400)\r\n    }\r\n\r\n    // Get event details\r\n    console.log('[events/confirm] Looking up event with event_id:', ticket.event_id)\r\n    const ev = await c.env.DB.prepare('SELECT * FROM events WHERE event_id = ?').bind(ticket.event_id).first()\r\n    console.log('[events/confirm] Event lookup result:', ev ? `Found: ${ev.event_name}` : 'NOT FOUND')\r\n    if (!ev) return c.json({ ok:false, error:'event_not_found' },404)\r\n    \r\n    // Capacity check\r\n    if (ev.capacity && ev.tickets_sold >= ev.capacity) return c.json({ ok:false, error:'sold_out' },409)\r\n    \r\n    // Update ticket and transaction status\r\n    await c.env.DB.batch([\r\n      c.env.DB.prepare('UPDATE tickets SET status = \"active\" WHERE id = ?').bind(ticket.id),\r\n      c.env.DB.prepare('UPDATE transactions SET payment_status = \"PAID\", payment_id = ?, updated_at = ? WHERE id = ?')\r\n        .bind(payment.id, toIso(new Date()), transaction.id),\r\n      // Increment if not exceeded capacity\r\n      c.env.DB.prepare('UPDATE events SET tickets_sold = tickets_sold + 1 WHERE event_id = ? AND (capacity IS NULL OR tickets_sold < capacity)')\r\n        .bind(ticket.event_id)\r\n    ])\r\n    \r\n    // Send confirmation email\r\n    const user = await c.env.DB.prepare('SELECT * FROM users WHERE user_id = ?').bind(transaction.user_id).first()\r\n    if (user) {\r\n      const emailContent = getTicketConfirmationEmail(ev, user, transaction)\r\n      await sendEmail(c.env, { \r\n        to: user.email, \r\n        ...emailContent,\r\n        emailType: 'event_ticket_confirmation',\r\n        relatedId: ticket.id,\r\n        relatedType: 'ticket',\r\n        metadata: { event_id: ev.id, event_name: ev.event_name }\r\n      })\r\n    }\r\n    \r\n    // Send admin notification for event tickets\r\n    try {\r\n      const adminEmailContent = getAdminNotificationEmail('event_ticket', {\r\n        eventName: ev.event_name,\r\n        customerName: user?.name || 'Customer',\r\n        customerEmail: user?.email || transaction.email,\r\n        amount: transaction.amount,\r\n        eventDate: ev.event_datetime,\r\n        ticketId: ticket.id,\r\n        orderRef: transaction.order_ref\r\n      })\r\n      \r\n      await sendEmail(c.env, { \r\n        to: 'admin@dicebastion.com',\r\n        ...adminEmailContent,\r\n        emailType: 'admin_event_notification',\r\n        relatedId: ticket.id,\r\n        relatedType: 'ticket',\r\n        metadata: { event_id: ev.id, event_name: ev.event_name }\r\n      })\r\n    } catch (adminEmailError) {\r\n      console.error('Failed to send admin notification for event ticket:', adminEmailError)\r\n      // Don't fail the main transaction if admin email fails\r\n    }\r\n    \r\n    return c.json({ \r\n      ok: true, \r\n      status: 'active',\r\n      eventName: ev.event_name,\r\n      eventDate: ev.event_datetime,\r\n      ticketCount: 1,\r\n      amount: transaction.amount,\r\n      currency: transaction.currency || 'GBP'\r\n    })\r\n  } catch (error) {\r\n    console.error('[events/confirm] EXCEPTION:', error)\r\n    return c.json({ ok: false, error: 'internal_error', message: error.message, stack: error.stack }, 500)\r\n  }\r\n})\r\n\r\n// Get single event by slug (public endpoint)\r\napp.get('/events/:slug', async c => {\r\n  try {\r\n    const slug = c.req.param('slug')\r\n    \r\n    const event = await c.env.DB.prepare(`\r\n      SELECT \r\n        event_id as id,\r\n        event_name as title,\r\n        slug,\r\n        description,\r\n        full_description,\r\n        event_datetime,\r\n        location,\r\n        membership_price,\r\n        non_membership_price,\r\n        capacity,\r\n        tickets_sold,\r\n        image_url,\r\n        requires_purchase,\r\n        is_recurring,\r\n        recurrence_pattern,\r\n        recurrence_end_date\r\n      FROM events \r\n      WHERE slug = ? AND is_active = 1\r\n    `).bind(slug).first()\r\n    \r\n    if (!event) {\r\n      return c.json({ error: 'event_not_found' }, 404)\r\n    }\r\n      return c.json(event)\r\n  } catch (err) {\r\n    console.error('Error fetching event:', err)\r\n    return c.json({ error: 'failed_to_fetch_event' }, 500)\r\n  }\r\n})\r\n\r\n// ============================================================================\r\n// ADMIN CRON JOB LOGS ENDPOINT\r\n// ============================================================================\r\n\r\n// Get cron job logs (admin only)\r\napp.get('/admin/cron-logs', async c => {\r\n  try {\r\n    const sessionToken = c.req.header('X-Session-Token')\r\n    \r\n    if (!sessionToken) {\r\n      return c.json({ error: 'no_session_token' }, 401)\r\n    }\r\n    \r\n    const now = toIso(new Date())\r\n    const session = await c.env.DB.prepare(`\r\n      SELECT s.*, u.is_admin, u.is_active\r\n      FROM user_sessions s\r\n      JOIN users u ON s.user_id = u.user_id\r\n      WHERE s.session_token = ? AND s.expires_at > ? AND u.is_active = 1 AND u.is_admin = 1\r\n    `).bind(sessionToken, now).first()\r\n    \r\n    if (!session) {\r\n      return c.json({ error: 'unauthorized' }, 401)\r\n    }\r\n    \r\n    // Get query parameters\r\n    const url = new URL(c.req.url)\r\n    const jobName = url.searchParams.get('job_name') // Optional filter by job name\r\n    const limit = parseInt(url.searchParams.get('limit') || '100')\r\n    const offset = parseInt(url.searchParams.get('offset') || '0')\r\n    \r\n    // Build query\r\n    let query = `\r\n      SELECT \r\n        log_id,\r\n        job_name,\r\n        started_at,\r\n        completed_at,\r\n        status,\r\n        records_processed,\r\n        records_succeeded,\r\n        records_failed,\r\n        error_message,\r\n        details\r\n      FROM cron_job_log\r\n    `\r\n    const params = []\r\n    \r\n    if (jobName) {\r\n      query += ` WHERE job_name = ?`\r\n      params.push(jobName)\r\n    }\r\n    \r\n    query += ` ORDER BY started_at DESC LIMIT ? OFFSET ?`\r\n    params.push(limit, offset)\r\n    \r\n    const logs = await c.env.DB.prepare(query).bind(...params).all()\r\n    \r\n    // Get summary stats for each job type\r\n    const summaryQuery = `\r\n      SELECT \r\n        job_name,\r\n        COUNT(*) as total_runs,\r\n        SUM(CASE WHEN status = 'completed' THEN 1 ELSE 0 END) as completed,\r\n        SUM(CASE WHEN status = 'failed' THEN 1 ELSE 0 END) as failed,\r\n        SUM(CASE WHEN status = 'partial' THEN 1 ELSE 0 END) as partial,\r\n        MAX(started_at) as last_run,\r\n        SUM(records_processed) as total_processed,\r\n        SUM(records_succeeded) as total_succeeded,\r\n        SUM(records_failed) as total_failed\r\n      FROM cron_job_log\r\n      WHERE started_at > datetime('now', '-7 days')\r\n      GROUP BY job_name\r\n    `\r\n    const summary = await c.env.DB.prepare(summaryQuery).all()\r\n    \r\n    return c.json({\r\n      success: true,\r\n      logs: logs.results || [],\r\n      summary: summary.results || [],\r\n      pagination: {\r\n        limit,\r\n        offset,\r\n        count: logs.results?.length || 0\r\n      }\r\n    })\r\n  } catch (error) {\r\n    console.error('[Cron Logs] ERROR:', error)\r\n    return c.json({ error: 'internal_error', message: error.message }, 500)  }\r\n})\r\n\r\n// ============================================================================\r\n// ADMIN EVENT MANAGEMENT ENDPOINTS\r\n// ============================================================================\r\n\r\n// Create new event (admin only)\r\napp.post('/admin/events', requireAdmin, async c => {\r\n  try {\r\n    const { title, slug, description, full_description, event_date, time, membership_price, non_membership_price, max_attendees, location, image_url, requires_purchase, is_active, is_recurring, recurrence_pattern, recurrence_end_date } = await c.req.json()\r\n    \r\n    if (!title || !slug || !event_date) {\r\n      return c.json({ error: 'missing_required_fields' }, 400)\r\n    }\r\n    \r\n    // Combine date and time\r\n    const datetime = time ? `${event_date}T${time}:00` : `${event_date}T00:00:00`\r\n    \r\n    const result = await c.env.DB.prepare(`\r\n      INSERT INTO events (event_name, slug, description, full_description, event_datetime, location, membership_price, non_membership_price, capacity, tickets_sold, image_url, requires_purchase, is_active, is_recurring, recurrence_pattern, recurrence_end_date)\r\n      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, 0, ?, ?, ?, ?, ?, ?)\r\n    `).bind(\r\n      title,\r\n      slug,\r\n      description || null,\r\n      full_description || null,\r\n      datetime,\r\n      location || null,\r\n      membership_price || 0,\r\n      non_membership_price || 0,\r\n      max_attendees || null,\r\n      image_url || null,\r\n      requires_purchase !== undefined ? requires_purchase : 1,\r\n      is_active !== undefined ? is_active : 1,\r\n      is_recurring || 0,\r\n      recurrence_pattern || null,\r\n      recurrence_end_date || null\r\n    ).run()\r\n    \r\n    return c.json({ success: true, id: result.meta.last_row_id })\r\n  } catch (e) {\r\n    console.error('Create event error:', e)\r\n    if (e.message && e.message.includes('UNIQUE constraint')) {\r\n      return c.json({ error: 'slug_already_exists' }, 400)\r\n    }\r\n    return c.json({ error: 'internal_error' }, 500)\r\n  }\r\n})\r\n\r\n// Update event (admin only)\r\napp.put('/admin/events/:id', requireAdmin, async c => {\r\n  try {\r\n    const id = c.req.param('id')\r\n    const { title, slug, description, full_description, event_date, time, membership_price, non_membership_price, max_attendees, location, image_url, requires_purchase, is_active, is_recurring, recurrence_pattern, recurrence_end_date } = await c.req.json()\r\n    \r\n    if (!title || !slug || !event_date) {\r\n      return c.json({ error: 'missing_required_fields' }, 400)\r\n    }\r\n    \r\n    // Combine date and time\r\n    const datetime = time ? `${event_date}T${time}:00` : `${event_date}T00:00:00`\r\n    \r\n    await c.env.DB.prepare(`\r\n      UPDATE events \r\n      SET event_name = ?, slug = ?, description = ?, full_description = ?, event_datetime = ?, location = ?, membership_price = ?, non_membership_price = ?, capacity = ?, image_url = ?, requires_purchase = ?, is_active = ?, is_recurring = ?, recurrence_pattern = ?, recurrence_end_date = ?\r\n      WHERE event_id = ?\r\n    `).bind(\r\n      title,\r\n      slug,\r\n      description || null,\r\n      full_description || null,\r\n      datetime,\r\n      location || null,\r\n      membership_price || 0,\r\n      non_membership_price || 0,\r\n      max_attendees || null,\r\n      image_url || null,\r\n      requires_purchase !== undefined ? requires_purchase : 1,\r\n      is_active !== undefined ? is_active : 1,\r\n      is_recurring || 0,\r\n      recurrence_pattern || null,\r\n      recurrence_end_date || null,\r\n      id\r\n    ).run()\r\n    \r\n    return c.json({ success: true })\r\n  } catch (e) {\r\n    console.error('Update event error:', e)\r\n    if (e.message && e.message.includes('UNIQUE constraint')) {\r\n      return c.json({ error: 'slug_already_exists' }, 400)\r\n    }\r\n    return c.json({ error: 'internal_error' }, 500)\r\n  }\r\n})\r\n\r\n// Delete event (admin only)\r\napp.delete('/admin/events/:id', requireAdmin, async c => {\r\n  try {\r\n    const id = c.req.param('id')\r\n    \r\n    // Check if event has tickets sold\r\n    const event = await c.env.DB.prepare('SELECT tickets_sold FROM events WHERE event_id = ?').bind(id).first()\r\n    if (!event) {\r\n      return c.json({ error: 'not_found' }, 404)\r\n    }\r\n    \r\n    if (event.tickets_sold > 0) {\r\n      return c.json({ error: 'cannot_delete_event_with_tickets' }, 400)\r\n    }\r\n    \r\n    await c.env.DB.prepare('DELETE FROM events WHERE event_id = ?').bind(id).run()\r\n    \r\n    return c.json({ success: true })\r\n  } catch (e) {\r\n    console.error('Delete event error:', e)\r\n    return c.json({ error: 'internal_error' }, 500)\r\n  }\r\n})\r\n\r\n// Create ticket checkout with idempotency + Turnstile\r\napp.post('/events/:id/checkout', async c => {\r\n  try {\r\n    const id = c.req.param('id')\r\n    if (!id || isNaN(Number(id))) return c.json({ error:'invalid_event_id' },400)\r\n    const evId = Number(id)\r\n    const ip = c.req.header('CF-Connecting-IP')\r\n    const debugMode = ['1','true','yes'].includes(String(c.req.query('debug') || c.env.DEBUG || '').toLowerCase())\r\n    \r\n    // Rate limiting: 5 requests per minute per IP (same as shop checkout)\r\n    if (!checkRateLimit(ip, eventCheckoutRateLimits, 5, 1)) {\r\n      return c.json({ error: 'rate_limit_exceeded', message: 'Too many event checkout requests. Please try again in a minute.' }, 429)\r\n    }\r\n    \r\n    const idem = c.req.header('Idempotency-Key')?.trim()\r\n    const { email, name, privacyConsent, marketingConsent, turnstileToken } = await c.req.json()\r\n    if (!email) return c.json({ error:'email_required' },400)\r\n    if (!EMAIL_RE.test(email)) return c.json({ error:'invalid_email' },400)\r\n    if (!privacyConsent) return c.json({ error:'privacy_consent_required' },400)\r\n    if (name && name.length > 200) return c.json({ error:'name_too_long' },400)\r\n    const tsOk = await verifyTurnstile(c.env, turnstileToken, ip, debugMode)\r\n    if (!tsOk) return c.json({ error:'turnstile_failed' },403)\r\n\r\n    const ev = await c.env.DB.prepare('SELECT * FROM events WHERE event_id = ?').bind(evId).first()\r\n    if (!ev) return c.json({ error:'event_not_found' },404)\r\n    if (ev.capacity && ev.tickets_sold >= ev.capacity) return c.json({ error:'sold_out' },409)\r\n\r\n    const ident = await getOrCreateIdentity(c.env.DB, email, clampStr(name,200))\r\n    if (!ident || typeof ident.id === 'undefined' || ident.id === null) {\r\n      console.error('identity missing id', ident)\r\n      return c.json({ error:'identity_error' },500)\r\n    }\r\n    const isActive = !!(await getActiveMembership(c.env.DB, ident.id))\r\n    const amount = Number(isActive ? ev.membership_price : ev.non_membership_price)\r\n    if (!Number.isFinite(amount) || amount <= 0) return c.json({ error:'invalid_amount' },400)\r\n    const currency = c.env.CURRENCY || 'GBP'\r\n\r\n    const s = await getSchema(c.env.DB)\r\n    await ensureSchema(c.env.DB, s.fkColumn)\r\n    await migrateToTransactions(c.env.DB)\r\n\r\n    const order_ref = `EVT-${evId}-${crypto.randomUUID()}`\r\n    \r\n    // Idempotency check in transactions table\r\n    if (idem){\r\n      const existing = await c.env.DB.prepare(`\r\n        SELECT t.*, ti.id as ticket_id FROM transactions t\r\n        JOIN tickets ti ON ti.id = t.reference_id\r\n        WHERE t.transaction_type = 'ticket' AND t.user_id = ? AND t.idempotency_key = ?\r\n        ORDER BY t.id DESC LIMIT 1\r\n      `).bind(ident.id, idem).first()\r\n      if (existing && existing.checkout_id){\r\n        return c.json({ orderRef: existing.order_ref, checkoutId: existing.checkout_id, reused: true })\r\n      }\r\n    }    // Insert minimal ticket record (business logic only)\r\n    const colParts = ['event_id', 'user_id', 'status', 'created_at']\r\n    const bindVals = [evId, ident.id, 'pending', toIso(new Date())]\r\n    \r\n    const placeholders = colParts.map(()=>'?').join(',')\r\n    const ticketResult = await c.env.DB.prepare(`INSERT INTO tickets (${colParts.join(',')}) VALUES (${placeholders}) RETURNING id`).bind(...bindVals).first()\r\n    const ticketId = ticketResult?.id || (await c.env.DB.prepare('SELECT last_insert_rowid() as id').first()).id\r\n\r\n    let checkout\r\n    try {\r\n      checkout = await createCheckout(c.env, { amount, currency, orderRef: order_ref, title: ev.event_name, description: `Ticket for ${ev.event_name}` })\r\n    } catch (e) {\r\n      console.error('SumUp checkout failed for event', evId, e)\r\n      return c.json({ error:'sumup_checkout_failed', message:String(e?.message||e) },502)\r\n    }\r\n    if (!checkout.id) {\r\n      console.error('event checkout missing id', checkout)\r\n      return c.json({ error: 'sumup_missing_id' }, 502)\r\n    }\r\n    \r\n    // Store payment details in transactions table\r\n    await c.env.DB.prepare(`\r\n      INSERT INTO transactions (transaction_type, reference_id, user_id, email, name, order_ref,\r\n                                checkout_id, amount, currency, payment_status, idempotency_key)\r\n      VALUES ('ticket', ?, ?, ?, ?, ?, ?, ?, ?, 'pending', ?)\r\n    `).bind(ticketId, ident.id, email, clampStr(name,200), order_ref, checkout.id,\r\n            String(amount), currency, idem || null).run()\r\n    \r\n    // Handle email preferences opt-in\r\n    await handleEmailPreferencesOptIn(c.env.DB, ident.id, marketingConsent)\r\n    \r\n    return c.json({ orderRef: order_ref, checkoutId: checkout.id })\r\n  } catch (e) {\r\n    const debugMode = ['1','true','yes'].includes(String(c.req.query('debug') || c.env.DEBUG || '').toLowerCase())\r\n    console.error('events checkout error', e)\r\n    return c.json(debugMode ? { error:'internal_error', detail: String(e), stack: String(e?.stack||'') } : { error:'internal_error' },500)\r\n  }\r\n})\r\n\r\n// Optional tiny debug endpoint\r\napp.get('/_debug/ping', c => {\r\n  const origin = c.req.header('Origin') || ''\r\n  const allowed = (c.env.ALLOWED_ORIGIN || '').split(',').map(s=>s.trim()).filter(Boolean)\r\n  const allow = allowed.includes(origin) ? origin : (allowed[0] || '')\r\n  return c.json({ ok:true, origin, allow, allowed })\r\n})\r\n\r\n// Debug endpoint to test event/transaction lookup\r\napp.get('/_debug/event-confirm/:orderRef', async c => {\r\n  const orderRef = c.req.param('orderRef')\r\n  \r\n  const transaction = await c.env.DB.prepare('SELECT * FROM transactions WHERE order_ref = ? AND transaction_type = \"ticket\"').bind(orderRef).first()\r\n  if (!transaction) return c.json({ error: 'transaction_not_found' })\r\n  \r\n  const ticket = await c.env.DB.prepare('SELECT * FROM tickets WHERE id = ?').bind(transaction.reference_id).first()\r\n  if (!ticket) return c.json({ error: 'ticket_not_found' })\r\n  \r\n  const event = await c.env.DB.prepare('SELECT * FROM events WHERE event_id = ?').bind(ticket.event_id).first()\r\n  \r\n  return c.json({\r\n    transaction,\r\n    ticket,\r\n    event: event || null,\r\n    event_found: !!event\r\n  })\r\n})\r\n\r\n// Debug endpoint to check SumUp payment status\r\napp.get('/_debug/sumup-payment/:checkoutId', async c => {\r\n  const checkoutId = c.req.param('checkoutId')\r\n  \r\n  try {\r\n    const payment = await fetchPayment(c.env, checkoutId)\r\n    return c.json({\r\n      checkout_id: checkoutId,\r\n      payment_status: payment?.status,\r\n      payment_amount: payment?.amount,\r\n      payment_currency: payment?.currency,\r\n      payment_full: payment\r\n    })\r\n  } catch (err) {\r\n    return c.json({\r\n      error: 'failed_to_fetch',\r\n      message: err.message\r\n    }, 500)\r\n  }\r\n})\r\n\r\n// Debug schema inspector\r\napp.get('/_debug/schema', async c => {\r\n  try {\r\n    const s = await getSchema(c.env.DB)\r\n    const memberships = await c.env.DB.prepare('PRAGMA table_info(memberships)').all().catch(()=>({ results: [] }))\r\n    const tickets = await c.env.DB.prepare('PRAGMA table_info(tickets)').all().catch(()=>({ results: [] }))\r\n    const tables = await c.env.DB.prepare(\"SELECT name FROM sqlite_master WHERE type='table'\").all().catch(()=>({ results: [] }))\r\n    const ticketFkCol = 'user_id'\r\n    return c.json({ ok:true, schema: s, ticketFkCol, tables: tables.results||[], memberships: memberships.results||[], tickets: tickets.results||[] })\r\n  } catch (e) {\r\n    return c.json({ ok:false, error: String(e) }, 500)\r\n  }\r\n})\r\n\r\n// Debug SumUp OAuth scopes\r\napp.get('/_debug/sumup-scopes', async c => {\r\n  try {\r\n    // Test with payment_instruments scope\r\n    const result = await sumupToken(c.env, 'payments payment_instruments')\r\n    return c.json({ \r\n      ok: true, \r\n      requestedScopes: 'payments payment_instruments',\r\n      grantedScopes: result.scope,\r\n      scopesArray: (result.scope || '').split(/\\s+/).filter(Boolean),\r\n      hasPaymentInstruments: (result.scope || '').includes('payment_instruments'),\r\n      fullResponse: result\r\n    })\r\n  } catch (e) {\r\n    return c.json({ \r\n      ok: false, \r\n      error: String(e.message || e),\r\n      stack: String(e.stack || '')\r\n    }, 500)\r\n  }\r\n})\r\n\r\n// === Auto-Renewal Management Endpoints ===\r\n\r\n// Get auto-renewal status for a user\r\napp.get('/membership/auto-renewal', async (c) => {\r\n  const email = c.req.query('email')\r\n  if (!email || !EMAIL_RE.test(email)) return c.json({ error: 'invalid_email' }, 400)\r\n  \r\n  const ident = await findIdentityByEmail(c.env.DB, email)\r\n  if (!ident) return c.json({ enabled: false, hasPaymentMethod: false })\r\n  \r\n  const membership = await getActiveMembership(c.env.DB, ident.id)\r\n  if (!membership) return c.json({ enabled: false, hasPaymentMethod: false })\r\n  \r\n  const instrument = await getActivePaymentInstrument(c.env.DB, ident.id)\r\n  \r\n  return c.json({\r\n    enabled: membership.auto_renew === 1,\r\n    hasPaymentMethod: !!instrument,\r\n    paymentMethod: instrument ? {\r\n      cardType: instrument.card_type,\r\n      last4: instrument.last_4,\r\n      expiryMonth: instrument.expiry_month,\r\n      expiryYear: instrument.expiry_year\r\n    } : null,\r\n    membershipEndDate: membership.end_date,\r\n    plan: membership.plan\r\n  })\r\n})\r\n\r\n// Toggle auto-renewal on/off\r\napp.post('/membership/auto-renewal/toggle', async (c) => {\r\n  try {\r\n    const { email, enabled } = await c.req.json()\r\n    if (!email || !EMAIL_RE.test(email)) return c.json({ error: 'invalid_email' }, 400)\r\n    if (typeof enabled !== 'boolean') return c.json({ error: 'enabled must be boolean' }, 400)\r\n    \r\n    const ident = await findIdentityByEmail(c.env.DB, email)\r\n    if (!ident) return c.json({ error: 'user_not_found' }, 404)\r\n    \r\n    const membership = await getActiveMembership(c.env.DB, ident.id)\r\n    if (!membership) return c.json({ error: 'no_active_membership' }, 404)\r\n    \r\n    await c.env.DB.prepare('UPDATE memberships SET auto_renew = ? WHERE id = ?')\r\n      .bind(enabled ? 1 : 0, membership.id).run()\r\n    \r\n    return c.json({ ok: true, enabled })\r\n  } catch (e) {\r\n    console.error('Toggle auto-renewal error:', e)\r\n    return c.json({ error: 'internal_error' }, 500)\r\n  }\r\n})\r\n\r\n// Remove saved payment method (disables auto-renewal)\r\napp.post('/membership/payment-method/remove', async (c) => {\r\n  try {\r\n    const { email } = await c.req.json()\r\n    if (!email || !EMAIL_RE.test(email)) return c.json({ error: 'invalid_email' }, 400)\r\n    \r\n    const ident = await findIdentityByEmail(c.env.DB, email)\r\n    if (!ident) return c.json({ error: 'user_not_found' }, 404)\r\n      // Deactivate all payment instruments\r\n    await c.env.DB.prepare('UPDATE payment_instruments SET is_active = 0 WHERE user_id = ?')\r\n      .bind(ident.id).run()\r\n    \r\n    // Disable auto-renewal for active memberships\r\n    await c.env.DB.prepare('UPDATE memberships SET auto_renew = 0, payment_instrument_id = NULL WHERE user_id = ? AND status = \"active\"')\r\n      .bind(ident.id).run()\r\n    \r\n    return c.json({ ok: true })\r\n  } catch (e) {\r\n    console.error('Remove payment method error:', e)\r\n    return c.json({ error: 'internal_error' }, 500)\r\n  }\r\n})\r\n\r\n// Manually retry a failed renewal (useful after user updates payment method)\r\napp.post('/membership/retry-renewal', async (c) => {\r\n  try {\r\n    const { email } = await c.req.json()\r\n    if (!email || !EMAIL_RE.test(email)) return c.json({ error: 'invalid_email' }, 400)\r\n    \r\n    await ensureSchema(c.env.DB, 'user_id')\r\n    \r\n    const ident = await findIdentityByEmail(c.env.DB, email)\r\n    if (!ident) return c.json({ error: 'user_not_found' }, 404)\r\n    \r\n    // Find membership with failed renewal\r\n    const membership = await getActiveMembership(c.env.DB, ident.id)\r\n    if (!membership) return c.json({ error: 'no_active_membership' }, 404)\r\n    \r\n    if (!membership.auto_renew) {\r\n      return c.json({ error: 'auto_renew_disabled', message: 'Auto-renewal is not enabled for this membership' }, 400)\r\n    }\r\n    \r\n    if (!membership.renewal_failed_at && membership.renewal_attempts === 0) {\r\n      return c.json({ error: 'no_failed_renewal', message: 'No failed renewal attempts found' }, 400)\r\n    }\r\n    \r\n    console.log(`Manual retry for membership ${membership.id}`)\r\n    \r\n    // Reset attempts and try renewal\r\n    await c.env.DB.prepare('UPDATE memberships SET renewal_attempts = 0 WHERE id = ?').bind(membership.id).run()\r\n    const result = await processMembershipRenewal(c.env.DB, membership, c.env)\r\n    \r\n    return c.json({ \r\n      ok: true, \r\n      success: result.success,\r\n      message: result.success ? 'Renewal successful' : 'Renewal failed',\r\n      details: result\r\n    })\r\n  } catch (e) {\r\n    console.error('Manual renewal retry error:', e)\r\n    return c.json({ error: 'internal_error', details: String(e) }, 500)\r\n  }\r\n})\r\n\r\n// Test endpoint to manually trigger renewal for a specific user\r\napp.get('/test/renew-user', async (c) => {\r\n  const email = c.req.query('email')\r\n  if (!email) return c.json({ error: 'email required' }, 400)\r\n  \r\n  try {    await ensureSchema(c.env.DB, 'user_id')\r\n    \r\n    const ident = await findIdentityByEmail(c.env.DB, email)\r\n    if (!ident) return c.json({ error: 'user_not_found' }, 404)\r\n    \r\n    // Find active membership with auto-renewal\r\n    const membership = await c.env.DB.prepare(`\r\n      SELECT * FROM memberships \r\n      WHERE user_id = ?\r\n        AND status = 'active' \r\n        AND auto_renew = 1\r\n      LIMIT 1\r\n    `).bind(ident.id).first()\r\n    \r\n    if (!membership) {\r\n      return c.json({ error: 'no_auto_renew_membership' }, 404)\r\n    }\r\n    \r\n    console.log('Manually triggering renewal for membership:', membership.id)\r\n    const result = await processMembershipRenewal(c.env.DB, membership, c.env)\r\n    \r\n    return c.json({ \r\n      success: result.success, \r\n      membership_id: membership.id,\r\n      result \r\n    })\r\n  } catch (e) {\r\n    console.error('Manual renewal test error:', e)\r\n    return c.json({ error: String(e), stack: String(e.stack || '') }, 500)\r\n  }\r\n})\r\n\r\n// ============================================================================\r\n// PRODUCT & SHOP API ENDPOINTS\r\n// ============================================================================\r\n\r\n// Get all active products (public)\r\napp.get('/products', async (c) => {\r\n  try {\r\n    await ensureSchema(c.env.DB, 'user_id')\r\n    \r\n    const products = await c.env.DB.prepare(`\r\n      SELECT id, name, slug, description, summary, full_description, price, currency, stock_quantity, image_url, category, is_active, release_date, created_at\r\n      FROM products\r\n      WHERE is_active = 1\r\n      ORDER BY name ASC\r\n    `).all()\r\n    \r\n    return c.json(products.results || [])\r\n  } catch (e) {\r\n    console.error('Get products error:', e)\r\n    return c.json({ error: 'internal_error' }, 500)\r\n  }\r\n})\r\n\r\n// Get single product by ID or slug (public)\r\napp.get('/products/:id', async (c) => {\r\n  try {\r\n    await ensureSchema(c.env.DB, 'user_id')\r\n    const id = c.req.param('id')\r\n    \r\n    // Try to find by ID first, then by slug\r\n    let product\r\n    if (/^\\d+$/.test(id)) {\r\n      product = await c.env.DB.prepare('SELECT * FROM products WHERE id = ? AND is_active = 1').bind(id).first()\r\n    }\r\n    \r\n    if (!product) {\r\n      product = await c.env.DB.prepare('SELECT * FROM products WHERE slug = ? AND is_active = 1').bind(id).first()\r\n    }\r\n    \r\n    if (!product) {\r\n      return c.json({ error: 'product_not_found' }, 404)\r\n    }\r\n    \r\n    return c.json(product)\r\n  } catch (e) {\r\n    console.error('Get product error:', e)\r\n    return c.json({ error: 'internal_error' }, 500)\r\n  }\r\n})\r\n\r\n// Create new product (admin only - TODO: add authentication)\r\napp.post('/admin/products', requireAdmin, async (c) => {\r\n  try {\r\n    await ensureSchema(c.env.DB, 'user_id')\r\n    \r\n    const { name, slug, description, summary, full_description, price, currency, stock_quantity, image_url, category, release_date } = await c.req.json()\r\n    \r\n    if (!name || !slug || price === undefined) {\r\n      return c.json({ error: 'missing_required_fields' }, 400)\r\n    }\r\n    \r\n    const now = toIso(new Date())\r\n    const result = await c.env.DB.prepare(`\r\n      INSERT INTO products (name, slug, description, summary, full_description, price, currency, stock_quantity, image_url, category, release_date, created_at, updated_at)\r\n      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\r\n    `).bind(\r\n      name, \r\n      slug, \r\n      description || null,\r\n      summary || null, \r\n      full_description || null,\r\n      price, \r\n      currency || 'GBP', \r\n      stock_quantity || 0, \r\n      image_url || null, \r\n      category || null,\r\n      release_date || null,\r\n      now,\r\n      now\r\n    ).run()\r\n    \r\n    return c.json({ success: true, product_id: result.meta.last_row_id })\r\n  } catch (e) {\r\n    console.error('Create product error:', e)\r\n    if (e.message?.includes('UNIQUE constraint')) {\r\n      return c.json({ error: 'slug_already_exists' }, 400)\r\n    }\r\n    return c.json({ error: 'internal_error' }, 500)\r\n  }\r\n})\r\n\r\n// Update product (admin only)\r\napp.put('/admin/products/:id', requireAdmin, async (c) => {\r\n  try {\r\n    await ensureSchema(c.env.DB, 'user_id')\r\n    \r\n    const id = c.req.param('id')\r\n    const { name, slug, description, summary, full_description, price, currency, stock_quantity, image_url, category, is_active, release_date } = await c.req.json()\r\n    \r\n    const updates = []\r\n    const binds = []\r\n    \r\n    if (name !== undefined) { updates.push('name = ?'); binds.push(name) }\r\n    if (slug !== undefined) { updates.push('slug = ?'); binds.push(slug) }\r\n    if (description !== undefined) { updates.push('description = ?'); binds.push(description) }\r\n    if (summary !== undefined) { updates.push('summary = ?'); binds.push(summary) }\r\n    if (full_description !== undefined) { updates.push('full_description = ?'); binds.push(full_description) }\r\n    if (price !== undefined) { updates.push('price = ?'); binds.push(price) }\r\n    if (currency !== undefined) { updates.push('currency = ?'); binds.push(currency) }\r\n    if (stock_quantity !== undefined) { updates.push('stock_quantity = ?'); binds.push(stock_quantity) }\r\n    if (image_url !== undefined) { updates.push('image_url = ?'); binds.push(image_url) }\r\n    if (category !== undefined) { updates.push('category = ?'); binds.push(category) }\r\n    if (is_active !== undefined) { updates.push('is_active = ?'); binds.push(is_active ? 1 : 0) }\r\n    if (release_date !== undefined) { updates.push('release_date = ?'); binds.push(release_date) }\r\n    \r\n    // Handle image update - delete old image if new one provided and different\r\n    if (image_url !== undefined) {\r\n      // Get current product to find old image\r\n      const currentProduct = await c.env.DB.prepare('SELECT image_url FROM products WHERE id = ?')\r\n        .bind(id).first()\r\n      \r\n      if (currentProduct && currentProduct.image_url && currentProduct.image_url !== image_url) {\r\n        const oldKey = extractImageKey(currentProduct.image_url)\r\n        if (oldKey && c.env.IMAGES) {\r\n          try {\r\n            await c.env.IMAGES.delete(oldKey)\r\n            console.log('Deleted old image:', oldKey)\r\n          } catch (err) {\r\n            console.error('Failed to delete old image:', err)\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n    if (updates.length === 0) {\r\n      return c.json({ error: 'no_fields_to_update' }, 400)\r\n    }\r\n    \r\n    updates.push('updated_at = ?')\r\n    binds.push(toIso(new Date()))\r\n    binds.push(id)\r\n    \r\n    await c.env.DB.prepare(`\r\n      UPDATE products SET ${updates.join(', ')} WHERE id = ?\r\n    `).bind(...binds).run()\r\n    \r\n    return c.json({ success: true })\r\n  } catch (e) {\r\n    console.error('Update product error:', e)\r\n    return c.json({ error: 'internal_error' }, 500)\r\n  }\r\n})\r\n\r\n// Delete product (admin only - soft delete by setting is_active = 0)\r\napp.delete('/admin/products/:id', requireAdmin, async (c) => {\r\n  try {\r\n    await ensureSchema(c.env.DB, 'user_id')\r\n    \r\n    const id = c.req.param('id')\r\n    \r\n    // Get product to find image\r\n    const product = await c.env.DB.prepare('SELECT image_url FROM products WHERE id = ?')\r\n      .bind(id).first()\r\n    \r\n    // Delete image from R2\r\n    if (product && product.image_url) {\r\n      const imageKey = extractImageKey(product.image_url)\r\n      if (imageKey && c.env.IMAGES) {\r\n        try {\r\n          await c.env.IMAGES.delete(imageKey)\r\n        } catch (err) {\r\n          console.error('Failed to delete image:', err)\r\n        }\r\n      }\r\n    }\r\n    \r\n    await c.env.DB.prepare('UPDATE products SET is_active = 0, updated_at = ? WHERE id = ?')\r\n      .bind(toIso(new Date()), id)\r\n      .run()\r\n    \r\n    return c.json({ success: true })\r\n  } catch (e) {\r\n    console.error('Delete product error:', e)\r\n    return c.json({ error: 'internal_error' }, 500)\r\n  }\r\n})\r\n\r\n// Get all orders (admin only)\r\napp.get('/admin/orders', async (c) => {\r\n  try {\r\n    await ensureSchema(c.env.DB, 'user_id')\r\n    \r\n    const adminKey = c.req.header('X-Admin-Key')\r\n    if (adminKey !== c.env.ADMIN_KEY) {\r\n      return c.json({ error: 'unauthorized' }, 401)\r\n    }\r\n    \r\n    const orders = await c.env.DB.prepare(`\r\n      SELECT * FROM orders \r\n      ORDER BY created_at DESC\r\n      LIMIT 100\r\n    `).all()\r\n    \r\n    return c.json(orders.results || [])\r\n  } catch (e) {\r\n    console.error('Get orders error:', e)\r\n    return c.json({ error: 'internal_error' }, 500)\r\n  }\r\n})\r\n\r\n// Get order details with items (admin only or order owner)\r\napp.get('/orders/:orderNumber', async (c) => {\r\n  try {\r\n    await ensureSchema(c.env.DB, 'user_id')\r\n    \r\n    const orderNumber = c.req.param('orderNumber')\r\n    const email = c.req.query('email')\r\n    \r\n    const order = await c.env.DB.prepare('SELECT * FROM orders WHERE order_number = ?')\r\n      .bind(orderNumber)\r\n      .first()\r\n    \r\n    if (!order) {\r\n      return c.json({ error: 'order_not_found' }, 404)\r\n    }\r\n    \r\n    // Check authorization (admin or order owner)\r\n    const adminKey = c.req.header('X-Admin-Key')\r\n    if (adminKey !== c.env.ADMIN_KEY && order.email !== email) {\r\n      return c.json({ error: 'unauthorized' }, 401)\r\n    }\r\n    \r\n    // Get order items\r\n    const items = await c.env.DB.prepare('SELECT * FROM order_items WHERE order_id = ?')\r\n      .bind(order.id)\r\n      .all()\r\n    \r\n    return c.json({\r\n      ...order,\r\n      items: items.results || []\r\n    })\r\n  } catch (e) {\r\n    console.error('Get order error:', e)\r\n    return c.json({ error: 'internal_error' }, 500)\r\n  }\r\n})\r\n\r\n// ============================================================================\r\n// SHOP CHECKOUT ENDPOINTS\r\n// ============================================================================\r\n\r\n// Test endpoint to verify email configuration\r\napp.post('/test/email', async (c) => {\r\n  try {\r\n    const { email } = await c.req.json()\r\n    if (!email || !EMAIL_RE.test(email)) {\r\n      return c.json({ error: 'Invalid email address' }, 400)\r\n    }\r\n    \r\n    const result = await sendEmail(c.env, {\r\n      to: email,\r\n      subject: '\uD83E\uDDEA Test Email from Dice Bastion Worker',\r\n      html: `\r\n        <h1>Test Email Successful!</h1>\r\n        <p>Hi there,</p>\r\n        <p>This is a test email from your Dice Bastion Cloudflare Worker.</p>\r\n        <p><strong>\u2705 Your email system is working correctly!</strong></p>\r\n        <ul>\r\n          <li>MailerSend API key is configured</li>\r\n          <li>Email sending is functional</li>\r\n          <li>DNS records are properly set up</li>\r\n        </ul>\r\n        <p>You can now process payments with confidence that confirmation emails will be sent.</p>\r\n        <hr>\r\n        <p style=\"color: #666; font-size: 0.9rem;\">Sent at: ${new Date().toISOString()}</p>\r\n      `,\r\n      emailType: 'test',\r\n      relatedType: 'test'\r\n    })\r\n    \r\n  return c.json(result)\r\n  } catch (e) {\r\n    console.error('Test email error:', e)\r\n    return c.json({ success: false, error: String(e) }, 500)\r\n  }\r\n})\r\n\r\n// ============================================================================\r\n// SCHEDULED HANDLER (CRON)\r\n// ============================================================================\r\n\r\n/**\r\n * Log a cron job activity to the database\r\n */\r\nasync function logCronJob(db, jobName, status, details = {}) {\r\n  const now = new Date().toISOString()\r\n  \r\n  const logData = {\r\n    job_name: jobName,\r\n    started_at: details.started_at || now,\r\n    completed_at: status !== 'running' ? now : null,\r\n    status: status,\r\n    records_processed: details.records_processed || 0,\r\n    records_succeeded: details.records_succeeded || 0,\r\n    records_failed: details.records_failed || 0,\r\n    error_message: details.error_message || null,\r\n    details: details.extra ? JSON.stringify(details.extra) : null\r\n  }\r\n  \r\n  try {\r\n    await db.prepare(`\r\n      INSERT INTO cron_job_log (\r\n        job_name, started_at, completed_at, status,\r\n        records_processed, records_succeeded, records_failed,\r\n        error_message, details\r\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)\r\n    `).bind(\r\n      logData.job_name,\r\n      logData.started_at,\r\n      logData.completed_at,\r\n      logData.status,\r\n      logData.records_processed,\r\n      logData.records_succeeded,\r\n      logData.records_failed,\r\n      logData.error_message,\r\n      logData.details\r\n    ).run()\r\n    \r\n    console.log(`[CRON] Logged ${jobName}: ${status}`, details)\r\n  } catch (e) {\r\n    console.error(`[CRON] Failed to log ${jobName}:`, e)\r\n  }\r\n}\r\n\r\n/**\r\n * Process membership auto-renewals\r\n * 1. Sends warning emails 7 days before renewal\r\n * 2. Processes renewals for memberships expiring today or past-due (grace period)\r\n * 3. Marks expired memberships after grace period ends\r\n */\r\nasync function processAutoRenewals(env) {\r\n  const jobName = 'auto_renewals'\r\n  const startedAt = new Date().toISOString()\r\n  const today = new Date().toISOString().split('T')[0]\r\n  \r\n  // Calculate warning date (7 days from now)\r\n  const warningDate = new Date()\r\n  warningDate.setDate(warningDate.getDate() + 7)\r\n  const warningDateStr = warningDate.toISOString().split('T')[0]\r\n  \r\n  // Calculate grace period start (30 days ago)\r\n  const gracePeriodStart = new Date()\r\n  gracePeriodStart.setDate(gracePeriodStart.getDate() - 30)\r\n  const gracePeriodStartStr = gracePeriodStart.toISOString().split('T')[0]\r\n  \r\n  console.log(`[CRON] Starting ${jobName} at ${startedAt}`)\r\n  console.log(`[CRON] Today: ${today}`)\r\n  console.log(`[CRON] Warning date (7 days ahead): ${warningDateStr}`)\r\n  console.log(`[CRON] Grace period start (30 days ago): ${gracePeriodStartStr}`)\r\n  \r\n  let processed = 0\r\n  let succeeded = 0\r\n  let failed = 0\r\n  let warningsSent = 0\r\n  let expired = 0\r\n  const errors = []\r\n  \r\n  try {\r\n    // ========================================================================\r\n    // STEP 1: Send warning emails for memberships expiring in 7 days\r\n    // ========================================================================\r\n    console.log(`[CRON] Step 1: Checking for memberships needing warning emails...`)\r\n      const warningMemberships = await env.DB.prepare(`\r\n      SELECT \r\n        m.id,\r\n        m.user_id,\r\n        m.plan,\r\n        m.end_date,\r\n        m.renewal_warning_sent,\r\n        u.email,\r\n        u.name\r\n      FROM memberships m\r\n      JOIN users u ON m.user_id = u.user_id\r\n      WHERE m.end_date = ?\r\n        AND m.auto_renew = 1\r\n        AND m.status = 'active'\r\n        AND (m.renewal_warning_sent = 0 OR m.renewal_warning_sent IS NULL)\r\n    `).bind(warningDateStr).all()\r\n    \r\n    console.log(`[CRON] Found ${warningMemberships.results?.length || 0} memberships needing warnings`)\r\n    \r\n    for (const membership of (warningMemberships.results || [])) {\r\n      try {\r\n        // Get payment instrument info for warning email\r\n        const instrument = await getActivePaymentInstrument(env.DB, membership.user_id)\r\n        const membershipWithInstrument = {\r\n          ...membership,\r\n          payment_instrument_last_4: instrument?.last_4 || null\r\n        }\r\n        \r\n        const emailContent = getUpcomingRenewalEmail(membershipWithInstrument, membership, 7)\r\n        await sendEmail(env, {\r\n          to: membership.email,\r\n          ...emailContent,\r\n          emailType: 'membership_renewal_reminder',\r\n          relatedId: membership.id,\r\n          relatedType: 'membership',\r\n          metadata: { plan: membership.plan, days_until_renewal: 7 }\r\n        })\r\n        \r\n        // Mark warning as sent\r\n        await env.DB.prepare('UPDATE memberships SET renewal_warning_sent = 1 WHERE id = ?')\r\n          .bind(membership.id).run()\r\n        \r\n        warningsSent++\r\n        console.log(`[CRON] Warning sent for membership ${membership.id} (${membership.email})`)\r\n      } catch (err) {\r\n        console.error(`[CRON] Failed to send warning for membership ${membership.id}:`, err)\r\n        errors.push({\r\n          membership_id: membership.id,\r\n          email: membership.email,\r\n          action: 'warning_email',\r\n          error: err.message\r\n        })\r\n      }\r\n    }\r\n    \r\n    // ========================================================================\r\n    // STEP 2: Process renewals for memberships expiring today or past-due\r\n    // ========================================================================\r\n    console.log(`[CRON] Step 2: Checking for memberships to renew...`)\r\n      const renewalMemberships = await env.DB.prepare(`\r\n      SELECT \r\n        m.id,\r\n        m.user_id,\r\n        m.plan,\r\n        m.end_date,\r\n        m.renewal_attempts,\r\n        m.amount,\r\n        u.email,\r\n        u.name\r\n      FROM memberships m\r\n      JOIN users u ON m.user_id = u.user_id\r\n      WHERE m.end_date <= ?\r\n        AND m.end_date >= ?\r\n        AND m.auto_renew = 1\r\n        AND m.status = 'active'\r\n        AND (m.renewal_attempts < 3 OR m.renewal_attempts IS NULL)\r\n    `).bind(today, gracePeriodStartStr).all()\r\n    \r\n    processed = renewalMemberships.results?.length || 0\r\n    console.log(`[CRON] Found ${processed} memberships to renew (including grace period)`)\r\n    \r\n    // Process each renewal using the existing processMembershipRenewal function\r\n    for (const membership of (renewalMemberships.results || [])) {\r\n      try {\r\n        console.log(`[CRON] Processing renewal for membership ${membership.id} (${membership.email})`)\r\n        const result = await processMembershipRenewal(env.DB, membership, env)\r\n        \r\n        if (result.success) {\r\n          succeeded++\r\n          console.log(`[CRON] \u2713 Successfully renewed membership ${membership.id}`)\r\n        } else {\r\n          failed++\r\n          errors.push({\r\n            membership_id: membership.id,\r\n            email: membership.email,\r\n            action: 'renewal',\r\n            error: result.error,\r\n            attempts: result.attempts\r\n          })\r\n          console.error(`[CRON] \u2717 Failed to renew membership ${membership.id}: ${result.error}`)\r\n        }\r\n      } catch (err) {\r\n        failed++\r\n        errors.push({\r\n          membership_id: membership.id,\r\n          email: membership.email,\r\n          action: 'renewal',\r\n          error: err.message\r\n        })\r\n        console.error(`[CRON] \u2717 Exception renewing membership ${membership.id}:`, err)\r\n      }\r\n    }\r\n    \r\n    // ========================================================================\r\n    // STEP 3: Mark expired memberships that have exhausted grace period\r\n    // ========================================================================\r\n    console.log(`[CRON] Step 3: Checking for expired memberships...`)\r\n    \r\n    const expiredResult = await env.DB.prepare(`\r\n      UPDATE memberships\r\n      SET status = 'expired'\r\n      WHERE end_date < ?\r\n        AND status = 'active'\r\n        AND (\r\n          auto_renew = 0 \r\n          OR renewal_attempts >= 3\r\n        )\r\n    `).bind(gracePeriodStartStr).run()\r\n    \r\n    expired = expiredResult.meta?.changes || 0\r\n    console.log(`[CRON] Marked ${expired} memberships as expired`)\r\n    \r\n    // Log final results\r\n    console.log(`[CRON] ${jobName} summary:`)\r\n    console.log(`  - Warnings sent: ${warningsSent}`)\r\n    console.log(`  - Renewals processed: ${processed}`)\r\n    console.log(`  - Renewals succeeded: ${succeeded}`)\r\n    console.log(`  - Renewals failed: ${failed}`)\r\n    console.log(`  - Memberships expired: ${expired}`)\r\n    \r\n    try {\r\n      await logCronJob(env.DB, jobName, failed > 0 ? 'partial' : 'completed', {\r\n        started_at: startedAt,\r\n        records_processed: processed,\r\n        records_succeeded: succeeded,\r\n        records_failed: failed,\r\n        extra: {\r\n          warnings_sent: warningsSent,\r\n          expired_count: expired,\r\n          errors: errors.length > 0 ? errors : undefined\r\n        }\r\n      })\r\n    } catch (logErr) {\r\n      console.error(`[CRON] ${jobName} - Failed to log success:`, logErr)\r\n    }\r\n    \r\n  } catch (err) {\r\n    console.error(`[CRON] ${jobName} failed:`, err)\r\n    try {\r\n      await logCronJob(env.DB, jobName, 'failed', {\r\n        started_at: startedAt,\r\n        records_processed: processed,\r\n        records_succeeded: succeeded,\r\n        records_failed: failed,\r\n        error_message: err.message,\r\n        extra: {\r\n          warnings_sent: warningsSent,\r\n          expired_count: expired,\r\n          errors: errors.length > 0 ? errors : undefined\r\n        }\r\n      })\r\n    } catch (logErr) {\r\n      console.error(`[CRON] ${jobName} - Failed to log error:`, logErr)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Process event reminders\r\n * Sends reminder emails for upcoming events\r\n */\r\nasync function processEventReminders(env) {\r\n  const jobName = 'event_reminders'\r\n  const startedAt = new Date().toISOString()\r\n  \r\n  console.log(`[CRON] Starting ${jobName} at ${startedAt}`)\r\n  \r\n  let processed = 0\r\n  let succeeded = 0\r\n  let failed = 0\r\n  const errors = []\r\n  \r\n  try {    // Find events happening tomorrow (24-hour reminder)\r\n    const tomorrow = new Date()\r\n    tomorrow.setDate(tomorrow.getDate() + 1)\r\n    const tomorrowDate = tomorrow.toISOString().split('T')[0]\r\n    \r\n    // Note: events table uses event_name, not title; also no event_time column\r\n    const upcomingEvents = await env.DB.prepare(`\r\n      SELECT \r\n        e.event_id,\r\n        e.event_name as title,\r\n        e.event_datetime,\r\n        COUNT(t.id) as ticket_count\r\n      FROM events e\r\n      LEFT JOIN tickets t ON e.event_id = t.event_id AND t.status IN ('confirmed', 'active')\r\n      WHERE DATE(e.event_datetime) = ?\r\n        AND e.is_active = 1\r\n      GROUP BY e.event_id\r\n    `).bind(tomorrowDate).all()\r\n    \r\n    processed = upcomingEvents.results?.length || 0\r\n    console.log(`[CRON] Found ${processed} events with reminders to send`)\r\n    \r\n    if (processed === 0) {\r\n      await logCronJob(env.DB, jobName, 'completed', {\r\n        started_at: startedAt,\r\n        records_processed: 0,\r\n        records_succeeded: 0,\r\n        records_failed: 0\r\n      })\r\n      return\r\n    }\r\n    \r\n    // Process reminders for each event\r\n    for (const event of upcomingEvents.results) {      try {\r\n        // Get attendees for this event\r\n        const attendees = await env.DB.prepare(`\r\n          SELECT \r\n            t.id as ticket_id,\r\n            t.user_id,\r\n            u.email,\r\n            u.name\r\n          FROM tickets t\r\n          JOIN users u ON t.user_id = u.user_id\r\n          WHERE t.event_id = ?\r\n            AND t.status IN ('confirmed', 'active')\r\n        `).bind(event.event_id).all()\r\n        \r\n        console.log(`[CRON] Would send ${attendees.results?.length || 0} reminders for event: ${event.title}`)\r\n        \r\n        // TODO: Send actual reminder emails\r\n        // For now, just log what would happen\r\n          succeeded++\r\n      } catch (err) {\r\n        failed++\r\n        errors.push({\r\n          event_id: event.event_id,\r\n          title: event.title,\r\n          error: err.message\r\n        })\r\n        console.error(`[CRON] Failed to send reminders for event ${event.event_id}:`, err)\r\n      }\r\n    }\r\n    \r\n    try {\r\n      await logCronJob(env.DB, jobName, failed > 0 ? 'partial' : 'completed', {\r\n        started_at: startedAt,\r\n        records_processed: processed,\r\n        records_succeeded: succeeded,\r\n        records_failed: failed,\r\n        extra: { errors: errors.length > 0 ? errors : undefined }\r\n      })\r\n    } catch (logErr) {\r\n      console.error(`[CRON] ${jobName} - Failed to log success:`, logErr)\r\n    }\r\n    \r\n  } catch (err) {\r\n    console.error(`[CRON] ${jobName} failed:`, err)\r\n    try {\r\n      await logCronJob(env.DB, jobName, 'failed', {\r\n        started_at: startedAt,\r\n        records_processed: processed,\r\n        records_succeeded: succeeded,\r\n        records_failed: failed,\r\n        error_message: err.message,\r\n        extra: { errors: errors.length > 0 ? errors : undefined }\r\n      })\r\n    } catch (logErr) {\r\n      console.error(`[CRON] ${jobName} - Failed to log error:`, logErr)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Reconcile payment statuses\r\n * Checks for stuck/pending payments and syncs with Stripe\r\n */\r\nasync function processPaymentReconciliation(env) {\r\n  const jobName = 'payment_reconciliation'\r\n  const startedAt = new Date().toISOString()\r\n  \r\n  console.log(`[CRON] Starting ${jobName} at ${startedAt}`)\r\n  \r\n  let processed = 0\r\n  let succeeded = 0\r\n  let failed = 0\r\n  const errors = []\r\n  \r\n  try {    // Find payments stuck in pending/processing for more than 1 hour\r\n    const oneHourAgo = new Date()\r\n    oneHourAgo.setHours(oneHourAgo.getHours() - 1)\r\n    const cutoffTime = oneHourAgo.toISOString()\r\n    \r\n    // Use transactions table instead of checkout_sessions\r\n    const stuckPayments = await env.DB.prepare(`\r\n      SELECT \r\n        checkout_id,\r\n        order_ref,\r\n        payment_status as status,\r\n        created_at\r\n      FROM transactions\r\n      WHERE payment_status IN ('pending', 'processing')\r\n        AND created_at < ?\r\n      LIMIT 100\r\n    `).bind(cutoffTime).all()\r\n    \r\n    processed = stuckPayments.results?.length || 0\r\n    console.log(`[CRON] Found ${processed} stuck payments to reconcile`)\r\n    \r\n    if (processed === 0) {\r\n      await logCronJob(env.DB, jobName, 'completed', {\r\n        started_at: startedAt,\r\n        records_processed: 0,\r\n        records_succeeded: 0,\r\n        records_failed: 0\r\n      })\r\n      return\r\n    }\r\n    \r\n    // Check each payment with Stripe\r\n    for (const payment of stuckPayments.results) {\r\n      try {        // TODO: Query Stripe/SumUp API to get actual payment status\r\n        console.log(`[CRON] Would check payment status for order_ref: ${payment.order_ref}`)\r\n        \r\n        // Future implementation:\r\n        // 1. Call payment provider API to get payment intent status\r\n        // 2. Update transactions payment_status accordingly\r\n        // 3. If failed, update memberships/tickets to 'cancelled'\r\n        // 4. Send appropriate notification emails\r\n          succeeded++\r\n      } catch (err) {\r\n        failed++\r\n        errors.push({\r\n          checkout_id: payment.checkout_id,\r\n          order_ref: payment.order_ref,\r\n          error: err.message\r\n        })\r\n        console.error(`[CRON] Failed to reconcile payment ${payment.order_ref}:`, err)\r\n      }\r\n    }\r\n    \r\n    try {\r\n      await logCronJob(env.DB, jobName, failed > 0 ? 'partial' : 'completed', {\r\n        started_at: startedAt,\r\n        records_processed: processed,\r\n        records_succeeded: succeeded,\r\n        records_failed: failed,\r\n        extra: { errors: errors.length > 0 ? errors : undefined }\r\n      })\r\n    } catch (logErr) {\r\n      console.error(`[CRON] ${jobName} - Failed to log success:`, logErr)\r\n    }\r\n    \r\n  } catch (err) {\r\n    console.error(`[CRON] ${jobName} failed:`, err)\r\n    try {\r\n      await logCronJob(env.DB, jobName, 'failed', {\r\n        started_at: startedAt,\r\n        records_processed: processed,\r\n        records_succeeded: succeeded,\r\n        records_failed: failed,\r\n        error_message: err.message,\r\n        extra: { errors: errors.length > 0 ? errors : undefined }\r\n      })\r\n    } catch (logErr) {\r\n      console.error(`[CRON] ${jobName} - Failed to log error:`, logErr)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Main scheduled handler - runs all cron jobs\r\n * Scheduled to run daily at 2 AM UTC\r\n */\r\nasync function handleScheduled(event, env, ctx) {\r\n  const runStarted = new Date().toISOString()\r\n  console.log('============================================')\r\n  console.log('Scheduled cron triggered at:', runStarted)\r\n  console.log('============================================')\r\n  \r\n  const jobResults = {\r\n    auto_renewals: null,\r\n    event_reminders: null,\r\n    payment_reconciliation: null\r\n  }\r\n  \r\n  // Run all cron jobs sequentially, catching errors individually\r\n  try {\r\n    await processAutoRenewals(env)\r\n    jobResults.auto_renewals = 'completed'\r\n  } catch (e) {\r\n    console.error('[CRON MASTER] Auto renewals failed:', e)\r\n    jobResults.auto_renewals = 'failed'\r\n    // Individual job already logged its own error\r\n  }\r\n  \r\n  try {\r\n    await processEventReminders(env)\r\n    jobResults.event_reminders = 'completed'\r\n  } catch (e) {\r\n    console.error('[CRON MASTER] Event reminders failed:', e)\r\n    jobResults.event_reminders = 'failed'\r\n    // Individual job already logged its own error\r\n  }\r\n  \r\n  try {\r\n    await processPaymentReconciliation(env)\r\n    jobResults.payment_reconciliation = 'completed'\r\n  } catch (e) {\r\n    console.error('[CRON MASTER] Payment reconciliation failed:', e)\r\n    jobResults.payment_reconciliation = 'failed'\r\n    // Individual job already logged its own error\r\n  }\r\n  \r\n  console.log('============================================')\r\n  console.log('All cron jobs completed at:', new Date().toISOString())\r\n  console.log('Job Results:', jobResults)\r\n  console.log('============================================')\r\n  \r\n  // Log the master cron run\r\n  const allSucceeded = Object.values(jobResults).every(r => r === 'completed')\r\n  const someFailed = Object.values(jobResults).some(r => r === 'failed')\r\n    try {\r\n    await logCronJob(env.DB, 'cron_master', allSucceeded ? 'completed' : 'partial', {\r\n      started_at: runStarted,\r\n      records_processed: 3,\r\n      records_succeeded: Object.values(jobResults).filter(r => r === 'completed').length,\r\n      records_failed: Object.values(jobResults).filter(r => r === 'failed').length,\r\n      extra: jobResults\r\n    })\r\n  } catch (logErr) {\r\n    console.error('[CRON MASTER] Failed to log master run:', logErr)\r\n  }\r\n}\r\n\r\nexport default {\r\n  fetch: app.fetch,\r\n  scheduled: handleScheduled\r\n}", "// src/index.ts\nimport { Hono } from \"./hono.js\";\nexport {\n  Hono\n};\n", "// src/hono.ts\nimport { HonoBase } from \"./hono-base.js\";\nimport { RegExpRouter } from \"./router/reg-exp-router/index.js\";\nimport { SmartRouter } from \"./router/smart-router/index.js\";\nimport { TrieRouter } from \"./router/trie-router/index.js\";\nvar Hono = class extends HonoBase {\n  constructor(options = {}) {\n    super(options);\n    this.router = options.router ?? new SmartRouter({\n      routers: [new RegExpRouter(), new TrieRouter()]\n    });\n  }\n};\nexport {\n  Hono\n};\n", "// src/hono-base.ts\nimport { compose } from \"./compose.js\";\nimport { Context } from \"./context.js\";\nimport { METHODS, METHOD_NAME_ALL, METHOD_NAME_ALL_LOWERCASE } from \"./router.js\";\nimport { COMPOSED_HANDLER } from \"./utils/constants.js\";\nimport { getPath, getPathNoStrict, mergePath } from \"./utils/url.js\";\nvar notFoundHandler = (c) => {\n  return c.text(\"404 Not Found\", 404);\n};\nvar errorHandler = (err, c) => {\n  if (\"getResponse\" in err) {\n    const res = err.getResponse();\n    return c.newResponse(res.body, res);\n  }\n  console.error(err);\n  return c.text(\"Internal Server Error\", 500);\n};\nvar Hono = class {\n  get;\n  post;\n  put;\n  delete;\n  options;\n  patch;\n  all;\n  on;\n  use;\n  router;\n  getPath;\n  _basePath = \"/\";\n  #path = \"/\";\n  routes = [];\n  constructor(options = {}) {\n    const allMethods = [...METHODS, METHOD_NAME_ALL_LOWERCASE];\n    allMethods.forEach((method) => {\n      this[method] = (args1, ...args) => {\n        if (typeof args1 === \"string\") {\n          this.#path = args1;\n        } else {\n          this.#addRoute(method, this.#path, args1);\n        }\n        args.forEach((handler) => {\n          this.#addRoute(method, this.#path, handler);\n        });\n        return this;\n      };\n    });\n    this.on = (method, path, ...handlers) => {\n      for (const p of [path].flat()) {\n        this.#path = p;\n        for (const m of [method].flat()) {\n          handlers.map((handler) => {\n            this.#addRoute(m.toUpperCase(), this.#path, handler);\n          });\n        }\n      }\n      return this;\n    };\n    this.use = (arg1, ...handlers) => {\n      if (typeof arg1 === \"string\") {\n        this.#path = arg1;\n      } else {\n        this.#path = \"*\";\n        handlers.unshift(arg1);\n      }\n      handlers.forEach((handler) => {\n        this.#addRoute(METHOD_NAME_ALL, this.#path, handler);\n      });\n      return this;\n    };\n    const { strict, ...optionsWithoutStrict } = options;\n    Object.assign(this, optionsWithoutStrict);\n    this.getPath = strict ?? true ? options.getPath ?? getPath : getPathNoStrict;\n  }\n  #clone() {\n    const clone = new Hono({\n      router: this.router,\n      getPath: this.getPath\n    });\n    clone.errorHandler = this.errorHandler;\n    clone.#notFoundHandler = this.#notFoundHandler;\n    clone.routes = this.routes;\n    return clone;\n  }\n  #notFoundHandler = notFoundHandler;\n  errorHandler = errorHandler;\n  route(path, app) {\n    const subApp = this.basePath(path);\n    app.routes.map((r) => {\n      let handler;\n      if (app.errorHandler === errorHandler) {\n        handler = r.handler;\n      } else {\n        handler = async (c, next) => (await compose([], app.errorHandler)(c, () => r.handler(c, next))).res;\n        handler[COMPOSED_HANDLER] = r.handler;\n      }\n      subApp.#addRoute(r.method, r.path, handler);\n    });\n    return this;\n  }\n  basePath(path) {\n    const subApp = this.#clone();\n    subApp._basePath = mergePath(this._basePath, path);\n    return subApp;\n  }\n  onError = (handler) => {\n    this.errorHandler = handler;\n    return this;\n  };\n  notFound = (handler) => {\n    this.#notFoundHandler = handler;\n    return this;\n  };\n  mount(path, applicationHandler, options) {\n    let replaceRequest;\n    let optionHandler;\n    if (options) {\n      if (typeof options === \"function\") {\n        optionHandler = options;\n      } else {\n        optionHandler = options.optionHandler;\n        if (options.replaceRequest === false) {\n          replaceRequest = (request) => request;\n        } else {\n          replaceRequest = options.replaceRequest;\n        }\n      }\n    }\n    const getOptions = optionHandler ? (c) => {\n      const options2 = optionHandler(c);\n      return Array.isArray(options2) ? options2 : [options2];\n    } : (c) => {\n      let executionContext = void 0;\n      try {\n        executionContext = c.executionCtx;\n      } catch {\n      }\n      return [c.env, executionContext];\n    };\n    replaceRequest ||= (() => {\n      const mergedPath = mergePath(this._basePath, path);\n      const pathPrefixLength = mergedPath === \"/\" ? 0 : mergedPath.length;\n      return (request) => {\n        const url = new URL(request.url);\n        url.pathname = url.pathname.slice(pathPrefixLength) || \"/\";\n        return new Request(url, request);\n      };\n    })();\n    const handler = async (c, next) => {\n      const res = await applicationHandler(replaceRequest(c.req.raw), ...getOptions(c));\n      if (res) {\n        return res;\n      }\n      await next();\n    };\n    this.#addRoute(METHOD_NAME_ALL, mergePath(path, \"*\"), handler);\n    return this;\n  }\n  #addRoute(method, path, handler) {\n    method = method.toUpperCase();\n    path = mergePath(this._basePath, path);\n    const r = { basePath: this._basePath, path, method, handler };\n    this.router.add(method, path, [handler, r]);\n    this.routes.push(r);\n  }\n  #handleError(err, c) {\n    if (err instanceof Error) {\n      return this.errorHandler(err, c);\n    }\n    throw err;\n  }\n  #dispatch(request, executionCtx, env, method) {\n    if (method === \"HEAD\") {\n      return (async () => new Response(null, await this.#dispatch(request, executionCtx, env, \"GET\")))();\n    }\n    const path = this.getPath(request, { env });\n    const matchResult = this.router.match(method, path);\n    const c = new Context(request, {\n      path,\n      matchResult,\n      env,\n      executionCtx,\n      notFoundHandler: this.#notFoundHandler\n    });\n    if (matchResult[0].length === 1) {\n      let res;\n      try {\n        res = matchResult[0][0][0][0](c, async () => {\n          c.res = await this.#notFoundHandler(c);\n        });\n      } catch (err) {\n        return this.#handleError(err, c);\n      }\n      return res instanceof Promise ? res.then(\n        (resolved) => resolved || (c.finalized ? c.res : this.#notFoundHandler(c))\n      ).catch((err) => this.#handleError(err, c)) : res ?? this.#notFoundHandler(c);\n    }\n    const composed = compose(matchResult[0], this.errorHandler, this.#notFoundHandler);\n    return (async () => {\n      try {\n        const context = await composed(c);\n        if (!context.finalized) {\n          throw new Error(\n            \"Context is not finalized. Did you forget to return a Response object or `await next()`?\"\n          );\n        }\n        return context.res;\n      } catch (err) {\n        return this.#handleError(err, c);\n      }\n    })();\n  }\n  fetch = (request, ...rest) => {\n    return this.#dispatch(request, rest[1], rest[0], request.method);\n  };\n  request = (input, requestInit, Env, executionCtx) => {\n    if (input instanceof Request) {\n      return this.fetch(requestInit ? new Request(input, requestInit) : input, Env, executionCtx);\n    }\n    input = input.toString();\n    return this.fetch(\n      new Request(\n        /^https?:\\/\\//.test(input) ? input : `http://localhost${mergePath(\"/\", input)}`,\n        requestInit\n      ),\n      Env,\n      executionCtx\n    );\n  };\n  fire = () => {\n    addEventListener(\"fetch\", (event) => {\n      event.respondWith(this.#dispatch(event.request, event, void 0, event.request.method));\n    });\n  };\n};\nexport {\n  Hono as HonoBase\n};\n", "// src/compose.ts\nvar compose = (middleware, onError, onNotFound) => {\n  return (context, next) => {\n    let index = -1;\n    return dispatch(0);\n    async function dispatch(i) {\n      if (i <= index) {\n        throw new Error(\"next() called multiple times\");\n      }\n      index = i;\n      let res;\n      let isError = false;\n      let handler;\n      if (middleware[i]) {\n        handler = middleware[i][0][0];\n        context.req.routeIndex = i;\n      } else {\n        handler = i === middleware.length && next || void 0;\n      }\n      if (handler) {\n        try {\n          res = await handler(context, () => dispatch(i + 1));\n        } catch (err) {\n          if (err instanceof Error && onError) {\n            context.error = err;\n            res = await onError(err, context);\n            isError = true;\n          } else {\n            throw err;\n          }\n        }\n      } else {\n        if (context.finalized === false && onNotFound) {\n          res = await onNotFound(context);\n        }\n      }\n      if (res && (context.finalized === false || isError)) {\n        context.res = res;\n      }\n      return context;\n    }\n  };\n};\nexport {\n  compose\n};\n", "// src/context.ts\nimport { HonoRequest } from \"./request.js\";\nimport { HtmlEscapedCallbackPhase, resolveCallback } from \"./utils/html.js\";\nvar TEXT_PLAIN = \"text/plain; charset=UTF-8\";\nvar setDefaultContentType = (contentType, headers) => {\n  return {\n    \"Content-Type\": contentType,\n    ...headers\n  };\n};\nvar Context = class {\n  #rawRequest;\n  #req;\n  env = {};\n  #var;\n  finalized = false;\n  error;\n  #status;\n  #executionCtx;\n  #res;\n  #layout;\n  #renderer;\n  #notFoundHandler;\n  #preparedHeaders;\n  #matchResult;\n  #path;\n  constructor(req, options) {\n    this.#rawRequest = req;\n    if (options) {\n      this.#executionCtx = options.executionCtx;\n      this.env = options.env;\n      this.#notFoundHandler = options.notFoundHandler;\n      this.#path = options.path;\n      this.#matchResult = options.matchResult;\n    }\n  }\n  get req() {\n    this.#req ??= new HonoRequest(this.#rawRequest, this.#path, this.#matchResult);\n    return this.#req;\n  }\n  get event() {\n    if (this.#executionCtx && \"respondWith\" in this.#executionCtx) {\n      return this.#executionCtx;\n    } else {\n      throw Error(\"This context has no FetchEvent\");\n    }\n  }\n  get executionCtx() {\n    if (this.#executionCtx) {\n      return this.#executionCtx;\n    } else {\n      throw Error(\"This context has no ExecutionContext\");\n    }\n  }\n  get res() {\n    return this.#res ||= new Response(null, {\n      headers: this.#preparedHeaders ??= new Headers()\n    });\n  }\n  set res(_res) {\n    if (this.#res && _res) {\n      _res = new Response(_res.body, _res);\n      for (const [k, v] of this.#res.headers.entries()) {\n        if (k === \"content-type\") {\n          continue;\n        }\n        if (k === \"set-cookie\") {\n          const cookies = this.#res.headers.getSetCookie();\n          _res.headers.delete(\"set-cookie\");\n          for (const cookie of cookies) {\n            _res.headers.append(\"set-cookie\", cookie);\n          }\n        } else {\n          _res.headers.set(k, v);\n        }\n      }\n    }\n    this.#res = _res;\n    this.finalized = true;\n  }\n  render = (...args) => {\n    this.#renderer ??= (content) => this.html(content);\n    return this.#renderer(...args);\n  };\n  setLayout = (layout) => this.#layout = layout;\n  getLayout = () => this.#layout;\n  setRenderer = (renderer) => {\n    this.#renderer = renderer;\n  };\n  header = (name, value, options) => {\n    if (this.finalized) {\n      this.#res = new Response(this.#res.body, this.#res);\n    }\n    const headers = this.#res ? this.#res.headers : this.#preparedHeaders ??= new Headers();\n    if (value === void 0) {\n      headers.delete(name);\n    } else if (options?.append) {\n      headers.append(name, value);\n    } else {\n      headers.set(name, value);\n    }\n  };\n  status = (status) => {\n    this.#status = status;\n  };\n  set = (key, value) => {\n    this.#var ??= /* @__PURE__ */ new Map();\n    this.#var.set(key, value);\n  };\n  get = (key) => {\n    return this.#var ? this.#var.get(key) : void 0;\n  };\n  get var() {\n    if (!this.#var) {\n      return {};\n    }\n    return Object.fromEntries(this.#var);\n  }\n  #newResponse(data, arg, headers) {\n    const responseHeaders = this.#res ? new Headers(this.#res.headers) : this.#preparedHeaders ?? new Headers();\n    if (typeof arg === \"object\" && \"headers\" in arg) {\n      const argHeaders = arg.headers instanceof Headers ? arg.headers : new Headers(arg.headers);\n      for (const [key, value] of argHeaders) {\n        if (key.toLowerCase() === \"set-cookie\") {\n          responseHeaders.append(key, value);\n        } else {\n          responseHeaders.set(key, value);\n        }\n      }\n    }\n    if (headers) {\n      for (const [k, v] of Object.entries(headers)) {\n        if (typeof v === \"string\") {\n          responseHeaders.set(k, v);\n        } else {\n          responseHeaders.delete(k);\n          for (const v2 of v) {\n            responseHeaders.append(k, v2);\n          }\n        }\n      }\n    }\n    const status = typeof arg === \"number\" ? arg : arg?.status ?? this.#status;\n    return new Response(data, { status, headers: responseHeaders });\n  }\n  newResponse = (...args) => this.#newResponse(...args);\n  body = (data, arg, headers) => this.#newResponse(data, arg, headers);\n  text = (text, arg, headers) => {\n    return !this.#preparedHeaders && !this.#status && !arg && !headers && !this.finalized ? new Response(text) : this.#newResponse(\n      text,\n      arg,\n      setDefaultContentType(TEXT_PLAIN, headers)\n    );\n  };\n  json = (object, arg, headers) => {\n    return this.#newResponse(\n      JSON.stringify(object),\n      arg,\n      setDefaultContentType(\"application/json\", headers)\n    );\n  };\n  html = (html, arg, headers) => {\n    const res = (html2) => this.#newResponse(html2, arg, setDefaultContentType(\"text/html; charset=UTF-8\", headers));\n    return typeof html === \"object\" ? resolveCallback(html, HtmlEscapedCallbackPhase.Stringify, false, {}).then(res) : res(html);\n  };\n  redirect = (location, status) => {\n    const locationString = String(location);\n    this.header(\n      \"Location\",\n      !/[^\\x00-\\xFF]/.test(locationString) ? locationString : encodeURI(locationString)\n    );\n    return this.newResponse(null, status ?? 302);\n  };\n  notFound = () => {\n    this.#notFoundHandler ??= () => new Response();\n    return this.#notFoundHandler(this);\n  };\n};\nexport {\n  Context,\n  TEXT_PLAIN\n};\n", "// src/request.ts\nimport { HTTPException } from \"./http-exception.js\";\nimport { GET_MATCH_RESULT } from \"./request/constants.js\";\nimport { parseBody } from \"./utils/body.js\";\nimport { decodeURIComponent_, getQueryParam, getQueryParams, tryDecode } from \"./utils/url.js\";\nvar tryDecodeURIComponent = (str) => tryDecode(str, decodeURIComponent_);\nvar HonoRequest = class {\n  raw;\n  #validatedData;\n  #matchResult;\n  routeIndex = 0;\n  path;\n  bodyCache = {};\n  constructor(request, path = \"/\", matchResult = [[]]) {\n    this.raw = request;\n    this.path = path;\n    this.#matchResult = matchResult;\n    this.#validatedData = {};\n  }\n  param(key) {\n    return key ? this.#getDecodedParam(key) : this.#getAllDecodedParams();\n  }\n  #getDecodedParam(key) {\n    const paramKey = this.#matchResult[0][this.routeIndex][1][key];\n    const param = this.#getParamValue(paramKey);\n    return param && /\\%/.test(param) ? tryDecodeURIComponent(param) : param;\n  }\n  #getAllDecodedParams() {\n    const decoded = {};\n    const keys = Object.keys(this.#matchResult[0][this.routeIndex][1]);\n    for (const key of keys) {\n      const value = this.#getParamValue(this.#matchResult[0][this.routeIndex][1][key]);\n      if (value !== void 0) {\n        decoded[key] = /\\%/.test(value) ? tryDecodeURIComponent(value) : value;\n      }\n    }\n    return decoded;\n  }\n  #getParamValue(paramKey) {\n    return this.#matchResult[1] ? this.#matchResult[1][paramKey] : paramKey;\n  }\n  query(key) {\n    return getQueryParam(this.url, key);\n  }\n  queries(key) {\n    return getQueryParams(this.url, key);\n  }\n  header(name) {\n    if (name) {\n      return this.raw.headers.get(name) ?? void 0;\n    }\n    const headerData = {};\n    this.raw.headers.forEach((value, key) => {\n      headerData[key] = value;\n    });\n    return headerData;\n  }\n  async parseBody(options) {\n    return this.bodyCache.parsedBody ??= await parseBody(this, options);\n  }\n  #cachedBody = (key) => {\n    const { bodyCache, raw } = this;\n    const cachedBody = bodyCache[key];\n    if (cachedBody) {\n      return cachedBody;\n    }\n    const anyCachedKey = Object.keys(bodyCache)[0];\n    if (anyCachedKey) {\n      return bodyCache[anyCachedKey].then((body) => {\n        if (anyCachedKey === \"json\") {\n          body = JSON.stringify(body);\n        }\n        return new Response(body)[key]();\n      });\n    }\n    return bodyCache[key] = raw[key]();\n  };\n  json() {\n    return this.#cachedBody(\"text\").then((text) => JSON.parse(text));\n  }\n  text() {\n    return this.#cachedBody(\"text\");\n  }\n  arrayBuffer() {\n    return this.#cachedBody(\"arrayBuffer\");\n  }\n  blob() {\n    return this.#cachedBody(\"blob\");\n  }\n  formData() {\n    return this.#cachedBody(\"formData\");\n  }\n  addValidatedData(target, data) {\n    this.#validatedData[target] = data;\n  }\n  valid(target) {\n    return this.#validatedData[target];\n  }\n  get url() {\n    return this.raw.url;\n  }\n  get method() {\n    return this.raw.method;\n  }\n  get [GET_MATCH_RESULT]() {\n    return this.#matchResult;\n  }\n  get matchedRoutes() {\n    return this.#matchResult[0].map(([[, route]]) => route);\n  }\n  get routePath() {\n    return this.#matchResult[0].map(([[, route]]) => route)[this.routeIndex].path;\n  }\n};\nvar cloneRawRequest = async (req) => {\n  if (!req.raw.bodyUsed) {\n    return req.raw.clone();\n  }\n  const cacheKey = Object.keys(req.bodyCache)[0];\n  if (!cacheKey) {\n    throw new HTTPException(500, {\n      message: \"Cannot clone request: body was already consumed and not cached. Please use HonoRequest methods (e.g., req.json(), req.text()) instead of consuming req.raw directly.\"\n    });\n  }\n  const requestInit = {\n    body: await req[cacheKey](),\n    cache: req.raw.cache,\n    credentials: req.raw.credentials,\n    headers: req.header(),\n    integrity: req.raw.integrity,\n    keepalive: req.raw.keepalive,\n    method: req.method,\n    mode: req.raw.mode,\n    redirect: req.raw.redirect,\n    referrer: req.raw.referrer,\n    referrerPolicy: req.raw.referrerPolicy,\n    signal: req.raw.signal\n  };\n  return new Request(req.url, requestInit);\n};\nexport {\n  HonoRequest,\n  cloneRawRequest\n};\n", "// src/http-exception.ts\nvar HTTPException = class extends Error {\n  res;\n  status;\n  constructor(status = 500, options) {\n    super(options?.message, { cause: options?.cause });\n    this.res = options?.res;\n    this.status = status;\n  }\n  getResponse() {\n    if (this.res) {\n      const newResponse = new Response(this.res.body, {\n        status: this.status,\n        headers: this.res.headers\n      });\n      return newResponse;\n    }\n    return new Response(this.message, {\n      status: this.status\n    });\n  }\n};\nexport {\n  HTTPException\n};\n", "// src/request/constants.ts\nvar GET_MATCH_RESULT = Symbol();\nexport {\n  GET_MATCH_RESULT\n};\n", "// src/utils/body.ts\nimport { HonoRequest } from \"../request.js\";\nvar parseBody = async (request, options = /* @__PURE__ */ Object.create(null)) => {\n  const { all = false, dot = false } = options;\n  const headers = request instanceof HonoRequest ? request.raw.headers : request.headers;\n  const contentType = headers.get(\"Content-Type\");\n  if (contentType?.startsWith(\"multipart/form-data\") || contentType?.startsWith(\"application/x-www-form-urlencoded\")) {\n    return parseFormData(request, { all, dot });\n  }\n  return {};\n};\nasync function parseFormData(request, options) {\n  const formData = await request.formData();\n  if (formData) {\n    return convertFormDataToBodyData(formData, options);\n  }\n  return {};\n}\nfunction convertFormDataToBodyData(formData, options) {\n  const form = /* @__PURE__ */ Object.create(null);\n  formData.forEach((value, key) => {\n    const shouldParseAllValues = options.all || key.endsWith(\"[]\");\n    if (!shouldParseAllValues) {\n      form[key] = value;\n    } else {\n      handleParsingAllValues(form, key, value);\n    }\n  });\n  if (options.dot) {\n    Object.entries(form).forEach(([key, value]) => {\n      const shouldParseDotValues = key.includes(\".\");\n      if (shouldParseDotValues) {\n        handleParsingNestedValues(form, key, value);\n        delete form[key];\n      }\n    });\n  }\n  return form;\n}\nvar handleParsingAllValues = (form, key, value) => {\n  if (form[key] !== void 0) {\n    if (Array.isArray(form[key])) {\n      ;\n      form[key].push(value);\n    } else {\n      form[key] = [form[key], value];\n    }\n  } else {\n    if (!key.endsWith(\"[]\")) {\n      form[key] = value;\n    } else {\n      form[key] = [value];\n    }\n  }\n};\nvar handleParsingNestedValues = (form, key, value) => {\n  let nestedForm = form;\n  const keys = key.split(\".\");\n  keys.forEach((key2, index) => {\n    if (index === keys.length - 1) {\n      nestedForm[key2] = value;\n    } else {\n      if (!nestedForm[key2] || typeof nestedForm[key2] !== \"object\" || Array.isArray(nestedForm[key2]) || nestedForm[key2] instanceof File) {\n        nestedForm[key2] = /* @__PURE__ */ Object.create(null);\n      }\n      nestedForm = nestedForm[key2];\n    }\n  });\n};\nexport {\n  parseBody\n};\n", "// src/utils/url.ts\nvar splitPath = (path) => {\n  const paths = path.split(\"/\");\n  if (paths[0] === \"\") {\n    paths.shift();\n  }\n  return paths;\n};\nvar splitRoutingPath = (routePath) => {\n  const { groups, path } = extractGroupsFromPath(routePath);\n  const paths = splitPath(path);\n  return replaceGroupMarks(paths, groups);\n};\nvar extractGroupsFromPath = (path) => {\n  const groups = [];\n  path = path.replace(/\\{[^}]+\\}/g, (match, index) => {\n    const mark = `@${index}`;\n    groups.push([mark, match]);\n    return mark;\n  });\n  return { groups, path };\n};\nvar replaceGroupMarks = (paths, groups) => {\n  for (let i = groups.length - 1; i >= 0; i--) {\n    const [mark] = groups[i];\n    for (let j = paths.length - 1; j >= 0; j--) {\n      if (paths[j].includes(mark)) {\n        paths[j] = paths[j].replace(mark, groups[i][1]);\n        break;\n      }\n    }\n  }\n  return paths;\n};\nvar patternCache = {};\nvar getPattern = (label, next) => {\n  if (label === \"*\") {\n    return \"*\";\n  }\n  const match = label.match(/^\\:([^\\{\\}]+)(?:\\{(.+)\\})?$/);\n  if (match) {\n    const cacheKey = `${label}#${next}`;\n    if (!patternCache[cacheKey]) {\n      if (match[2]) {\n        patternCache[cacheKey] = next && next[0] !== \":\" && next[0] !== \"*\" ? [cacheKey, match[1], new RegExp(`^${match[2]}(?=/${next})`)] : [label, match[1], new RegExp(`^${match[2]}$`)];\n      } else {\n        patternCache[cacheKey] = [label, match[1], true];\n      }\n    }\n    return patternCache[cacheKey];\n  }\n  return null;\n};\nvar tryDecode = (str, decoder) => {\n  try {\n    return decoder(str);\n  } catch {\n    return str.replace(/(?:%[0-9A-Fa-f]{2})+/g, (match) => {\n      try {\n        return decoder(match);\n      } catch {\n        return match;\n      }\n    });\n  }\n};\nvar tryDecodeURI = (str) => tryDecode(str, decodeURI);\nvar getPath = (request) => {\n  const url = request.url;\n  const start = url.indexOf(\"/\", url.indexOf(\":\") + 4);\n  let i = start;\n  for (; i < url.length; i++) {\n    const charCode = url.charCodeAt(i);\n    if (charCode === 37) {\n      const queryIndex = url.indexOf(\"?\", i);\n      const path = url.slice(start, queryIndex === -1 ? void 0 : queryIndex);\n      return tryDecodeURI(path.includes(\"%25\") ? path.replace(/%25/g, \"%2525\") : path);\n    } else if (charCode === 63) {\n      break;\n    }\n  }\n  return url.slice(start, i);\n};\nvar getQueryStrings = (url) => {\n  const queryIndex = url.indexOf(\"?\", 8);\n  return queryIndex === -1 ? \"\" : \"?\" + url.slice(queryIndex + 1);\n};\nvar getPathNoStrict = (request) => {\n  const result = getPath(request);\n  return result.length > 1 && result.at(-1) === \"/\" ? result.slice(0, -1) : result;\n};\nvar mergePath = (base, sub, ...rest) => {\n  if (rest.length) {\n    sub = mergePath(sub, ...rest);\n  }\n  return `${base?.[0] === \"/\" ? \"\" : \"/\"}${base}${sub === \"/\" ? \"\" : `${base?.at(-1) === \"/\" ? \"\" : \"/\"}${sub?.[0] === \"/\" ? sub.slice(1) : sub}`}`;\n};\nvar checkOptionalParameter = (path) => {\n  if (path.charCodeAt(path.length - 1) !== 63 || !path.includes(\":\")) {\n    return null;\n  }\n  const segments = path.split(\"/\");\n  const results = [];\n  let basePath = \"\";\n  segments.forEach((segment) => {\n    if (segment !== \"\" && !/\\:/.test(segment)) {\n      basePath += \"/\" + segment;\n    } else if (/\\:/.test(segment)) {\n      if (/\\?/.test(segment)) {\n        if (results.length === 0 && basePath === \"\") {\n          results.push(\"/\");\n        } else {\n          results.push(basePath);\n        }\n        const optionalSegment = segment.replace(\"?\", \"\");\n        basePath += \"/\" + optionalSegment;\n        results.push(basePath);\n      } else {\n        basePath += \"/\" + segment;\n      }\n    }\n  });\n  return results.filter((v, i, a) => a.indexOf(v) === i);\n};\nvar _decodeURI = (value) => {\n  if (!/[%+]/.test(value)) {\n    return value;\n  }\n  if (value.indexOf(\"+\") !== -1) {\n    value = value.replace(/\\+/g, \" \");\n  }\n  return value.indexOf(\"%\") !== -1 ? tryDecode(value, decodeURIComponent_) : value;\n};\nvar _getQueryParam = (url, key, multiple) => {\n  let encoded;\n  if (!multiple && key && !/[%+]/.test(key)) {\n    let keyIndex2 = url.indexOf(`?${key}`, 8);\n    if (keyIndex2 === -1) {\n      keyIndex2 = url.indexOf(`&${key}`, 8);\n    }\n    while (keyIndex2 !== -1) {\n      const trailingKeyCode = url.charCodeAt(keyIndex2 + key.length + 1);\n      if (trailingKeyCode === 61) {\n        const valueIndex = keyIndex2 + key.length + 2;\n        const endIndex = url.indexOf(\"&\", valueIndex);\n        return _decodeURI(url.slice(valueIndex, endIndex === -1 ? void 0 : endIndex));\n      } else if (trailingKeyCode == 38 || isNaN(trailingKeyCode)) {\n        return \"\";\n      }\n      keyIndex2 = url.indexOf(`&${key}`, keyIndex2 + 1);\n    }\n    encoded = /[%+]/.test(url);\n    if (!encoded) {\n      return void 0;\n    }\n  }\n  const results = {};\n  encoded ??= /[%+]/.test(url);\n  let keyIndex = url.indexOf(\"?\", 8);\n  while (keyIndex !== -1) {\n    const nextKeyIndex = url.indexOf(\"&\", keyIndex + 1);\n    let valueIndex = url.indexOf(\"=\", keyIndex);\n    if (valueIndex > nextKeyIndex && nextKeyIndex !== -1) {\n      valueIndex = -1;\n    }\n    let name = url.slice(\n      keyIndex + 1,\n      valueIndex === -1 ? nextKeyIndex === -1 ? void 0 : nextKeyIndex : valueIndex\n    );\n    if (encoded) {\n      name = _decodeURI(name);\n    }\n    keyIndex = nextKeyIndex;\n    if (name === \"\") {\n      continue;\n    }\n    let value;\n    if (valueIndex === -1) {\n      value = \"\";\n    } else {\n      value = url.slice(valueIndex + 1, nextKeyIndex === -1 ? void 0 : nextKeyIndex);\n      if (encoded) {\n        value = _decodeURI(value);\n      }\n    }\n    if (multiple) {\n      if (!(results[name] && Array.isArray(results[name]))) {\n        results[name] = [];\n      }\n      ;\n      results[name].push(value);\n    } else {\n      results[name] ??= value;\n    }\n  }\n  return key ? results[key] : results;\n};\nvar getQueryParam = _getQueryParam;\nvar getQueryParams = (url, key) => {\n  return _getQueryParam(url, key, true);\n};\nvar decodeURIComponent_ = decodeURIComponent;\nexport {\n  checkOptionalParameter,\n  decodeURIComponent_,\n  getPath,\n  getPathNoStrict,\n  getPattern,\n  getQueryParam,\n  getQueryParams,\n  getQueryStrings,\n  mergePath,\n  splitPath,\n  splitRoutingPath,\n  tryDecode\n};\n", "// src/utils/html.ts\nvar HtmlEscapedCallbackPhase = {\n  Stringify: 1,\n  BeforeStream: 2,\n  Stream: 3\n};\nvar raw = (value, callbacks) => {\n  const escapedString = new String(value);\n  escapedString.isEscaped = true;\n  escapedString.callbacks = callbacks;\n  return escapedString;\n};\nvar escapeRe = /[&<>'\"]/;\nvar stringBufferToString = async (buffer, callbacks) => {\n  let str = \"\";\n  callbacks ||= [];\n  const resolvedBuffer = await Promise.all(buffer);\n  for (let i = resolvedBuffer.length - 1; ; i--) {\n    str += resolvedBuffer[i];\n    i--;\n    if (i < 0) {\n      break;\n    }\n    let r = resolvedBuffer[i];\n    if (typeof r === \"object\") {\n      callbacks.push(...r.callbacks || []);\n    }\n    const isEscaped = r.isEscaped;\n    r = await (typeof r === \"object\" ? r.toString() : r);\n    if (typeof r === \"object\") {\n      callbacks.push(...r.callbacks || []);\n    }\n    if (r.isEscaped ?? isEscaped) {\n      str += r;\n    } else {\n      const buf = [str];\n      escapeToBuffer(r, buf);\n      str = buf[0];\n    }\n  }\n  return raw(str, callbacks);\n};\nvar escapeToBuffer = (str, buffer) => {\n  const match = str.search(escapeRe);\n  if (match === -1) {\n    buffer[0] += str;\n    return;\n  }\n  let escape;\n  let index;\n  let lastIndex = 0;\n  for (index = match; index < str.length; index++) {\n    switch (str.charCodeAt(index)) {\n      case 34:\n        escape = \"&quot;\";\n        break;\n      case 39:\n        escape = \"&#39;\";\n        break;\n      case 38:\n        escape = \"&amp;\";\n        break;\n      case 60:\n        escape = \"&lt;\";\n        break;\n      case 62:\n        escape = \"&gt;\";\n        break;\n      default:\n        continue;\n    }\n    buffer[0] += str.substring(lastIndex, index) + escape;\n    lastIndex = index + 1;\n  }\n  buffer[0] += str.substring(lastIndex, index);\n};\nvar resolveCallbackSync = (str) => {\n  const callbacks = str.callbacks;\n  if (!callbacks?.length) {\n    return str;\n  }\n  const buffer = [str];\n  const context = {};\n  callbacks.forEach((c) => c({ phase: HtmlEscapedCallbackPhase.Stringify, buffer, context }));\n  return buffer[0];\n};\nvar resolveCallback = async (str, phase, preserveCallbacks, context, buffer) => {\n  if (typeof str === \"object\" && !(str instanceof String)) {\n    if (!(str instanceof Promise)) {\n      str = str.toString();\n    }\n    if (str instanceof Promise) {\n      str = await str;\n    }\n  }\n  const callbacks = str.callbacks;\n  if (!callbacks?.length) {\n    return Promise.resolve(str);\n  }\n  if (buffer) {\n    buffer[0] += str;\n  } else {\n    buffer = [str];\n  }\n  const resStr = Promise.all(callbacks.map((c) => c({ phase, buffer, context }))).then(\n    (res) => Promise.all(\n      res.filter(Boolean).map((str2) => resolveCallback(str2, phase, false, context, buffer))\n    ).then(() => buffer[0])\n  );\n  if (preserveCallbacks) {\n    return raw(await resStr, callbacks);\n  } else {\n    return resStr;\n  }\n};\nexport {\n  HtmlEscapedCallbackPhase,\n  escapeToBuffer,\n  raw,\n  resolveCallback,\n  resolveCallbackSync,\n  stringBufferToString\n};\n", "// src/router.ts\nvar METHOD_NAME_ALL = \"ALL\";\nvar METHOD_NAME_ALL_LOWERCASE = \"all\";\nvar METHODS = [\"get\", \"post\", \"put\", \"delete\", \"options\", \"patch\"];\nvar MESSAGE_MATCHER_IS_ALREADY_BUILT = \"Can not add a route since the matcher is already built.\";\nvar UnsupportedPathError = class extends Error {\n};\nexport {\n  MESSAGE_MATCHER_IS_ALREADY_BUILT,\n  METHODS,\n  METHOD_NAME_ALL,\n  METHOD_NAME_ALL_LOWERCASE,\n  UnsupportedPathError\n};\n", "// src/utils/constants.ts\nvar COMPOSED_HANDLER = \"__COMPOSED_HANDLER\";\nexport {\n  COMPOSED_HANDLER\n};\n", "// src/router/reg-exp-router/index.ts\nimport { RegExpRouter } from \"./router.js\";\nimport { PreparedRegExpRouter, buildInitParams, serializeInitParams } from \"./prepared-router.js\";\nexport {\n  PreparedRegExpRouter,\n  RegExpRouter,\n  buildInitParams,\n  serializeInitParams\n};\n", "// src/router/reg-exp-router/router.ts\nimport {\n  MESSAGE_MATCHER_IS_ALREADY_BUILT,\n  METHOD_NAME_ALL,\n  UnsupportedPathError\n} from \"../../router.js\";\nimport { checkOptionalParameter } from \"../../utils/url.js\";\nimport { match, emptyParam } from \"./matcher.js\";\nimport { PATH_ERROR } from \"./node.js\";\nimport { Trie } from \"./trie.js\";\nvar nullMatcher = [/^$/, [], /* @__PURE__ */ Object.create(null)];\nvar wildcardRegExpCache = /* @__PURE__ */ Object.create(null);\nfunction buildWildcardRegExp(path) {\n  return wildcardRegExpCache[path] ??= new RegExp(\n    path === \"*\" ? \"\" : `^${path.replace(\n      /\\/\\*$|([.\\\\+*[^\\]$()])/g,\n      (_, metaChar) => metaChar ? `\\\\${metaChar}` : \"(?:|/.*)\"\n    )}$`\n  );\n}\nfunction clearWildcardRegExpCache() {\n  wildcardRegExpCache = /* @__PURE__ */ Object.create(null);\n}\nfunction buildMatcherFromPreprocessedRoutes(routes) {\n  const trie = new Trie();\n  const handlerData = [];\n  if (routes.length === 0) {\n    return nullMatcher;\n  }\n  const routesWithStaticPathFlag = routes.map(\n    (route) => [!/\\*|\\/:/.test(route[0]), ...route]\n  ).sort(\n    ([isStaticA, pathA], [isStaticB, pathB]) => isStaticA ? 1 : isStaticB ? -1 : pathA.length - pathB.length\n  );\n  const staticMap = /* @__PURE__ */ Object.create(null);\n  for (let i = 0, j = -1, len = routesWithStaticPathFlag.length; i < len; i++) {\n    const [pathErrorCheckOnly, path, handlers] = routesWithStaticPathFlag[i];\n    if (pathErrorCheckOnly) {\n      staticMap[path] = [handlers.map(([h]) => [h, /* @__PURE__ */ Object.create(null)]), emptyParam];\n    } else {\n      j++;\n    }\n    let paramAssoc;\n    try {\n      paramAssoc = trie.insert(path, j, pathErrorCheckOnly);\n    } catch (e) {\n      throw e === PATH_ERROR ? new UnsupportedPathError(path) : e;\n    }\n    if (pathErrorCheckOnly) {\n      continue;\n    }\n    handlerData[j] = handlers.map(([h, paramCount]) => {\n      const paramIndexMap = /* @__PURE__ */ Object.create(null);\n      paramCount -= 1;\n      for (; paramCount >= 0; paramCount--) {\n        const [key, value] = paramAssoc[paramCount];\n        paramIndexMap[key] = value;\n      }\n      return [h, paramIndexMap];\n    });\n  }\n  const [regexp, indexReplacementMap, paramReplacementMap] = trie.buildRegExp();\n  for (let i = 0, len = handlerData.length; i < len; i++) {\n    for (let j = 0, len2 = handlerData[i].length; j < len2; j++) {\n      const map = handlerData[i][j]?.[1];\n      if (!map) {\n        continue;\n      }\n      const keys = Object.keys(map);\n      for (let k = 0, len3 = keys.length; k < len3; k++) {\n        map[keys[k]] = paramReplacementMap[map[keys[k]]];\n      }\n    }\n  }\n  const handlerMap = [];\n  for (const i in indexReplacementMap) {\n    handlerMap[i] = handlerData[indexReplacementMap[i]];\n  }\n  return [regexp, handlerMap, staticMap];\n}\nfunction findMiddleware(middleware, path) {\n  if (!middleware) {\n    return void 0;\n  }\n  for (const k of Object.keys(middleware).sort((a, b) => b.length - a.length)) {\n    if (buildWildcardRegExp(k).test(path)) {\n      return [...middleware[k]];\n    }\n  }\n  return void 0;\n}\nvar RegExpRouter = class {\n  name = \"RegExpRouter\";\n  #middleware;\n  #routes;\n  constructor() {\n    this.#middleware = { [METHOD_NAME_ALL]: /* @__PURE__ */ Object.create(null) };\n    this.#routes = { [METHOD_NAME_ALL]: /* @__PURE__ */ Object.create(null) };\n  }\n  add(method, path, handler) {\n    const middleware = this.#middleware;\n    const routes = this.#routes;\n    if (!middleware || !routes) {\n      throw new Error(MESSAGE_MATCHER_IS_ALREADY_BUILT);\n    }\n    if (!middleware[method]) {\n      ;\n      [middleware, routes].forEach((handlerMap) => {\n        handlerMap[method] = /* @__PURE__ */ Object.create(null);\n        Object.keys(handlerMap[METHOD_NAME_ALL]).forEach((p) => {\n          handlerMap[method][p] = [...handlerMap[METHOD_NAME_ALL][p]];\n        });\n      });\n    }\n    if (path === \"/*\") {\n      path = \"*\";\n    }\n    const paramCount = (path.match(/\\/:/g) || []).length;\n    if (/\\*$/.test(path)) {\n      const re = buildWildcardRegExp(path);\n      if (method === METHOD_NAME_ALL) {\n        Object.keys(middleware).forEach((m) => {\n          middleware[m][path] ||= findMiddleware(middleware[m], path) || findMiddleware(middleware[METHOD_NAME_ALL], path) || [];\n        });\n      } else {\n        middleware[method][path] ||= findMiddleware(middleware[method], path) || findMiddleware(middleware[METHOD_NAME_ALL], path) || [];\n      }\n      Object.keys(middleware).forEach((m) => {\n        if (method === METHOD_NAME_ALL || method === m) {\n          Object.keys(middleware[m]).forEach((p) => {\n            re.test(p) && middleware[m][p].push([handler, paramCount]);\n          });\n        }\n      });\n      Object.keys(routes).forEach((m) => {\n        if (method === METHOD_NAME_ALL || method === m) {\n          Object.keys(routes[m]).forEach(\n            (p) => re.test(p) && routes[m][p].push([handler, paramCount])\n          );\n        }\n      });\n      return;\n    }\n    const paths = checkOptionalParameter(path) || [path];\n    for (let i = 0, len = paths.length; i < len; i++) {\n      const path2 = paths[i];\n      Object.keys(routes).forEach((m) => {\n        if (method === METHOD_NAME_ALL || method === m) {\n          routes[m][path2] ||= [\n            ...findMiddleware(middleware[m], path2) || findMiddleware(middleware[METHOD_NAME_ALL], path2) || []\n          ];\n          routes[m][path2].push([handler, paramCount - len + i + 1]);\n        }\n      });\n    }\n  }\n  match = match;\n  buildAllMatchers() {\n    const matchers = /* @__PURE__ */ Object.create(null);\n    Object.keys(this.#routes).concat(Object.keys(this.#middleware)).forEach((method) => {\n      matchers[method] ||= this.#buildMatcher(method);\n    });\n    this.#middleware = this.#routes = void 0;\n    clearWildcardRegExpCache();\n    return matchers;\n  }\n  #buildMatcher(method) {\n    const routes = [];\n    let hasOwnRoute = method === METHOD_NAME_ALL;\n    [this.#middleware, this.#routes].forEach((r) => {\n      const ownRoute = r[method] ? Object.keys(r[method]).map((path) => [path, r[method][path]]) : [];\n      if (ownRoute.length !== 0) {\n        hasOwnRoute ||= true;\n        routes.push(...ownRoute);\n      } else if (method !== METHOD_NAME_ALL) {\n        routes.push(\n          ...Object.keys(r[METHOD_NAME_ALL]).map((path) => [path, r[METHOD_NAME_ALL][path]])\n        );\n      }\n    });\n    if (!hasOwnRoute) {\n      return null;\n    } else {\n      return buildMatcherFromPreprocessedRoutes(routes);\n    }\n  }\n};\nexport {\n  RegExpRouter\n};\n", "// src/router/reg-exp-router/matcher.ts\nimport { METHOD_NAME_ALL } from \"../../router.js\";\nvar emptyParam = [];\nfunction match(method, path) {\n  const matchers = this.buildAllMatchers();\n  const match2 = (method2, path2) => {\n    const matcher = matchers[method2] || matchers[METHOD_NAME_ALL];\n    const staticMatch = matcher[2][path2];\n    if (staticMatch) {\n      return staticMatch;\n    }\n    const match3 = path2.match(matcher[0]);\n    if (!match3) {\n      return [[], emptyParam];\n    }\n    const index = match3.indexOf(\"\", 1);\n    return [matcher[1][index], match3];\n  };\n  this.match = match2;\n  return match2(method, path);\n}\nexport {\n  emptyParam,\n  match\n};\n", "// src/router/reg-exp-router/node.ts\nvar LABEL_REG_EXP_STR = \"[^/]+\";\nvar ONLY_WILDCARD_REG_EXP_STR = \".*\";\nvar TAIL_WILDCARD_REG_EXP_STR = \"(?:|/.*)\";\nvar PATH_ERROR = Symbol();\nvar regExpMetaChars = new Set(\".\\\\+*[^]$()\");\nfunction compareKey(a, b) {\n  if (a.length === 1) {\n    return b.length === 1 ? a < b ? -1 : 1 : -1;\n  }\n  if (b.length === 1) {\n    return 1;\n  }\n  if (a === ONLY_WILDCARD_REG_EXP_STR || a === TAIL_WILDCARD_REG_EXP_STR) {\n    return 1;\n  } else if (b === ONLY_WILDCARD_REG_EXP_STR || b === TAIL_WILDCARD_REG_EXP_STR) {\n    return -1;\n  }\n  if (a === LABEL_REG_EXP_STR) {\n    return 1;\n  } else if (b === LABEL_REG_EXP_STR) {\n    return -1;\n  }\n  return a.length === b.length ? a < b ? -1 : 1 : b.length - a.length;\n}\nvar Node = class {\n  #index;\n  #varIndex;\n  #children = /* @__PURE__ */ Object.create(null);\n  insert(tokens, index, paramMap, context, pathErrorCheckOnly) {\n    if (tokens.length === 0) {\n      if (this.#index !== void 0) {\n        throw PATH_ERROR;\n      }\n      if (pathErrorCheckOnly) {\n        return;\n      }\n      this.#index = index;\n      return;\n    }\n    const [token, ...restTokens] = tokens;\n    const pattern = token === \"*\" ? restTokens.length === 0 ? [\"\", \"\", ONLY_WILDCARD_REG_EXP_STR] : [\"\", \"\", LABEL_REG_EXP_STR] : token === \"/*\" ? [\"\", \"\", TAIL_WILDCARD_REG_EXP_STR] : token.match(/^\\:([^\\{\\}]+)(?:\\{(.+)\\})?$/);\n    let node;\n    if (pattern) {\n      const name = pattern[1];\n      let regexpStr = pattern[2] || LABEL_REG_EXP_STR;\n      if (name && pattern[2]) {\n        if (regexpStr === \".*\") {\n          throw PATH_ERROR;\n        }\n        regexpStr = regexpStr.replace(/^\\((?!\\?:)(?=[^)]+\\)$)/, \"(?:\");\n        if (/\\((?!\\?:)/.test(regexpStr)) {\n          throw PATH_ERROR;\n        }\n      }\n      node = this.#children[regexpStr];\n      if (!node) {\n        if (Object.keys(this.#children).some(\n          (k) => k !== ONLY_WILDCARD_REG_EXP_STR && k !== TAIL_WILDCARD_REG_EXP_STR\n        )) {\n          throw PATH_ERROR;\n        }\n        if (pathErrorCheckOnly) {\n          return;\n        }\n        node = this.#children[regexpStr] = new Node();\n        if (name !== \"\") {\n          node.#varIndex = context.varIndex++;\n        }\n      }\n      if (!pathErrorCheckOnly && name !== \"\") {\n        paramMap.push([name, node.#varIndex]);\n      }\n    } else {\n      node = this.#children[token];\n      if (!node) {\n        if (Object.keys(this.#children).some(\n          (k) => k.length > 1 && k !== ONLY_WILDCARD_REG_EXP_STR && k !== TAIL_WILDCARD_REG_EXP_STR\n        )) {\n          throw PATH_ERROR;\n        }\n        if (pathErrorCheckOnly) {\n          return;\n        }\n        node = this.#children[token] = new Node();\n      }\n    }\n    node.insert(restTokens, index, paramMap, context, pathErrorCheckOnly);\n  }\n  buildRegExpStr() {\n    const childKeys = Object.keys(this.#children).sort(compareKey);\n    const strList = childKeys.map((k) => {\n      const c = this.#children[k];\n      return (typeof c.#varIndex === \"number\" ? `(${k})@${c.#varIndex}` : regExpMetaChars.has(k) ? `\\\\${k}` : k) + c.buildRegExpStr();\n    });\n    if (typeof this.#index === \"number\") {\n      strList.unshift(`#${this.#index}`);\n    }\n    if (strList.length === 0) {\n      return \"\";\n    }\n    if (strList.length === 1) {\n      return strList[0];\n    }\n    return \"(?:\" + strList.join(\"|\") + \")\";\n  }\n};\nexport {\n  Node,\n  PATH_ERROR\n};\n", "// src/router/reg-exp-router/trie.ts\nimport { Node } from \"./node.js\";\nvar Trie = class {\n  #context = { varIndex: 0 };\n  #root = new Node();\n  insert(path, index, pathErrorCheckOnly) {\n    const paramAssoc = [];\n    const groups = [];\n    for (let i = 0; ; ) {\n      let replaced = false;\n      path = path.replace(/\\{[^}]+\\}/g, (m) => {\n        const mark = `@\\\\${i}`;\n        groups[i] = [mark, m];\n        i++;\n        replaced = true;\n        return mark;\n      });\n      if (!replaced) {\n        break;\n      }\n    }\n    const tokens = path.match(/(?::[^\\/]+)|(?:\\/\\*$)|./g) || [];\n    for (let i = groups.length - 1; i >= 0; i--) {\n      const [mark] = groups[i];\n      for (let j = tokens.length - 1; j >= 0; j--) {\n        if (tokens[j].indexOf(mark) !== -1) {\n          tokens[j] = tokens[j].replace(mark, groups[i][1]);\n          break;\n        }\n      }\n    }\n    this.#root.insert(tokens, index, paramAssoc, this.#context, pathErrorCheckOnly);\n    return paramAssoc;\n  }\n  buildRegExp() {\n    let regexp = this.#root.buildRegExpStr();\n    if (regexp === \"\") {\n      return [/^$/, [], []];\n    }\n    let captureIndex = 0;\n    const indexReplacementMap = [];\n    const paramReplacementMap = [];\n    regexp = regexp.replace(/#(\\d+)|@(\\d+)|\\.\\*\\$/g, (_, handlerIndex, paramIndex) => {\n      if (handlerIndex !== void 0) {\n        indexReplacementMap[++captureIndex] = Number(handlerIndex);\n        return \"$()\";\n      }\n      if (paramIndex !== void 0) {\n        paramReplacementMap[Number(paramIndex)] = ++captureIndex;\n        return \"\";\n      }\n      return \"\";\n    });\n    return [new RegExp(`^${regexp}`), indexReplacementMap, paramReplacementMap];\n  }\n};\nexport {\n  Trie\n};\n", "// src/router/reg-exp-router/prepared-router.ts\nimport { METHOD_NAME_ALL } from \"../../router.js\";\nimport { match, emptyParam } from \"./matcher.js\";\nimport { RegExpRouter } from \"./router.js\";\nvar PreparedRegExpRouter = class {\n  name = \"PreparedRegExpRouter\";\n  #matchers;\n  #relocateMap;\n  constructor(matchers, relocateMap) {\n    this.#matchers = matchers;\n    this.#relocateMap = relocateMap;\n  }\n  #addWildcard(method, handlerData) {\n    const matcher = this.#matchers[method];\n    matcher[1].forEach((list) => list && list.push(handlerData));\n    Object.values(matcher[2]).forEach((list) => list[0].push(handlerData));\n  }\n  #addPath(method, path, handler, indexes, map) {\n    const matcher = this.#matchers[method];\n    if (!map) {\n      matcher[2][path][0].push([handler, {}]);\n    } else {\n      indexes.forEach((index) => {\n        if (typeof index === \"number\") {\n          matcher[1][index].push([handler, map]);\n        } else {\n          ;\n          matcher[2][index || path][0].push([handler, map]);\n        }\n      });\n    }\n  }\n  add(method, path, handler) {\n    if (!this.#matchers[method]) {\n      const all = this.#matchers[METHOD_NAME_ALL];\n      const staticMap = {};\n      for (const key in all[2]) {\n        staticMap[key] = [all[2][key][0].slice(), emptyParam];\n      }\n      this.#matchers[method] = [\n        all[0],\n        all[1].map((list) => Array.isArray(list) ? list.slice() : 0),\n        staticMap\n      ];\n    }\n    if (path === \"/*\" || path === \"*\") {\n      const handlerData = [handler, {}];\n      if (method === METHOD_NAME_ALL) {\n        for (const m in this.#matchers) {\n          this.#addWildcard(m, handlerData);\n        }\n      } else {\n        this.#addWildcard(method, handlerData);\n      }\n      return;\n    }\n    const data = this.#relocateMap[path];\n    if (!data) {\n      throw new Error(`Path ${path} is not registered`);\n    }\n    for (const [indexes, map] of data) {\n      if (method === METHOD_NAME_ALL) {\n        for (const m in this.#matchers) {\n          this.#addPath(m, path, handler, indexes, map);\n        }\n      } else {\n        this.#addPath(method, path, handler, indexes, map);\n      }\n    }\n  }\n  buildAllMatchers() {\n    return this.#matchers;\n  }\n  match = match;\n};\nvar buildInitParams = ({ paths }) => {\n  const RegExpRouterWithMatcherExport = class extends RegExpRouter {\n    buildAndExportAllMatchers() {\n      return this.buildAllMatchers();\n    }\n  };\n  const router = new RegExpRouterWithMatcherExport();\n  for (const path of paths) {\n    router.add(METHOD_NAME_ALL, path, path);\n  }\n  const matchers = router.buildAndExportAllMatchers();\n  const all = matchers[METHOD_NAME_ALL];\n  const relocateMap = {};\n  for (const path of paths) {\n    if (path === \"/*\" || path === \"*\") {\n      continue;\n    }\n    all[1].forEach((list, i) => {\n      list.forEach(([p, map]) => {\n        if (p === path) {\n          if (relocateMap[path]) {\n            relocateMap[path][0][1] = {\n              ...relocateMap[path][0][1],\n              ...map\n            };\n          } else {\n            relocateMap[path] = [[[], map]];\n          }\n          if (relocateMap[path][0][0].findIndex((j) => j === i) === -1) {\n            relocateMap[path][0][0].push(i);\n          }\n        }\n      });\n    });\n    for (const path2 in all[2]) {\n      all[2][path2][0].forEach(([p]) => {\n        if (p === path) {\n          relocateMap[path] ||= [[[]]];\n          const value = path2 === path ? \"\" : path2;\n          if (relocateMap[path][0][0].findIndex((v) => v === value) === -1) {\n            relocateMap[path][0][0].push(value);\n          }\n        }\n      });\n    }\n  }\n  for (let i = 0, len = all[1].length; i < len; i++) {\n    all[1][i] = all[1][i] ? [] : 0;\n  }\n  for (const path in all[2]) {\n    all[2][path][0] = [];\n  }\n  return [matchers, relocateMap];\n};\nvar serializeInitParams = ([matchers, relocateMap]) => {\n  const matchersStr = JSON.stringify(\n    matchers,\n    (_, value) => value instanceof RegExp ? `##${value.toString()}##` : value\n  ).replace(/\"##(.+?)##\"/g, (_, str) => str.replace(/\\\\\\\\/g, \"\\\\\"));\n  const relocateMapStr = JSON.stringify(relocateMap);\n  return `[${matchersStr},${relocateMapStr}]`;\n};\nexport {\n  PreparedRegExpRouter,\n  buildInitParams,\n  serializeInitParams\n};\n", "// src/router/smart-router/index.ts\nimport { SmartRouter } from \"./router.js\";\nexport {\n  SmartRouter\n};\n", "// src/router/smart-router/router.ts\nimport { MESSAGE_MATCHER_IS_ALREADY_BUILT, UnsupportedPathError } from \"../../router.js\";\nvar SmartRouter = class {\n  name = \"SmartRouter\";\n  #routers = [];\n  #routes = [];\n  constructor(init) {\n    this.#routers = init.routers;\n  }\n  add(method, path, handler) {\n    if (!this.#routes) {\n      throw new Error(MESSAGE_MATCHER_IS_ALREADY_BUILT);\n    }\n    this.#routes.push([method, path, handler]);\n  }\n  match(method, path) {\n    if (!this.#routes) {\n      throw new Error(\"Fatal error\");\n    }\n    const routers = this.#routers;\n    const routes = this.#routes;\n    const len = routers.length;\n    let i = 0;\n    let res;\n    for (; i < len; i++) {\n      const router = routers[i];\n      try {\n        for (let i2 = 0, len2 = routes.length; i2 < len2; i2++) {\n          router.add(...routes[i2]);\n        }\n        res = router.match(method, path);\n      } catch (e) {\n        if (e instanceof UnsupportedPathError) {\n          continue;\n        }\n        throw e;\n      }\n      this.match = router.match.bind(router);\n      this.#routers = [router];\n      this.#routes = void 0;\n      break;\n    }\n    if (i === len) {\n      throw new Error(\"Fatal error\");\n    }\n    this.name = `SmartRouter + ${this.activeRouter.name}`;\n    return res;\n  }\n  get activeRouter() {\n    if (this.#routes || this.#routers.length !== 1) {\n      throw new Error(\"No active router has been determined yet.\");\n    }\n    return this.#routers[0];\n  }\n};\nexport {\n  SmartRouter\n};\n", "// src/router/trie-router/index.ts\nimport { TrieRouter } from \"./router.js\";\nexport {\n  TrieRouter\n};\n", "// src/router/trie-router/router.ts\nimport { checkOptionalParameter } from \"../../utils/url.js\";\nimport { Node } from \"./node.js\";\nvar TrieRouter = class {\n  name = \"TrieRouter\";\n  #node;\n  constructor() {\n    this.#node = new Node();\n  }\n  add(method, path, handler) {\n    const results = checkOptionalParameter(path);\n    if (results) {\n      for (let i = 0, len = results.length; i < len; i++) {\n        this.#node.insert(method, results[i], handler);\n      }\n      return;\n    }\n    this.#node.insert(method, path, handler);\n  }\n  match(method, path) {\n    return this.#node.search(method, path);\n  }\n};\nexport {\n  TrieRouter\n};\n", "// src/router/trie-router/node.ts\nimport { METHOD_NAME_ALL } from \"../../router.js\";\nimport { getPattern, splitPath, splitRoutingPath } from \"../../utils/url.js\";\nvar emptyParams = /* @__PURE__ */ Object.create(null);\nvar Node = class {\n  #methods;\n  #children;\n  #patterns;\n  #order = 0;\n  #params = emptyParams;\n  constructor(method, handler, children) {\n    this.#children = children || /* @__PURE__ */ Object.create(null);\n    this.#methods = [];\n    if (method && handler) {\n      const m = /* @__PURE__ */ Object.create(null);\n      m[method] = { handler, possibleKeys: [], score: 0 };\n      this.#methods = [m];\n    }\n    this.#patterns = [];\n  }\n  insert(method, path, handler) {\n    this.#order = ++this.#order;\n    let curNode = this;\n    const parts = splitRoutingPath(path);\n    const possibleKeys = [];\n    for (let i = 0, len = parts.length; i < len; i++) {\n      const p = parts[i];\n      const nextP = parts[i + 1];\n      const pattern = getPattern(p, nextP);\n      const key = Array.isArray(pattern) ? pattern[0] : p;\n      if (key in curNode.#children) {\n        curNode = curNode.#children[key];\n        if (pattern) {\n          possibleKeys.push(pattern[1]);\n        }\n        continue;\n      }\n      curNode.#children[key] = new Node();\n      if (pattern) {\n        curNode.#patterns.push(pattern);\n        possibleKeys.push(pattern[1]);\n      }\n      curNode = curNode.#children[key];\n    }\n    curNode.#methods.push({\n      [method]: {\n        handler,\n        possibleKeys: possibleKeys.filter((v, i, a) => a.indexOf(v) === i),\n        score: this.#order\n      }\n    });\n    return curNode;\n  }\n  #getHandlerSets(node, method, nodeParams, params) {\n    const handlerSets = [];\n    for (let i = 0, len = node.#methods.length; i < len; i++) {\n      const m = node.#methods[i];\n      const handlerSet = m[method] || m[METHOD_NAME_ALL];\n      const processedSet = {};\n      if (handlerSet !== void 0) {\n        handlerSet.params = /* @__PURE__ */ Object.create(null);\n        handlerSets.push(handlerSet);\n        if (nodeParams !== emptyParams || params && params !== emptyParams) {\n          for (let i2 = 0, len2 = handlerSet.possibleKeys.length; i2 < len2; i2++) {\n            const key = handlerSet.possibleKeys[i2];\n            const processed = processedSet[handlerSet.score];\n            handlerSet.params[key] = params?.[key] && !processed ? params[key] : nodeParams[key] ?? params?.[key];\n            processedSet[handlerSet.score] = true;\n          }\n        }\n      }\n    }\n    return handlerSets;\n  }\n  search(method, path) {\n    const handlerSets = [];\n    this.#params = emptyParams;\n    const curNode = this;\n    let curNodes = [curNode];\n    const parts = splitPath(path);\n    const curNodesQueue = [];\n    for (let i = 0, len = parts.length; i < len; i++) {\n      const part = parts[i];\n      const isLast = i === len - 1;\n      const tempNodes = [];\n      for (let j = 0, len2 = curNodes.length; j < len2; j++) {\n        const node = curNodes[j];\n        const nextNode = node.#children[part];\n        if (nextNode) {\n          nextNode.#params = node.#params;\n          if (isLast) {\n            if (nextNode.#children[\"*\"]) {\n              handlerSets.push(\n                ...this.#getHandlerSets(nextNode.#children[\"*\"], method, node.#params)\n              );\n            }\n            handlerSets.push(...this.#getHandlerSets(nextNode, method, node.#params));\n          } else {\n            tempNodes.push(nextNode);\n          }\n        }\n        for (let k = 0, len3 = node.#patterns.length; k < len3; k++) {\n          const pattern = node.#patterns[k];\n          const params = node.#params === emptyParams ? {} : { ...node.#params };\n          if (pattern === \"*\") {\n            const astNode = node.#children[\"*\"];\n            if (astNode) {\n              handlerSets.push(...this.#getHandlerSets(astNode, method, node.#params));\n              astNode.#params = params;\n              tempNodes.push(astNode);\n            }\n            continue;\n          }\n          const [key, name, matcher] = pattern;\n          if (!part && !(matcher instanceof RegExp)) {\n            continue;\n          }\n          const child = node.#children[key];\n          const restPathString = parts.slice(i).join(\"/\");\n          if (matcher instanceof RegExp) {\n            const m = matcher.exec(restPathString);\n            if (m) {\n              params[name] = m[0];\n              handlerSets.push(...this.#getHandlerSets(child, method, node.#params, params));\n              if (Object.keys(child.#children).length) {\n                child.#params = params;\n                const componentCount = m[0].match(/\\//)?.length ?? 0;\n                const targetCurNodes = curNodesQueue[componentCount] ||= [];\n                targetCurNodes.push(child);\n              }\n              continue;\n            }\n          }\n          if (matcher === true || matcher.test(part)) {\n            params[name] = part;\n            if (isLast) {\n              handlerSets.push(...this.#getHandlerSets(child, method, params, node.#params));\n              if (child.#children[\"*\"]) {\n                handlerSets.push(\n                  ...this.#getHandlerSets(child.#children[\"*\"], method, params, node.#params)\n                );\n              }\n            } else {\n              child.#params = params;\n              tempNodes.push(child);\n            }\n          }\n        }\n      }\n      curNodes = tempNodes.concat(curNodesQueue.shift() ?? []);\n    }\n    if (handlerSets.length > 1) {\n      handlerSets.sort((a, b) => {\n        return a.score - b.score;\n      });\n    }\n    return [handlerSets.map(({ handler, params }) => [handler, params])];\n  }\n};\nexport {\n  Node\n};\n", "/*\n Copyright (c) 2012 Nevins Bartolomeo <nevins.bartolomeo@gmail.com>\n Copyright (c) 2012 Shane Girish <shaneGirish@gmail.com>\n Copyright (c) 2025 Daniel Wirtz <dcode@dcode.io>\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions\n are met:\n 1. Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n 2. Redistributions in binary form must reproduce the above copyright\n notice, this list of conditions and the following disclaimer in the\n documentation and/or other materials provided with the distribution.\n 3. The name of the author may not be used to endorse or promote products\n derived from this software without specific prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR\n IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES\n OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,\n INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\n THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n// The Node.js crypto module is used as a fallback for the Web Crypto API. When\n// building for the browser, inclusion of the crypto module should be disabled,\n// which the package hints at in its package.json for bundlers that support it.\nimport nodeCrypto from \"crypto\";\n\n/**\n * The random implementation to use as a fallback.\n * @type {?function(number):!Array.<number>}\n * @inner\n */\nvar randomFallback = null;\n\n/**\n * Generates cryptographically secure random bytes.\n * @function\n * @param {number} len Bytes length\n * @returns {!Array.<number>} Random bytes\n * @throws {Error} If no random implementation is available\n * @inner\n */\nfunction randomBytes(len) {\n  // Web Crypto API. Globally available in the browser and in Node.js >=23.\n  try {\n    return crypto.getRandomValues(new Uint8Array(len));\n  } catch {}\n  // Node.js crypto module for non-browser environments.\n  try {\n    return nodeCrypto.randomBytes(len);\n  } catch {}\n  // Custom fallback specified with `setRandomFallback`.\n  if (!randomFallback) {\n    throw Error(\n      \"Neither WebCryptoAPI nor a crypto module is available. Use bcrypt.setRandomFallback to set an alternative\",\n    );\n  }\n  return randomFallback(len);\n}\n\n/**\n * Sets the pseudo random number generator to use as a fallback if neither node's `crypto` module nor the Web Crypto\n *  API is available. Please note: It is highly important that the PRNG used is cryptographically secure and that it\n *  is seeded properly!\n * @param {?function(number):!Array.<number>} random Function taking the number of bytes to generate as its\n *  sole argument, returning the corresponding array of cryptographically secure random byte values.\n * @see http://nodejs.org/api/crypto.html\n * @see http://www.w3.org/TR/WebCryptoAPI/\n */\nexport function setRandomFallback(random) {\n  randomFallback = random;\n}\n\n/**\n * Synchronously generates a salt.\n * @param {number=} rounds Number of rounds to use, defaults to 10 if omitted\n * @param {number=} seed_length Not supported.\n * @returns {string} Resulting salt\n * @throws {Error} If a random fallback is required but not set\n */\nexport function genSaltSync(rounds, seed_length) {\n  rounds = rounds || GENSALT_DEFAULT_LOG2_ROUNDS;\n  if (typeof rounds !== \"number\")\n    throw Error(\n      \"Illegal arguments: \" + typeof rounds + \", \" + typeof seed_length,\n    );\n  if (rounds < 4) rounds = 4;\n  else if (rounds > 31) rounds = 31;\n  var salt = [];\n  salt.push(\"$2b$\");\n  if (rounds < 10) salt.push(\"0\");\n  salt.push(rounds.toString());\n  salt.push(\"$\");\n  salt.push(base64_encode(randomBytes(BCRYPT_SALT_LEN), BCRYPT_SALT_LEN)); // May throw\n  return salt.join(\"\");\n}\n\n/**\n * Asynchronously generates a salt.\n * @param {(number|function(Error, string=))=} rounds Number of rounds to use, defaults to 10 if omitted\n * @param {(number|function(Error, string=))=} seed_length Not supported.\n * @param {function(Error, string=)=} callback Callback receiving the error, if any, and the resulting salt\n * @returns {!Promise} If `callback` has been omitted\n * @throws {Error} If `callback` is present but not a function\n */\nexport function genSalt(rounds, seed_length, callback) {\n  if (typeof seed_length === \"function\")\n    (callback = seed_length), (seed_length = undefined); // Not supported.\n  if (typeof rounds === \"function\") (callback = rounds), (rounds = undefined);\n  if (typeof rounds === \"undefined\") rounds = GENSALT_DEFAULT_LOG2_ROUNDS;\n  else if (typeof rounds !== \"number\")\n    throw Error(\"illegal arguments: \" + typeof rounds);\n\n  function _async(callback) {\n    nextTick(function () {\n      // Pretty thin, but salting is fast enough\n      try {\n        callback(null, genSaltSync(rounds));\n      } catch (err) {\n        callback(err);\n      }\n    });\n  }\n\n  if (callback) {\n    if (typeof callback !== \"function\")\n      throw Error(\"Illegal callback: \" + typeof callback);\n    _async(callback);\n  } else\n    return new Promise(function (resolve, reject) {\n      _async(function (err, res) {\n        if (err) {\n          reject(err);\n          return;\n        }\n        resolve(res);\n      });\n    });\n}\n\n/**\n * Synchronously generates a hash for the given password.\n * @param {string} password Password to hash\n * @param {(number|string)=} salt Salt length to generate or salt to use, default to 10\n * @returns {string} Resulting hash\n */\nexport function hashSync(password, salt) {\n  if (typeof salt === \"undefined\") salt = GENSALT_DEFAULT_LOG2_ROUNDS;\n  if (typeof salt === \"number\") salt = genSaltSync(salt);\n  if (typeof password !== \"string\" || typeof salt !== \"string\")\n    throw Error(\"Illegal arguments: \" + typeof password + \", \" + typeof salt);\n  return _hash(password, salt);\n}\n\n/**\n * Asynchronously generates a hash for the given password.\n * @param {string} password Password to hash\n * @param {number|string} salt Salt length to generate or salt to use\n * @param {function(Error, string=)=} callback Callback receiving the error, if any, and the resulting hash\n * @param {function(number)=} progressCallback Callback successively called with the percentage of rounds completed\n *  (0.0 - 1.0), maximally once per `MAX_EXECUTION_TIME = 100` ms.\n * @returns {!Promise} If `callback` has been omitted\n * @throws {Error} If `callback` is present but not a function\n */\nexport function hash(password, salt, callback, progressCallback) {\n  function _async(callback) {\n    if (typeof password === \"string\" && typeof salt === \"number\")\n      genSalt(salt, function (err, salt) {\n        _hash(password, salt, callback, progressCallback);\n      });\n    else if (typeof password === \"string\" && typeof salt === \"string\")\n      _hash(password, salt, callback, progressCallback);\n    else\n      nextTick(\n        callback.bind(\n          this,\n          Error(\"Illegal arguments: \" + typeof password + \", \" + typeof salt),\n        ),\n      );\n  }\n\n  if (callback) {\n    if (typeof callback !== \"function\")\n      throw Error(\"Illegal callback: \" + typeof callback);\n    _async(callback);\n  } else\n    return new Promise(function (resolve, reject) {\n      _async(function (err, res) {\n        if (err) {\n          reject(err);\n          return;\n        }\n        resolve(res);\n      });\n    });\n}\n\n/**\n * Compares two strings of the same length in constant time.\n * @param {string} known Must be of the correct length\n * @param {string} unknown Must be the same length as `known`\n * @returns {boolean}\n * @inner\n */\nfunction safeStringCompare(known, unknown) {\n  var diff = known.length ^ unknown.length;\n  for (var i = 0; i < known.length; ++i) {\n    diff |= known.charCodeAt(i) ^ unknown.charCodeAt(i);\n  }\n  return diff === 0;\n}\n\n/**\n * Synchronously tests a password against a hash.\n * @param {string} password Password to compare\n * @param {string} hash Hash to test against\n * @returns {boolean} true if matching, otherwise false\n * @throws {Error} If an argument is illegal\n */\nexport function compareSync(password, hash) {\n  if (typeof password !== \"string\" || typeof hash !== \"string\")\n    throw Error(\"Illegal arguments: \" + typeof password + \", \" + typeof hash);\n  if (hash.length !== 60) return false;\n  return safeStringCompare(\n    hashSync(password, hash.substring(0, hash.length - 31)),\n    hash,\n  );\n}\n\n/**\n * Asynchronously tests a password against a hash.\n * @param {string} password Password to compare\n * @param {string} hashValue Hash to test against\n * @param {function(Error, boolean)=} callback Callback receiving the error, if any, otherwise the result\n * @param {function(number)=} progressCallback Callback successively called with the percentage of rounds completed\n *  (0.0 - 1.0), maximally once per `MAX_EXECUTION_TIME = 100` ms.\n * @returns {!Promise} If `callback` has been omitted\n * @throws {Error} If `callback` is present but not a function\n */\nexport function compare(password, hashValue, callback, progressCallback) {\n  function _async(callback) {\n    if (typeof password !== \"string\" || typeof hashValue !== \"string\") {\n      nextTick(\n        callback.bind(\n          this,\n          Error(\n            \"Illegal arguments: \" + typeof password + \", \" + typeof hashValue,\n          ),\n        ),\n      );\n      return;\n    }\n    if (hashValue.length !== 60) {\n      nextTick(callback.bind(this, null, false));\n      return;\n    }\n    hash(\n      password,\n      hashValue.substring(0, 29),\n      function (err, comp) {\n        if (err) callback(err);\n        else callback(null, safeStringCompare(comp, hashValue));\n      },\n      progressCallback,\n    );\n  }\n\n  if (callback) {\n    if (typeof callback !== \"function\")\n      throw Error(\"Illegal callback: \" + typeof callback);\n    _async(callback);\n  } else\n    return new Promise(function (resolve, reject) {\n      _async(function (err, res) {\n        if (err) {\n          reject(err);\n          return;\n        }\n        resolve(res);\n      });\n    });\n}\n\n/**\n * Gets the number of rounds used to encrypt the specified hash.\n * @param {string} hash Hash to extract the used number of rounds from\n * @returns {number} Number of rounds used\n * @throws {Error} If `hash` is not a string\n */\nexport function getRounds(hash) {\n  if (typeof hash !== \"string\")\n    throw Error(\"Illegal arguments: \" + typeof hash);\n  return parseInt(hash.split(\"$\")[2], 10);\n}\n\n/**\n * Gets the salt portion from a hash. Does not validate the hash.\n * @param {string} hash Hash to extract the salt from\n * @returns {string} Extracted salt part\n * @throws {Error} If `hash` is not a string or otherwise invalid\n */\nexport function getSalt(hash) {\n  if (typeof hash !== \"string\")\n    throw Error(\"Illegal arguments: \" + typeof hash);\n  if (hash.length !== 60)\n    throw Error(\"Illegal hash length: \" + hash.length + \" != 60\");\n  return hash.substring(0, 29);\n}\n\n/**\n * Tests if a password will be truncated when hashed, that is its length is\n * greater than 72 bytes when converted to UTF-8.\n * @param {string} password The password to test\n * @returns {boolean} `true` if truncated, otherwise `false`\n */\nexport function truncates(password) {\n  if (typeof password !== \"string\")\n    throw Error(\"Illegal arguments: \" + typeof password);\n  return utf8Length(password) > 72;\n}\n\n/**\n * Continues with the callback after yielding to the event loop.\n * @function\n * @param {function(...[*])} callback Callback to execute\n * @inner\n */\nvar nextTick =\n  typeof setImmediate === \"function\"\n    ? setImmediate\n    : typeof scheduler === \"object\" && typeof scheduler.postTask === \"function\"\n      ? scheduler.postTask.bind(scheduler)\n      : setTimeout;\n\n/** Calculates the byte length of a string encoded as UTF8. */\nfunction utf8Length(string) {\n  var len = 0,\n    c = 0;\n  for (var i = 0; i < string.length; ++i) {\n    c = string.charCodeAt(i);\n    if (c < 128) len += 1;\n    else if (c < 2048) len += 2;\n    else if (\n      (c & 0xfc00) === 0xd800 &&\n      (string.charCodeAt(i + 1) & 0xfc00) === 0xdc00\n    ) {\n      ++i;\n      len += 4;\n    } else len += 3;\n  }\n  return len;\n}\n\n/** Converts a string to an array of UTF8 bytes. */\nfunction utf8Array(string) {\n  var offset = 0,\n    c1,\n    c2;\n  var buffer = new Array(utf8Length(string));\n  for (var i = 0, k = string.length; i < k; ++i) {\n    c1 = string.charCodeAt(i);\n    if (c1 < 128) {\n      buffer[offset++] = c1;\n    } else if (c1 < 2048) {\n      buffer[offset++] = (c1 >> 6) | 192;\n      buffer[offset++] = (c1 & 63) | 128;\n    } else if (\n      (c1 & 0xfc00) === 0xd800 &&\n      ((c2 = string.charCodeAt(i + 1)) & 0xfc00) === 0xdc00\n    ) {\n      c1 = 0x10000 + ((c1 & 0x03ff) << 10) + (c2 & 0x03ff);\n      ++i;\n      buffer[offset++] = (c1 >> 18) | 240;\n      buffer[offset++] = ((c1 >> 12) & 63) | 128;\n      buffer[offset++] = ((c1 >> 6) & 63) | 128;\n      buffer[offset++] = (c1 & 63) | 128;\n    } else {\n      buffer[offset++] = (c1 >> 12) | 224;\n      buffer[offset++] = ((c1 >> 6) & 63) | 128;\n      buffer[offset++] = (c1 & 63) | 128;\n    }\n  }\n  return buffer;\n}\n\n// A base64 implementation for the bcrypt algorithm. This is partly non-standard.\n\n/**\n * bcrypt's own non-standard base64 dictionary.\n * @type {!Array.<string>}\n * @const\n * @inner\n **/\nvar BASE64_CODE =\n  \"./ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\".split(\"\");\n\n/**\n * @type {!Array.<number>}\n * @const\n * @inner\n **/\nvar BASE64_INDEX = [\n  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n  -1, -1, -1, -1, -1, -1, -1, -1, 0, 1, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63,\n  -1, -1, -1, -1, -1, -1, -1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,\n  16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, -1, -1, -1, -1, -1, -1, 28,\n  29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47,\n  48, 49, 50, 51, 52, 53, -1, -1, -1, -1, -1,\n];\n\n/**\n * Encodes a byte array to base64 with up to len bytes of input.\n * @param {!Array.<number>} b Byte array\n * @param {number} len Maximum input length\n * @returns {string}\n * @inner\n */\nfunction base64_encode(b, len) {\n  var off = 0,\n    rs = [],\n    c1,\n    c2;\n  if (len <= 0 || len > b.length) throw Error(\"Illegal len: \" + len);\n  while (off < len) {\n    c1 = b[off++] & 0xff;\n    rs.push(BASE64_CODE[(c1 >> 2) & 0x3f]);\n    c1 = (c1 & 0x03) << 4;\n    if (off >= len) {\n      rs.push(BASE64_CODE[c1 & 0x3f]);\n      break;\n    }\n    c2 = b[off++] & 0xff;\n    c1 |= (c2 >> 4) & 0x0f;\n    rs.push(BASE64_CODE[c1 & 0x3f]);\n    c1 = (c2 & 0x0f) << 2;\n    if (off >= len) {\n      rs.push(BASE64_CODE[c1 & 0x3f]);\n      break;\n    }\n    c2 = b[off++] & 0xff;\n    c1 |= (c2 >> 6) & 0x03;\n    rs.push(BASE64_CODE[c1 & 0x3f]);\n    rs.push(BASE64_CODE[c2 & 0x3f]);\n  }\n  return rs.join(\"\");\n}\n\n/**\n * Decodes a base64 encoded string to up to len bytes of output.\n * @param {string} s String to decode\n * @param {number} len Maximum output length\n * @returns {!Array.<number>}\n * @inner\n */\nfunction base64_decode(s, len) {\n  var off = 0,\n    slen = s.length,\n    olen = 0,\n    rs = [],\n    c1,\n    c2,\n    c3,\n    c4,\n    o,\n    code;\n  if (len <= 0) throw Error(\"Illegal len: \" + len);\n  while (off < slen - 1 && olen < len) {\n    code = s.charCodeAt(off++);\n    c1 = code < BASE64_INDEX.length ? BASE64_INDEX[code] : -1;\n    code = s.charCodeAt(off++);\n    c2 = code < BASE64_INDEX.length ? BASE64_INDEX[code] : -1;\n    if (c1 == -1 || c2 == -1) break;\n    o = (c1 << 2) >>> 0;\n    o |= (c2 & 0x30) >> 4;\n    rs.push(String.fromCharCode(o));\n    if (++olen >= len || off >= slen) break;\n    code = s.charCodeAt(off++);\n    c3 = code < BASE64_INDEX.length ? BASE64_INDEX[code] : -1;\n    if (c3 == -1) break;\n    o = ((c2 & 0x0f) << 4) >>> 0;\n    o |= (c3 & 0x3c) >> 2;\n    rs.push(String.fromCharCode(o));\n    if (++olen >= len || off >= slen) break;\n    code = s.charCodeAt(off++);\n    c4 = code < BASE64_INDEX.length ? BASE64_INDEX[code] : -1;\n    o = ((c3 & 0x03) << 6) >>> 0;\n    o |= c4;\n    rs.push(String.fromCharCode(o));\n    ++olen;\n  }\n  var res = [];\n  for (off = 0; off < olen; off++) res.push(rs[off].charCodeAt(0));\n  return res;\n}\n\n/**\n * @type {number}\n * @const\n * @inner\n */\nvar BCRYPT_SALT_LEN = 16;\n\n/**\n * @type {number}\n * @const\n * @inner\n */\nvar GENSALT_DEFAULT_LOG2_ROUNDS = 10;\n\n/**\n * @type {number}\n * @const\n * @inner\n */\nvar BLOWFISH_NUM_ROUNDS = 16;\n\n/**\n * @type {number}\n * @const\n * @inner\n */\nvar MAX_EXECUTION_TIME = 100;\n\n/**\n * @type {Array.<number>}\n * @const\n * @inner\n */\nvar P_ORIG = [\n  0x243f6a88, 0x85a308d3, 0x13198a2e, 0x03707344, 0xa4093822, 0x299f31d0,\n  0x082efa98, 0xec4e6c89, 0x452821e6, 0x38d01377, 0xbe5466cf, 0x34e90c6c,\n  0xc0ac29b7, 0xc97c50dd, 0x3f84d5b5, 0xb5470917, 0x9216d5d9, 0x8979fb1b,\n];\n\n/**\n * @type {Array.<number>}\n * @const\n * @inner\n */\nvar S_ORIG = [\n  0xd1310ba6, 0x98dfb5ac, 0x2ffd72db, 0xd01adfb7, 0xb8e1afed, 0x6a267e96,\n  0xba7c9045, 0xf12c7f99, 0x24a19947, 0xb3916cf7, 0x0801f2e2, 0x858efc16,\n  0x636920d8, 0x71574e69, 0xa458fea3, 0xf4933d7e, 0x0d95748f, 0x728eb658,\n  0x718bcd58, 0x82154aee, 0x7b54a41d, 0xc25a59b5, 0x9c30d539, 0x2af26013,\n  0xc5d1b023, 0x286085f0, 0xca417918, 0xb8db38ef, 0x8e79dcb0, 0x603a180e,\n  0x6c9e0e8b, 0xb01e8a3e, 0xd71577c1, 0xbd314b27, 0x78af2fda, 0x55605c60,\n  0xe65525f3, 0xaa55ab94, 0x57489862, 0x63e81440, 0x55ca396a, 0x2aab10b6,\n  0xb4cc5c34, 0x1141e8ce, 0xa15486af, 0x7c72e993, 0xb3ee1411, 0x636fbc2a,\n  0x2ba9c55d, 0x741831f6, 0xce5c3e16, 0x9b87931e, 0xafd6ba33, 0x6c24cf5c,\n  0x7a325381, 0x28958677, 0x3b8f4898, 0x6b4bb9af, 0xc4bfe81b, 0x66282193,\n  0x61d809cc, 0xfb21a991, 0x487cac60, 0x5dec8032, 0xef845d5d, 0xe98575b1,\n  0xdc262302, 0xeb651b88, 0x23893e81, 0xd396acc5, 0x0f6d6ff3, 0x83f44239,\n  0x2e0b4482, 0xa4842004, 0x69c8f04a, 0x9e1f9b5e, 0x21c66842, 0xf6e96c9a,\n  0x670c9c61, 0xabd388f0, 0x6a51a0d2, 0xd8542f68, 0x960fa728, 0xab5133a3,\n  0x6eef0b6c, 0x137a3be4, 0xba3bf050, 0x7efb2a98, 0xa1f1651d, 0x39af0176,\n  0x66ca593e, 0x82430e88, 0x8cee8619, 0x456f9fb4, 0x7d84a5c3, 0x3b8b5ebe,\n  0xe06f75d8, 0x85c12073, 0x401a449f, 0x56c16aa6, 0x4ed3aa62, 0x363f7706,\n  0x1bfedf72, 0x429b023d, 0x37d0d724, 0xd00a1248, 0xdb0fead3, 0x49f1c09b,\n  0x075372c9, 0x80991b7b, 0x25d479d8, 0xf6e8def7, 0xe3fe501a, 0xb6794c3b,\n  0x976ce0bd, 0x04c006ba, 0xc1a94fb6, 0x409f60c4, 0x5e5c9ec2, 0x196a2463,\n  0x68fb6faf, 0x3e6c53b5, 0x1339b2eb, 0x3b52ec6f, 0x6dfc511f, 0x9b30952c,\n  0xcc814544, 0xaf5ebd09, 0xbee3d004, 0xde334afd, 0x660f2807, 0x192e4bb3,\n  0xc0cba857, 0x45c8740f, 0xd20b5f39, 0xb9d3fbdb, 0x5579c0bd, 0x1a60320a,\n  0xd6a100c6, 0x402c7279, 0x679f25fe, 0xfb1fa3cc, 0x8ea5e9f8, 0xdb3222f8,\n  0x3c7516df, 0xfd616b15, 0x2f501ec8, 0xad0552ab, 0x323db5fa, 0xfd238760,\n  0x53317b48, 0x3e00df82, 0x9e5c57bb, 0xca6f8ca0, 0x1a87562e, 0xdf1769db,\n  0xd542a8f6, 0x287effc3, 0xac6732c6, 0x8c4f5573, 0x695b27b0, 0xbbca58c8,\n  0xe1ffa35d, 0xb8f011a0, 0x10fa3d98, 0xfd2183b8, 0x4afcb56c, 0x2dd1d35b,\n  0x9a53e479, 0xb6f84565, 0xd28e49bc, 0x4bfb9790, 0xe1ddf2da, 0xa4cb7e33,\n  0x62fb1341, 0xcee4c6e8, 0xef20cada, 0x36774c01, 0xd07e9efe, 0x2bf11fb4,\n  0x95dbda4d, 0xae909198, 0xeaad8e71, 0x6b93d5a0, 0xd08ed1d0, 0xafc725e0,\n  0x8e3c5b2f, 0x8e7594b7, 0x8ff6e2fb, 0xf2122b64, 0x8888b812, 0x900df01c,\n  0x4fad5ea0, 0x688fc31c, 0xd1cff191, 0xb3a8c1ad, 0x2f2f2218, 0xbe0e1777,\n  0xea752dfe, 0x8b021fa1, 0xe5a0cc0f, 0xb56f74e8, 0x18acf3d6, 0xce89e299,\n  0xb4a84fe0, 0xfd13e0b7, 0x7cc43b81, 0xd2ada8d9, 0x165fa266, 0x80957705,\n  0x93cc7314, 0x211a1477, 0xe6ad2065, 0x77b5fa86, 0xc75442f5, 0xfb9d35cf,\n  0xebcdaf0c, 0x7b3e89a0, 0xd6411bd3, 0xae1e7e49, 0x00250e2d, 0x2071b35e,\n  0x226800bb, 0x57b8e0af, 0x2464369b, 0xf009b91e, 0x5563911d, 0x59dfa6aa,\n  0x78c14389, 0xd95a537f, 0x207d5ba2, 0x02e5b9c5, 0x83260376, 0x6295cfa9,\n  0x11c81968, 0x4e734a41, 0xb3472dca, 0x7b14a94a, 0x1b510052, 0x9a532915,\n  0xd60f573f, 0xbc9bc6e4, 0x2b60a476, 0x81e67400, 0x08ba6fb5, 0x571be91f,\n  0xf296ec6b, 0x2a0dd915, 0xb6636521, 0xe7b9f9b6, 0xff34052e, 0xc5855664,\n  0x53b02d5d, 0xa99f8fa1, 0x08ba4799, 0x6e85076a, 0x4b7a70e9, 0xb5b32944,\n  0xdb75092e, 0xc4192623, 0xad6ea6b0, 0x49a7df7d, 0x9cee60b8, 0x8fedb266,\n  0xecaa8c71, 0x699a17ff, 0x5664526c, 0xc2b19ee1, 0x193602a5, 0x75094c29,\n  0xa0591340, 0xe4183a3e, 0x3f54989a, 0x5b429d65, 0x6b8fe4d6, 0x99f73fd6,\n  0xa1d29c07, 0xefe830f5, 0x4d2d38e6, 0xf0255dc1, 0x4cdd2086, 0x8470eb26,\n  0x6382e9c6, 0x021ecc5e, 0x09686b3f, 0x3ebaefc9, 0x3c971814, 0x6b6a70a1,\n  0x687f3584, 0x52a0e286, 0xb79c5305, 0xaa500737, 0x3e07841c, 0x7fdeae5c,\n  0x8e7d44ec, 0x5716f2b8, 0xb03ada37, 0xf0500c0d, 0xf01c1f04, 0x0200b3ff,\n  0xae0cf51a, 0x3cb574b2, 0x25837a58, 0xdc0921bd, 0xd19113f9, 0x7ca92ff6,\n  0x94324773, 0x22f54701, 0x3ae5e581, 0x37c2dadc, 0xc8b57634, 0x9af3dda7,\n  0xa9446146, 0x0fd0030e, 0xecc8c73e, 0xa4751e41, 0xe238cd99, 0x3bea0e2f,\n  0x3280bba1, 0x183eb331, 0x4e548b38, 0x4f6db908, 0x6f420d03, 0xf60a04bf,\n  0x2cb81290, 0x24977c79, 0x5679b072, 0xbcaf89af, 0xde9a771f, 0xd9930810,\n  0xb38bae12, 0xdccf3f2e, 0x5512721f, 0x2e6b7124, 0x501adde6, 0x9f84cd87,\n  0x7a584718, 0x7408da17, 0xbc9f9abc, 0xe94b7d8c, 0xec7aec3a, 0xdb851dfa,\n  0x63094366, 0xc464c3d2, 0xef1c1847, 0x3215d908, 0xdd433b37, 0x24c2ba16,\n  0x12a14d43, 0x2a65c451, 0x50940002, 0x133ae4dd, 0x71dff89e, 0x10314e55,\n  0x81ac77d6, 0x5f11199b, 0x043556f1, 0xd7a3c76b, 0x3c11183b, 0x5924a509,\n  0xf28fe6ed, 0x97f1fbfa, 0x9ebabf2c, 0x1e153c6e, 0x86e34570, 0xeae96fb1,\n  0x860e5e0a, 0x5a3e2ab3, 0x771fe71c, 0x4e3d06fa, 0x2965dcb9, 0x99e71d0f,\n  0x803e89d6, 0x5266c825, 0x2e4cc978, 0x9c10b36a, 0xc6150eba, 0x94e2ea78,\n  0xa5fc3c53, 0x1e0a2df4, 0xf2f74ea7, 0x361d2b3d, 0x1939260f, 0x19c27960,\n  0x5223a708, 0xf71312b6, 0xebadfe6e, 0xeac31f66, 0xe3bc4595, 0xa67bc883,\n  0xb17f37d1, 0x018cff28, 0xc332ddef, 0xbe6c5aa5, 0x65582185, 0x68ab9802,\n  0xeecea50f, 0xdb2f953b, 0x2aef7dad, 0x5b6e2f84, 0x1521b628, 0x29076170,\n  0xecdd4775, 0x619f1510, 0x13cca830, 0xeb61bd96, 0x0334fe1e, 0xaa0363cf,\n  0xb5735c90, 0x4c70a239, 0xd59e9e0b, 0xcbaade14, 0xeecc86bc, 0x60622ca7,\n  0x9cab5cab, 0xb2f3846e, 0x648b1eaf, 0x19bdf0ca, 0xa02369b9, 0x655abb50,\n  0x40685a32, 0x3c2ab4b3, 0x319ee9d5, 0xc021b8f7, 0x9b540b19, 0x875fa099,\n  0x95f7997e, 0x623d7da8, 0xf837889a, 0x97e32d77, 0x11ed935f, 0x16681281,\n  0x0e358829, 0xc7e61fd6, 0x96dedfa1, 0x7858ba99, 0x57f584a5, 0x1b227263,\n  0x9b83c3ff, 0x1ac24696, 0xcdb30aeb, 0x532e3054, 0x8fd948e4, 0x6dbc3128,\n  0x58ebf2ef, 0x34c6ffea, 0xfe28ed61, 0xee7c3c73, 0x5d4a14d9, 0xe864b7e3,\n  0x42105d14, 0x203e13e0, 0x45eee2b6, 0xa3aaabea, 0xdb6c4f15, 0xfacb4fd0,\n  0xc742f442, 0xef6abbb5, 0x654f3b1d, 0x41cd2105, 0xd81e799e, 0x86854dc7,\n  0xe44b476a, 0x3d816250, 0xcf62a1f2, 0x5b8d2646, 0xfc8883a0, 0xc1c7b6a3,\n  0x7f1524c3, 0x69cb7492, 0x47848a0b, 0x5692b285, 0x095bbf00, 0xad19489d,\n  0x1462b174, 0x23820e00, 0x58428d2a, 0x0c55f5ea, 0x1dadf43e, 0x233f7061,\n  0x3372f092, 0x8d937e41, 0xd65fecf1, 0x6c223bdb, 0x7cde3759, 0xcbee7460,\n  0x4085f2a7, 0xce77326e, 0xa6078084, 0x19f8509e, 0xe8efd855, 0x61d99735,\n  0xa969a7aa, 0xc50c06c2, 0x5a04abfc, 0x800bcadc, 0x9e447a2e, 0xc3453484,\n  0xfdd56705, 0x0e1e9ec9, 0xdb73dbd3, 0x105588cd, 0x675fda79, 0xe3674340,\n  0xc5c43465, 0x713e38d8, 0x3d28f89e, 0xf16dff20, 0x153e21e7, 0x8fb03d4a,\n  0xe6e39f2b, 0xdb83adf7, 0xe93d5a68, 0x948140f7, 0xf64c261c, 0x94692934,\n  0x411520f7, 0x7602d4f7, 0xbcf46b2e, 0xd4a20068, 0xd4082471, 0x3320f46a,\n  0x43b7d4b7, 0x500061af, 0x1e39f62e, 0x97244546, 0x14214f74, 0xbf8b8840,\n  0x4d95fc1d, 0x96b591af, 0x70f4ddd3, 0x66a02f45, 0xbfbc09ec, 0x03bd9785,\n  0x7fac6dd0, 0x31cb8504, 0x96eb27b3, 0x55fd3941, 0xda2547e6, 0xabca0a9a,\n  0x28507825, 0x530429f4, 0x0a2c86da, 0xe9b66dfb, 0x68dc1462, 0xd7486900,\n  0x680ec0a4, 0x27a18dee, 0x4f3ffea2, 0xe887ad8c, 0xb58ce006, 0x7af4d6b6,\n  0xaace1e7c, 0xd3375fec, 0xce78a399, 0x406b2a42, 0x20fe9e35, 0xd9f385b9,\n  0xee39d7ab, 0x3b124e8b, 0x1dc9faf7, 0x4b6d1856, 0x26a36631, 0xeae397b2,\n  0x3a6efa74, 0xdd5b4332, 0x6841e7f7, 0xca7820fb, 0xfb0af54e, 0xd8feb397,\n  0x454056ac, 0xba489527, 0x55533a3a, 0x20838d87, 0xfe6ba9b7, 0xd096954b,\n  0x55a867bc, 0xa1159a58, 0xcca92963, 0x99e1db33, 0xa62a4a56, 0x3f3125f9,\n  0x5ef47e1c, 0x9029317c, 0xfdf8e802, 0x04272f70, 0x80bb155c, 0x05282ce3,\n  0x95c11548, 0xe4c66d22, 0x48c1133f, 0xc70f86dc, 0x07f9c9ee, 0x41041f0f,\n  0x404779a4, 0x5d886e17, 0x325f51eb, 0xd59bc0d1, 0xf2bcc18f, 0x41113564,\n  0x257b7834, 0x602a9c60, 0xdff8e8a3, 0x1f636c1b, 0x0e12b4c2, 0x02e1329e,\n  0xaf664fd1, 0xcad18115, 0x6b2395e0, 0x333e92e1, 0x3b240b62, 0xeebeb922,\n  0x85b2a20e, 0xe6ba0d99, 0xde720c8c, 0x2da2f728, 0xd0127845, 0x95b794fd,\n  0x647d0862, 0xe7ccf5f0, 0x5449a36f, 0x877d48fa, 0xc39dfd27, 0xf33e8d1e,\n  0x0a476341, 0x992eff74, 0x3a6f6eab, 0xf4f8fd37, 0xa812dc60, 0xa1ebddf8,\n  0x991be14c, 0xdb6e6b0d, 0xc67b5510, 0x6d672c37, 0x2765d43b, 0xdcd0e804,\n  0xf1290dc7, 0xcc00ffa3, 0xb5390f92, 0x690fed0b, 0x667b9ffb, 0xcedb7d9c,\n  0xa091cf0b, 0xd9155ea3, 0xbb132f88, 0x515bad24, 0x7b9479bf, 0x763bd6eb,\n  0x37392eb3, 0xcc115979, 0x8026e297, 0xf42e312d, 0x6842ada7, 0xc66a2b3b,\n  0x12754ccc, 0x782ef11c, 0x6a124237, 0xb79251e7, 0x06a1bbe6, 0x4bfb6350,\n  0x1a6b1018, 0x11caedfa, 0x3d25bdd8, 0xe2e1c3c9, 0x44421659, 0x0a121386,\n  0xd90cec6e, 0xd5abea2a, 0x64af674e, 0xda86a85f, 0xbebfe988, 0x64e4c3fe,\n  0x9dbc8057, 0xf0f7c086, 0x60787bf8, 0x6003604d, 0xd1fd8346, 0xf6381fb0,\n  0x7745ae04, 0xd736fccc, 0x83426b33, 0xf01eab71, 0xb0804187, 0x3c005e5f,\n  0x77a057be, 0xbde8ae24, 0x55464299, 0xbf582e61, 0x4e58f48f, 0xf2ddfda2,\n  0xf474ef38, 0x8789bdc2, 0x5366f9c3, 0xc8b38e74, 0xb475f255, 0x46fcd9b9,\n  0x7aeb2661, 0x8b1ddf84, 0x846a0e79, 0x915f95e2, 0x466e598e, 0x20b45770,\n  0x8cd55591, 0xc902de4c, 0xb90bace1, 0xbb8205d0, 0x11a86248, 0x7574a99e,\n  0xb77f19b6, 0xe0a9dc09, 0x662d09a1, 0xc4324633, 0xe85a1f02, 0x09f0be8c,\n  0x4a99a025, 0x1d6efe10, 0x1ab93d1d, 0x0ba5a4df, 0xa186f20f, 0x2868f169,\n  0xdcb7da83, 0x573906fe, 0xa1e2ce9b, 0x4fcd7f52, 0x50115e01, 0xa70683fa,\n  0xa002b5c4, 0x0de6d027, 0x9af88c27, 0x773f8641, 0xc3604c06, 0x61a806b5,\n  0xf0177a28, 0xc0f586e0, 0x006058aa, 0x30dc7d62, 0x11e69ed7, 0x2338ea63,\n  0x53c2dd94, 0xc2c21634, 0xbbcbee56, 0x90bcb6de, 0xebfc7da1, 0xce591d76,\n  0x6f05e409, 0x4b7c0188, 0x39720a3d, 0x7c927c24, 0x86e3725f, 0x724d9db9,\n  0x1ac15bb4, 0xd39eb8fc, 0xed545578, 0x08fca5b5, 0xd83d7cd3, 0x4dad0fc4,\n  0x1e50ef5e, 0xb161e6f8, 0xa28514d9, 0x6c51133c, 0x6fd5c7e7, 0x56e14ec4,\n  0x362abfce, 0xddc6c837, 0xd79a3234, 0x92638212, 0x670efa8e, 0x406000e0,\n  0x3a39ce37, 0xd3faf5cf, 0xabc27737, 0x5ac52d1b, 0x5cb0679e, 0x4fa33742,\n  0xd3822740, 0x99bc9bbe, 0xd5118e9d, 0xbf0f7315, 0xd62d1c7e, 0xc700c47b,\n  0xb78c1b6b, 0x21a19045, 0xb26eb1be, 0x6a366eb4, 0x5748ab2f, 0xbc946e79,\n  0xc6a376d2, 0x6549c2c8, 0x530ff8ee, 0x468dde7d, 0xd5730a1d, 0x4cd04dc6,\n  0x2939bbdb, 0xa9ba4650, 0xac9526e8, 0xbe5ee304, 0xa1fad5f0, 0x6a2d519a,\n  0x63ef8ce2, 0x9a86ee22, 0xc089c2b8, 0x43242ef6, 0xa51e03aa, 0x9cf2d0a4,\n  0x83c061ba, 0x9be96a4d, 0x8fe51550, 0xba645bd6, 0x2826a2f9, 0xa73a3ae1,\n  0x4ba99586, 0xef5562e9, 0xc72fefd3, 0xf752f7da, 0x3f046f69, 0x77fa0a59,\n  0x80e4a915, 0x87b08601, 0x9b09e6ad, 0x3b3ee593, 0xe990fd5a, 0x9e34d797,\n  0x2cf0b7d9, 0x022b8b51, 0x96d5ac3a, 0x017da67d, 0xd1cf3ed6, 0x7c7d2d28,\n  0x1f9f25cf, 0xadf2b89b, 0x5ad6b472, 0x5a88f54c, 0xe029ac71, 0xe019a5e6,\n  0x47b0acfd, 0xed93fa9b, 0xe8d3c48d, 0x283b57cc, 0xf8d56629, 0x79132e28,\n  0x785f0191, 0xed756055, 0xf7960e44, 0xe3d35e8c, 0x15056dd4, 0x88f46dba,\n  0x03a16125, 0x0564f0bd, 0xc3eb9e15, 0x3c9057a2, 0x97271aec, 0xa93a072a,\n  0x1b3f6d9b, 0x1e6321f5, 0xf59c66fb, 0x26dcf319, 0x7533d928, 0xb155fdf5,\n  0x03563482, 0x8aba3cbb, 0x28517711, 0xc20ad9f8, 0xabcc5167, 0xccad925f,\n  0x4de81751, 0x3830dc8e, 0x379d5862, 0x9320f991, 0xea7a90c2, 0xfb3e7bce,\n  0x5121ce64, 0x774fbe32, 0xa8b6e37e, 0xc3293d46, 0x48de5369, 0x6413e680,\n  0xa2ae0810, 0xdd6db224, 0x69852dfd, 0x09072166, 0xb39a460a, 0x6445c0dd,\n  0x586cdecf, 0x1c20c8ae, 0x5bbef7dd, 0x1b588d40, 0xccd2017f, 0x6bb4e3bb,\n  0xdda26a7e, 0x3a59ff45, 0x3e350a44, 0xbcb4cdd5, 0x72eacea8, 0xfa6484bb,\n  0x8d6612ae, 0xbf3c6f47, 0xd29be463, 0x542f5d9e, 0xaec2771b, 0xf64e6370,\n  0x740e0d8d, 0xe75b1357, 0xf8721671, 0xaf537d5d, 0x4040cb08, 0x4eb4e2cc,\n  0x34d2466a, 0x0115af84, 0xe1b00428, 0x95983a1d, 0x06b89fb4, 0xce6ea048,\n  0x6f3f3b82, 0x3520ab82, 0x011a1d4b, 0x277227f8, 0x611560b1, 0xe7933fdc,\n  0xbb3a792b, 0x344525bd, 0xa08839e1, 0x51ce794b, 0x2f32c9b7, 0xa01fbac9,\n  0xe01cc87e, 0xbcc7d1f6, 0xcf0111c3, 0xa1e8aac7, 0x1a908749, 0xd44fbd9a,\n  0xd0dadecb, 0xd50ada38, 0x0339c32a, 0xc6913667, 0x8df9317c, 0xe0b12b4f,\n  0xf79e59b7, 0x43f5bb3a, 0xf2d519ff, 0x27d9459c, 0xbf97222c, 0x15e6fc2a,\n  0x0f91fc71, 0x9b941525, 0xfae59361, 0xceb69ceb, 0xc2a86459, 0x12baa8d1,\n  0xb6c1075e, 0xe3056a0c, 0x10d25065, 0xcb03a442, 0xe0ec6e0e, 0x1698db3b,\n  0x4c98a0be, 0x3278e964, 0x9f1f9532, 0xe0d392df, 0xd3a0342b, 0x8971f21e,\n  0x1b0a7441, 0x4ba3348c, 0xc5be7120, 0xc37632d8, 0xdf359f8d, 0x9b992f2e,\n  0xe60b6f47, 0x0fe3f11d, 0xe54cda54, 0x1edad891, 0xce6279cf, 0xcd3e7e6f,\n  0x1618b166, 0xfd2c1d05, 0x848fd2c5, 0xf6fb2299, 0xf523f357, 0xa6327623,\n  0x93a83531, 0x56cccd02, 0xacf08162, 0x5a75ebb5, 0x6e163697, 0x88d273cc,\n  0xde966292, 0x81b949d0, 0x4c50901b, 0x71c65614, 0xe6c6c7bd, 0x327a140a,\n  0x45e1d006, 0xc3f27b9a, 0xc9aa53fd, 0x62a80f00, 0xbb25bfe2, 0x35bdd2f6,\n  0x71126905, 0xb2040222, 0xb6cbcf7c, 0xcd769c2b, 0x53113ec0, 0x1640e3d3,\n  0x38abbd60, 0x2547adf0, 0xba38209c, 0xf746ce76, 0x77afa1c5, 0x20756060,\n  0x85cbfe4e, 0x8ae88dd8, 0x7aaaf9b0, 0x4cf9aa7e, 0x1948c25c, 0x02fb8a8c,\n  0x01c36ae4, 0xd6ebe1f9, 0x90d4f869, 0xa65cdea0, 0x3f09252d, 0xc208e69f,\n  0xb74e6132, 0xce77e25b, 0x578fdfe3, 0x3ac372e6,\n];\n\n/**\n * @type {Array.<number>}\n * @const\n * @inner\n */\nvar C_ORIG = [\n  0x4f727068, 0x65616e42, 0x65686f6c, 0x64657253, 0x63727944, 0x6f756274,\n];\n\n/**\n * @param {Array.<number>} lr\n * @param {number} off\n * @param {Array.<number>} P\n * @param {Array.<number>} S\n * @returns {Array.<number>}\n * @inner\n */\nfunction _encipher(lr, off, P, S) {\n  // This is our bottleneck: 1714/1905 ticks / 90% - see profile.txt\n  var n,\n    l = lr[off],\n    r = lr[off + 1];\n\n  l ^= P[0];\n\n  /*\n    for (var i=0, k=BLOWFISH_NUM_ROUNDS-2; i<=k;)\n        // Feistel substitution on left word\n        n  = S[l >>> 24],\n        n += S[0x100 | ((l >> 16) & 0xff)],\n        n ^= S[0x200 | ((l >> 8) & 0xff)],\n        n += S[0x300 | (l & 0xff)],\n        r ^= n ^ P[++i],\n        // Feistel substitution on right word\n        n  = S[r >>> 24],\n        n += S[0x100 | ((r >> 16) & 0xff)],\n        n ^= S[0x200 | ((r >> 8) & 0xff)],\n        n += S[0x300 | (r & 0xff)],\n        l ^= n ^ P[++i];\n    */\n\n  //The following is an unrolled version of the above loop.\n  //Iteration 0\n  n = S[l >>> 24];\n  n += S[0x100 | ((l >> 16) & 0xff)];\n  n ^= S[0x200 | ((l >> 8) & 0xff)];\n  n += S[0x300 | (l & 0xff)];\n  r ^= n ^ P[1];\n  n = S[r >>> 24];\n  n += S[0x100 | ((r >> 16) & 0xff)];\n  n ^= S[0x200 | ((r >> 8) & 0xff)];\n  n += S[0x300 | (r & 0xff)];\n  l ^= n ^ P[2];\n  //Iteration 1\n  n = S[l >>> 24];\n  n += S[0x100 | ((l >> 16) & 0xff)];\n  n ^= S[0x200 | ((l >> 8) & 0xff)];\n  n += S[0x300 | (l & 0xff)];\n  r ^= n ^ P[3];\n  n = S[r >>> 24];\n  n += S[0x100 | ((r >> 16) & 0xff)];\n  n ^= S[0x200 | ((r >> 8) & 0xff)];\n  n += S[0x300 | (r & 0xff)];\n  l ^= n ^ P[4];\n  //Iteration 2\n  n = S[l >>> 24];\n  n += S[0x100 | ((l >> 16) & 0xff)];\n  n ^= S[0x200 | ((l >> 8) & 0xff)];\n  n += S[0x300 | (l & 0xff)];\n  r ^= n ^ P[5];\n  n = S[r >>> 24];\n  n += S[0x100 | ((r >> 16) & 0xff)];\n  n ^= S[0x200 | ((r >> 8) & 0xff)];\n  n += S[0x300 | (r & 0xff)];\n  l ^= n ^ P[6];\n  //Iteration 3\n  n = S[l >>> 24];\n  n += S[0x100 | ((l >> 16) & 0xff)];\n  n ^= S[0x200 | ((l >> 8) & 0xff)];\n  n += S[0x300 | (l & 0xff)];\n  r ^= n ^ P[7];\n  n = S[r >>> 24];\n  n += S[0x100 | ((r >> 16) & 0xff)];\n  n ^= S[0x200 | ((r >> 8) & 0xff)];\n  n += S[0x300 | (r & 0xff)];\n  l ^= n ^ P[8];\n  //Iteration 4\n  n = S[l >>> 24];\n  n += S[0x100 | ((l >> 16) & 0xff)];\n  n ^= S[0x200 | ((l >> 8) & 0xff)];\n  n += S[0x300 | (l & 0xff)];\n  r ^= n ^ P[9];\n  n = S[r >>> 24];\n  n += S[0x100 | ((r >> 16) & 0xff)];\n  n ^= S[0x200 | ((r >> 8) & 0xff)];\n  n += S[0x300 | (r & 0xff)];\n  l ^= n ^ P[10];\n  //Iteration 5\n  n = S[l >>> 24];\n  n += S[0x100 | ((l >> 16) & 0xff)];\n  n ^= S[0x200 | ((l >> 8) & 0xff)];\n  n += S[0x300 | (l & 0xff)];\n  r ^= n ^ P[11];\n  n = S[r >>> 24];\n  n += S[0x100 | ((r >> 16) & 0xff)];\n  n ^= S[0x200 | ((r >> 8) & 0xff)];\n  n += S[0x300 | (r & 0xff)];\n  l ^= n ^ P[12];\n  //Iteration 6\n  n = S[l >>> 24];\n  n += S[0x100 | ((l >> 16) & 0xff)];\n  n ^= S[0x200 | ((l >> 8) & 0xff)];\n  n += S[0x300 | (l & 0xff)];\n  r ^= n ^ P[13];\n  n = S[r >>> 24];\n  n += S[0x100 | ((r >> 16) & 0xff)];\n  n ^= S[0x200 | ((r >> 8) & 0xff)];\n  n += S[0x300 | (r & 0xff)];\n  l ^= n ^ P[14];\n  //Iteration 7\n  n = S[l >>> 24];\n  n += S[0x100 | ((l >> 16) & 0xff)];\n  n ^= S[0x200 | ((l >> 8) & 0xff)];\n  n += S[0x300 | (l & 0xff)];\n  r ^= n ^ P[15];\n  n = S[r >>> 24];\n  n += S[0x100 | ((r >> 16) & 0xff)];\n  n ^= S[0x200 | ((r >> 8) & 0xff)];\n  n += S[0x300 | (r & 0xff)];\n  l ^= n ^ P[16];\n\n  lr[off] = r ^ P[BLOWFISH_NUM_ROUNDS + 1];\n  lr[off + 1] = l;\n  return lr;\n}\n\n/**\n * @param {Array.<number>} data\n * @param {number} offp\n * @returns {{key: number, offp: number}}\n * @inner\n */\nfunction _streamtoword(data, offp) {\n  for (var i = 0, word = 0; i < 4; ++i)\n    (word = (word << 8) | (data[offp] & 0xff)),\n      (offp = (offp + 1) % data.length);\n  return { key: word, offp: offp };\n}\n\n/**\n * @param {Array.<number>} key\n * @param {Array.<number>} P\n * @param {Array.<number>} S\n * @inner\n */\nfunction _key(key, P, S) {\n  var offset = 0,\n    lr = [0, 0],\n    plen = P.length,\n    slen = S.length,\n    sw;\n  for (var i = 0; i < plen; i++)\n    (sw = _streamtoword(key, offset)),\n      (offset = sw.offp),\n      (P[i] = P[i] ^ sw.key);\n  for (i = 0; i < plen; i += 2)\n    (lr = _encipher(lr, 0, P, S)), (P[i] = lr[0]), (P[i + 1] = lr[1]);\n  for (i = 0; i < slen; i += 2)\n    (lr = _encipher(lr, 0, P, S)), (S[i] = lr[0]), (S[i + 1] = lr[1]);\n}\n\n/**\n * Expensive key schedule Blowfish.\n * @param {Array.<number>} data\n * @param {Array.<number>} key\n * @param {Array.<number>} P\n * @param {Array.<number>} S\n * @inner\n */\nfunction _ekskey(data, key, P, S) {\n  var offp = 0,\n    lr = [0, 0],\n    plen = P.length,\n    slen = S.length,\n    sw;\n  for (var i = 0; i < plen; i++)\n    (sw = _streamtoword(key, offp)), (offp = sw.offp), (P[i] = P[i] ^ sw.key);\n  offp = 0;\n  for (i = 0; i < plen; i += 2)\n    (sw = _streamtoword(data, offp)),\n      (offp = sw.offp),\n      (lr[0] ^= sw.key),\n      (sw = _streamtoword(data, offp)),\n      (offp = sw.offp),\n      (lr[1] ^= sw.key),\n      (lr = _encipher(lr, 0, P, S)),\n      (P[i] = lr[0]),\n      (P[i + 1] = lr[1]);\n  for (i = 0; i < slen; i += 2)\n    (sw = _streamtoword(data, offp)),\n      (offp = sw.offp),\n      (lr[0] ^= sw.key),\n      (sw = _streamtoword(data, offp)),\n      (offp = sw.offp),\n      (lr[1] ^= sw.key),\n      (lr = _encipher(lr, 0, P, S)),\n      (S[i] = lr[0]),\n      (S[i + 1] = lr[1]);\n}\n\n/**\n * Internaly crypts a string.\n * @param {Array.<number>} b Bytes to crypt\n * @param {Array.<number>} salt Salt bytes to use\n * @param {number} rounds Number of rounds\n * @param {function(Error, Array.<number>=)=} callback Callback receiving the error, if any, and the resulting bytes. If\n *  omitted, the operation will be performed synchronously.\n *  @param {function(number)=} progressCallback Callback called with the current progress\n * @returns {!Array.<number>|undefined} Resulting bytes if callback has been omitted, otherwise `undefined`\n * @inner\n */\nfunction _crypt(b, salt, rounds, callback, progressCallback) {\n  var cdata = C_ORIG.slice(),\n    clen = cdata.length,\n    err;\n\n  // Validate\n  if (rounds < 4 || rounds > 31) {\n    err = Error(\"Illegal number of rounds (4-31): \" + rounds);\n    if (callback) {\n      nextTick(callback.bind(this, err));\n      return;\n    } else throw err;\n  }\n  if (salt.length !== BCRYPT_SALT_LEN) {\n    err = Error(\n      \"Illegal salt length: \" + salt.length + \" != \" + BCRYPT_SALT_LEN,\n    );\n    if (callback) {\n      nextTick(callback.bind(this, err));\n      return;\n    } else throw err;\n  }\n  rounds = (1 << rounds) >>> 0;\n\n  var P,\n    S,\n    i = 0,\n    j;\n\n  //Use typed arrays when available - huge speedup!\n  if (typeof Int32Array === \"function\") {\n    P = new Int32Array(P_ORIG);\n    S = new Int32Array(S_ORIG);\n  } else {\n    P = P_ORIG.slice();\n    S = S_ORIG.slice();\n  }\n\n  _ekskey(salt, b, P, S);\n\n  /**\n   * Calcualtes the next round.\n   * @returns {Array.<number>|undefined} Resulting array if callback has been omitted, otherwise `undefined`\n   * @inner\n   */\n  function next() {\n    if (progressCallback) progressCallback(i / rounds);\n    if (i < rounds) {\n      var start = Date.now();\n      for (; i < rounds; ) {\n        i = i + 1;\n        _key(b, P, S);\n        _key(salt, P, S);\n        if (Date.now() - start > MAX_EXECUTION_TIME) break;\n      }\n    } else {\n      for (i = 0; i < 64; i++)\n        for (j = 0; j < clen >> 1; j++) _encipher(cdata, j << 1, P, S);\n      var ret = [];\n      for (i = 0; i < clen; i++)\n        ret.push(((cdata[i] >> 24) & 0xff) >>> 0),\n          ret.push(((cdata[i] >> 16) & 0xff) >>> 0),\n          ret.push(((cdata[i] >> 8) & 0xff) >>> 0),\n          ret.push((cdata[i] & 0xff) >>> 0);\n      if (callback) {\n        callback(null, ret);\n        return;\n      } else return ret;\n    }\n    if (callback) nextTick(next);\n  }\n\n  // Async\n  if (typeof callback !== \"undefined\") {\n    next();\n\n    // Sync\n  } else {\n    var res;\n    while (true) if (typeof (res = next()) !== \"undefined\") return res || [];\n  }\n}\n\n/**\n * Internally hashes a password.\n * @param {string} password Password to hash\n * @param {?string} salt Salt to use, actually never null\n * @param {function(Error, string=)=} callback Callback receiving the error, if any, and the resulting hash. If omitted,\n *  hashing is performed synchronously.\n *  @param {function(number)=} progressCallback Callback called with the current progress\n * @returns {string|undefined} Resulting hash if callback has been omitted, otherwise `undefined`\n * @inner\n */\nfunction _hash(password, salt, callback, progressCallback) {\n  var err;\n  if (typeof password !== \"string\" || typeof salt !== \"string\") {\n    err = Error(\"Invalid string / salt: Not a string\");\n    if (callback) {\n      nextTick(callback.bind(this, err));\n      return;\n    } else throw err;\n  }\n\n  // Validate the salt\n  var minor, offset;\n  if (salt.charAt(0) !== \"$\" || salt.charAt(1) !== \"2\") {\n    err = Error(\"Invalid salt version: \" + salt.substring(0, 2));\n    if (callback) {\n      nextTick(callback.bind(this, err));\n      return;\n    } else throw err;\n  }\n  if (salt.charAt(2) === \"$\") (minor = String.fromCharCode(0)), (offset = 3);\n  else {\n    minor = salt.charAt(2);\n    if (\n      (minor !== \"a\" && minor !== \"b\" && minor !== \"y\") ||\n      salt.charAt(3) !== \"$\"\n    ) {\n      err = Error(\"Invalid salt revision: \" + salt.substring(2, 4));\n      if (callback) {\n        nextTick(callback.bind(this, err));\n        return;\n      } else throw err;\n    }\n    offset = 4;\n  }\n\n  // Extract number of rounds\n  if (salt.charAt(offset + 2) > \"$\") {\n    err = Error(\"Missing salt rounds\");\n    if (callback) {\n      nextTick(callback.bind(this, err));\n      return;\n    } else throw err;\n  }\n  var r1 = parseInt(salt.substring(offset, offset + 1), 10) * 10,\n    r2 = parseInt(salt.substring(offset + 1, offset + 2), 10),\n    rounds = r1 + r2,\n    real_salt = salt.substring(offset + 3, offset + 25);\n  password += minor >= \"a\" ? \"\\x00\" : \"\";\n\n  var passwordb = utf8Array(password),\n    saltb = base64_decode(real_salt, BCRYPT_SALT_LEN);\n\n  /**\n   * Finishes hashing.\n   * @param {Array.<number>} bytes Byte array\n   * @returns {string}\n   * @inner\n   */\n  function finish(bytes) {\n    var res = [];\n    res.push(\"$2\");\n    if (minor >= \"a\") res.push(minor);\n    res.push(\"$\");\n    if (rounds < 10) res.push(\"0\");\n    res.push(rounds.toString());\n    res.push(\"$\");\n    res.push(base64_encode(saltb, saltb.length));\n    res.push(base64_encode(bytes, C_ORIG.length * 4 - 1));\n    return res.join(\"\");\n  }\n\n  // Sync\n  if (typeof callback == \"undefined\")\n    return finish(_crypt(passwordb, saltb, rounds));\n  // Async\n  else {\n    _crypt(\n      passwordb,\n      saltb,\n      rounds,\n      function (err, bytes) {\n        if (err) callback(err, null);\n        else callback(null, finish(bytes));\n      },\n      progressCallback,\n    );\n  }\n}\n\n/**\n * Encodes a byte array to base64 with up to len bytes of input, using the custom bcrypt alphabet.\n * @function\n * @param {!Array.<number>} bytes Byte array\n * @param {number} length Maximum input length\n * @returns {string}\n */\nexport function encodeBase64(bytes, length) {\n  return base64_encode(bytes, length);\n}\n\n/**\n * Decodes a base64 encoded string to up to len bytes of output, using the custom bcrypt alphabet.\n * @function\n * @param {string} string String to decode\n * @param {number} length Maximum output length\n * @returns {!Array.<number>}\n */\nexport function decodeBase64(string, length) {\n  return base64_decode(string, length);\n}\n\nexport default {\n  setRandomFallback,\n  genSaltSync,\n  genSalt,\n  hashSync,\n  hash,\n  compareSync,\n  compare,\n  getRounds,\n  getSalt,\n  truncates,\n  encodeBase64,\n  decodeBase64,\n};\n", "// Recurring event utilities\r\nexport function calculateNextOccurrence(event, fromDate = new Date()) {\r\n  if (!event.is_recurring || !event.recurrence_pattern) {\r\n    return new Date(event.event_datetime);\r\n  }\r\n\r\n  try {\r\n    const pattern = JSON.parse(event.recurrence_pattern);\r\n    const baseDate = new Date(fromDate);\r\n    baseDate.setHours(0, 0, 0, 0);\r\n\r\n    if (event.recurrence_end_date) {\r\n      const endDate = new Date(event.recurrence_end_date);\r\n      if (baseDate > endDate) return null;\r\n    }\r\n\r\n    switch (pattern.type) {\r\n      case 'weekly':\r\n        return getNextWeeklyOccurrence(baseDate, pattern);\r\n      case 'monthly_day':\r\n        return getNextMonthlyDayOccurrence(baseDate, pattern);\r\n      case 'monthly_date':\r\n        return getNextMonthlyDateOccurrence(baseDate, pattern);\r\n      default:\r\n        return new Date(event.event_datetime);\r\n    }\r\n  } catch (e) {\r\n    console.error('Error parsing recurrence pattern:', e);\r\n    return new Date(event.event_datetime);\r\n  }\r\n}\r\n\r\nfunction getNextWeeklyOccurrence(fromDate, pattern) {\r\n  // pattern: {type:\"weekly\", day:0-6, time:\"HH:MM\"}\r\n  const targetDay = pattern.day; // 0=Sunday, 6=Saturday\r\n  const [hours, minutes] = pattern.time.split(':').map(Number);\r\n  \r\n  const result = new Date(fromDate);\r\n  const currentDay = result.getDay();\r\n  \r\n  // Days until target day\r\n  let daysToAdd = targetDay - currentDay;\r\n  if (daysToAdd < 0) daysToAdd += 7;\r\n  if (daysToAdd === 0 && result > fromDate) daysToAdd = 7;\r\n  \r\n  result.setDate(result.getDate() + daysToAdd);\r\n  result.setHours(hours, minutes, 0, 0);\r\n  \r\n  return result;\r\n}\r\n\r\nfunction getNextMonthlyDayOccurrence(fromDate, pattern) {\r\n  // pattern: {type:\"monthly_day\", week:1-5 (1=first, 5=last), day:0-6, time:\"HH:MM\"}\r\n  const [hours, minutes] = pattern.time.split(':').map(Number);\r\n  \r\n  let result = new Date(fromDate);\r\n  result.setDate(1); // Start at first of month\r\n  \r\n  // Try current month first, then next month\r\n  for (let attempt = 0; attempt < 2; attempt++) {\r\n    const occurrence = getNthDayOfMonth(result.getFullYear(), result.getMonth(), pattern.week, pattern.day);\r\n    occurrence.setHours(hours, minutes, 0, 0);\r\n    \r\n    if (occurrence >= fromDate) {\r\n      return occurrence;\r\n    }\r\n    \r\n    // Move to next month\r\n    result.setMonth(result.getMonth() + 1);\r\n  }\r\n  \r\n  return result;\r\n}\r\n\r\nfunction getNthDayOfMonth(year, month, week, dayOfWeek) {\r\n  // week: 1=first, 2=second, 3=third, 4=fourth, 5=last\r\n  // dayOfWeek: 0=Sunday, 6=Saturday\r\n  \r\n  if (week === 5) {\r\n    // Last occurrence\r\n    const lastDay = new Date(year, month + 1, 0);\r\n    const lastDayOfWeek = lastDay.getDay();\r\n    let diff = lastDayOfWeek - dayOfWeek;\r\n    if (diff < 0) diff += 7;\r\n    lastDay.setDate(lastDay.getDate() - diff);\r\n    return lastDay;\r\n  }\r\n  \r\n  // First, second, third, or fourth occurrence\r\n  const firstDay = new Date(year, month, 1);\r\n  const firstDayOfWeek = firstDay.getDay();\r\n  \r\n  let daysToAdd = dayOfWeek - firstDayOfWeek;\r\n  if (daysToAdd < 0) daysToAdd += 7;\r\n  \r\n  daysToAdd += (week - 1) * 7;\r\n  \r\n  const result = new Date(year, month, 1 + daysToAdd);\r\n  \r\n  // Make sure we didn't overflow into next month\r\n  if (result.getMonth() !== month) {\r\n    return null;\r\n  }\r\n  \r\n  return result;\r\n}\r\n\r\nfunction getNextMonthlyDateOccurrence(fromDate, pattern) {\r\n  // pattern: {type:\"monthly_date\", date:1-31, time:\"HH:MM\"}\r\n  const targetDate = pattern.date;\r\n  const [hours, minutes] = pattern.time.split(':').map(Number);\r\n  \r\n  let result = new Date(fromDate);\r\n  result.setDate(targetDate);\r\n  result.setHours(hours, minutes, 0, 0);\r\n  \r\n  // If this month's date has passed, go to next month\r\n  if (result < fromDate) {\r\n    result.setMonth(result.getMonth() + 1);\r\n    result.setDate(targetDate);\r\n  }\r\n  \r\n  // Handle months that don't have this date (e.g., Feb 30)\r\n  if (result.getDate() !== targetDate) {\r\n    result.setMonth(result.getMonth() + 1);\r\n    result.setDate(targetDate);\r\n  }\r\n  \r\n  return result;\r\n}\r\n\r\nexport function getUpcomingOccurrences(event, count = 3) {\r\n  const occurrences = [];\r\n  let nextDate = new Date();\r\n  \r\n  for (let i = 0; i < count; i++) {\r\n    const occurrence = calculateNextOccurrence(event, nextDate);\r\n    if (!occurrence) break;\r\n    \r\n    occurrences.push(occurrence);\r\n    \r\n    // Move to day after this occurrence for next calculation\r\n    nextDate = new Date(occurrence);\r\n    nextDate.setDate(nextDate.getDate() + 1);\r\n  }\r\n  \r\n  return occurrences;\r\n}\r\n", "/**\r\n * Event Reminder Email Template\r\n * Sent 1 day before the event to remind attendees\r\n */\r\n\r\nexport function getEventReminderEmail(event, user, ticket) {\r\n  const eventDate = new Date(event.event_datetime)\r\n  const options = { \r\n    weekday: 'long', \r\n    year: 'numeric', \r\n    month: 'long', \r\n    day: 'numeric', \r\n    hour: '2-digit', \r\n    minute: '2-digit'\r\n  }\r\n  const formattedDate = eventDate.toLocaleDateString('en-GB', options)\r\n  \r\n  const htmlContent = `\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>Event Reminder: ${event.event_name}</title>\r\n    <style>\r\n        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; }\r\n        .container { max-width: 600px; margin: 0 auto; padding: 20px; }\r\n        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; border-radius: 8px 8px 0 0; }\r\n        .content { background: white; padding: 30px; border-radius: 0 0 8px 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }\r\n        .event-title { font-size: 28px; margin-bottom: 10px; }\r\n        .event-date { font-size: 20px; font-weight: bold; color: #667eea; margin: 20px 0; }\r\n        .reminder-box { background: #f8f9fa; border-left: 4px solid #667eea; padding: 15px; margin: 25px 0; }\r\n        .cta-button { display: inline-block; background: #667eea; color: white; padding: 12px 25px; text-decoration: none; border-radius: 6px; font-weight: bold; margin: 20px 0; }\r\n        .footer { margin-top: 30px; font-size: 14px; color: #666; text-align: center; }\r\n        .ticket-info { background: #f8f9fa; padding: 15px; border-radius: 6px; margin: 20px 0; }\r\n    </style>\r\n</head>\r\n<body>\r\n    <div class=\"container\">\r\n        <div class=\"header\">\r\n            <h1 class=\"event-title\">\u23F0 Event Reminder: ${event.event_name}</h1>\r\n            <p style=\"margin: 10px 0 0 0; opacity: 0.9;\">Don't forget! Your event is tomorrow!</p>\r\n        </div>\r\n        \r\n        <div class=\"content\">\r\n            <p>Hello ${user.name || 'there'},</p>\r\n            \r\n            <p>This is a friendly reminder that <strong>${event.event_name}</strong> is happening <strong>tomorrow</strong>! We're excited to see you there.</p>\r\n            \r\n            <div class=\"event-date\">\r\n                \uD83D\uDCC5 ${formattedDate}\r\n            </div>\r\n            \r\n            <div class=\"reminder-box\">\r\n                <h3 style=\"margin-top: 0;\">\uD83D\uDCCD Event Location</h3>\r\n                <p>${event.location || 'TBD - Check our website for updates'}</p>\r\n                \r\n                ${event.requires_purchase ? '' : '<p><strong>This is a free event - no ticket needed!</strong></p>'}\r\n            </div>\r\n            \r\n            ${ticket ? `\r\n            <div class=\"ticket-info\">\r\n                <h3 style=\"margin-top: 0;\">\uD83C\uDF9F\uFE0F Your Ticket Information</h3>\r\n                <p><strong>Order Reference:</strong> ${ticket.order_ref}</p>\r\n                <p><strong>Ticket Status:</strong> ${ticket.status === 'confirmed' ? '\u2705 Confirmed' : ticket.status}</p>\r\n                ${event.membership_price ? '<p><strong>You got the member discount!</strong></p>' : ''}\r\n            </div>\r\n            ` : ''}\r\n            \r\n            <div style=\"text-align: center; margin: 30px 0;\">\r\n                <a href=\"https://dicebastion.com/events\" class=\"cta-button\">View Event Details</a>\r\n            </div>\r\n            \r\n            <h3>\uD83D\uDCCB What to Bring</h3>\r\n            <ul>\r\n                <li>Your ticket confirmation (digital or printed)</li>\r\n                <li>Photo ID (if required for age verification)</li>\r\n                <li>Comfortable clothing and any necessary equipment</li>\r\n                <li>Your enthusiasm and excitement!</li>\r\n            </ul>\r\n            \r\n            <h3>\uD83D\uDEA8 Important Notes</h3>\r\n            <ul>\r\n                <li><strong>Arrival Time:</strong> Please arrive 15-30 minutes early for check-in</li>\r\n                <li><strong>Cancellation Policy:</strong> Contact us ASAP if you can't attend</li>\r\n                <li><strong>Questions?</strong> Reply to this email or contact our support team</li>\r\n            </ul>\r\n            \r\n            <p>We can't wait to see you there! If you have any questions or need to make changes to your reservation, please don't hesitate to contact us.</p>\r\n            \r\n            <p>See you soon!</p>\r\n            \r\n            <p><strong>The Dice Bastion Team</strong></p>\r\n            \r\n            <div class=\"footer\">\r\n                <p>Dice Bastion | Gibraltar's Premier Gaming Club</p>\r\n                <p><a href=\"https://dicebastion.com\" style=\"color: #667eea;\">dicebastion.com</a> | <a href=\"mailto:info@dicebastion.com\" style=\"color: #667eea;\">info@dicebastion.com</a></p>\r\n                <p style=\"font-size: 12px; margin-top: 10px;\">You're receiving this email because you registered for ${event.event_name}.</p>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</body>\r\n</html>\r\n  `\r\n  \r\n  const textContent = `\r\nEvent Reminder: ${event.event_name}\r\n================================\r\n\r\nHello ${user.name || 'there'},\r\n\r\nThis is a friendly reminder that ${event.event_name} is happening tomorrow! We're excited to see you there.\r\n\r\n\uD83D\uDCC5 Event Date: ${formattedDate}\r\n\uD83D\uDCCD Location: ${event.location || 'TBD - Check our website for updates'}\r\n\r\n${ticket ? `\r\n\uD83C\uDF9F\uFE0F Your Ticket Information:\r\n- Order Reference: ${ticket.order_ref}\r\n- Status: ${ticket.status === 'confirmed' ? 'Confirmed' : ticket.status}\r\n` : ''}\r\n\r\n\uD83D\uDCCB What to Bring:\r\n- Your ticket confirmation (digital or printed)\r\n- Photo ID (if required for age verification)\r\n- Comfortable clothing and any necessary equipment\r\n- Your enthusiasm and excitement!\r\n\r\n\uD83D\uDEA8 Important Notes:\r\n- Arrival Time: Please arrive 15-30 minutes early for check-in\r\n- Cancellation Policy: Contact us ASAP if you can't attend\r\n- Questions? Reply to this email or contact our support team\r\n\r\nView event details: https://dicebastion.com/events\r\n\r\nWe can't wait to see you there!\r\n\r\nThe Dice Bastion Team\r\n\r\n---\r\nDice Bastion | Gibraltar's Premier Gaming Club\r\ndicebastion.com | info@dicebastion.com\r\nYou're receiving this email because you registered for ${event.event_name}.\r\n```\r\n  \r\n  return {\r\n    subject: `\u23F0 Reminder: ${event.event_name} is tomorrow!`,\r\n    html: htmlContent,\r\n    text: textContent\r\n  }\r\n}\r\n\r\n// Helper function to check if event reminder should be sent\r\nexport function shouldSendEventReminder(eventDate) {\r\n  const now = new Date()\r\n  const oneDayFromNow = new Date(now.getTime() + 24 * 60 * 60 * 1000)\r\n  const tomorrow = new Date(now)\r\n  tomorrow.setDate(now.getDate() + 1)\r\n  tomorrow.setHours(0, 0, 0, 0)\r\n  \r\n  const eventStart = new Date(eventDate)\r\n  \r\n  // Check if event is tomorrow (within 24-48 hours from now)\r\n  return eventStart >= tomorrow && eventStart < oneDayFromNow\r\n}\r\n", "/**\r\n * Authentication Utilities for Dice Bastion\r\n * Secure token generation, validation, and email preference management\r\n */\r\n\r\n/**\r\n * Generate a secure random token for email verification\r\n * @param {number} length - Token length (default: 32)\r\n * @returns {string} Secure random token\r\n */\r\nexport function generateSecureToken(length = 32) {\r\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'\r\n  let token = ''\r\n  const crypto = globalThis.crypto || require('crypto')\r\n  \r\n  const values = new Uint8Array(length)\r\n  crypto.getRandomValues(values)\r\n  \r\n  for (let i = 0; i < length; i++) {\r\n    token += chars[values[i] % chars.length]\r\n  }\r\n  \r\n  return token\r\n}\r\n\r\n/**\r\n * Create an email verification token\r\n * @param {object} db - Database connection\r\n * @param {string} email - User email\r\n * @param {string} userId - User ID\r\n * @param {number} expiresIn - Minutes until expiration (default: 60)\r\n * @returns {Promise<object>} Verification token info\r\n */\r\nexport async function createEmailVerificationToken(db, email, userId, expiresIn = 60) {\r\n  try {\r\n    // Create email_verification_tokens table if it doesn't exist\r\n    await db.prepare(`\r\n      CREATE TABLE IF NOT EXISTS email_verification_tokens (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        user_id INTEGER NOT NULL,\r\n        email TEXT NOT NULL,\r\n        token TEXT NOT NULL UNIQUE,\r\n        token_hash TEXT NOT NULL,\r\n        purpose TEXT NOT NULL, -- 'email_preferences', 'password_reset', etc.\r\n        expires_at TEXT NOT NULL,\r\n        created_at TEXT NOT NULL DEFAULT (strftime('%Y-%m-%dT%H:%M:%fZ','now')),\r\n        used_at TEXT,\r\n        FOREIGN KEY (user_id) REFERENCES users(user_id)\r\n      )\r\n    `).run().catch(() => {})\r\n    \r\n    // Generate secure token\r\n    const token = generateSecureToken(32)\r\n    const expiresAt = new Date(Date.now() + expiresIn * 60 * 1000).toISOString()\r\n    \r\n    // Store token hash (not plain token) for security\r\n    const tokenHash = await hashToken(token)\r\n    \r\n    // Store the token\r\n    await db.prepare(`\r\n      INSERT INTO email_verification_tokens \r\n      (user_id, email, token, token_hash, purpose, expires_at) \r\n      VALUES (?, ?, ?, ?, ?, ?)\r\n    `).bind(userId, email, token, tokenHash, 'email_preferences', expiresAt).run()\r\n    \r\n    return {\r\n      token,\r\n      expiresAt,\r\n      email\r\n    }\r\n  } catch (error) {\r\n    console.error('Error creating verification token:', error)\r\n    throw new Error('Failed to create verification token')\r\n  }\r\n}\r\n\r\n/**\r\n * Hash a token for secure storage\r\n * @param {string} token - Plain token\r\n * @returns {Promise<string>} Hashed token\r\n */\r\nasync function hashToken(token) {\r\n  const encoder = new TextEncoder()\r\n  const data = encoder.encode(token)\r\n  const hashBuffer = await crypto.subtle.digest('SHA-256', data)\r\n  const hashArray = Array.from(new Uint8Array(hashBuffer))\r\n  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('')\r\n}\r\n\r\n/**\r\n * Verify an email verification token\r\n * @param {object} db - Database connection\r\n * @param {string} token - Verification token\r\n * @param {string} email - User email (for additional verification)\r\n * @returns {Promise<object>} Verification result\r\n */\r\nexport async function verifyEmailVerificationToken(db, token, email) {\r\n  try {\r\n    // Get the token from database (case-insensitive email lookup)\r\n    const result = await db.prepare(`\r\n      SELECT * FROM email_verification_tokens \r\n      WHERE token = ? AND LOWER(email) = LOWER(?)\r\n    `).bind(token, email).first()\r\n    \r\n    if (!result) {\r\n      return { valid: false, error: 'Invalid or expired token' }\r\n    }\r\n    \r\n    // Check if token is expired\r\n    const now = new Date()\r\n    const expiresAt = new Date(result.expires_at)\r\n    \r\n    if (now > expiresAt) {\r\n      return { valid: false, error: 'Token has expired' }\r\n    }\r\n    \r\n    // Verify token hash\r\n    const tokenHash = await hashToken(token)\r\n    if (tokenHash !== result.token_hash) {\r\n      return { valid: false, error: 'Invalid token' }\r\n    }\r\n    \r\n    // Mark token as used\r\n    await db.prepare(`\r\n      UPDATE email_verification_tokens \r\n      SET used_at = ? \r\n      WHERE id = ?\r\n    `).bind(new Date().toISOString(), result.id).run()\r\n    \r\n    return {\r\n      valid: true,\r\n      userId: result.user_id,\r\n      email: result.email,\r\n      purpose: result.purpose\r\n    }\r\n  } catch (error) {\r\n    console.error('Error verifying token:', error)\r\n    return { valid: false, error: 'Token verification failed' }\r\n  }\r\n}\r\n\r\n/**\r\n * Get user email preferences\r\n * @param {object} db - Database connection\r\n * @param {string} userId - User ID\r\n * @returns {Promise<object>} User preferences\r\n */\r\nexport async function getUserEmailPreferences(db, userId) {\r\n  try {\r\n    // Create email_preferences table if it doesn't exist\r\n    await db.prepare(`\r\n      CREATE TABLE IF NOT EXISTS email_preferences (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        user_id INTEGER NOT NULL UNIQUE,\r\n        essential_emails BOOLEAN DEFAULT 1, -- Required operational emails\r\n        marketing_emails BOOLEAN DEFAULT 0, -- Optional marketing emails\r\n        consent_given BOOLEAN DEFAULT 0,    -- Explicit consent for marketing\r\n        consent_date TEXT,                 -- When consent was given\r\n        last_updated TEXT NOT NULL DEFAULT (strftime('%Y-%m-%dT%H:%M:%fZ','now')),\r\n        FOREIGN KEY (user_id) REFERENCES users(user_id)\r\n      )\r\n    `).run().catch(() => {})\r\n    \r\n    // Get existing preferences or create defaults\r\n    let preferences = await db.prepare(`\r\n      SELECT * FROM email_preferences WHERE user_id = ?\r\n    `).bind(userId).first()\r\n    \r\n    if (!preferences) {\r\n      // Create default preferences\r\n      await db.prepare(`\r\n        INSERT INTO email_preferences \r\n        (user_id, membership_emails, event_emails, shop_emails, marketing_emails) \r\n        VALUES (?, 1, 1, 1, 1)\r\n      `).bind(userId).run()\r\n      \r\n      preferences = {\r\n        user_id: userId,\r\n        membership_emails: 1,\r\n        event_emails: 1,\r\n        shop_emails: 1,\r\n        marketing_emails: 1\r\n      }\r\n    }\r\n    \r\n    return {\r\n      success: true,\r\n      preferences: {\r\n        essentialEmails: Boolean(preferences.essential_emails),\r\n        marketingEmails: Boolean(preferences.marketing_emails),\r\n        consentGiven: Boolean(preferences.consent_given),\r\n        consentDate: preferences.consent_date || null\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error('Error getting email preferences:', error)\r\n    return { success: false, error: 'Failed to get preferences' }\r\n  }\r\n}\r\n\r\n/**\r\n * Update user email preferences\r\n * @param {object} db - Database connection\r\n * @param {string} userId - User ID\r\n * @param {object} preferences - Updated preferences\r\n * @returns {Promise<object>} Update result\r\n */\r\nexport async function updateUserEmailPreferences(db, userId, preferences) {\r\n  try {\r\n    const now = new Date().toISOString()\r\n    \r\n    await db.prepare(`\r\n      INSERT OR REPLACE INTO email_preferences \r\n      (user_id, essential_emails, marketing_emails, consent_given, consent_date, last_updated) \r\n      VALUES (?, ?, ?, ?, ?, ?)\r\n    `).bind(\r\n      userId,\r\n      preferences.essentialEmails ? 1 : 0,\r\n      preferences.marketingEmails ? 1 : 0,\r\n      preferences.consentGiven ? 1 : 0,\r\n      preferences.consentGiven ? new Date().toISOString() : null,\r\n      now\r\n    ).run()\r\n    \r\n    return { success: true }\r\n  } catch (error) {\r\n    console.error('Error updating email preferences:', error)\r\n    return { success: false, error: 'Failed to update preferences' }\r\n  }\r\n}\r\n\r\n/**\r\n * Check if user has valid session for email preferences\r\n * @param {object} db - Database connection\r\n * @param {string} sessionToken - Session token\r\n * @returns {Promise<object>} Session validation result\r\n */\r\nexport async function validateEmailPreferencesSession(db, sessionToken) {\r\n  try {\r\n    const now = new Date().toISOString()\r\n    \r\n    const session = await db.prepare(`\r\n      SELECT s.*, u.email, u.user_id \r\n      FROM user_sessions s \r\n      JOIN users u ON s.user_id = u.user_id\r\n      WHERE s.session_token = ? \r\n      AND s.expires_at > ?\r\n      AND u.is_active = 1\r\n    `).bind(sessionToken, now).first()\r\n    \r\n    if (!session) {\r\n      return { valid: false, error: 'Invalid or expired session' }\r\n    }\r\n    \r\n    return {\r\n      valid: true,\r\n      userId: session.user_id,\r\n      email: session.email\r\n    }\r\n  } catch (error) {\r\n    console.error('Session validation error:', error)\r\n    return { valid: false, error: 'Session validation failed' }\r\n  }\r\n}\r\n\r\n/**\r\n * Clean up expired verification tokens\r\n * @param {object} db - Database connection\r\n * @returns {Promise<number>} Number of tokens cleaned up\r\n */\r\nexport async function cleanupExpiredVerificationTokens(db) {\r\n  try {\r\n    const now = new Date().toISOString()\r\n    \r\n    const result = await db.prepare(`\r\n      DELETE FROM email_verification_tokens \r\n      WHERE expires_at < ? AND used_at IS NULL\r\n    `).bind(now).run()\r\n    \r\n    return result.changes || 0\r\n  } catch (error) {\r\n    console.error('Error cleaning up tokens:', error)\r\n    return 0\r\n  }\r\n}\r\n\r\n// Rate limiting for email verification requests\r\nconst emailVerificationRateLimits = new Map()\r\n\r\n/**\r\n * Check rate limit for email verification\r\n * @param {string} ip - IP address\r\n * @param {string} email - Email address\r\n * @returns {boolean} True if request is allowed\r\n */\r\nexport function checkEmailVerificationRateLimit(ip, email) {\r\n  const now = Date.now()\r\n  const key = `${ip}:${email}`\r\n  \r\n  if (emailVerificationRateLimits.has(key)) {\r\n    const [timestamp, count] = emailVerificationRateLimits.get(key)\r\n    \r\n    // Reset after 1 hour\r\n    if (now - timestamp > 60 * 60 * 1000) {\r\n      emailVerificationRateLimits.set(key, [now, 1])\r\n      return true\r\n    }\r\n    \r\n    // Limit to 3 attempts per hour\r\n    if (count >= 3) {\r\n      return false\r\n    }\r\n    \r\n    emailVerificationRateLimits.set(key, [timestamp, count + 1])\r\n    return true\r\n  }\r\n  \r\n  emailVerificationRateLimits.set(key, [now, 1])\r\n  return true\r\n}\r\n\r\n/**\r\n * Generate email verification link\r\n * @param {string} baseUrl - Base URL of the application\r\n * @param {string} email - User email\r\n * @param {string} token - Verification token\r\n * @returns {string} Full verification URL\r\n */\r\nexport function generateVerificationLink(baseUrl, email, token) {\r\n  // URL-safe email encoding\r\n  const encodedEmail = encodeURIComponent(email)\r\n  return `${baseUrl}/email-preferences?email=${encodedEmail}&token=${token}`\r\n}\r\n\r\n/**\r\n * Check if user can access email preferences without verification\r\n * (Currently always returns false since we don't have user sessions yet)\r\n * @param {object} db - Database connection\r\n * @param {string} sessionToken - Session token\r\n * @returns {Promise<boolean>} True if direct access is allowed\r\n */\r\nexport async function canAccessEmailPreferencesDirectly(db, sessionToken) {\r\n  // Currently disabled since we don't have user sessions yet\r\n  // This can be enabled later when user authentication is implemented\r\n  return false\r\n}"],
  "mappings": "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AC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAA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",
  "names": ["init_performance", "init_performance", "PerformanceMark", "init_performance", "init_performance", "init_performance", "init_performance", "clear", "count", "countReset", "createTask", "debug", "dir", "dirxml", "error", "group", "groupCollapsed", "groupEnd", "info", "log", "profile", "profileEnd", "table", "time", "timeEnd", "timeLog", "timeStamp", "trace", "warn", "init_console", "init_performance", "init_console", "init_performance", "hrtime", "init_performance", "init_performance", "dir", "env", "count", "init_performance", "init_performance", "init_performance", "cwd", "hrtime", "assert", "init_process", "init_performance", "init_process", "init_performance", "init_performance", "init_performance", "init_performance", "init_performance", "context", "init_performance", "init_performance", "init_performance", "init_performance", "init_performance", "init_performance", "match", "raw", "init_performance", "context", "init_performance", "init_performance", "app", "env", "context", "init_performance", "init_performance", "init_performance", "init_performance", "context", "init_performance", "init_performance", "init_performance", "init_performance", "init_performance", "init_performance", "init_performance", "Node", "Node", "Hono", "init_performance", "callback", "nextTick", "salt", "hash", "off", "err", "init_performance", "init_performance", "init_performance", "Hono", "count", "error", "env", "customer", "title", "savePaymentInstrument", "debug", "error", "cardLast4", "ev", "time"]
}
