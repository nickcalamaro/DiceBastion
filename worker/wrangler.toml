name = "dicebastion-memberships"
main = "src/index.js"
compatibility_flags = [ "nodejs_compat" ]
compatibility_date = "2024-10-23"

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "dicebastion"
database_id = "9abc9bae-236a-4237-aa88-78cf161ba9d1"

# R2 Object Storage
[[r2_buckets]]
binding = "IMAGES"
bucket_name = "dicebastion-images"

# Service Bindings - Connect to payments worker
[[services]]
binding = "PAYMENTS"
service = "dicebastion-payments"

# Environment Variables (for local development)
[vars]
DEBUG = "false"
PAYMENTS_WORKER_URL = "https://dicebastion-payments.ncalamaro.workers.dev"
ALLOWED_ORIGIN = "http://localhost:1313,http://localhost:1314,http://localhost:8000,https://dicebastion.com,https://www.dicebastion.com,https://shop.dicebastion.com,https://dicebastion-shop.pages.dev"
SUMUP_MERCHANT_CODE = "MUZHYEAH"
ALLOW_TEST_BYPASS = "true"

# Production secrets (set via: wrangler secret put SECRET_NAME)
# - SUMUP_ACCESS_TOKEN
# - SUMUP_MERCHANT_CODE
# - MAILERSEND_API_KEY
# - ADMIN_KEY (for shop admin endpoints)
# - BGG_API_TOKEN (for BoardGameGeek API access)

# Cron trigger for membership renewals (daily at 2 AM UTC)
[triggers]
crons = ["0 2 * * *"]
