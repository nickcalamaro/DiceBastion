{
  "version": 3,
  "sources": ["../../../node_modules/bcryptjs/dist/bcrypt.js", "../../../node_modules/hono/dist/compose.js", "../../../node_modules/hono/dist/request/constants.js", "../../../node_modules/hono/dist/utils/body.js", "../../../node_modules/hono/dist/utils/url.js", "../../../node_modules/hono/dist/request.js", "../../../node_modules/hono/dist/utils/html.js", "../../../node_modules/hono/dist/context.js", "../../../node_modules/hono/dist/router.js", "../../../node_modules/hono/dist/utils/constants.js", "../../../node_modules/hono/dist/hono-base.js", "../../../node_modules/hono/dist/router/reg-exp-router/matcher.js", "../../../node_modules/hono/dist/router/reg-exp-router/node.js", "../../../node_modules/hono/dist/router/reg-exp-router/trie.js", "../../../node_modules/hono/dist/router/reg-exp-router/router.js", "../../../node_modules/hono/dist/router/smart-router/router.js", "../../../node_modules/hono/dist/router/trie-router/node.js", "../../../node_modules/hono/dist/router/trie-router/router.js", "../../../node_modules/hono/dist/hono.js", "../../../src/index.js"],
  "sourceRoot": "C:\\Users\\nickc\\Dev\\DiceBastion\\worker\\.wrangler\\tmp\\deploy-k2vW9B",
  "sourcesContent": ["/*\r\n Copyright (c) 2012 Nevins Bartolomeo <nevins.bartolomeo@gmail.com>\r\n Copyright (c) 2012 Shane Girish <shaneGirish@gmail.com>\r\n Copyright (c) 2014 Daniel Wirtz <dcode@dcode.io>\r\n\r\n Redistribution and use in source and binary forms, with or without\r\n modification, are permitted provided that the following conditions\r\n are met:\r\n 1. Redistributions of source code must retain the above copyright\r\n notice, this list of conditions and the following disclaimer.\r\n 2. Redistributions in binary form must reproduce the above copyright\r\n notice, this list of conditions and the following disclaimer in the\r\n documentation and/or other materials provided with the distribution.\r\n 3. The name of the author may not be used to endorse or promote products\r\n derived from this software without specific prior written permission.\r\n\r\n THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR\r\n IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES\r\n OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,\r\n INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\r\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\r\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\r\n THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\n/**\r\n * @license bcrypt.js (c) 2013 Daniel Wirtz <dcode@dcode.io>\r\n * Released under the Apache License, Version 2.0\r\n * see: https://github.com/dcodeIO/bcrypt.js for details\r\n */\r\n(function(global, factory) {\r\n\r\n    /* AMD */ if (typeof define === 'function' && define[\"amd\"])\r\n        define([], factory);\r\n    /* CommonJS */ else if (typeof require === 'function' && typeof module === \"object\" && module && module[\"exports\"])\r\n        module[\"exports\"] = factory();\r\n    /* Global */ else\r\n        (global[\"dcodeIO\"] = global[\"dcodeIO\"] || {})[\"bcrypt\"] = factory();\r\n\r\n}(this, function() {\r\n    \"use strict\";\r\n\r\n    /**\r\n     * bcrypt namespace.\r\n     * @type {Object.<string,*>}\r\n     */\r\n    var bcrypt = {};\r\n\r\n    /**\r\n     * The random implementation to use as a fallback.\r\n     * @type {?function(number):!Array.<number>}\r\n     * @inner\r\n     */\r\n    var randomFallback = null;\r\n\r\n    /**\r\n     * Generates cryptographically secure random bytes.\r\n     * @function\r\n     * @param {number} len Bytes length\r\n     * @returns {!Array.<number>} Random bytes\r\n     * @throws {Error} If no random implementation is available\r\n     * @inner\r\n     */\r\n    function random(len) {\r\n        /* node */ if (typeof module !== 'undefined' && module && module['exports'])\r\n            try {\r\n                return require(\"crypto\")['randomBytes'](len);\r\n            } catch (e) {}\r\n        /* WCA */ try {\r\n            var a; (self['crypto']||self['msCrypto'])['getRandomValues'](a = new Uint32Array(len));\r\n            return Array.prototype.slice.call(a);\r\n        } catch (e) {}\r\n        /* fallback */ if (!randomFallback)\r\n            throw Error(\"Neither WebCryptoAPI nor a crypto module is available. Use bcrypt.setRandomFallback to set an alternative\");\r\n        return randomFallback(len);\r\n    }\r\n\r\n    // Test if any secure randomness source is available\r\n    var randomAvailable = false;\r\n    try {\r\n        random(1);\r\n        randomAvailable = true;\r\n    } catch (e) {}\r\n\r\n    // Default fallback, if any\r\n    randomFallback = null;\r\n    /**\r\n     * Sets the pseudo random number generator to use as a fallback if neither node's `crypto` module nor the Web Crypto\r\n     *  API is available. Please note: It is highly important that the PRNG used is cryptographically secure and that it\r\n     *  is seeded properly!\r\n     * @param {?function(number):!Array.<number>} random Function taking the number of bytes to generate as its\r\n     *  sole argument, returning the corresponding array of cryptographically secure random byte values.\r\n     * @see http://nodejs.org/api/crypto.html\r\n     * @see http://www.w3.org/TR/WebCryptoAPI/\r\n     */\r\n    bcrypt.setRandomFallback = function(random) {\r\n        randomFallback = random;\r\n    };\r\n\r\n    /**\r\n     * Synchronously generates a salt.\r\n     * @param {number=} rounds Number of rounds to use, defaults to 10 if omitted\r\n     * @param {number=} seed_length Not supported.\r\n     * @returns {string} Resulting salt\r\n     * @throws {Error} If a random fallback is required but not set\r\n     * @expose\r\n     */\r\n    bcrypt.genSaltSync = function(rounds, seed_length) {\r\n        rounds = rounds || GENSALT_DEFAULT_LOG2_ROUNDS;\r\n        if (typeof rounds !== 'number')\r\n            throw Error(\"Illegal arguments: \"+(typeof rounds)+\", \"+(typeof seed_length));\r\n        if (rounds < 4)\r\n            rounds = 4;\r\n        else if (rounds > 31)\r\n            rounds = 31;\r\n        var salt = [];\r\n        salt.push(\"$2a$\");\r\n        if (rounds < 10)\r\n            salt.push(\"0\");\r\n        salt.push(rounds.toString());\r\n        salt.push('$');\r\n        salt.push(base64_encode(random(BCRYPT_SALT_LEN), BCRYPT_SALT_LEN)); // May throw\r\n        return salt.join('');\r\n    };\r\n\r\n    /**\r\n     * Asynchronously generates a salt.\r\n     * @param {(number|function(Error, string=))=} rounds Number of rounds to use, defaults to 10 if omitted\r\n     * @param {(number|function(Error, string=))=} seed_length Not supported.\r\n     * @param {function(Error, string=)=} callback Callback receiving the error, if any, and the resulting salt\r\n     * @returns {!Promise} If `callback` has been omitted\r\n     * @throws {Error} If `callback` is present but not a function\r\n     * @expose\r\n     */\r\n    bcrypt.genSalt = function(rounds, seed_length, callback) {\r\n        if (typeof seed_length === 'function')\r\n            callback = seed_length,\r\n            seed_length = undefined; // Not supported.\r\n        if (typeof rounds === 'function')\r\n            callback = rounds,\r\n            rounds = undefined;\r\n        if (typeof rounds === 'undefined')\r\n            rounds = GENSALT_DEFAULT_LOG2_ROUNDS;\r\n        else if (typeof rounds !== 'number')\r\n            throw Error(\"illegal arguments: \"+(typeof rounds));\r\n\r\n        function _async(callback) {\r\n            nextTick(function() { // Pretty thin, but salting is fast enough\r\n                try {\r\n                    callback(null, bcrypt.genSaltSync(rounds));\r\n                } catch (err) {\r\n                    callback(err);\r\n                }\r\n            });\r\n        }\r\n\r\n        if (callback) {\r\n            if (typeof callback !== 'function')\r\n                throw Error(\"Illegal callback: \"+typeof(callback));\r\n            _async(callback);\r\n        } else\r\n            return new Promise(function(resolve, reject) {\r\n                _async(function(err, res) {\r\n                    if (err) {\r\n                        reject(err);\r\n                        return;\r\n                    }\r\n                    resolve(res);\r\n                });\r\n            });\r\n    };\r\n\r\n    /**\r\n     * Synchronously generates a hash for the given string.\r\n     * @param {string} s String to hash\r\n     * @param {(number|string)=} salt Salt length to generate or salt to use, default to 10\r\n     * @returns {string} Resulting hash\r\n     * @expose\r\n     */\r\n    bcrypt.hashSync = function(s, salt) {\r\n        if (typeof salt === 'undefined')\r\n            salt = GENSALT_DEFAULT_LOG2_ROUNDS;\r\n        if (typeof salt === 'number')\r\n            salt = bcrypt.genSaltSync(salt);\r\n        if (typeof s !== 'string' || typeof salt !== 'string')\r\n            throw Error(\"Illegal arguments: \"+(typeof s)+', '+(typeof salt));\r\n        return _hash(s, salt);\r\n    };\r\n\r\n    /**\r\n     * Asynchronously generates a hash for the given string.\r\n     * @param {string} s String to hash\r\n     * @param {number|string} salt Salt length to generate or salt to use\r\n     * @param {function(Error, string=)=} callback Callback receiving the error, if any, and the resulting hash\r\n     * @param {function(number)=} progressCallback Callback successively called with the percentage of rounds completed\r\n     *  (0.0 - 1.0), maximally once per `MAX_EXECUTION_TIME = 100` ms.\r\n     * @returns {!Promise} If `callback` has been omitted\r\n     * @throws {Error} If `callback` is present but not a function\r\n     * @expose\r\n     */\r\n    bcrypt.hash = function(s, salt, callback, progressCallback) {\r\n\r\n        function _async(callback) {\r\n            if (typeof s === 'string' && typeof salt === 'number')\r\n                bcrypt.genSalt(salt, function(err, salt) {\r\n                    _hash(s, salt, callback, progressCallback);\r\n                });\r\n            else if (typeof s === 'string' && typeof salt === 'string')\r\n                _hash(s, salt, callback, progressCallback);\r\n            else\r\n                nextTick(callback.bind(this, Error(\"Illegal arguments: \"+(typeof s)+', '+(typeof salt))));\r\n        }\r\n\r\n        if (callback) {\r\n            if (typeof callback !== 'function')\r\n                throw Error(\"Illegal callback: \"+typeof(callback));\r\n            _async(callback);\r\n        } else\r\n            return new Promise(function(resolve, reject) {\r\n                _async(function(err, res) {\r\n                    if (err) {\r\n                        reject(err);\r\n                        return;\r\n                    }\r\n                    resolve(res);\r\n                });\r\n            });\r\n    };\r\n\r\n    /**\r\n     * Compares two strings of the same length in constant time.\r\n     * @param {string} known Must be of the correct length\r\n     * @param {string} unknown Must be the same length as `known`\r\n     * @returns {boolean}\r\n     * @inner\r\n     */\r\n    function safeStringCompare(known, unknown) {\r\n        var right = 0,\r\n            wrong = 0;\r\n        for (var i=0, k=known.length; i<k; ++i) {\r\n            if (known.charCodeAt(i) === unknown.charCodeAt(i))\r\n                ++right;\r\n            else\r\n                ++wrong;\r\n        }\r\n        // Prevent removal of unused variables (never true, actually)\r\n        if (right < 0)\r\n            return false;\r\n        return wrong === 0;\r\n    }\r\n\r\n    /**\r\n     * Synchronously tests a string against a hash.\r\n     * @param {string} s String to compare\r\n     * @param {string} hash Hash to test against\r\n     * @returns {boolean} true if matching, otherwise false\r\n     * @throws {Error} If an argument is illegal\r\n     * @expose\r\n     */\r\n    bcrypt.compareSync = function(s, hash) {\r\n        if (typeof s !== \"string\" || typeof hash !== \"string\")\r\n            throw Error(\"Illegal arguments: \"+(typeof s)+', '+(typeof hash));\r\n        if (hash.length !== 60)\r\n            return false;\r\n        return safeStringCompare(bcrypt.hashSync(s, hash.substr(0, hash.length-31)), hash);\r\n    };\r\n\r\n    /**\r\n     * Asynchronously compares the given data against the given hash.\r\n     * @param {string} s Data to compare\r\n     * @param {string} hash Data to be compared to\r\n     * @param {function(Error, boolean)=} callback Callback receiving the error, if any, otherwise the result\r\n     * @param {function(number)=} progressCallback Callback successively called with the percentage of rounds completed\r\n     *  (0.0 - 1.0), maximally once per `MAX_EXECUTION_TIME = 100` ms.\r\n     * @returns {!Promise} If `callback` has been omitted\r\n     * @throws {Error} If `callback` is present but not a function\r\n     * @expose\r\n     */\r\n    bcrypt.compare = function(s, hash, callback, progressCallback) {\r\n\r\n        function _async(callback) {\r\n            if (typeof s !== \"string\" || typeof hash !== \"string\") {\r\n                nextTick(callback.bind(this, Error(\"Illegal arguments: \"+(typeof s)+', '+(typeof hash))));\r\n                return;\r\n            }\r\n            if (hash.length !== 60) {\r\n                nextTick(callback.bind(this, null, false));\r\n                return;\r\n            }\r\n            bcrypt.hash(s, hash.substr(0, 29), function(err, comp) {\r\n                if (err)\r\n                    callback(err);\r\n                else\r\n                    callback(null, safeStringCompare(comp, hash));\r\n            }, progressCallback);\r\n        }\r\n\r\n        if (callback) {\r\n            if (typeof callback !== 'function')\r\n                throw Error(\"Illegal callback: \"+typeof(callback));\r\n            _async(callback);\r\n        } else\r\n            return new Promise(function(resolve, reject) {\r\n                _async(function(err, res) {\r\n                    if (err) {\r\n                        reject(err);\r\n                        return;\r\n                    }\r\n                    resolve(res);\r\n                });\r\n            });\r\n    };\r\n\r\n    /**\r\n     * Gets the number of rounds used to encrypt the specified hash.\r\n     * @param {string} hash Hash to extract the used number of rounds from\r\n     * @returns {number} Number of rounds used\r\n     * @throws {Error} If `hash` is not a string\r\n     * @expose\r\n     */\r\n    bcrypt.getRounds = function(hash) {\r\n        if (typeof hash !== \"string\")\r\n            throw Error(\"Illegal arguments: \"+(typeof hash));\r\n        return parseInt(hash.split(\"$\")[2], 10);\r\n    };\r\n\r\n    /**\r\n     * Gets the salt portion from a hash. Does not validate the hash.\r\n     * @param {string} hash Hash to extract the salt from\r\n     * @returns {string} Extracted salt part\r\n     * @throws {Error} If `hash` is not a string or otherwise invalid\r\n     * @expose\r\n     */\r\n    bcrypt.getSalt = function(hash) {\r\n        if (typeof hash !== 'string')\r\n            throw Error(\"Illegal arguments: \"+(typeof hash));\r\n        if (hash.length !== 60)\r\n            throw Error(\"Illegal hash length: \"+hash.length+\" != 60\");\r\n        return hash.substring(0, 29);\r\n    };\r\n\r\n    /**\r\n     * Continues with the callback on the next tick.\r\n     * @function\r\n     * @param {function(...[*])} callback Callback to execute\r\n     * @inner\r\n     */\r\n    var nextTick = typeof process !== 'undefined' && process && typeof process.nextTick === 'function'\r\n        ? (typeof setImmediate === 'function' ? setImmediate : process.nextTick)\r\n        : setTimeout;\r\n\r\n    /**\r\n     * Converts a JavaScript string to UTF8 bytes.\r\n     * @param {string} str String\r\n     * @returns {!Array.<number>} UTF8 bytes\r\n     * @inner\r\n     */\r\n    function stringToBytes(str) {\r\n        var out = [],\r\n            i = 0;\r\n        utfx.encodeUTF16toUTF8(function() {\r\n            if (i >= str.length) return null;\r\n            return str.charCodeAt(i++);\r\n        }, function(b) {\r\n            out.push(b);\r\n        });\r\n        return out;\r\n    }\r\n\r\n    // A base64 implementation for the bcrypt algorithm. This is partly non-standard.\r\n\r\n    /**\r\n     * bcrypt's own non-standard base64 dictionary.\r\n     * @type {!Array.<string>}\r\n     * @const\r\n     * @inner\r\n     **/\r\n    var BASE64_CODE = \"./ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\".split('');\r\n\r\n    /**\r\n     * @type {!Array.<number>}\r\n     * @const\r\n     * @inner\r\n     **/\r\n    var BASE64_INDEX = [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\r\n        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\r\n        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0,\r\n        1, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, -1, -1, -1, -1, -1, -1,\r\n        -1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,\r\n        20, 21, 22, 23, 24, 25, 26, 27, -1, -1, -1, -1, -1, -1, 28, 29, 30,\r\n        31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47,\r\n        48, 49, 50, 51, 52, 53, -1, -1, -1, -1, -1];\r\n\r\n    /**\r\n     * @type {!function(...number):string}\r\n     * @inner\r\n     */\r\n    var stringFromCharCode = String.fromCharCode;\r\n\r\n    /**\r\n     * Encodes a byte array to base64 with up to len bytes of input.\r\n     * @param {!Array.<number>} b Byte array\r\n     * @param {number} len Maximum input length\r\n     * @returns {string}\r\n     * @inner\r\n     */\r\n    function base64_encode(b, len) {\r\n        var off = 0,\r\n            rs = [],\r\n            c1, c2;\r\n        if (len <= 0 || len > b.length)\r\n            throw Error(\"Illegal len: \"+len);\r\n        while (off < len) {\r\n            c1 = b[off++] & 0xff;\r\n            rs.push(BASE64_CODE[(c1 >> 2) & 0x3f]);\r\n            c1 = (c1 & 0x03) << 4;\r\n            if (off >= len) {\r\n                rs.push(BASE64_CODE[c1 & 0x3f]);\r\n                break;\r\n            }\r\n            c2 = b[off++] & 0xff;\r\n            c1 |= (c2 >> 4) & 0x0f;\r\n            rs.push(BASE64_CODE[c1 & 0x3f]);\r\n            c1 = (c2 & 0x0f) << 2;\r\n            if (off >= len) {\r\n                rs.push(BASE64_CODE[c1 & 0x3f]);\r\n                break;\r\n            }\r\n            c2 = b[off++] & 0xff;\r\n            c1 |= (c2 >> 6) & 0x03;\r\n            rs.push(BASE64_CODE[c1 & 0x3f]);\r\n            rs.push(BASE64_CODE[c2 & 0x3f]);\r\n        }\r\n        return rs.join('');\r\n    }\r\n\r\n    /**\r\n     * Decodes a base64 encoded string to up to len bytes of output.\r\n     * @param {string} s String to decode\r\n     * @param {number} len Maximum output length\r\n     * @returns {!Array.<number>}\r\n     * @inner\r\n     */\r\n    function base64_decode(s, len) {\r\n        var off = 0,\r\n            slen = s.length,\r\n            olen = 0,\r\n            rs = [],\r\n            c1, c2, c3, c4, o, code;\r\n        if (len <= 0)\r\n            throw Error(\"Illegal len: \"+len);\r\n        while (off < slen - 1 && olen < len) {\r\n            code = s.charCodeAt(off++);\r\n            c1 = code < BASE64_INDEX.length ? BASE64_INDEX[code] : -1;\r\n            code = s.charCodeAt(off++);\r\n            c2 = code < BASE64_INDEX.length ? BASE64_INDEX[code] : -1;\r\n            if (c1 == -1 || c2 == -1)\r\n                break;\r\n            o = (c1 << 2) >>> 0;\r\n            o |= (c2 & 0x30) >> 4;\r\n            rs.push(stringFromCharCode(o));\r\n            if (++olen >= len || off >= slen)\r\n                break;\r\n            code = s.charCodeAt(off++);\r\n            c3 = code < BASE64_INDEX.length ? BASE64_INDEX[code] : -1;\r\n            if (c3 == -1)\r\n                break;\r\n            o = ((c2 & 0x0f) << 4) >>> 0;\r\n            o |= (c3 & 0x3c) >> 2;\r\n            rs.push(stringFromCharCode(o));\r\n            if (++olen >= len || off >= slen)\r\n                break;\r\n            code = s.charCodeAt(off++);\r\n            c4 = code < BASE64_INDEX.length ? BASE64_INDEX[code] : -1;\r\n            o = ((c3 & 0x03) << 6) >>> 0;\r\n            o |= c4;\r\n            rs.push(stringFromCharCode(o));\r\n            ++olen;\r\n        }\r\n        var res = [];\r\n        for (off = 0; off<olen; off++)\r\n            res.push(rs[off].charCodeAt(0));\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * utfx-embeddable (c) 2014 Daniel Wirtz <dcode@dcode.io>\r\n     * Released under the Apache License, Version 2.0\r\n     * see: https://github.com/dcodeIO/utfx for details\r\n     */\r\n    var utfx = function() {\r\n        \"use strict\";\r\n\r\n        /**\r\n         * utfx namespace.\r\n         * @inner\r\n         * @type {!Object.<string,*>}\r\n         */\r\n        var utfx = {};\r\n\r\n        /**\r\n         * Maximum valid code point.\r\n         * @type {number}\r\n         * @const\r\n         */\r\n        utfx.MAX_CODEPOINT = 0x10FFFF;\r\n\r\n        /**\r\n         * Encodes UTF8 code points to UTF8 bytes.\r\n         * @param {(!function():number|null) | number} src Code points source, either as a function returning the next code point\r\n         *  respectively `null` if there are no more code points left or a single numeric code point.\r\n         * @param {!function(number)} dst Bytes destination as a function successively called with the next byte\r\n         */\r\n        utfx.encodeUTF8 = function(src, dst) {\r\n            var cp = null;\r\n            if (typeof src === 'number')\r\n                cp = src,\r\n                src = function() { return null; };\r\n            while (cp !== null || (cp = src()) !== null) {\r\n                if (cp < 0x80)\r\n                    dst(cp&0x7F);\r\n                else if (cp < 0x800)\r\n                    dst(((cp>>6)&0x1F)|0xC0),\r\n                    dst((cp&0x3F)|0x80);\r\n                else if (cp < 0x10000)\r\n                    dst(((cp>>12)&0x0F)|0xE0),\r\n                    dst(((cp>>6)&0x3F)|0x80),\r\n                    dst((cp&0x3F)|0x80);\r\n                else\r\n                    dst(((cp>>18)&0x07)|0xF0),\r\n                    dst(((cp>>12)&0x3F)|0x80),\r\n                    dst(((cp>>6)&0x3F)|0x80),\r\n                    dst((cp&0x3F)|0x80);\r\n                cp = null;\r\n            }\r\n        };\r\n\r\n        /**\r\n         * Decodes UTF8 bytes to UTF8 code points.\r\n         * @param {!function():number|null} src Bytes source as a function returning the next byte respectively `null` if there\r\n         *  are no more bytes left.\r\n         * @param {!function(number)} dst Code points destination as a function successively called with each decoded code point.\r\n         * @throws {RangeError} If a starting byte is invalid in UTF8\r\n         * @throws {Error} If the last sequence is truncated. Has an array property `bytes` holding the\r\n         *  remaining bytes.\r\n         */\r\n        utfx.decodeUTF8 = function(src, dst) {\r\n            var a, b, c, d, fail = function(b) {\r\n                b = b.slice(0, b.indexOf(null));\r\n                var err = Error(b.toString());\r\n                err.name = \"TruncatedError\";\r\n                err['bytes'] = b;\r\n                throw err;\r\n            };\r\n            while ((a = src()) !== null) {\r\n                if ((a&0x80) === 0)\r\n                    dst(a);\r\n                else if ((a&0xE0) === 0xC0)\r\n                    ((b = src()) === null) && fail([a, b]),\r\n                    dst(((a&0x1F)<<6) | (b&0x3F));\r\n                else if ((a&0xF0) === 0xE0)\r\n                    ((b=src()) === null || (c=src()) === null) && fail([a, b, c]),\r\n                    dst(((a&0x0F)<<12) | ((b&0x3F)<<6) | (c&0x3F));\r\n                else if ((a&0xF8) === 0xF0)\r\n                    ((b=src()) === null || (c=src()) === null || (d=src()) === null) && fail([a, b, c ,d]),\r\n                    dst(((a&0x07)<<18) | ((b&0x3F)<<12) | ((c&0x3F)<<6) | (d&0x3F));\r\n                else throw RangeError(\"Illegal starting byte: \"+a);\r\n            }\r\n        };\r\n\r\n        /**\r\n         * Converts UTF16 characters to UTF8 code points.\r\n         * @param {!function():number|null} src Characters source as a function returning the next char code respectively\r\n         *  `null` if there are no more characters left.\r\n         * @param {!function(number)} dst Code points destination as a function successively called with each converted code\r\n         *  point.\r\n         */\r\n        utfx.UTF16toUTF8 = function(src, dst) {\r\n            var c1, c2 = null;\r\n            while (true) {\r\n                if ((c1 = c2 !== null ? c2 : src()) === null)\r\n                    break;\r\n                if (c1 >= 0xD800 && c1 <= 0xDFFF) {\r\n                    if ((c2 = src()) !== null) {\r\n                        if (c2 >= 0xDC00 && c2 <= 0xDFFF) {\r\n                            dst((c1-0xD800)*0x400+c2-0xDC00+0x10000);\r\n                            c2 = null; continue;\r\n                        }\r\n                    }\r\n                }\r\n                dst(c1);\r\n            }\r\n            if (c2 !== null) dst(c2);\r\n        };\r\n\r\n        /**\r\n         * Converts UTF8 code points to UTF16 characters.\r\n         * @param {(!function():number|null) | number} src Code points source, either as a function returning the next code point\r\n         *  respectively `null` if there are no more code points left or a single numeric code point.\r\n         * @param {!function(number)} dst Characters destination as a function successively called with each converted char code.\r\n         * @throws {RangeError} If a code point is out of range\r\n         */\r\n        utfx.UTF8toUTF16 = function(src, dst) {\r\n            var cp = null;\r\n            if (typeof src === 'number')\r\n                cp = src, src = function() { return null; };\r\n            while (cp !== null || (cp = src()) !== null) {\r\n                if (cp <= 0xFFFF)\r\n                    dst(cp);\r\n                else\r\n                    cp -= 0x10000,\r\n                    dst((cp>>10)+0xD800),\r\n                    dst((cp%0x400)+0xDC00);\r\n                cp = null;\r\n            }\r\n        };\r\n\r\n        /**\r\n         * Converts and encodes UTF16 characters to UTF8 bytes.\r\n         * @param {!function():number|null} src Characters source as a function returning the next char code respectively `null`\r\n         *  if there are no more characters left.\r\n         * @param {!function(number)} dst Bytes destination as a function successively called with the next byte.\r\n         */\r\n        utfx.encodeUTF16toUTF8 = function(src, dst) {\r\n            utfx.UTF16toUTF8(src, function(cp) {\r\n                utfx.encodeUTF8(cp, dst);\r\n            });\r\n        };\r\n\r\n        /**\r\n         * Decodes and converts UTF8 bytes to UTF16 characters.\r\n         * @param {!function():number|null} src Bytes source as a function returning the next byte respectively `null` if there\r\n         *  are no more bytes left.\r\n         * @param {!function(number)} dst Characters destination as a function successively called with each converted char code.\r\n         * @throws {RangeError} If a starting byte is invalid in UTF8\r\n         * @throws {Error} If the last sequence is truncated. Has an array property `bytes` holding the remaining bytes.\r\n         */\r\n        utfx.decodeUTF8toUTF16 = function(src, dst) {\r\n            utfx.decodeUTF8(src, function(cp) {\r\n                utfx.UTF8toUTF16(cp, dst);\r\n            });\r\n        };\r\n\r\n        /**\r\n         * Calculates the byte length of an UTF8 code point.\r\n         * @param {number} cp UTF8 code point\r\n         * @returns {number} Byte length\r\n         */\r\n        utfx.calculateCodePoint = function(cp) {\r\n            return (cp < 0x80) ? 1 : (cp < 0x800) ? 2 : (cp < 0x10000) ? 3 : 4;\r\n        };\r\n\r\n        /**\r\n         * Calculates the number of UTF8 bytes required to store UTF8 code points.\r\n         * @param {(!function():number|null)} src Code points source as a function returning the next code point respectively\r\n         *  `null` if there are no more code points left.\r\n         * @returns {number} The number of UTF8 bytes required\r\n         */\r\n        utfx.calculateUTF8 = function(src) {\r\n            var cp, l=0;\r\n            while ((cp = src()) !== null)\r\n                l += utfx.calculateCodePoint(cp);\r\n            return l;\r\n        };\r\n\r\n        /**\r\n         * Calculates the number of UTF8 code points respectively UTF8 bytes required to store UTF16 char codes.\r\n         * @param {(!function():number|null)} src Characters source as a function returning the next char code respectively\r\n         *  `null` if there are no more characters left.\r\n         * @returns {!Array.<number>} The number of UTF8 code points at index 0 and the number of UTF8 bytes required at index 1.\r\n         */\r\n        utfx.calculateUTF16asUTF8 = function(src) {\r\n            var n=0, l=0;\r\n            utfx.UTF16toUTF8(src, function(cp) {\r\n                ++n; l += utfx.calculateCodePoint(cp);\r\n            });\r\n            return [n,l];\r\n        };\r\n\r\n        return utfx;\r\n    }();\r\n\r\n    Date.now = Date.now || function() { return +new Date; };\r\n\r\n    /**\r\n     * @type {number}\r\n     * @const\r\n     * @inner\r\n     */\r\n    var BCRYPT_SALT_LEN = 16;\r\n\r\n    /**\r\n     * @type {number}\r\n     * @const\r\n     * @inner\r\n     */\r\n    var GENSALT_DEFAULT_LOG2_ROUNDS = 10;\r\n\r\n    /**\r\n     * @type {number}\r\n     * @const\r\n     * @inner\r\n     */\r\n    var BLOWFISH_NUM_ROUNDS = 16;\r\n\r\n    /**\r\n     * @type {number}\r\n     * @const\r\n     * @inner\r\n     */\r\n    var MAX_EXECUTION_TIME = 100;\r\n\r\n    /**\r\n     * @type {Array.<number>}\r\n     * @const\r\n     * @inner\r\n     */\r\n    var P_ORIG = [\r\n        0x243f6a88, 0x85a308d3, 0x13198a2e, 0x03707344, 0xa4093822,\r\n        0x299f31d0, 0x082efa98, 0xec4e6c89, 0x452821e6, 0x38d01377,\r\n        0xbe5466cf, 0x34e90c6c, 0xc0ac29b7, 0xc97c50dd, 0x3f84d5b5,\r\n        0xb5470917, 0x9216d5d9, 0x8979fb1b\r\n    ];\r\n\r\n    /**\r\n     * @type {Array.<number>}\r\n     * @const\r\n     * @inner\r\n     */\r\n    var S_ORIG = [\r\n        0xd1310ba6, 0x98dfb5ac, 0x2ffd72db, 0xd01adfb7, 0xb8e1afed,\r\n        0x6a267e96, 0xba7c9045, 0xf12c7f99, 0x24a19947, 0xb3916cf7,\r\n        0x0801f2e2, 0x858efc16, 0x636920d8, 0x71574e69, 0xa458fea3,\r\n        0xf4933d7e, 0x0d95748f, 0x728eb658, 0x718bcd58, 0x82154aee,\r\n        0x7b54a41d, 0xc25a59b5, 0x9c30d539, 0x2af26013, 0xc5d1b023,\r\n        0x286085f0, 0xca417918, 0xb8db38ef, 0x8e79dcb0, 0x603a180e,\r\n        0x6c9e0e8b, 0xb01e8a3e, 0xd71577c1, 0xbd314b27, 0x78af2fda,\r\n        0x55605c60, 0xe65525f3, 0xaa55ab94, 0x57489862, 0x63e81440,\r\n        0x55ca396a, 0x2aab10b6, 0xb4cc5c34, 0x1141e8ce, 0xa15486af,\r\n        0x7c72e993, 0xb3ee1411, 0x636fbc2a, 0x2ba9c55d, 0x741831f6,\r\n        0xce5c3e16, 0x9b87931e, 0xafd6ba33, 0x6c24cf5c, 0x7a325381,\r\n        0x28958677, 0x3b8f4898, 0x6b4bb9af, 0xc4bfe81b, 0x66282193,\r\n        0x61d809cc, 0xfb21a991, 0x487cac60, 0x5dec8032, 0xef845d5d,\r\n        0xe98575b1, 0xdc262302, 0xeb651b88, 0x23893e81, 0xd396acc5,\r\n        0x0f6d6ff3, 0x83f44239, 0x2e0b4482, 0xa4842004, 0x69c8f04a,\r\n        0x9e1f9b5e, 0x21c66842, 0xf6e96c9a, 0x670c9c61, 0xabd388f0,\r\n        0x6a51a0d2, 0xd8542f68, 0x960fa728, 0xab5133a3, 0x6eef0b6c,\r\n        0x137a3be4, 0xba3bf050, 0x7efb2a98, 0xa1f1651d, 0x39af0176,\r\n        0x66ca593e, 0x82430e88, 0x8cee8619, 0x456f9fb4, 0x7d84a5c3,\r\n        0x3b8b5ebe, 0xe06f75d8, 0x85c12073, 0x401a449f, 0x56c16aa6,\r\n        0x4ed3aa62, 0x363f7706, 0x1bfedf72, 0x429b023d, 0x37d0d724,\r\n        0xd00a1248, 0xdb0fead3, 0x49f1c09b, 0x075372c9, 0x80991b7b,\r\n        0x25d479d8, 0xf6e8def7, 0xe3fe501a, 0xb6794c3b, 0x976ce0bd,\r\n        0x04c006ba, 0xc1a94fb6, 0x409f60c4, 0x5e5c9ec2, 0x196a2463,\r\n        0x68fb6faf, 0x3e6c53b5, 0x1339b2eb, 0x3b52ec6f, 0x6dfc511f,\r\n        0x9b30952c, 0xcc814544, 0xaf5ebd09, 0xbee3d004, 0xde334afd,\r\n        0x660f2807, 0x192e4bb3, 0xc0cba857, 0x45c8740f, 0xd20b5f39,\r\n        0xb9d3fbdb, 0x5579c0bd, 0x1a60320a, 0xd6a100c6, 0x402c7279,\r\n        0x679f25fe, 0xfb1fa3cc, 0x8ea5e9f8, 0xdb3222f8, 0x3c7516df,\r\n        0xfd616b15, 0x2f501ec8, 0xad0552ab, 0x323db5fa, 0xfd238760,\r\n        0x53317b48, 0x3e00df82, 0x9e5c57bb, 0xca6f8ca0, 0x1a87562e,\r\n        0xdf1769db, 0xd542a8f6, 0x287effc3, 0xac6732c6, 0x8c4f5573,\r\n        0x695b27b0, 0xbbca58c8, 0xe1ffa35d, 0xb8f011a0, 0x10fa3d98,\r\n        0xfd2183b8, 0x4afcb56c, 0x2dd1d35b, 0x9a53e479, 0xb6f84565,\r\n        0xd28e49bc, 0x4bfb9790, 0xe1ddf2da, 0xa4cb7e33, 0x62fb1341,\r\n        0xcee4c6e8, 0xef20cada, 0x36774c01, 0xd07e9efe, 0x2bf11fb4,\r\n        0x95dbda4d, 0xae909198, 0xeaad8e71, 0x6b93d5a0, 0xd08ed1d0,\r\n        0xafc725e0, 0x8e3c5b2f, 0x8e7594b7, 0x8ff6e2fb, 0xf2122b64,\r\n        0x8888b812, 0x900df01c, 0x4fad5ea0, 0x688fc31c, 0xd1cff191,\r\n        0xb3a8c1ad, 0x2f2f2218, 0xbe0e1777, 0xea752dfe, 0x8b021fa1,\r\n        0xe5a0cc0f, 0xb56f74e8, 0x18acf3d6, 0xce89e299, 0xb4a84fe0,\r\n        0xfd13e0b7, 0x7cc43b81, 0xd2ada8d9, 0x165fa266, 0x80957705,\r\n        0x93cc7314, 0x211a1477, 0xe6ad2065, 0x77b5fa86, 0xc75442f5,\r\n        0xfb9d35cf, 0xebcdaf0c, 0x7b3e89a0, 0xd6411bd3, 0xae1e7e49,\r\n        0x00250e2d, 0x2071b35e, 0x226800bb, 0x57b8e0af, 0x2464369b,\r\n        0xf009b91e, 0x5563911d, 0x59dfa6aa, 0x78c14389, 0xd95a537f,\r\n        0x207d5ba2, 0x02e5b9c5, 0x83260376, 0x6295cfa9, 0x11c81968,\r\n        0x4e734a41, 0xb3472dca, 0x7b14a94a, 0x1b510052, 0x9a532915,\r\n        0xd60f573f, 0xbc9bc6e4, 0x2b60a476, 0x81e67400, 0x08ba6fb5,\r\n        0x571be91f, 0xf296ec6b, 0x2a0dd915, 0xb6636521, 0xe7b9f9b6,\r\n        0xff34052e, 0xc5855664, 0x53b02d5d, 0xa99f8fa1, 0x08ba4799,\r\n        0x6e85076a, 0x4b7a70e9, 0xb5b32944, 0xdb75092e, 0xc4192623,\r\n        0xad6ea6b0, 0x49a7df7d, 0x9cee60b8, 0x8fedb266, 0xecaa8c71,\r\n        0x699a17ff, 0x5664526c, 0xc2b19ee1, 0x193602a5, 0x75094c29,\r\n        0xa0591340, 0xe4183a3e, 0x3f54989a, 0x5b429d65, 0x6b8fe4d6,\r\n        0x99f73fd6, 0xa1d29c07, 0xefe830f5, 0x4d2d38e6, 0xf0255dc1,\r\n        0x4cdd2086, 0x8470eb26, 0x6382e9c6, 0x021ecc5e, 0x09686b3f,\r\n        0x3ebaefc9, 0x3c971814, 0x6b6a70a1, 0x687f3584, 0x52a0e286,\r\n        0xb79c5305, 0xaa500737, 0x3e07841c, 0x7fdeae5c, 0x8e7d44ec,\r\n        0x5716f2b8, 0xb03ada37, 0xf0500c0d, 0xf01c1f04, 0x0200b3ff,\r\n        0xae0cf51a, 0x3cb574b2, 0x25837a58, 0xdc0921bd, 0xd19113f9,\r\n        0x7ca92ff6, 0x94324773, 0x22f54701, 0x3ae5e581, 0x37c2dadc,\r\n        0xc8b57634, 0x9af3dda7, 0xa9446146, 0x0fd0030e, 0xecc8c73e,\r\n        0xa4751e41, 0xe238cd99, 0x3bea0e2f, 0x3280bba1, 0x183eb331,\r\n        0x4e548b38, 0x4f6db908, 0x6f420d03, 0xf60a04bf, 0x2cb81290,\r\n        0x24977c79, 0x5679b072, 0xbcaf89af, 0xde9a771f, 0xd9930810,\r\n        0xb38bae12, 0xdccf3f2e, 0x5512721f, 0x2e6b7124, 0x501adde6,\r\n        0x9f84cd87, 0x7a584718, 0x7408da17, 0xbc9f9abc, 0xe94b7d8c,\r\n        0xec7aec3a, 0xdb851dfa, 0x63094366, 0xc464c3d2, 0xef1c1847,\r\n        0x3215d908, 0xdd433b37, 0x24c2ba16, 0x12a14d43, 0x2a65c451,\r\n        0x50940002, 0x133ae4dd, 0x71dff89e, 0x10314e55, 0x81ac77d6,\r\n        0x5f11199b, 0x043556f1, 0xd7a3c76b, 0x3c11183b, 0x5924a509,\r\n        0xf28fe6ed, 0x97f1fbfa, 0x9ebabf2c, 0x1e153c6e, 0x86e34570,\r\n        0xeae96fb1, 0x860e5e0a, 0x5a3e2ab3, 0x771fe71c, 0x4e3d06fa,\r\n        0x2965dcb9, 0x99e71d0f, 0x803e89d6, 0x5266c825, 0x2e4cc978,\r\n        0x9c10b36a, 0xc6150eba, 0x94e2ea78, 0xa5fc3c53, 0x1e0a2df4,\r\n        0xf2f74ea7, 0x361d2b3d, 0x1939260f, 0x19c27960, 0x5223a708,\r\n        0xf71312b6, 0xebadfe6e, 0xeac31f66, 0xe3bc4595, 0xa67bc883,\r\n        0xb17f37d1, 0x018cff28, 0xc332ddef, 0xbe6c5aa5, 0x65582185,\r\n        0x68ab9802, 0xeecea50f, 0xdb2f953b, 0x2aef7dad, 0x5b6e2f84,\r\n        0x1521b628, 0x29076170, 0xecdd4775, 0x619f1510, 0x13cca830,\r\n        0xeb61bd96, 0x0334fe1e, 0xaa0363cf, 0xb5735c90, 0x4c70a239,\r\n        0xd59e9e0b, 0xcbaade14, 0xeecc86bc, 0x60622ca7, 0x9cab5cab,\r\n        0xb2f3846e, 0x648b1eaf, 0x19bdf0ca, 0xa02369b9, 0x655abb50,\r\n        0x40685a32, 0x3c2ab4b3, 0x319ee9d5, 0xc021b8f7, 0x9b540b19,\r\n        0x875fa099, 0x95f7997e, 0x623d7da8, 0xf837889a, 0x97e32d77,\r\n        0x11ed935f, 0x16681281, 0x0e358829, 0xc7e61fd6, 0x96dedfa1,\r\n        0x7858ba99, 0x57f584a5, 0x1b227263, 0x9b83c3ff, 0x1ac24696,\r\n        0xcdb30aeb, 0x532e3054, 0x8fd948e4, 0x6dbc3128, 0x58ebf2ef,\r\n        0x34c6ffea, 0xfe28ed61, 0xee7c3c73, 0x5d4a14d9, 0xe864b7e3,\r\n        0x42105d14, 0x203e13e0, 0x45eee2b6, 0xa3aaabea, 0xdb6c4f15,\r\n        0xfacb4fd0, 0xc742f442, 0xef6abbb5, 0x654f3b1d, 0x41cd2105,\r\n        0xd81e799e, 0x86854dc7, 0xe44b476a, 0x3d816250, 0xcf62a1f2,\r\n        0x5b8d2646, 0xfc8883a0, 0xc1c7b6a3, 0x7f1524c3, 0x69cb7492,\r\n        0x47848a0b, 0x5692b285, 0x095bbf00, 0xad19489d, 0x1462b174,\r\n        0x23820e00, 0x58428d2a, 0x0c55f5ea, 0x1dadf43e, 0x233f7061,\r\n        0x3372f092, 0x8d937e41, 0xd65fecf1, 0x6c223bdb, 0x7cde3759,\r\n        0xcbee7460, 0x4085f2a7, 0xce77326e, 0xa6078084, 0x19f8509e,\r\n        0xe8efd855, 0x61d99735, 0xa969a7aa, 0xc50c06c2, 0x5a04abfc,\r\n        0x800bcadc, 0x9e447a2e, 0xc3453484, 0xfdd56705, 0x0e1e9ec9,\r\n        0xdb73dbd3, 0x105588cd, 0x675fda79, 0xe3674340, 0xc5c43465,\r\n        0x713e38d8, 0x3d28f89e, 0xf16dff20, 0x153e21e7, 0x8fb03d4a,\r\n        0xe6e39f2b, 0xdb83adf7, 0xe93d5a68, 0x948140f7, 0xf64c261c,\r\n        0x94692934, 0x411520f7, 0x7602d4f7, 0xbcf46b2e, 0xd4a20068,\r\n        0xd4082471, 0x3320f46a, 0x43b7d4b7, 0x500061af, 0x1e39f62e,\r\n        0x97244546, 0x14214f74, 0xbf8b8840, 0x4d95fc1d, 0x96b591af,\r\n        0x70f4ddd3, 0x66a02f45, 0xbfbc09ec, 0x03bd9785, 0x7fac6dd0,\r\n        0x31cb8504, 0x96eb27b3, 0x55fd3941, 0xda2547e6, 0xabca0a9a,\r\n        0x28507825, 0x530429f4, 0x0a2c86da, 0xe9b66dfb, 0x68dc1462,\r\n        0xd7486900, 0x680ec0a4, 0x27a18dee, 0x4f3ffea2, 0xe887ad8c,\r\n        0xb58ce006, 0x7af4d6b6, 0xaace1e7c, 0xd3375fec, 0xce78a399,\r\n        0x406b2a42, 0x20fe9e35, 0xd9f385b9, 0xee39d7ab, 0x3b124e8b,\r\n        0x1dc9faf7, 0x4b6d1856, 0x26a36631, 0xeae397b2, 0x3a6efa74,\r\n        0xdd5b4332, 0x6841e7f7, 0xca7820fb, 0xfb0af54e, 0xd8feb397,\r\n        0x454056ac, 0xba489527, 0x55533a3a, 0x20838d87, 0xfe6ba9b7,\r\n        0xd096954b, 0x55a867bc, 0xa1159a58, 0xcca92963, 0x99e1db33,\r\n        0xa62a4a56, 0x3f3125f9, 0x5ef47e1c, 0x9029317c, 0xfdf8e802,\r\n        0x04272f70, 0x80bb155c, 0x05282ce3, 0x95c11548, 0xe4c66d22,\r\n        0x48c1133f, 0xc70f86dc, 0x07f9c9ee, 0x41041f0f, 0x404779a4,\r\n        0x5d886e17, 0x325f51eb, 0xd59bc0d1, 0xf2bcc18f, 0x41113564,\r\n        0x257b7834, 0x602a9c60, 0xdff8e8a3, 0x1f636c1b, 0x0e12b4c2,\r\n        0x02e1329e, 0xaf664fd1, 0xcad18115, 0x6b2395e0, 0x333e92e1,\r\n        0x3b240b62, 0xeebeb922, 0x85b2a20e, 0xe6ba0d99, 0xde720c8c,\r\n        0x2da2f728, 0xd0127845, 0x95b794fd, 0x647d0862, 0xe7ccf5f0,\r\n        0x5449a36f, 0x877d48fa, 0xc39dfd27, 0xf33e8d1e, 0x0a476341,\r\n        0x992eff74, 0x3a6f6eab, 0xf4f8fd37, 0xa812dc60, 0xa1ebddf8,\r\n        0x991be14c, 0xdb6e6b0d, 0xc67b5510, 0x6d672c37, 0x2765d43b,\r\n        0xdcd0e804, 0xf1290dc7, 0xcc00ffa3, 0xb5390f92, 0x690fed0b,\r\n        0x667b9ffb, 0xcedb7d9c, 0xa091cf0b, 0xd9155ea3, 0xbb132f88,\r\n        0x515bad24, 0x7b9479bf, 0x763bd6eb, 0x37392eb3, 0xcc115979,\r\n        0x8026e297, 0xf42e312d, 0x6842ada7, 0xc66a2b3b, 0x12754ccc,\r\n        0x782ef11c, 0x6a124237, 0xb79251e7, 0x06a1bbe6, 0x4bfb6350,\r\n        0x1a6b1018, 0x11caedfa, 0x3d25bdd8, 0xe2e1c3c9, 0x44421659,\r\n        0x0a121386, 0xd90cec6e, 0xd5abea2a, 0x64af674e, 0xda86a85f,\r\n        0xbebfe988, 0x64e4c3fe, 0x9dbc8057, 0xf0f7c086, 0x60787bf8,\r\n        0x6003604d, 0xd1fd8346, 0xf6381fb0, 0x7745ae04, 0xd736fccc,\r\n        0x83426b33, 0xf01eab71, 0xb0804187, 0x3c005e5f, 0x77a057be,\r\n        0xbde8ae24, 0x55464299, 0xbf582e61, 0x4e58f48f, 0xf2ddfda2,\r\n        0xf474ef38, 0x8789bdc2, 0x5366f9c3, 0xc8b38e74, 0xb475f255,\r\n        0x46fcd9b9, 0x7aeb2661, 0x8b1ddf84, 0x846a0e79, 0x915f95e2,\r\n        0x466e598e, 0x20b45770, 0x8cd55591, 0xc902de4c, 0xb90bace1,\r\n        0xbb8205d0, 0x11a86248, 0x7574a99e, 0xb77f19b6, 0xe0a9dc09,\r\n        0x662d09a1, 0xc4324633, 0xe85a1f02, 0x09f0be8c, 0x4a99a025,\r\n        0x1d6efe10, 0x1ab93d1d, 0x0ba5a4df, 0xa186f20f, 0x2868f169,\r\n        0xdcb7da83, 0x573906fe, 0xa1e2ce9b, 0x4fcd7f52, 0x50115e01,\r\n        0xa70683fa, 0xa002b5c4, 0x0de6d027, 0x9af88c27, 0x773f8641,\r\n        0xc3604c06, 0x61a806b5, 0xf0177a28, 0xc0f586e0, 0x006058aa,\r\n        0x30dc7d62, 0x11e69ed7, 0x2338ea63, 0x53c2dd94, 0xc2c21634,\r\n        0xbbcbee56, 0x90bcb6de, 0xebfc7da1, 0xce591d76, 0x6f05e409,\r\n        0x4b7c0188, 0x39720a3d, 0x7c927c24, 0x86e3725f, 0x724d9db9,\r\n        0x1ac15bb4, 0xd39eb8fc, 0xed545578, 0x08fca5b5, 0xd83d7cd3,\r\n        0x4dad0fc4, 0x1e50ef5e, 0xb161e6f8, 0xa28514d9, 0x6c51133c,\r\n        0x6fd5c7e7, 0x56e14ec4, 0x362abfce, 0xddc6c837, 0xd79a3234,\r\n        0x92638212, 0x670efa8e, 0x406000e0, 0x3a39ce37, 0xd3faf5cf,\r\n        0xabc27737, 0x5ac52d1b, 0x5cb0679e, 0x4fa33742, 0xd3822740,\r\n        0x99bc9bbe, 0xd5118e9d, 0xbf0f7315, 0xd62d1c7e, 0xc700c47b,\r\n        0xb78c1b6b, 0x21a19045, 0xb26eb1be, 0x6a366eb4, 0x5748ab2f,\r\n        0xbc946e79, 0xc6a376d2, 0x6549c2c8, 0x530ff8ee, 0x468dde7d,\r\n        0xd5730a1d, 0x4cd04dc6, 0x2939bbdb, 0xa9ba4650, 0xac9526e8,\r\n        0xbe5ee304, 0xa1fad5f0, 0x6a2d519a, 0x63ef8ce2, 0x9a86ee22,\r\n        0xc089c2b8, 0x43242ef6, 0xa51e03aa, 0x9cf2d0a4, 0x83c061ba,\r\n        0x9be96a4d, 0x8fe51550, 0xba645bd6, 0x2826a2f9, 0xa73a3ae1,\r\n        0x4ba99586, 0xef5562e9, 0xc72fefd3, 0xf752f7da, 0x3f046f69,\r\n        0x77fa0a59, 0x80e4a915, 0x87b08601, 0x9b09e6ad, 0x3b3ee593,\r\n        0xe990fd5a, 0x9e34d797, 0x2cf0b7d9, 0x022b8b51, 0x96d5ac3a,\r\n        0x017da67d, 0xd1cf3ed6, 0x7c7d2d28, 0x1f9f25cf, 0xadf2b89b,\r\n        0x5ad6b472, 0x5a88f54c, 0xe029ac71, 0xe019a5e6, 0x47b0acfd,\r\n        0xed93fa9b, 0xe8d3c48d, 0x283b57cc, 0xf8d56629, 0x79132e28,\r\n        0x785f0191, 0xed756055, 0xf7960e44, 0xe3d35e8c, 0x15056dd4,\r\n        0x88f46dba, 0x03a16125, 0x0564f0bd, 0xc3eb9e15, 0x3c9057a2,\r\n        0x97271aec, 0xa93a072a, 0x1b3f6d9b, 0x1e6321f5, 0xf59c66fb,\r\n        0x26dcf319, 0x7533d928, 0xb155fdf5, 0x03563482, 0x8aba3cbb,\r\n        0x28517711, 0xc20ad9f8, 0xabcc5167, 0xccad925f, 0x4de81751,\r\n        0x3830dc8e, 0x379d5862, 0x9320f991, 0xea7a90c2, 0xfb3e7bce,\r\n        0x5121ce64, 0x774fbe32, 0xa8b6e37e, 0xc3293d46, 0x48de5369,\r\n        0x6413e680, 0xa2ae0810, 0xdd6db224, 0x69852dfd, 0x09072166,\r\n        0xb39a460a, 0x6445c0dd, 0x586cdecf, 0x1c20c8ae, 0x5bbef7dd,\r\n        0x1b588d40, 0xccd2017f, 0x6bb4e3bb, 0xdda26a7e, 0x3a59ff45,\r\n        0x3e350a44, 0xbcb4cdd5, 0x72eacea8, 0xfa6484bb, 0x8d6612ae,\r\n        0xbf3c6f47, 0xd29be463, 0x542f5d9e, 0xaec2771b, 0xf64e6370,\r\n        0x740e0d8d, 0xe75b1357, 0xf8721671, 0xaf537d5d, 0x4040cb08,\r\n        0x4eb4e2cc, 0x34d2466a, 0x0115af84, 0xe1b00428, 0x95983a1d,\r\n        0x06b89fb4, 0xce6ea048, 0x6f3f3b82, 0x3520ab82, 0x011a1d4b,\r\n        0x277227f8, 0x611560b1, 0xe7933fdc, 0xbb3a792b, 0x344525bd,\r\n        0xa08839e1, 0x51ce794b, 0x2f32c9b7, 0xa01fbac9, 0xe01cc87e,\r\n        0xbcc7d1f6, 0xcf0111c3, 0xa1e8aac7, 0x1a908749, 0xd44fbd9a,\r\n        0xd0dadecb, 0xd50ada38, 0x0339c32a, 0xc6913667, 0x8df9317c,\r\n        0xe0b12b4f, 0xf79e59b7, 0x43f5bb3a, 0xf2d519ff, 0x27d9459c,\r\n        0xbf97222c, 0x15e6fc2a, 0x0f91fc71, 0x9b941525, 0xfae59361,\r\n        0xceb69ceb, 0xc2a86459, 0x12baa8d1, 0xb6c1075e, 0xe3056a0c,\r\n        0x10d25065, 0xcb03a442, 0xe0ec6e0e, 0x1698db3b, 0x4c98a0be,\r\n        0x3278e964, 0x9f1f9532, 0xe0d392df, 0xd3a0342b, 0x8971f21e,\r\n        0x1b0a7441, 0x4ba3348c, 0xc5be7120, 0xc37632d8, 0xdf359f8d,\r\n        0x9b992f2e, 0xe60b6f47, 0x0fe3f11d, 0xe54cda54, 0x1edad891,\r\n        0xce6279cf, 0xcd3e7e6f, 0x1618b166, 0xfd2c1d05, 0x848fd2c5,\r\n        0xf6fb2299, 0xf523f357, 0xa6327623, 0x93a83531, 0x56cccd02,\r\n        0xacf08162, 0x5a75ebb5, 0x6e163697, 0x88d273cc, 0xde966292,\r\n        0x81b949d0, 0x4c50901b, 0x71c65614, 0xe6c6c7bd, 0x327a140a,\r\n        0x45e1d006, 0xc3f27b9a, 0xc9aa53fd, 0x62a80f00, 0xbb25bfe2,\r\n        0x35bdd2f6, 0x71126905, 0xb2040222, 0xb6cbcf7c, 0xcd769c2b,\r\n        0x53113ec0, 0x1640e3d3, 0x38abbd60, 0x2547adf0, 0xba38209c,\r\n        0xf746ce76, 0x77afa1c5, 0x20756060, 0x85cbfe4e, 0x8ae88dd8,\r\n        0x7aaaf9b0, 0x4cf9aa7e, 0x1948c25c, 0x02fb8a8c, 0x01c36ae4,\r\n        0xd6ebe1f9, 0x90d4f869, 0xa65cdea0, 0x3f09252d, 0xc208e69f,\r\n        0xb74e6132, 0xce77e25b, 0x578fdfe3, 0x3ac372e6\r\n    ];\r\n\r\n    /**\r\n     * @type {Array.<number>}\r\n     * @const\r\n     * @inner\r\n     */\r\n    var C_ORIG = [\r\n        0x4f727068, 0x65616e42, 0x65686f6c, 0x64657253, 0x63727944,\r\n        0x6f756274\r\n    ];\r\n\r\n    /**\r\n     * @param {Array.<number>} lr\r\n     * @param {number} off\r\n     * @param {Array.<number>} P\r\n     * @param {Array.<number>} S\r\n     * @returns {Array.<number>}\r\n     * @inner\r\n     */\r\n    function _encipher(lr, off, P, S) { // This is our bottleneck: 1714/1905 ticks / 90% - see profile.txt\r\n        var n,\r\n            l = lr[off],\r\n            r = lr[off + 1];\r\n\r\n        l ^= P[0];\r\n\r\n        /*\r\n        for (var i=0, k=BLOWFISH_NUM_ROUNDS-2; i<=k;)\r\n            // Feistel substitution on left word\r\n            n  = S[l >>> 24],\r\n            n += S[0x100 | ((l >> 16) & 0xff)],\r\n            n ^= S[0x200 | ((l >> 8) & 0xff)],\r\n            n += S[0x300 | (l & 0xff)],\r\n            r ^= n ^ P[++i],\r\n            // Feistel substitution on right word\r\n            n  = S[r >>> 24],\r\n            n += S[0x100 | ((r >> 16) & 0xff)],\r\n            n ^= S[0x200 | ((r >> 8) & 0xff)],\r\n            n += S[0x300 | (r & 0xff)],\r\n            l ^= n ^ P[++i];\r\n        */\r\n\r\n        //The following is an unrolled version of the above loop.\r\n        //Iteration 0\r\n        n  = S[l >>> 24];\r\n        n += S[0x100 | ((l >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((l >> 8) & 0xff)];\r\n        n += S[0x300 | (l & 0xff)];\r\n        r ^= n ^ P[1];\r\n        n  = S[r >>> 24];\r\n        n += S[0x100 | ((r >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((r >> 8) & 0xff)];\r\n        n += S[0x300 | (r & 0xff)];\r\n        l ^= n ^ P[2];\r\n        //Iteration 1\r\n        n  = S[l >>> 24];\r\n        n += S[0x100 | ((l >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((l >> 8) & 0xff)];\r\n        n += S[0x300 | (l & 0xff)];\r\n        r ^= n ^ P[3];\r\n        n  = S[r >>> 24];\r\n        n += S[0x100 | ((r >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((r >> 8) & 0xff)];\r\n        n += S[0x300 | (r & 0xff)];\r\n        l ^= n ^ P[4];\r\n        //Iteration 2\r\n        n  = S[l >>> 24];\r\n        n += S[0x100 | ((l >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((l >> 8) & 0xff)];\r\n        n += S[0x300 | (l & 0xff)];\r\n        r ^= n ^ P[5];\r\n        n  = S[r >>> 24];\r\n        n += S[0x100 | ((r >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((r >> 8) & 0xff)];\r\n        n += S[0x300 | (r & 0xff)];\r\n        l ^= n ^ P[6];\r\n        //Iteration 3\r\n        n  = S[l >>> 24];\r\n        n += S[0x100 | ((l >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((l >> 8) & 0xff)];\r\n        n += S[0x300 | (l & 0xff)];\r\n        r ^= n ^ P[7];\r\n        n  = S[r >>> 24];\r\n        n += S[0x100 | ((r >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((r >> 8) & 0xff)];\r\n        n += S[0x300 | (r & 0xff)];\r\n        l ^= n ^ P[8];\r\n        //Iteration 4\r\n        n  = S[l >>> 24];\r\n        n += S[0x100 | ((l >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((l >> 8) & 0xff)];\r\n        n += S[0x300 | (l & 0xff)];\r\n        r ^= n ^ P[9];\r\n        n  = S[r >>> 24];\r\n        n += S[0x100 | ((r >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((r >> 8) & 0xff)];\r\n        n += S[0x300 | (r & 0xff)];\r\n        l ^= n ^ P[10];\r\n        //Iteration 5\r\n        n  = S[l >>> 24];\r\n        n += S[0x100 | ((l >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((l >> 8) & 0xff)];\r\n        n += S[0x300 | (l & 0xff)];\r\n        r ^= n ^ P[11];\r\n        n  = S[r >>> 24];\r\n        n += S[0x100 | ((r >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((r >> 8) & 0xff)];\r\n        n += S[0x300 | (r & 0xff)];\r\n        l ^= n ^ P[12];\r\n        //Iteration 6\r\n        n  = S[l >>> 24];\r\n        n += S[0x100 | ((l >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((l >> 8) & 0xff)];\r\n        n += S[0x300 | (l & 0xff)];\r\n        r ^= n ^ P[13];\r\n        n  = S[r >>> 24];\r\n        n += S[0x100 | ((r >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((r >> 8) & 0xff)];\r\n        n += S[0x300 | (r & 0xff)];\r\n        l ^= n ^ P[14];\r\n        //Iteration 7\r\n        n  = S[l >>> 24];\r\n        n += S[0x100 | ((l >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((l >> 8) & 0xff)];\r\n        n += S[0x300 | (l & 0xff)];\r\n        r ^= n ^ P[15];\r\n        n  = S[r >>> 24];\r\n        n += S[0x100 | ((r >> 16) & 0xff)];\r\n        n ^= S[0x200 | ((r >> 8) & 0xff)];\r\n        n += S[0x300 | (r & 0xff)];\r\n        l ^= n ^ P[16];\r\n\r\n        lr[off] = r ^ P[BLOWFISH_NUM_ROUNDS + 1];\r\n        lr[off + 1] = l;\r\n        return lr;\r\n    }\r\n\r\n    /**\r\n     * @param {Array.<number>} data\r\n     * @param {number} offp\r\n     * @returns {{key: number, offp: number}}\r\n     * @inner\r\n     */\r\n    function _streamtoword(data, offp) {\r\n        for (var i = 0, word = 0; i < 4; ++i)\r\n            word = (word << 8) | (data[offp] & 0xff),\r\n            offp = (offp + 1) % data.length;\r\n        return { key: word, offp: offp };\r\n    }\r\n\r\n    /**\r\n     * @param {Array.<number>} key\r\n     * @param {Array.<number>} P\r\n     * @param {Array.<number>} S\r\n     * @inner\r\n     */\r\n    function _key(key, P, S) {\r\n        var offset = 0,\r\n            lr = [0, 0],\r\n            plen = P.length,\r\n            slen = S.length,\r\n            sw;\r\n        for (var i = 0; i < plen; i++)\r\n            sw = _streamtoword(key, offset),\r\n            offset = sw.offp,\r\n            P[i] = P[i] ^ sw.key;\r\n        for (i = 0; i < plen; i += 2)\r\n            lr = _encipher(lr, 0, P, S),\r\n            P[i] = lr[0],\r\n            P[i + 1] = lr[1];\r\n        for (i = 0; i < slen; i += 2)\r\n            lr = _encipher(lr, 0, P, S),\r\n            S[i] = lr[0],\r\n            S[i + 1] = lr[1];\r\n    }\r\n\r\n    /**\r\n     * Expensive key schedule Blowfish.\r\n     * @param {Array.<number>} data\r\n     * @param {Array.<number>} key\r\n     * @param {Array.<number>} P\r\n     * @param {Array.<number>} S\r\n     * @inner\r\n     */\r\n    function _ekskey(data, key, P, S) {\r\n        var offp = 0,\r\n            lr = [0, 0],\r\n            plen = P.length,\r\n            slen = S.length,\r\n            sw;\r\n        for (var i = 0; i < plen; i++)\r\n            sw = _streamtoword(key, offp),\r\n            offp = sw.offp,\r\n            P[i] = P[i] ^ sw.key;\r\n        offp = 0;\r\n        for (i = 0; i < plen; i += 2)\r\n            sw = _streamtoword(data, offp),\r\n            offp = sw.offp,\r\n            lr[0] ^= sw.key,\r\n            sw = _streamtoword(data, offp),\r\n            offp = sw.offp,\r\n            lr[1] ^= sw.key,\r\n            lr = _encipher(lr, 0, P, S),\r\n            P[i] = lr[0],\r\n            P[i + 1] = lr[1];\r\n        for (i = 0; i < slen; i += 2)\r\n            sw = _streamtoword(data, offp),\r\n            offp = sw.offp,\r\n            lr[0] ^= sw.key,\r\n            sw = _streamtoword(data, offp),\r\n            offp = sw.offp,\r\n            lr[1] ^= sw.key,\r\n            lr = _encipher(lr, 0, P, S),\r\n            S[i] = lr[0],\r\n            S[i + 1] = lr[1];\r\n    }\r\n\r\n    /**\r\n     * Internaly crypts a string.\r\n     * @param {Array.<number>} b Bytes to crypt\r\n     * @param {Array.<number>} salt Salt bytes to use\r\n     * @param {number} rounds Number of rounds\r\n     * @param {function(Error, Array.<number>=)=} callback Callback receiving the error, if any, and the resulting bytes. If\r\n     *  omitted, the operation will be performed synchronously.\r\n     *  @param {function(number)=} progressCallback Callback called with the current progress\r\n     * @returns {!Array.<number>|undefined} Resulting bytes if callback has been omitted, otherwise `undefined`\r\n     * @inner\r\n     */\r\n    function _crypt(b, salt, rounds, callback, progressCallback) {\r\n        var cdata = C_ORIG.slice(),\r\n            clen = cdata.length,\r\n            err;\r\n\r\n        // Validate\r\n        if (rounds < 4 || rounds > 31) {\r\n            err = Error(\"Illegal number of rounds (4-31): \"+rounds);\r\n            if (callback) {\r\n                nextTick(callback.bind(this, err));\r\n                return;\r\n            } else\r\n                throw err;\r\n        }\r\n        if (salt.length !== BCRYPT_SALT_LEN) {\r\n            err =Error(\"Illegal salt length: \"+salt.length+\" != \"+BCRYPT_SALT_LEN);\r\n            if (callback) {\r\n                nextTick(callback.bind(this, err));\r\n                return;\r\n            } else\r\n                throw err;\r\n        }\r\n        rounds = (1 << rounds) >>> 0;\r\n\r\n        var P, S, i = 0, j;\r\n\r\n        //Use typed arrays when available - huge speedup!\r\n        if (Int32Array) {\r\n            P = new Int32Array(P_ORIG);\r\n            S = new Int32Array(S_ORIG);\r\n        } else {\r\n            P = P_ORIG.slice();\r\n            S = S_ORIG.slice();\r\n        }\r\n\r\n        _ekskey(salt, b, P, S);\r\n\r\n        /**\r\n         * Calcualtes the next round.\r\n         * @returns {Array.<number>|undefined} Resulting array if callback has been omitted, otherwise `undefined`\r\n         * @inner\r\n         */\r\n        function next() {\r\n            if (progressCallback)\r\n                progressCallback(i / rounds);\r\n            if (i < rounds) {\r\n                var start = Date.now();\r\n                for (; i < rounds;) {\r\n                    i = i + 1;\r\n                    _key(b, P, S);\r\n                    _key(salt, P, S);\r\n                    if (Date.now() - start > MAX_EXECUTION_TIME)\r\n                        break;\r\n                }\r\n            } else {\r\n                for (i = 0; i < 64; i++)\r\n                    for (j = 0; j < (clen >> 1); j++)\r\n                        _encipher(cdata, j << 1, P, S);\r\n                var ret = [];\r\n                for (i = 0; i < clen; i++)\r\n                    ret.push(((cdata[i] >> 24) & 0xff) >>> 0),\r\n                    ret.push(((cdata[i] >> 16) & 0xff) >>> 0),\r\n                    ret.push(((cdata[i] >> 8) & 0xff) >>> 0),\r\n                    ret.push((cdata[i] & 0xff) >>> 0);\r\n                if (callback) {\r\n                    callback(null, ret);\r\n                    return;\r\n                } else\r\n                    return ret;\r\n            }\r\n            if (callback)\r\n                nextTick(next);\r\n        }\r\n\r\n        // Async\r\n        if (typeof callback !== 'undefined') {\r\n            next();\r\n\r\n            // Sync\r\n        } else {\r\n            var res;\r\n            while (true)\r\n                if (typeof(res = next()) !== 'undefined')\r\n                    return res || [];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Internally hashes a string.\r\n     * @param {string} s String to hash\r\n     * @param {?string} salt Salt to use, actually never null\r\n     * @param {function(Error, string=)=} callback Callback receiving the error, if any, and the resulting hash. If omitted,\r\n     *  hashing is perormed synchronously.\r\n     *  @param {function(number)=} progressCallback Callback called with the current progress\r\n     * @returns {string|undefined} Resulting hash if callback has been omitted, otherwise `undefined`\r\n     * @inner\r\n     */\r\n    function _hash(s, salt, callback, progressCallback) {\r\n        var err;\r\n        if (typeof s !== 'string' || typeof salt !== 'string') {\r\n            err = Error(\"Invalid string / salt: Not a string\");\r\n            if (callback) {\r\n                nextTick(callback.bind(this, err));\r\n                return;\r\n            }\r\n            else\r\n                throw err;\r\n        }\r\n\r\n        // Validate the salt\r\n        var minor, offset;\r\n        if (salt.charAt(0) !== '$' || salt.charAt(1) !== '2') {\r\n            err = Error(\"Invalid salt version: \"+salt.substring(0,2));\r\n            if (callback) {\r\n                nextTick(callback.bind(this, err));\r\n                return;\r\n            }\r\n            else\r\n                throw err;\r\n        }\r\n        if (salt.charAt(2) === '$')\r\n            minor = String.fromCharCode(0),\r\n            offset = 3;\r\n        else {\r\n            minor = salt.charAt(2);\r\n            if ((minor !== 'a' && minor !== 'b' && minor !== 'y') || salt.charAt(3) !== '$') {\r\n                err = Error(\"Invalid salt revision: \"+salt.substring(2,4));\r\n                if (callback) {\r\n                    nextTick(callback.bind(this, err));\r\n                    return;\r\n                } else\r\n                    throw err;\r\n            }\r\n            offset = 4;\r\n        }\r\n\r\n        // Extract number of rounds\r\n        if (salt.charAt(offset + 2) > '$') {\r\n            err = Error(\"Missing salt rounds\");\r\n            if (callback) {\r\n                nextTick(callback.bind(this, err));\r\n                return;\r\n            } else\r\n                throw err;\r\n        }\r\n        var r1 = parseInt(salt.substring(offset, offset + 1), 10) * 10,\r\n            r2 = parseInt(salt.substring(offset + 1, offset + 2), 10),\r\n            rounds = r1 + r2,\r\n            real_salt = salt.substring(offset + 3, offset + 25);\r\n        s += minor >= 'a' ? \"\\x00\" : \"\";\r\n\r\n        var passwordb = stringToBytes(s),\r\n            saltb = base64_decode(real_salt, BCRYPT_SALT_LEN);\r\n\r\n        /**\r\n         * Finishes hashing.\r\n         * @param {Array.<number>} bytes Byte array\r\n         * @returns {string}\r\n         * @inner\r\n         */\r\n        function finish(bytes) {\r\n            var res = [];\r\n            res.push(\"$2\");\r\n            if (minor >= 'a')\r\n                res.push(minor);\r\n            res.push(\"$\");\r\n            if (rounds < 10)\r\n                res.push(\"0\");\r\n            res.push(rounds.toString());\r\n            res.push(\"$\");\r\n            res.push(base64_encode(saltb, saltb.length));\r\n            res.push(base64_encode(bytes, C_ORIG.length * 4 - 1));\r\n            return res.join('');\r\n        }\r\n\r\n        // Sync\r\n        if (typeof callback == 'undefined')\r\n            return finish(_crypt(passwordb, saltb, rounds));\r\n\r\n        // Async\r\n        else {\r\n            _crypt(passwordb, saltb, rounds, function(err, bytes) {\r\n                if (err)\r\n                    callback(err, null);\r\n                else\r\n                    callback(null, finish(bytes));\r\n            }, progressCallback);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Encodes a byte array to base64 with up to len bytes of input, using the custom bcrypt alphabet.\r\n     * @function\r\n     * @param {!Array.<number>} b Byte array\r\n     * @param {number} len Maximum input length\r\n     * @returns {string}\r\n     * @expose\r\n     */\r\n    bcrypt.encodeBase64 = base64_encode;\r\n\r\n    /**\r\n     * Decodes a base64 encoded string to up to len bytes of output, using the custom bcrypt alphabet.\r\n     * @function\r\n     * @param {string} s String to decode\r\n     * @param {number} len Maximum output length\r\n     * @returns {!Array.<number>}\r\n     * @expose\r\n     */\r\n    bcrypt.decodeBase64 = base64_decode;\r\n\r\n    return bcrypt;\r\n}));\r\n", "// src/compose.ts\nvar compose = (middleware, onError, onNotFound) => {\n  return (context, next) => {\n    let index = -1;\n    return dispatch(0);\n    async function dispatch(i) {\n      if (i <= index) {\n        throw new Error(\"next() called multiple times\");\n      }\n      index = i;\n      let res;\n      let isError = false;\n      let handler;\n      if (middleware[i]) {\n        handler = middleware[i][0][0];\n        context.req.routeIndex = i;\n      } else {\n        handler = i === middleware.length && next || void 0;\n      }\n      if (handler) {\n        try {\n          res = await handler(context, () => dispatch(i + 1));\n        } catch (err) {\n          if (err instanceof Error && onError) {\n            context.error = err;\n            res = await onError(err, context);\n            isError = true;\n          } else {\n            throw err;\n          }\n        }\n      } else {\n        if (context.finalized === false && onNotFound) {\n          res = await onNotFound(context);\n        }\n      }\n      if (res && (context.finalized === false || isError)) {\n        context.res = res;\n      }\n      return context;\n    }\n  };\n};\nexport {\n  compose\n};\n", "// src/request/constants.ts\nvar GET_MATCH_RESULT = Symbol();\nexport {\n  GET_MATCH_RESULT\n};\n", "// src/utils/body.ts\nimport { HonoRequest } from \"../request.js\";\nvar parseBody = async (request, options = /* @__PURE__ */ Object.create(null)) => {\n  const { all = false, dot = false } = options;\n  const headers = request instanceof HonoRequest ? request.raw.headers : request.headers;\n  const contentType = headers.get(\"Content-Type\");\n  if (contentType?.startsWith(\"multipart/form-data\") || contentType?.startsWith(\"application/x-www-form-urlencoded\")) {\n    return parseFormData(request, { all, dot });\n  }\n  return {};\n};\nasync function parseFormData(request, options) {\n  const formData = await request.formData();\n  if (formData) {\n    return convertFormDataToBodyData(formData, options);\n  }\n  return {};\n}\nfunction convertFormDataToBodyData(formData, options) {\n  const form = /* @__PURE__ */ Object.create(null);\n  formData.forEach((value, key) => {\n    const shouldParseAllValues = options.all || key.endsWith(\"[]\");\n    if (!shouldParseAllValues) {\n      form[key] = value;\n    } else {\n      handleParsingAllValues(form, key, value);\n    }\n  });\n  if (options.dot) {\n    Object.entries(form).forEach(([key, value]) => {\n      const shouldParseDotValues = key.includes(\".\");\n      if (shouldParseDotValues) {\n        handleParsingNestedValues(form, key, value);\n        delete form[key];\n      }\n    });\n  }\n  return form;\n}\nvar handleParsingAllValues = (form, key, value) => {\n  if (form[key] !== void 0) {\n    if (Array.isArray(form[key])) {\n      ;\n      form[key].push(value);\n    } else {\n      form[key] = [form[key], value];\n    }\n  } else {\n    if (!key.endsWith(\"[]\")) {\n      form[key] = value;\n    } else {\n      form[key] = [value];\n    }\n  }\n};\nvar handleParsingNestedValues = (form, key, value) => {\n  let nestedForm = form;\n  const keys = key.split(\".\");\n  keys.forEach((key2, index) => {\n    if (index === keys.length - 1) {\n      nestedForm[key2] = value;\n    } else {\n      if (!nestedForm[key2] || typeof nestedForm[key2] !== \"object\" || Array.isArray(nestedForm[key2]) || nestedForm[key2] instanceof File) {\n        nestedForm[key2] = /* @__PURE__ */ Object.create(null);\n      }\n      nestedForm = nestedForm[key2];\n    }\n  });\n};\nexport {\n  parseBody\n};\n", "// src/utils/url.ts\nvar splitPath = (path) => {\n  const paths = path.split(\"/\");\n  if (paths[0] === \"\") {\n    paths.shift();\n  }\n  return paths;\n};\nvar splitRoutingPath = (routePath) => {\n  const { groups, path } = extractGroupsFromPath(routePath);\n  const paths = splitPath(path);\n  return replaceGroupMarks(paths, groups);\n};\nvar extractGroupsFromPath = (path) => {\n  const groups = [];\n  path = path.replace(/\\{[^}]+\\}/g, (match, index) => {\n    const mark = `@${index}`;\n    groups.push([mark, match]);\n    return mark;\n  });\n  return { groups, path };\n};\nvar replaceGroupMarks = (paths, groups) => {\n  for (let i = groups.length - 1; i >= 0; i--) {\n    const [mark] = groups[i];\n    for (let j = paths.length - 1; j >= 0; j--) {\n      if (paths[j].includes(mark)) {\n        paths[j] = paths[j].replace(mark, groups[i][1]);\n        break;\n      }\n    }\n  }\n  return paths;\n};\nvar patternCache = {};\nvar getPattern = (label, next) => {\n  if (label === \"*\") {\n    return \"*\";\n  }\n  const match = label.match(/^\\:([^\\{\\}]+)(?:\\{(.+)\\})?$/);\n  if (match) {\n    const cacheKey = `${label}#${next}`;\n    if (!patternCache[cacheKey]) {\n      if (match[2]) {\n        patternCache[cacheKey] = next && next[0] !== \":\" && next[0] !== \"*\" ? [cacheKey, match[1], new RegExp(`^${match[2]}(?=/${next})`)] : [label, match[1], new RegExp(`^${match[2]}$`)];\n      } else {\n        patternCache[cacheKey] = [label, match[1], true];\n      }\n    }\n    return patternCache[cacheKey];\n  }\n  return null;\n};\nvar tryDecode = (str, decoder) => {\n  try {\n    return decoder(str);\n  } catch {\n    return str.replace(/(?:%[0-9A-Fa-f]{2})+/g, (match) => {\n      try {\n        return decoder(match);\n      } catch {\n        return match;\n      }\n    });\n  }\n};\nvar tryDecodeURI = (str) => tryDecode(str, decodeURI);\nvar getPath = (request) => {\n  const url = request.url;\n  const start = url.indexOf(\"/\", url.indexOf(\":\") + 4);\n  let i = start;\n  for (; i < url.length; i++) {\n    const charCode = url.charCodeAt(i);\n    if (charCode === 37) {\n      const queryIndex = url.indexOf(\"?\", i);\n      const path = url.slice(start, queryIndex === -1 ? void 0 : queryIndex);\n      return tryDecodeURI(path.includes(\"%25\") ? path.replace(/%25/g, \"%2525\") : path);\n    } else if (charCode === 63) {\n      break;\n    }\n  }\n  return url.slice(start, i);\n};\nvar getQueryStrings = (url) => {\n  const queryIndex = url.indexOf(\"?\", 8);\n  return queryIndex === -1 ? \"\" : \"?\" + url.slice(queryIndex + 1);\n};\nvar getPathNoStrict = (request) => {\n  const result = getPath(request);\n  return result.length > 1 && result.at(-1) === \"/\" ? result.slice(0, -1) : result;\n};\nvar mergePath = (base, sub, ...rest) => {\n  if (rest.length) {\n    sub = mergePath(sub, ...rest);\n  }\n  return `${base?.[0] === \"/\" ? \"\" : \"/\"}${base}${sub === \"/\" ? \"\" : `${base?.at(-1) === \"/\" ? \"\" : \"/\"}${sub?.[0] === \"/\" ? sub.slice(1) : sub}`}`;\n};\nvar checkOptionalParameter = (path) => {\n  if (path.charCodeAt(path.length - 1) !== 63 || !path.includes(\":\")) {\n    return null;\n  }\n  const segments = path.split(\"/\");\n  const results = [];\n  let basePath = \"\";\n  segments.forEach((segment) => {\n    if (segment !== \"\" && !/\\:/.test(segment)) {\n      basePath += \"/\" + segment;\n    } else if (/\\:/.test(segment)) {\n      if (/\\?/.test(segment)) {\n        if (results.length === 0 && basePath === \"\") {\n          results.push(\"/\");\n        } else {\n          results.push(basePath);\n        }\n        const optionalSegment = segment.replace(\"?\", \"\");\n        basePath += \"/\" + optionalSegment;\n        results.push(basePath);\n      } else {\n        basePath += \"/\" + segment;\n      }\n    }\n  });\n  return results.filter((v, i, a) => a.indexOf(v) === i);\n};\nvar _decodeURI = (value) => {\n  if (!/[%+]/.test(value)) {\n    return value;\n  }\n  if (value.indexOf(\"+\") !== -1) {\n    value = value.replace(/\\+/g, \" \");\n  }\n  return value.indexOf(\"%\") !== -1 ? tryDecode(value, decodeURIComponent_) : value;\n};\nvar _getQueryParam = (url, key, multiple) => {\n  let encoded;\n  if (!multiple && key && !/[%+]/.test(key)) {\n    let keyIndex2 = url.indexOf(`?${key}`, 8);\n    if (keyIndex2 === -1) {\n      keyIndex2 = url.indexOf(`&${key}`, 8);\n    }\n    while (keyIndex2 !== -1) {\n      const trailingKeyCode = url.charCodeAt(keyIndex2 + key.length + 1);\n      if (trailingKeyCode === 61) {\n        const valueIndex = keyIndex2 + key.length + 2;\n        const endIndex = url.indexOf(\"&\", valueIndex);\n        return _decodeURI(url.slice(valueIndex, endIndex === -1 ? void 0 : endIndex));\n      } else if (trailingKeyCode == 38 || isNaN(trailingKeyCode)) {\n        return \"\";\n      }\n      keyIndex2 = url.indexOf(`&${key}`, keyIndex2 + 1);\n    }\n    encoded = /[%+]/.test(url);\n    if (!encoded) {\n      return void 0;\n    }\n  }\n  const results = {};\n  encoded ??= /[%+]/.test(url);\n  let keyIndex = url.indexOf(\"?\", 8);\n  while (keyIndex !== -1) {\n    const nextKeyIndex = url.indexOf(\"&\", keyIndex + 1);\n    let valueIndex = url.indexOf(\"=\", keyIndex);\n    if (valueIndex > nextKeyIndex && nextKeyIndex !== -1) {\n      valueIndex = -1;\n    }\n    let name = url.slice(\n      keyIndex + 1,\n      valueIndex === -1 ? nextKeyIndex === -1 ? void 0 : nextKeyIndex : valueIndex\n    );\n    if (encoded) {\n      name = _decodeURI(name);\n    }\n    keyIndex = nextKeyIndex;\n    if (name === \"\") {\n      continue;\n    }\n    let value;\n    if (valueIndex === -1) {\n      value = \"\";\n    } else {\n      value = url.slice(valueIndex + 1, nextKeyIndex === -1 ? void 0 : nextKeyIndex);\n      if (encoded) {\n        value = _decodeURI(value);\n      }\n    }\n    if (multiple) {\n      if (!(results[name] && Array.isArray(results[name]))) {\n        results[name] = [];\n      }\n      ;\n      results[name].push(value);\n    } else {\n      results[name] ??= value;\n    }\n  }\n  return key ? results[key] : results;\n};\nvar getQueryParam = _getQueryParam;\nvar getQueryParams = (url, key) => {\n  return _getQueryParam(url, key, true);\n};\nvar decodeURIComponent_ = decodeURIComponent;\nexport {\n  checkOptionalParameter,\n  decodeURIComponent_,\n  getPath,\n  getPathNoStrict,\n  getPattern,\n  getQueryParam,\n  getQueryParams,\n  getQueryStrings,\n  mergePath,\n  splitPath,\n  splitRoutingPath,\n  tryDecode\n};\n", "// src/request.ts\nimport { HTTPException } from \"./http-exception.js\";\nimport { GET_MATCH_RESULT } from \"./request/constants.js\";\nimport { parseBody } from \"./utils/body.js\";\nimport { decodeURIComponent_, getQueryParam, getQueryParams, tryDecode } from \"./utils/url.js\";\nvar tryDecodeURIComponent = (str) => tryDecode(str, decodeURIComponent_);\nvar HonoRequest = class {\n  raw;\n  #validatedData;\n  #matchResult;\n  routeIndex = 0;\n  path;\n  bodyCache = {};\n  constructor(request, path = \"/\", matchResult = [[]]) {\n    this.raw = request;\n    this.path = path;\n    this.#matchResult = matchResult;\n    this.#validatedData = {};\n  }\n  param(key) {\n    return key ? this.#getDecodedParam(key) : this.#getAllDecodedParams();\n  }\n  #getDecodedParam(key) {\n    const paramKey = this.#matchResult[0][this.routeIndex][1][key];\n    const param = this.#getParamValue(paramKey);\n    return param && /\\%/.test(param) ? tryDecodeURIComponent(param) : param;\n  }\n  #getAllDecodedParams() {\n    const decoded = {};\n    const keys = Object.keys(this.#matchResult[0][this.routeIndex][1]);\n    for (const key of keys) {\n      const value = this.#getParamValue(this.#matchResult[0][this.routeIndex][1][key]);\n      if (value !== void 0) {\n        decoded[key] = /\\%/.test(value) ? tryDecodeURIComponent(value) : value;\n      }\n    }\n    return decoded;\n  }\n  #getParamValue(paramKey) {\n    return this.#matchResult[1] ? this.#matchResult[1][paramKey] : paramKey;\n  }\n  query(key) {\n    return getQueryParam(this.url, key);\n  }\n  queries(key) {\n    return getQueryParams(this.url, key);\n  }\n  header(name) {\n    if (name) {\n      return this.raw.headers.get(name) ?? void 0;\n    }\n    const headerData = {};\n    this.raw.headers.forEach((value, key) => {\n      headerData[key] = value;\n    });\n    return headerData;\n  }\n  async parseBody(options) {\n    return this.bodyCache.parsedBody ??= await parseBody(this, options);\n  }\n  #cachedBody = (key) => {\n    const { bodyCache, raw } = this;\n    const cachedBody = bodyCache[key];\n    if (cachedBody) {\n      return cachedBody;\n    }\n    const anyCachedKey = Object.keys(bodyCache)[0];\n    if (anyCachedKey) {\n      return bodyCache[anyCachedKey].then((body) => {\n        if (anyCachedKey === \"json\") {\n          body = JSON.stringify(body);\n        }\n        return new Response(body)[key]();\n      });\n    }\n    return bodyCache[key] = raw[key]();\n  };\n  json() {\n    return this.#cachedBody(\"text\").then((text) => JSON.parse(text));\n  }\n  text() {\n    return this.#cachedBody(\"text\");\n  }\n  arrayBuffer() {\n    return this.#cachedBody(\"arrayBuffer\");\n  }\n  blob() {\n    return this.#cachedBody(\"blob\");\n  }\n  formData() {\n    return this.#cachedBody(\"formData\");\n  }\n  addValidatedData(target, data) {\n    this.#validatedData[target] = data;\n  }\n  valid(target) {\n    return this.#validatedData[target];\n  }\n  get url() {\n    return this.raw.url;\n  }\n  get method() {\n    return this.raw.method;\n  }\n  get [GET_MATCH_RESULT]() {\n    return this.#matchResult;\n  }\n  get matchedRoutes() {\n    return this.#matchResult[0].map(([[, route]]) => route);\n  }\n  get routePath() {\n    return this.#matchResult[0].map(([[, route]]) => route)[this.routeIndex].path;\n  }\n};\nvar cloneRawRequest = async (req) => {\n  if (!req.raw.bodyUsed) {\n    return req.raw.clone();\n  }\n  const cacheKey = Object.keys(req.bodyCache)[0];\n  if (!cacheKey) {\n    throw new HTTPException(500, {\n      message: \"Cannot clone request: body was already consumed and not cached. Please use HonoRequest methods (e.g., req.json(), req.text()) instead of consuming req.raw directly.\"\n    });\n  }\n  const requestInit = {\n    body: await req[cacheKey](),\n    cache: req.raw.cache,\n    credentials: req.raw.credentials,\n    headers: req.header(),\n    integrity: req.raw.integrity,\n    keepalive: req.raw.keepalive,\n    method: req.method,\n    mode: req.raw.mode,\n    redirect: req.raw.redirect,\n    referrer: req.raw.referrer,\n    referrerPolicy: req.raw.referrerPolicy,\n    signal: req.raw.signal\n  };\n  return new Request(req.url, requestInit);\n};\nexport {\n  HonoRequest,\n  cloneRawRequest\n};\n", "// src/utils/html.ts\nvar HtmlEscapedCallbackPhase = {\n  Stringify: 1,\n  BeforeStream: 2,\n  Stream: 3\n};\nvar raw = (value, callbacks) => {\n  const escapedString = new String(value);\n  escapedString.isEscaped = true;\n  escapedString.callbacks = callbacks;\n  return escapedString;\n};\nvar escapeRe = /[&<>'\"]/;\nvar stringBufferToString = async (buffer, callbacks) => {\n  let str = \"\";\n  callbacks ||= [];\n  const resolvedBuffer = await Promise.all(buffer);\n  for (let i = resolvedBuffer.length - 1; ; i--) {\n    str += resolvedBuffer[i];\n    i--;\n    if (i < 0) {\n      break;\n    }\n    let r = resolvedBuffer[i];\n    if (typeof r === \"object\") {\n      callbacks.push(...r.callbacks || []);\n    }\n    const isEscaped = r.isEscaped;\n    r = await (typeof r === \"object\" ? r.toString() : r);\n    if (typeof r === \"object\") {\n      callbacks.push(...r.callbacks || []);\n    }\n    if (r.isEscaped ?? isEscaped) {\n      str += r;\n    } else {\n      const buf = [str];\n      escapeToBuffer(r, buf);\n      str = buf[0];\n    }\n  }\n  return raw(str, callbacks);\n};\nvar escapeToBuffer = (str, buffer) => {\n  const match = str.search(escapeRe);\n  if (match === -1) {\n    buffer[0] += str;\n    return;\n  }\n  let escape;\n  let index;\n  let lastIndex = 0;\n  for (index = match; index < str.length; index++) {\n    switch (str.charCodeAt(index)) {\n      case 34:\n        escape = \"&quot;\";\n        break;\n      case 39:\n        escape = \"&#39;\";\n        break;\n      case 38:\n        escape = \"&amp;\";\n        break;\n      case 60:\n        escape = \"&lt;\";\n        break;\n      case 62:\n        escape = \"&gt;\";\n        break;\n      default:\n        continue;\n    }\n    buffer[0] += str.substring(lastIndex, index) + escape;\n    lastIndex = index + 1;\n  }\n  buffer[0] += str.substring(lastIndex, index);\n};\nvar resolveCallbackSync = (str) => {\n  const callbacks = str.callbacks;\n  if (!callbacks?.length) {\n    return str;\n  }\n  const buffer = [str];\n  const context = {};\n  callbacks.forEach((c) => c({ phase: HtmlEscapedCallbackPhase.Stringify, buffer, context }));\n  return buffer[0];\n};\nvar resolveCallback = async (str, phase, preserveCallbacks, context, buffer) => {\n  if (typeof str === \"object\" && !(str instanceof String)) {\n    if (!(str instanceof Promise)) {\n      str = str.toString();\n    }\n    if (str instanceof Promise) {\n      str = await str;\n    }\n  }\n  const callbacks = str.callbacks;\n  if (!callbacks?.length) {\n    return Promise.resolve(str);\n  }\n  if (buffer) {\n    buffer[0] += str;\n  } else {\n    buffer = [str];\n  }\n  const resStr = Promise.all(callbacks.map((c) => c({ phase, buffer, context }))).then(\n    (res) => Promise.all(\n      res.filter(Boolean).map((str2) => resolveCallback(str2, phase, false, context, buffer))\n    ).then(() => buffer[0])\n  );\n  if (preserveCallbacks) {\n    return raw(await resStr, callbacks);\n  } else {\n    return resStr;\n  }\n};\nexport {\n  HtmlEscapedCallbackPhase,\n  escapeToBuffer,\n  raw,\n  resolveCallback,\n  resolveCallbackSync,\n  stringBufferToString\n};\n", "// src/context.ts\nimport { HonoRequest } from \"./request.js\";\nimport { HtmlEscapedCallbackPhase, resolveCallback } from \"./utils/html.js\";\nvar TEXT_PLAIN = \"text/plain; charset=UTF-8\";\nvar setDefaultContentType = (contentType, headers) => {\n  return {\n    \"Content-Type\": contentType,\n    ...headers\n  };\n};\nvar Context = class {\n  #rawRequest;\n  #req;\n  env = {};\n  #var;\n  finalized = false;\n  error;\n  #status;\n  #executionCtx;\n  #res;\n  #layout;\n  #renderer;\n  #notFoundHandler;\n  #preparedHeaders;\n  #matchResult;\n  #path;\n  constructor(req, options) {\n    this.#rawRequest = req;\n    if (options) {\n      this.#executionCtx = options.executionCtx;\n      this.env = options.env;\n      this.#notFoundHandler = options.notFoundHandler;\n      this.#path = options.path;\n      this.#matchResult = options.matchResult;\n    }\n  }\n  get req() {\n    this.#req ??= new HonoRequest(this.#rawRequest, this.#path, this.#matchResult);\n    return this.#req;\n  }\n  get event() {\n    if (this.#executionCtx && \"respondWith\" in this.#executionCtx) {\n      return this.#executionCtx;\n    } else {\n      throw Error(\"This context has no FetchEvent\");\n    }\n  }\n  get executionCtx() {\n    if (this.#executionCtx) {\n      return this.#executionCtx;\n    } else {\n      throw Error(\"This context has no ExecutionContext\");\n    }\n  }\n  get res() {\n    return this.#res ||= new Response(null, {\n      headers: this.#preparedHeaders ??= new Headers()\n    });\n  }\n  set res(_res) {\n    if (this.#res && _res) {\n      _res = new Response(_res.body, _res);\n      for (const [k, v] of this.#res.headers.entries()) {\n        if (k === \"content-type\") {\n          continue;\n        }\n        if (k === \"set-cookie\") {\n          const cookies = this.#res.headers.getSetCookie();\n          _res.headers.delete(\"set-cookie\");\n          for (const cookie of cookies) {\n            _res.headers.append(\"set-cookie\", cookie);\n          }\n        } else {\n          _res.headers.set(k, v);\n        }\n      }\n    }\n    this.#res = _res;\n    this.finalized = true;\n  }\n  render = (...args) => {\n    this.#renderer ??= (content) => this.html(content);\n    return this.#renderer(...args);\n  };\n  setLayout = (layout) => this.#layout = layout;\n  getLayout = () => this.#layout;\n  setRenderer = (renderer) => {\n    this.#renderer = renderer;\n  };\n  header = (name, value, options) => {\n    if (this.finalized) {\n      this.#res = new Response(this.#res.body, this.#res);\n    }\n    const headers = this.#res ? this.#res.headers : this.#preparedHeaders ??= new Headers();\n    if (value === void 0) {\n      headers.delete(name);\n    } else if (options?.append) {\n      headers.append(name, value);\n    } else {\n      headers.set(name, value);\n    }\n  };\n  status = (status) => {\n    this.#status = status;\n  };\n  set = (key, value) => {\n    this.#var ??= /* @__PURE__ */ new Map();\n    this.#var.set(key, value);\n  };\n  get = (key) => {\n    return this.#var ? this.#var.get(key) : void 0;\n  };\n  get var() {\n    if (!this.#var) {\n      return {};\n    }\n    return Object.fromEntries(this.#var);\n  }\n  #newResponse(data, arg, headers) {\n    const responseHeaders = this.#res ? new Headers(this.#res.headers) : this.#preparedHeaders ?? new Headers();\n    if (typeof arg === \"object\" && \"headers\" in arg) {\n      const argHeaders = arg.headers instanceof Headers ? arg.headers : new Headers(arg.headers);\n      for (const [key, value] of argHeaders) {\n        if (key.toLowerCase() === \"set-cookie\") {\n          responseHeaders.append(key, value);\n        } else {\n          responseHeaders.set(key, value);\n        }\n      }\n    }\n    if (headers) {\n      for (const [k, v] of Object.entries(headers)) {\n        if (typeof v === \"string\") {\n          responseHeaders.set(k, v);\n        } else {\n          responseHeaders.delete(k);\n          for (const v2 of v) {\n            responseHeaders.append(k, v2);\n          }\n        }\n      }\n    }\n    const status = typeof arg === \"number\" ? arg : arg?.status ?? this.#status;\n    return new Response(data, { status, headers: responseHeaders });\n  }\n  newResponse = (...args) => this.#newResponse(...args);\n  body = (data, arg, headers) => this.#newResponse(data, arg, headers);\n  text = (text, arg, headers) => {\n    return !this.#preparedHeaders && !this.#status && !arg && !headers && !this.finalized ? new Response(text) : this.#newResponse(\n      text,\n      arg,\n      setDefaultContentType(TEXT_PLAIN, headers)\n    );\n  };\n  json = (object, arg, headers) => {\n    return this.#newResponse(\n      JSON.stringify(object),\n      arg,\n      setDefaultContentType(\"application/json\", headers)\n    );\n  };\n  html = (html, arg, headers) => {\n    const res = (html2) => this.#newResponse(html2, arg, setDefaultContentType(\"text/html; charset=UTF-8\", headers));\n    return typeof html === \"object\" ? resolveCallback(html, HtmlEscapedCallbackPhase.Stringify, false, {}).then(res) : res(html);\n  };\n  redirect = (location, status) => {\n    const locationString = String(location);\n    this.header(\n      \"Location\",\n      !/[^\\x00-\\xFF]/.test(locationString) ? locationString : encodeURI(locationString)\n    );\n    return this.newResponse(null, status ?? 302);\n  };\n  notFound = () => {\n    this.#notFoundHandler ??= () => new Response();\n    return this.#notFoundHandler(this);\n  };\n};\nexport {\n  Context,\n  TEXT_PLAIN\n};\n", "// src/router.ts\nvar METHOD_NAME_ALL = \"ALL\";\nvar METHOD_NAME_ALL_LOWERCASE = \"all\";\nvar METHODS = [\"get\", \"post\", \"put\", \"delete\", \"options\", \"patch\"];\nvar MESSAGE_MATCHER_IS_ALREADY_BUILT = \"Can not add a route since the matcher is already built.\";\nvar UnsupportedPathError = class extends Error {\n};\nexport {\n  MESSAGE_MATCHER_IS_ALREADY_BUILT,\n  METHODS,\n  METHOD_NAME_ALL,\n  METHOD_NAME_ALL_LOWERCASE,\n  UnsupportedPathError\n};\n", "// src/utils/constants.ts\nvar COMPOSED_HANDLER = \"__COMPOSED_HANDLER\";\nexport {\n  COMPOSED_HANDLER\n};\n", "// src/hono-base.ts\nimport { compose } from \"./compose.js\";\nimport { Context } from \"./context.js\";\nimport { METHODS, METHOD_NAME_ALL, METHOD_NAME_ALL_LOWERCASE } from \"./router.js\";\nimport { COMPOSED_HANDLER } from \"./utils/constants.js\";\nimport { getPath, getPathNoStrict, mergePath } from \"./utils/url.js\";\nvar notFoundHandler = (c) => {\n  return c.text(\"404 Not Found\", 404);\n};\nvar errorHandler = (err, c) => {\n  if (\"getResponse\" in err) {\n    const res = err.getResponse();\n    return c.newResponse(res.body, res);\n  }\n  console.error(err);\n  return c.text(\"Internal Server Error\", 500);\n};\nvar Hono = class {\n  get;\n  post;\n  put;\n  delete;\n  options;\n  patch;\n  all;\n  on;\n  use;\n  router;\n  getPath;\n  _basePath = \"/\";\n  #path = \"/\";\n  routes = [];\n  constructor(options = {}) {\n    const allMethods = [...METHODS, METHOD_NAME_ALL_LOWERCASE];\n    allMethods.forEach((method) => {\n      this[method] = (args1, ...args) => {\n        if (typeof args1 === \"string\") {\n          this.#path = args1;\n        } else {\n          this.#addRoute(method, this.#path, args1);\n        }\n        args.forEach((handler) => {\n          this.#addRoute(method, this.#path, handler);\n        });\n        return this;\n      };\n    });\n    this.on = (method, path, ...handlers) => {\n      for (const p of [path].flat()) {\n        this.#path = p;\n        for (const m of [method].flat()) {\n          handlers.map((handler) => {\n            this.#addRoute(m.toUpperCase(), this.#path, handler);\n          });\n        }\n      }\n      return this;\n    };\n    this.use = (arg1, ...handlers) => {\n      if (typeof arg1 === \"string\") {\n        this.#path = arg1;\n      } else {\n        this.#path = \"*\";\n        handlers.unshift(arg1);\n      }\n      handlers.forEach((handler) => {\n        this.#addRoute(METHOD_NAME_ALL, this.#path, handler);\n      });\n      return this;\n    };\n    const { strict, ...optionsWithoutStrict } = options;\n    Object.assign(this, optionsWithoutStrict);\n    this.getPath = strict ?? true ? options.getPath ?? getPath : getPathNoStrict;\n  }\n  #clone() {\n    const clone = new Hono({\n      router: this.router,\n      getPath: this.getPath\n    });\n    clone.errorHandler = this.errorHandler;\n    clone.#notFoundHandler = this.#notFoundHandler;\n    clone.routes = this.routes;\n    return clone;\n  }\n  #notFoundHandler = notFoundHandler;\n  errorHandler = errorHandler;\n  route(path, app) {\n    const subApp = this.basePath(path);\n    app.routes.map((r) => {\n      let handler;\n      if (app.errorHandler === errorHandler) {\n        handler = r.handler;\n      } else {\n        handler = async (c, next) => (await compose([], app.errorHandler)(c, () => r.handler(c, next))).res;\n        handler[COMPOSED_HANDLER] = r.handler;\n      }\n      subApp.#addRoute(r.method, r.path, handler);\n    });\n    return this;\n  }\n  basePath(path) {\n    const subApp = this.#clone();\n    subApp._basePath = mergePath(this._basePath, path);\n    return subApp;\n  }\n  onError = (handler) => {\n    this.errorHandler = handler;\n    return this;\n  };\n  notFound = (handler) => {\n    this.#notFoundHandler = handler;\n    return this;\n  };\n  mount(path, applicationHandler, options) {\n    let replaceRequest;\n    let optionHandler;\n    if (options) {\n      if (typeof options === \"function\") {\n        optionHandler = options;\n      } else {\n        optionHandler = options.optionHandler;\n        if (options.replaceRequest === false) {\n          replaceRequest = (request) => request;\n        } else {\n          replaceRequest = options.replaceRequest;\n        }\n      }\n    }\n    const getOptions = optionHandler ? (c) => {\n      const options2 = optionHandler(c);\n      return Array.isArray(options2) ? options2 : [options2];\n    } : (c) => {\n      let executionContext = void 0;\n      try {\n        executionContext = c.executionCtx;\n      } catch {\n      }\n      return [c.env, executionContext];\n    };\n    replaceRequest ||= (() => {\n      const mergedPath = mergePath(this._basePath, path);\n      const pathPrefixLength = mergedPath === \"/\" ? 0 : mergedPath.length;\n      return (request) => {\n        const url = new URL(request.url);\n        url.pathname = url.pathname.slice(pathPrefixLength) || \"/\";\n        return new Request(url, request);\n      };\n    })();\n    const handler = async (c, next) => {\n      const res = await applicationHandler(replaceRequest(c.req.raw), ...getOptions(c));\n      if (res) {\n        return res;\n      }\n      await next();\n    };\n    this.#addRoute(METHOD_NAME_ALL, mergePath(path, \"*\"), handler);\n    return this;\n  }\n  #addRoute(method, path, handler) {\n    method = method.toUpperCase();\n    path = mergePath(this._basePath, path);\n    const r = { basePath: this._basePath, path, method, handler };\n    this.router.add(method, path, [handler, r]);\n    this.routes.push(r);\n  }\n  #handleError(err, c) {\n    if (err instanceof Error) {\n      return this.errorHandler(err, c);\n    }\n    throw err;\n  }\n  #dispatch(request, executionCtx, env, method) {\n    if (method === \"HEAD\") {\n      return (async () => new Response(null, await this.#dispatch(request, executionCtx, env, \"GET\")))();\n    }\n    const path = this.getPath(request, { env });\n    const matchResult = this.router.match(method, path);\n    const c = new Context(request, {\n      path,\n      matchResult,\n      env,\n      executionCtx,\n      notFoundHandler: this.#notFoundHandler\n    });\n    if (matchResult[0].length === 1) {\n      let res;\n      try {\n        res = matchResult[0][0][0][0](c, async () => {\n          c.res = await this.#notFoundHandler(c);\n        });\n      } catch (err) {\n        return this.#handleError(err, c);\n      }\n      return res instanceof Promise ? res.then(\n        (resolved) => resolved || (c.finalized ? c.res : this.#notFoundHandler(c))\n      ).catch((err) => this.#handleError(err, c)) : res ?? this.#notFoundHandler(c);\n    }\n    const composed = compose(matchResult[0], this.errorHandler, this.#notFoundHandler);\n    return (async () => {\n      try {\n        const context = await composed(c);\n        if (!context.finalized) {\n          throw new Error(\n            \"Context is not finalized. Did you forget to return a Response object or `await next()`?\"\n          );\n        }\n        return context.res;\n      } catch (err) {\n        return this.#handleError(err, c);\n      }\n    })();\n  }\n  fetch = (request, ...rest) => {\n    return this.#dispatch(request, rest[1], rest[0], request.method);\n  };\n  request = (input, requestInit, Env, executionCtx) => {\n    if (input instanceof Request) {\n      return this.fetch(requestInit ? new Request(input, requestInit) : input, Env, executionCtx);\n    }\n    input = input.toString();\n    return this.fetch(\n      new Request(\n        /^https?:\\/\\//.test(input) ? input : `http://localhost${mergePath(\"/\", input)}`,\n        requestInit\n      ),\n      Env,\n      executionCtx\n    );\n  };\n  fire = () => {\n    addEventListener(\"fetch\", (event) => {\n      event.respondWith(this.#dispatch(event.request, event, void 0, event.request.method));\n    });\n  };\n};\nexport {\n  Hono as HonoBase\n};\n", "// src/router/reg-exp-router/matcher.ts\nimport { METHOD_NAME_ALL } from \"../../router.js\";\nvar emptyParam = [];\nfunction match(method, path) {\n  const matchers = this.buildAllMatchers();\n  const match2 = (method2, path2) => {\n    const matcher = matchers[method2] || matchers[METHOD_NAME_ALL];\n    const staticMatch = matcher[2][path2];\n    if (staticMatch) {\n      return staticMatch;\n    }\n    const match3 = path2.match(matcher[0]);\n    if (!match3) {\n      return [[], emptyParam];\n    }\n    const index = match3.indexOf(\"\", 1);\n    return [matcher[1][index], match3];\n  };\n  this.match = match2;\n  return match2(method, path);\n}\nexport {\n  emptyParam,\n  match\n};\n", "// src/router/reg-exp-router/node.ts\nvar LABEL_REG_EXP_STR = \"[^/]+\";\nvar ONLY_WILDCARD_REG_EXP_STR = \".*\";\nvar TAIL_WILDCARD_REG_EXP_STR = \"(?:|/.*)\";\nvar PATH_ERROR = Symbol();\nvar regExpMetaChars = new Set(\".\\\\+*[^]$()\");\nfunction compareKey(a, b) {\n  if (a.length === 1) {\n    return b.length === 1 ? a < b ? -1 : 1 : -1;\n  }\n  if (b.length === 1) {\n    return 1;\n  }\n  if (a === ONLY_WILDCARD_REG_EXP_STR || a === TAIL_WILDCARD_REG_EXP_STR) {\n    return 1;\n  } else if (b === ONLY_WILDCARD_REG_EXP_STR || b === TAIL_WILDCARD_REG_EXP_STR) {\n    return -1;\n  }\n  if (a === LABEL_REG_EXP_STR) {\n    return 1;\n  } else if (b === LABEL_REG_EXP_STR) {\n    return -1;\n  }\n  return a.length === b.length ? a < b ? -1 : 1 : b.length - a.length;\n}\nvar Node = class {\n  #index;\n  #varIndex;\n  #children = /* @__PURE__ */ Object.create(null);\n  insert(tokens, index, paramMap, context, pathErrorCheckOnly) {\n    if (tokens.length === 0) {\n      if (this.#index !== void 0) {\n        throw PATH_ERROR;\n      }\n      if (pathErrorCheckOnly) {\n        return;\n      }\n      this.#index = index;\n      return;\n    }\n    const [token, ...restTokens] = tokens;\n    const pattern = token === \"*\" ? restTokens.length === 0 ? [\"\", \"\", ONLY_WILDCARD_REG_EXP_STR] : [\"\", \"\", LABEL_REG_EXP_STR] : token === \"/*\" ? [\"\", \"\", TAIL_WILDCARD_REG_EXP_STR] : token.match(/^\\:([^\\{\\}]+)(?:\\{(.+)\\})?$/);\n    let node;\n    if (pattern) {\n      const name = pattern[1];\n      let regexpStr = pattern[2] || LABEL_REG_EXP_STR;\n      if (name && pattern[2]) {\n        if (regexpStr === \".*\") {\n          throw PATH_ERROR;\n        }\n        regexpStr = regexpStr.replace(/^\\((?!\\?:)(?=[^)]+\\)$)/, \"(?:\");\n        if (/\\((?!\\?:)/.test(regexpStr)) {\n          throw PATH_ERROR;\n        }\n      }\n      node = this.#children[regexpStr];\n      if (!node) {\n        if (Object.keys(this.#children).some(\n          (k) => k !== ONLY_WILDCARD_REG_EXP_STR && k !== TAIL_WILDCARD_REG_EXP_STR\n        )) {\n          throw PATH_ERROR;\n        }\n        if (pathErrorCheckOnly) {\n          return;\n        }\n        node = this.#children[regexpStr] = new Node();\n        if (name !== \"\") {\n          node.#varIndex = context.varIndex++;\n        }\n      }\n      if (!pathErrorCheckOnly && name !== \"\") {\n        paramMap.push([name, node.#varIndex]);\n      }\n    } else {\n      node = this.#children[token];\n      if (!node) {\n        if (Object.keys(this.#children).some(\n          (k) => k.length > 1 && k !== ONLY_WILDCARD_REG_EXP_STR && k !== TAIL_WILDCARD_REG_EXP_STR\n        )) {\n          throw PATH_ERROR;\n        }\n        if (pathErrorCheckOnly) {\n          return;\n        }\n        node = this.#children[token] = new Node();\n      }\n    }\n    node.insert(restTokens, index, paramMap, context, pathErrorCheckOnly);\n  }\n  buildRegExpStr() {\n    const childKeys = Object.keys(this.#children).sort(compareKey);\n    const strList = childKeys.map((k) => {\n      const c = this.#children[k];\n      return (typeof c.#varIndex === \"number\" ? `(${k})@${c.#varIndex}` : regExpMetaChars.has(k) ? `\\\\${k}` : k) + c.buildRegExpStr();\n    });\n    if (typeof this.#index === \"number\") {\n      strList.unshift(`#${this.#index}`);\n    }\n    if (strList.length === 0) {\n      return \"\";\n    }\n    if (strList.length === 1) {\n      return strList[0];\n    }\n    return \"(?:\" + strList.join(\"|\") + \")\";\n  }\n};\nexport {\n  Node,\n  PATH_ERROR\n};\n", "// src/router/reg-exp-router/trie.ts\nimport { Node } from \"./node.js\";\nvar Trie = class {\n  #context = { varIndex: 0 };\n  #root = new Node();\n  insert(path, index, pathErrorCheckOnly) {\n    const paramAssoc = [];\n    const groups = [];\n    for (let i = 0; ; ) {\n      let replaced = false;\n      path = path.replace(/\\{[^}]+\\}/g, (m) => {\n        const mark = `@\\\\${i}`;\n        groups[i] = [mark, m];\n        i++;\n        replaced = true;\n        return mark;\n      });\n      if (!replaced) {\n        break;\n      }\n    }\n    const tokens = path.match(/(?::[^\\/]+)|(?:\\/\\*$)|./g) || [];\n    for (let i = groups.length - 1; i >= 0; i--) {\n      const [mark] = groups[i];\n      for (let j = tokens.length - 1; j >= 0; j--) {\n        if (tokens[j].indexOf(mark) !== -1) {\n          tokens[j] = tokens[j].replace(mark, groups[i][1]);\n          break;\n        }\n      }\n    }\n    this.#root.insert(tokens, index, paramAssoc, this.#context, pathErrorCheckOnly);\n    return paramAssoc;\n  }\n  buildRegExp() {\n    let regexp = this.#root.buildRegExpStr();\n    if (regexp === \"\") {\n      return [/^$/, [], []];\n    }\n    let captureIndex = 0;\n    const indexReplacementMap = [];\n    const paramReplacementMap = [];\n    regexp = regexp.replace(/#(\\d+)|@(\\d+)|\\.\\*\\$/g, (_, handlerIndex, paramIndex) => {\n      if (handlerIndex !== void 0) {\n        indexReplacementMap[++captureIndex] = Number(handlerIndex);\n        return \"$()\";\n      }\n      if (paramIndex !== void 0) {\n        paramReplacementMap[Number(paramIndex)] = ++captureIndex;\n        return \"\";\n      }\n      return \"\";\n    });\n    return [new RegExp(`^${regexp}`), indexReplacementMap, paramReplacementMap];\n  }\n};\nexport {\n  Trie\n};\n", "// src/router/reg-exp-router/router.ts\nimport {\n  MESSAGE_MATCHER_IS_ALREADY_BUILT,\n  METHOD_NAME_ALL,\n  UnsupportedPathError\n} from \"../../router.js\";\nimport { checkOptionalParameter } from \"../../utils/url.js\";\nimport { match, emptyParam } from \"./matcher.js\";\nimport { PATH_ERROR } from \"./node.js\";\nimport { Trie } from \"./trie.js\";\nvar nullMatcher = [/^$/, [], /* @__PURE__ */ Object.create(null)];\nvar wildcardRegExpCache = /* @__PURE__ */ Object.create(null);\nfunction buildWildcardRegExp(path) {\n  return wildcardRegExpCache[path] ??= new RegExp(\n    path === \"*\" ? \"\" : `^${path.replace(\n      /\\/\\*$|([.\\\\+*[^\\]$()])/g,\n      (_, metaChar) => metaChar ? `\\\\${metaChar}` : \"(?:|/.*)\"\n    )}$`\n  );\n}\nfunction clearWildcardRegExpCache() {\n  wildcardRegExpCache = /* @__PURE__ */ Object.create(null);\n}\nfunction buildMatcherFromPreprocessedRoutes(routes) {\n  const trie = new Trie();\n  const handlerData = [];\n  if (routes.length === 0) {\n    return nullMatcher;\n  }\n  const routesWithStaticPathFlag = routes.map(\n    (route) => [!/\\*|\\/:/.test(route[0]), ...route]\n  ).sort(\n    ([isStaticA, pathA], [isStaticB, pathB]) => isStaticA ? 1 : isStaticB ? -1 : pathA.length - pathB.length\n  );\n  const staticMap = /* @__PURE__ */ Object.create(null);\n  for (let i = 0, j = -1, len = routesWithStaticPathFlag.length; i < len; i++) {\n    const [pathErrorCheckOnly, path, handlers] = routesWithStaticPathFlag[i];\n    if (pathErrorCheckOnly) {\n      staticMap[path] = [handlers.map(([h]) => [h, /* @__PURE__ */ Object.create(null)]), emptyParam];\n    } else {\n      j++;\n    }\n    let paramAssoc;\n    try {\n      paramAssoc = trie.insert(path, j, pathErrorCheckOnly);\n    } catch (e) {\n      throw e === PATH_ERROR ? new UnsupportedPathError(path) : e;\n    }\n    if (pathErrorCheckOnly) {\n      continue;\n    }\n    handlerData[j] = handlers.map(([h, paramCount]) => {\n      const paramIndexMap = /* @__PURE__ */ Object.create(null);\n      paramCount -= 1;\n      for (; paramCount >= 0; paramCount--) {\n        const [key, value] = paramAssoc[paramCount];\n        paramIndexMap[key] = value;\n      }\n      return [h, paramIndexMap];\n    });\n  }\n  const [regexp, indexReplacementMap, paramReplacementMap] = trie.buildRegExp();\n  for (let i = 0, len = handlerData.length; i < len; i++) {\n    for (let j = 0, len2 = handlerData[i].length; j < len2; j++) {\n      const map = handlerData[i][j]?.[1];\n      if (!map) {\n        continue;\n      }\n      const keys = Object.keys(map);\n      for (let k = 0, len3 = keys.length; k < len3; k++) {\n        map[keys[k]] = paramReplacementMap[map[keys[k]]];\n      }\n    }\n  }\n  const handlerMap = [];\n  for (const i in indexReplacementMap) {\n    handlerMap[i] = handlerData[indexReplacementMap[i]];\n  }\n  return [regexp, handlerMap, staticMap];\n}\nfunction findMiddleware(middleware, path) {\n  if (!middleware) {\n    return void 0;\n  }\n  for (const k of Object.keys(middleware).sort((a, b) => b.length - a.length)) {\n    if (buildWildcardRegExp(k).test(path)) {\n      return [...middleware[k]];\n    }\n  }\n  return void 0;\n}\nvar RegExpRouter = class {\n  name = \"RegExpRouter\";\n  #middleware;\n  #routes;\n  constructor() {\n    this.#middleware = { [METHOD_NAME_ALL]: /* @__PURE__ */ Object.create(null) };\n    this.#routes = { [METHOD_NAME_ALL]: /* @__PURE__ */ Object.create(null) };\n  }\n  add(method, path, handler) {\n    const middleware = this.#middleware;\n    const routes = this.#routes;\n    if (!middleware || !routes) {\n      throw new Error(MESSAGE_MATCHER_IS_ALREADY_BUILT);\n    }\n    if (!middleware[method]) {\n      ;\n      [middleware, routes].forEach((handlerMap) => {\n        handlerMap[method] = /* @__PURE__ */ Object.create(null);\n        Object.keys(handlerMap[METHOD_NAME_ALL]).forEach((p) => {\n          handlerMap[method][p] = [...handlerMap[METHOD_NAME_ALL][p]];\n        });\n      });\n    }\n    if (path === \"/*\") {\n      path = \"*\";\n    }\n    const paramCount = (path.match(/\\/:/g) || []).length;\n    if (/\\*$/.test(path)) {\n      const re = buildWildcardRegExp(path);\n      if (method === METHOD_NAME_ALL) {\n        Object.keys(middleware).forEach((m) => {\n          middleware[m][path] ||= findMiddleware(middleware[m], path) || findMiddleware(middleware[METHOD_NAME_ALL], path) || [];\n        });\n      } else {\n        middleware[method][path] ||= findMiddleware(middleware[method], path) || findMiddleware(middleware[METHOD_NAME_ALL], path) || [];\n      }\n      Object.keys(middleware).forEach((m) => {\n        if (method === METHOD_NAME_ALL || method === m) {\n          Object.keys(middleware[m]).forEach((p) => {\n            re.test(p) && middleware[m][p].push([handler, paramCount]);\n          });\n        }\n      });\n      Object.keys(routes).forEach((m) => {\n        if (method === METHOD_NAME_ALL || method === m) {\n          Object.keys(routes[m]).forEach(\n            (p) => re.test(p) && routes[m][p].push([handler, paramCount])\n          );\n        }\n      });\n      return;\n    }\n    const paths = checkOptionalParameter(path) || [path];\n    for (let i = 0, len = paths.length; i < len; i++) {\n      const path2 = paths[i];\n      Object.keys(routes).forEach((m) => {\n        if (method === METHOD_NAME_ALL || method === m) {\n          routes[m][path2] ||= [\n            ...findMiddleware(middleware[m], path2) || findMiddleware(middleware[METHOD_NAME_ALL], path2) || []\n          ];\n          routes[m][path2].push([handler, paramCount - len + i + 1]);\n        }\n      });\n    }\n  }\n  match = match;\n  buildAllMatchers() {\n    const matchers = /* @__PURE__ */ Object.create(null);\n    Object.keys(this.#routes).concat(Object.keys(this.#middleware)).forEach((method) => {\n      matchers[method] ||= this.#buildMatcher(method);\n    });\n    this.#middleware = this.#routes = void 0;\n    clearWildcardRegExpCache();\n    return matchers;\n  }\n  #buildMatcher(method) {\n    const routes = [];\n    let hasOwnRoute = method === METHOD_NAME_ALL;\n    [this.#middleware, this.#routes].forEach((r) => {\n      const ownRoute = r[method] ? Object.keys(r[method]).map((path) => [path, r[method][path]]) : [];\n      if (ownRoute.length !== 0) {\n        hasOwnRoute ||= true;\n        routes.push(...ownRoute);\n      } else if (method !== METHOD_NAME_ALL) {\n        routes.push(\n          ...Object.keys(r[METHOD_NAME_ALL]).map((path) => [path, r[METHOD_NAME_ALL][path]])\n        );\n      }\n    });\n    if (!hasOwnRoute) {\n      return null;\n    } else {\n      return buildMatcherFromPreprocessedRoutes(routes);\n    }\n  }\n};\nexport {\n  RegExpRouter\n};\n", "// src/router/smart-router/router.ts\nimport { MESSAGE_MATCHER_IS_ALREADY_BUILT, UnsupportedPathError } from \"../../router.js\";\nvar SmartRouter = class {\n  name = \"SmartRouter\";\n  #routers = [];\n  #routes = [];\n  constructor(init) {\n    this.#routers = init.routers;\n  }\n  add(method, path, handler) {\n    if (!this.#routes) {\n      throw new Error(MESSAGE_MATCHER_IS_ALREADY_BUILT);\n    }\n    this.#routes.push([method, path, handler]);\n  }\n  match(method, path) {\n    if (!this.#routes) {\n      throw new Error(\"Fatal error\");\n    }\n    const routers = this.#routers;\n    const routes = this.#routes;\n    const len = routers.length;\n    let i = 0;\n    let res;\n    for (; i < len; i++) {\n      const router = routers[i];\n      try {\n        for (let i2 = 0, len2 = routes.length; i2 < len2; i2++) {\n          router.add(...routes[i2]);\n        }\n        res = router.match(method, path);\n      } catch (e) {\n        if (e instanceof UnsupportedPathError) {\n          continue;\n        }\n        throw e;\n      }\n      this.match = router.match.bind(router);\n      this.#routers = [router];\n      this.#routes = void 0;\n      break;\n    }\n    if (i === len) {\n      throw new Error(\"Fatal error\");\n    }\n    this.name = `SmartRouter + ${this.activeRouter.name}`;\n    return res;\n  }\n  get activeRouter() {\n    if (this.#routes || this.#routers.length !== 1) {\n      throw new Error(\"No active router has been determined yet.\");\n    }\n    return this.#routers[0];\n  }\n};\nexport {\n  SmartRouter\n};\n", "// src/router/trie-router/node.ts\nimport { METHOD_NAME_ALL } from \"../../router.js\";\nimport { getPattern, splitPath, splitRoutingPath } from \"../../utils/url.js\";\nvar emptyParams = /* @__PURE__ */ Object.create(null);\nvar Node = class {\n  #methods;\n  #children;\n  #patterns;\n  #order = 0;\n  #params = emptyParams;\n  constructor(method, handler, children) {\n    this.#children = children || /* @__PURE__ */ Object.create(null);\n    this.#methods = [];\n    if (method && handler) {\n      const m = /* @__PURE__ */ Object.create(null);\n      m[method] = { handler, possibleKeys: [], score: 0 };\n      this.#methods = [m];\n    }\n    this.#patterns = [];\n  }\n  insert(method, path, handler) {\n    this.#order = ++this.#order;\n    let curNode = this;\n    const parts = splitRoutingPath(path);\n    const possibleKeys = [];\n    for (let i = 0, len = parts.length; i < len; i++) {\n      const p = parts[i];\n      const nextP = parts[i + 1];\n      const pattern = getPattern(p, nextP);\n      const key = Array.isArray(pattern) ? pattern[0] : p;\n      if (key in curNode.#children) {\n        curNode = curNode.#children[key];\n        if (pattern) {\n          possibleKeys.push(pattern[1]);\n        }\n        continue;\n      }\n      curNode.#children[key] = new Node();\n      if (pattern) {\n        curNode.#patterns.push(pattern);\n        possibleKeys.push(pattern[1]);\n      }\n      curNode = curNode.#children[key];\n    }\n    curNode.#methods.push({\n      [method]: {\n        handler,\n        possibleKeys: possibleKeys.filter((v, i, a) => a.indexOf(v) === i),\n        score: this.#order\n      }\n    });\n    return curNode;\n  }\n  #getHandlerSets(node, method, nodeParams, params) {\n    const handlerSets = [];\n    for (let i = 0, len = node.#methods.length; i < len; i++) {\n      const m = node.#methods[i];\n      const handlerSet = m[method] || m[METHOD_NAME_ALL];\n      const processedSet = {};\n      if (handlerSet !== void 0) {\n        handlerSet.params = /* @__PURE__ */ Object.create(null);\n        handlerSets.push(handlerSet);\n        if (nodeParams !== emptyParams || params && params !== emptyParams) {\n          for (let i2 = 0, len2 = handlerSet.possibleKeys.length; i2 < len2; i2++) {\n            const key = handlerSet.possibleKeys[i2];\n            const processed = processedSet[handlerSet.score];\n            handlerSet.params[key] = params?.[key] && !processed ? params[key] : nodeParams[key] ?? params?.[key];\n            processedSet[handlerSet.score] = true;\n          }\n        }\n      }\n    }\n    return handlerSets;\n  }\n  search(method, path) {\n    const handlerSets = [];\n    this.#params = emptyParams;\n    const curNode = this;\n    let curNodes = [curNode];\n    const parts = splitPath(path);\n    const curNodesQueue = [];\n    for (let i = 0, len = parts.length; i < len; i++) {\n      const part = parts[i];\n      const isLast = i === len - 1;\n      const tempNodes = [];\n      for (let j = 0, len2 = curNodes.length; j < len2; j++) {\n        const node = curNodes[j];\n        const nextNode = node.#children[part];\n        if (nextNode) {\n          nextNode.#params = node.#params;\n          if (isLast) {\n            if (nextNode.#children[\"*\"]) {\n              handlerSets.push(\n                ...this.#getHandlerSets(nextNode.#children[\"*\"], method, node.#params)\n              );\n            }\n            handlerSets.push(...this.#getHandlerSets(nextNode, method, node.#params));\n          } else {\n            tempNodes.push(nextNode);\n          }\n        }\n        for (let k = 0, len3 = node.#patterns.length; k < len3; k++) {\n          const pattern = node.#patterns[k];\n          const params = node.#params === emptyParams ? {} : { ...node.#params };\n          if (pattern === \"*\") {\n            const astNode = node.#children[\"*\"];\n            if (astNode) {\n              handlerSets.push(...this.#getHandlerSets(astNode, method, node.#params));\n              astNode.#params = params;\n              tempNodes.push(astNode);\n            }\n            continue;\n          }\n          const [key, name, matcher] = pattern;\n          if (!part && !(matcher instanceof RegExp)) {\n            continue;\n          }\n          const child = node.#children[key];\n          const restPathString = parts.slice(i).join(\"/\");\n          if (matcher instanceof RegExp) {\n            const m = matcher.exec(restPathString);\n            if (m) {\n              params[name] = m[0];\n              handlerSets.push(...this.#getHandlerSets(child, method, node.#params, params));\n              if (Object.keys(child.#children).length) {\n                child.#params = params;\n                const componentCount = m[0].match(/\\//)?.length ?? 0;\n                const targetCurNodes = curNodesQueue[componentCount] ||= [];\n                targetCurNodes.push(child);\n              }\n              continue;\n            }\n          }\n          if (matcher === true || matcher.test(part)) {\n            params[name] = part;\n            if (isLast) {\n              handlerSets.push(...this.#getHandlerSets(child, method, params, node.#params));\n              if (child.#children[\"*\"]) {\n                handlerSets.push(\n                  ...this.#getHandlerSets(child.#children[\"*\"], method, params, node.#params)\n                );\n              }\n            } else {\n              child.#params = params;\n              tempNodes.push(child);\n            }\n          }\n        }\n      }\n      curNodes = tempNodes.concat(curNodesQueue.shift() ?? []);\n    }\n    if (handlerSets.length > 1) {\n      handlerSets.sort((a, b) => {\n        return a.score - b.score;\n      });\n    }\n    return [handlerSets.map(({ handler, params }) => [handler, params])];\n  }\n};\nexport {\n  Node\n};\n", "// src/router/trie-router/router.ts\nimport { checkOptionalParameter } from \"../../utils/url.js\";\nimport { Node } from \"./node.js\";\nvar TrieRouter = class {\n  name = \"TrieRouter\";\n  #node;\n  constructor() {\n    this.#node = new Node();\n  }\n  add(method, path, handler) {\n    const results = checkOptionalParameter(path);\n    if (results) {\n      for (let i = 0, len = results.length; i < len; i++) {\n        this.#node.insert(method, results[i], handler);\n      }\n      return;\n    }\n    this.#node.insert(method, path, handler);\n  }\n  match(method, path) {\n    return this.#node.search(method, path);\n  }\n};\nexport {\n  TrieRouter\n};\n", "// src/hono.ts\nimport { HonoBase } from \"./hono-base.js\";\nimport { RegExpRouter } from \"./router/reg-exp-router/index.js\";\nimport { SmartRouter } from \"./router/smart-router/index.js\";\nimport { TrieRouter } from \"./router/trie-router/index.js\";\nvar Hono = class extends HonoBase {\n  constructor(options = {}) {\n    super(options);\n    this.router = options.router ?? new SmartRouter({\n      routers: [new RegExpRouter(), new TrieRouter()]\n    });\n  }\n};\nexport {\n  Hono\n};\n", "import { Hono } from 'hono'\r\nimport bcrypt from 'bcryptjs'\r\n\r\n// Replace generic cors with strict configurable CORS + debug logging\r\nconst app = new Hono()\r\napp.use('*', async (c, next) => {\r\n  const allowed = (c.env.ALLOWED_ORIGIN || '').split(',').map(s=>s.trim()).filter(Boolean)\r\n  const origin = c.req.header('Origin')\r\n  const debugMode = ['1','true','yes'].includes(String(c.req.query('debug') || c.env.DEBUG || '').toLowerCase())\r\n  const allowOrigin = (origin && allowed.includes(origin)) ? origin : ''\r\n  if (allowOrigin) c.res.headers.set('Access-Control-Allow-Origin', allowOrigin)\r\n  c.res.headers.set('Vary','Origin')\r\n  c.res.headers.set('Access-Control-Allow-Headers','Content-Type, Idempotency-Key, X-Session-Token, X-Admin-Key')\r\n  c.res.headers.set('Access-Control-Allow-Methods','GET,POST,PUT,DELETE,OPTIONS')\r\n  if (debugMode) {\r\n    try { console.log('CORS', { origin, allowOrigin, allowed }) } catch {}\r\n    c.res.headers.set('X-Debug-Origin', origin || '')\r\n    c.res.headers.set('X-Debug-Allow', allowOrigin || '')\r\n  }\r\n  if (c.req.method === 'OPTIONS') return new Response('', { headers: c.res.headers })\r\n  await next()\r\n})\r\n\r\n// Helpers\r\nconst addMonths = (date, months) => {\r\n  const d = new Date(date)\r\n  const day = d.getUTCDate()\r\n  const target = new Date(Date.UTC(d.getUTCFullYear(), d.getUTCMonth() + months + 1, 0))\r\n  const clampedDay = Math.min(day, target.getUTCDate())\r\n  return new Date(Date.UTC(d.getUTCFullYear(), d.getUTCMonth() + months, clampedDay, d.getUTCHours(), d.getUTCMinutes(), d.getUTCSeconds()))\r\n}\r\n\r\nconst toIso = (d) => new Date(d).toISOString()\r\n\r\n// --- Schema compatibility helpers (users/user_id vs members/member_id) ---\r\nlet __schemaCache\r\nasync function getSchema(db){\r\n  if (__schemaCache) return __schemaCache\r\n  // Detect memberships FK column (prefer user_id if present, else member_id)\r\n  const mcols = await db.prepare('PRAGMA table_info(memberships)').all().catch(()=>({ results: [] }))\r\n  const mnames = new Set((mcols?.results||[]).map(c => String(c.name||'').toLowerCase()))\r\n  const fkColumn = mnames.has('user_id') ? 'user_id' : (mnames.has('member_id') ? 'member_id' : 'user_id')\r\n  // Identity is consolidated to users\r\n  const identityTable = 'users'\r\n  // Detect id column in users (user_id vs id)\r\n  let idColumn = 'user_id'\r\n  try {\r\n    const ic = await db.prepare('PRAGMA table_info(users)').all().catch(()=>({ results: [] }))\r\n    const inames = new Set((ic?.results||[]).map(r => String(r.name||'').toLowerCase()))\r\n    if (inames.has('user_id')) idColumn = 'user_id'\r\n    else if (inames.has('id')) idColumn = 'id'\r\n    else {\r\n      const pk = (ic?.results||[]).find(r => r.pk === 1)\r\n      if (pk && pk.name) idColumn = String(pk.name)\r\n    }\r\n  } catch {}\r\n  __schemaCache = { fkColumn, identityTable, idColumn }\r\n  return __schemaCache\r\n}\r\n\r\nasync function ensureSchema(db, fkColumn){\r\n  // memberships columns only (assume tickets already has user_id from migrations)\r\n  try {\r\n    const mc = await db.prepare('PRAGMA table_info(memberships)').all().catch(()=>({ results: [] }))\r\n    const mnames = new Set((mc?.results||[]).map(r => String(r.name||'').toLowerCase()))\r\n    const alter = []\r\n    if (!mnames.has('amount')) alter.push('ALTER TABLE memberships ADD COLUMN amount TEXT')\r\n    if (!mnames.has('currency')) alter.push('ALTER TABLE memberships ADD COLUMN currency TEXT')\r\n    if (!mnames.has('consent_at')) alter.push('ALTER TABLE memberships ADD COLUMN consent_at TEXT')\r\n    if (!mnames.has('idempotency_key')) alter.push('ALTER TABLE memberships ADD COLUMN idempotency_key TEXT')\r\n    if (!mnames.has('payment_status')) alter.push('ALTER TABLE memberships ADD COLUMN payment_status TEXT')\r\n    if (!mnames.has('payment_instrument_id')) alter.push('ALTER TABLE memberships ADD COLUMN payment_instrument_id TEXT')\r\n    if (!mnames.has('renewal_failed_at')) alter.push('ALTER TABLE memberships ADD COLUMN renewal_failed_at TEXT')\r\n    if (!mnames.has('renewal_attempts')) alter.push('ALTER TABLE memberships ADD COLUMN renewal_attempts INTEGER DEFAULT 0')\r\n    if (!mnames.has('renewal_warning_sent')) alter.push('ALTER TABLE memberships ADD COLUMN renewal_warning_sent INTEGER DEFAULT 0')\r\n    for (const sql of alter) { await db.prepare(sql).run().catch(()=>{}) }\r\n  } catch {}\r\n  // tickets columns (post consolidation, expect user_id)\r\n  try {\r\n    const tc = await db.prepare('PRAGMA table_info(tickets)').all().catch(()=>({ results: [] }))\r\n    const tnames = new Set((tc?.results||[]).map(r => String(r.name||'').toLowerCase()))\r\n    const talter = []\r\n    if (!tnames.has('amount')) talter.push('ALTER TABLE tickets ADD COLUMN amount TEXT')\r\n    if (!tnames.has('currency')) talter.push('ALTER TABLE tickets ADD COLUMN currency TEXT')\r\n    if (!tnames.has('consent_at')) talter.push('ALTER TABLE tickets ADD COLUMN consent_at TEXT')\r\n    if (!tnames.has('idempotency_key')) talter.push('ALTER TABLE tickets ADD COLUMN idempotency_key TEXT')\r\n    if (!tnames.has('payment_status')) talter.push('ALTER TABLE tickets ADD COLUMN payment_status TEXT')\r\n    if (!tnames.has('created_at')) talter.push('ALTER TABLE tickets ADD COLUMN created_at TEXT')\r\n    for (const sql of talter) { await db.prepare(sql).run().catch(()=>{}) }\r\n  } catch {}\r\n  // Create payment_instruments table if not exists\r\n  try {\r\n    await db.prepare(`\r\n      CREATE TABLE IF NOT EXISTS payment_instruments (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        user_id INTEGER NOT NULL,\r\n        instrument_id TEXT NOT NULL,\r\n        card_type TEXT,\r\n        last_4 TEXT,\r\n        expiry_month INTEGER,\r\n        expiry_year INTEGER,\r\n        created_at TEXT NOT NULL,\r\n        updated_at TEXT NOT NULL,\r\n        is_active INTEGER DEFAULT 1,\r\n        UNIQUE(user_id, instrument_id)\r\n      )\r\n    `).run().catch(()=>{})\r\n  } catch {}\r\n  // Create renewal_log table for tracking renewal attempts\r\n  try {\r\n    await db.prepare(`\r\n      CREATE TABLE IF NOT EXISTS renewal_log (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        membership_id INTEGER NOT NULL,\r\n        attempt_date TEXT NOT NULL,\r\n        status TEXT NOT NULL,\r\n        payment_id TEXT,\r\n        error_message TEXT,\r\n        amount TEXT,\r\n        currency TEXT\r\n      )\r\n    `).run().catch(()=>{})\r\n  } catch {}\r\n  // Create transactions table for all payment records\r\n  try {\r\n    await db.prepare(`\r\n      CREATE TABLE IF NOT EXISTS transactions (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        transaction_type TEXT NOT NULL,\r\n        reference_id INTEGER,\r\n        user_id INTEGER,\r\n        email TEXT,\r\n        name TEXT,\r\n        order_ref TEXT UNIQUE,\r\n        checkout_id TEXT,\r\n        payment_id TEXT,\r\n        amount TEXT,\r\n        currency TEXT,\r\n        payment_status TEXT,\r\n        idempotency_key TEXT,\r\n        consent_at TEXT,\r\n        created_at TEXT NOT NULL DEFAULT (strftime('%Y-%m-%dT%H:%M:%fZ','now')),\r\n        updated_at TEXT\r\n      )\r\n    `).run().catch(()=>{})\r\n  } catch {}\r\n  \r\n  // Create products table for shop items\r\n  try {\r\n    await db.prepare(`\r\n      CREATE TABLE IF NOT EXISTS products (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        name TEXT NOT NULL,\r\n        slug TEXT UNIQUE NOT NULL,\r\n        description TEXT,\r\n        price INTEGER NOT NULL,\r\n        currency TEXT DEFAULT 'GBP',\r\n        stock_quantity INTEGER DEFAULT 0,\r\n        image_url TEXT,\r\n        category TEXT,\r\n        is_active INTEGER DEFAULT 1,\r\n        created_at TEXT NOT NULL DEFAULT (strftime('%Y-%m-%dT%H:%M:%fZ','now')),\r\n        updated_at TEXT NOT NULL DEFAULT (strftime('%Y-%m-%dT%H:%M:%fZ','now'))\r\n      )\r\n    `).run().catch(()=>{})\r\n  } catch {}\r\n  \r\n  // Create orders table for shop purchases\r\n  try {\r\n    await db.prepare(`\r\n      CREATE TABLE IF NOT EXISTS orders (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        order_number TEXT UNIQUE NOT NULL,\r\n        user_id INTEGER,\r\n        email TEXT NOT NULL,\r\n        name TEXT NOT NULL,\r\n        status TEXT DEFAULT 'pending',\r\n        subtotal INTEGER NOT NULL,\r\n        tax INTEGER DEFAULT 0,\r\n        shipping INTEGER DEFAULT 0,\r\n        total INTEGER NOT NULL,\r\n        currency TEXT DEFAULT 'GBP',\r\n        checkout_id TEXT,\r\n        payment_id TEXT,\r\n        payment_status TEXT,\r\n        shipping_address TEXT,\r\n        billing_address TEXT,\r\n        notes TEXT,\r\n        created_at TEXT NOT NULL DEFAULT (strftime('%Y-%m-%dT%H:%M:%fZ','now')),\r\n        updated_at TEXT NOT NULL DEFAULT (strftime('%Y-%m-%dT%H:%M:%fZ','now')),\r\n        completed_at TEXT\r\n      )\r\n    `).run().catch(()=>{})\r\n  } catch {}\r\n  \r\n  // Create order_items table for items in each order\r\n  try {\r\n    await db.prepare(`\r\n      CREATE TABLE IF NOT EXISTS order_items (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        order_id INTEGER NOT NULL,\r\n        product_id INTEGER NOT NULL,\r\n        product_name TEXT NOT NULL,\r\n        quantity INTEGER NOT NULL,\r\n        unit_price INTEGER NOT NULL,\r\n        subtotal INTEGER NOT NULL,\r\n        FOREIGN KEY (order_id) REFERENCES orders(id),\r\n        FOREIGN KEY (product_id) REFERENCES products(id)\r\n      )\r\n    `).run().catch(()=>{})\r\n  } catch {}\r\n  \r\n  // Create cart_items table for temporary shopping carts\r\n  try {\r\n    await db.prepare(`\r\n      CREATE TABLE IF NOT EXISTS cart_items (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        session_id TEXT NOT NULL,\r\n        product_id INTEGER NOT NULL,\r\n        quantity INTEGER NOT NULL DEFAULT 1,\r\n        created_at TEXT NOT NULL DEFAULT (strftime('%Y-%m-%dT%H:%M:%fZ','now')),\r\n        updated_at TEXT NOT NULL DEFAULT (strftime('%Y-%m-%dT%H:%M:%fZ','now')),\r\n        UNIQUE(session_id, product_id),\r\n        FOREIGN KEY (product_id) REFERENCES products(id)\r\n      )\r\n    `).run().catch(()=>{})\r\n  } catch {}\r\n}\r\n\r\n// One-time migration: copy payment data from memberships/tickets to transactions\r\nasync function migrateToTransactions(db) {\r\n  try {\r\n    // Check if migration already ran\r\n    const check = await db.prepare('SELECT COUNT(*) as count FROM transactions').first()\r\n    if (check && check.count > 0) {\r\n      console.log('Transactions table already has data, skipping migration')\r\n      return\r\n    }\r\n    \r\n    console.log('Starting migration to transactions table...')\r\n    \r\n    // Migrate memberships\r\n    const memberships = await db.prepare(`\r\n      SELECT id, user_id, email, name, order_ref, checkout_id, payment_id, amount, currency, \r\n             payment_status, idempotency_key, consent_at, created_at\r\n      FROM memberships\r\n      WHERE order_ref IS NOT NULL OR checkout_id IS NOT NULL\r\n    `).all()\r\n    \r\n    for (const m of (memberships.results || [])) {\r\n      await db.prepare(`\r\n        INSERT INTO transactions (transaction_type, reference_id, user_id, email, name, order_ref, \r\n                                  checkout_id, payment_id, amount, currency, payment_status, \r\n                                  idempotency_key, consent_at, created_at)\r\n        VALUES ('membership', ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\r\n      `).bind(\r\n        m.id, m.user_id, m.email, m.name, m.order_ref, m.checkout_id, m.payment_id,\r\n        m.amount, m.currency, m.payment_status, m.idempotency_key, m.consent_at,\r\n        m.created_at || toIso(new Date())\r\n      ).run().catch(e => console.error('Failed to migrate membership', m.id, e))\r\n    }\r\n    \r\n    // Migrate tickets\r\n    const tickets = await db.prepare(`\r\n      SELECT id, user_id, order_ref, checkout_id, payment_id, amount, currency,\r\n             payment_status, idempotency_key, consent_at, created_at\r\n      FROM tickets\r\n      WHERE order_ref IS NOT NULL OR checkout_id IS NOT NULL\r\n    `).all()\r\n    \r\n    for (const t of (tickets.results || [])) {\r\n      // Get email/name from user if available\r\n      let email = null, name = null\r\n      if (t.user_id) {\r\n        const user = await db.prepare('SELECT email, name FROM users WHERE user_id = ?').bind(t.user_id).first()\r\n        email = user?.email\r\n        name = user?.name\r\n      }\r\n      \r\n      await db.prepare(`\r\n        INSERT INTO transactions (transaction_type, reference_id, user_id, email, name, order_ref,\r\n                                  checkout_id, payment_id, amount, currency, payment_status,\r\n                                  idempotency_key, consent_at, created_at)\r\n        VALUES ('ticket', ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\r\n      `).bind(\r\n        t.id, t.user_id, email, name, t.order_ref, t.checkout_id, t.payment_id,\r\n        t.amount, t.currency, t.payment_status, t.idempotency_key, t.consent_at,\r\n        t.created_at || toIso(new Date())\r\n      ).run().catch(e => console.error('Failed to migrate ticket', t.id, e))\r\n    }\r\n    \r\n    console.log(`Migrated ${memberships.results?.length || 0} memberships and ${tickets.results?.length || 0} tickets to transactions`)\r\n  } catch (e) {\r\n    console.error('Migration to transactions failed:', e)\r\n  }\r\n}\r\n\r\nasync function findIdentityByEmail(db, email){\r\n  const s = await getSchema(db)\r\n  const row = await db.prepare(`SELECT * FROM ${s.identityTable} WHERE email = ?`).bind(email).first()\r\n  if (!row) return null\r\n  if (typeof row.id === 'undefined') row.id = row[s.idColumn]\r\n  return row\r\n}\r\n\r\nasync function getOrCreateIdentity(db, email, name){\r\n  const s = await getSchema(db)\r\n  let existing = await db.prepare(`SELECT * FROM ${s.identityTable} WHERE email = ?`).bind(email).first()\r\n  if (existing){ if (typeof existing.id === 'undefined') existing.id = existing[s.idColumn]; return existing }\r\n  await db.prepare(`INSERT INTO ${s.identityTable} (email, name) VALUES (?, ?)`).bind(email, name || null).run()\r\n  existing = await db.prepare(`SELECT * FROM ${s.identityTable} WHERE email = ?`).bind(email).first()\r\n  if (existing && typeof existing.id === 'undefined') existing.id = existing[s.idColumn]\r\n  return existing\r\n}\r\n\r\nasync function getActiveMembership(db, identityId) {\r\n  const now = new Date().toISOString()\r\n  // Detect available FK columns on memberships\r\n  const mc = await db.prepare('PRAGMA table_info(memberships)').all().catch(()=>({ results: [] }))\r\n  const mnames = new Set((mc?.results||[]).map(r => String(r.name||'').toLowerCase()))\r\n  let where = '', binds = []\r\n  if (mnames.has('user_id') && mnames.has('member_id')) {\r\n    where = '(user_id = ? OR member_id = ?)'\r\n    binds = [identityId, identityId, now]\r\n  } else if (mnames.has('user_id')) {\r\n    where = 'user_id = ?'\r\n    binds = [identityId, now]\r\n  } else {\r\n    where = 'member_id = ?'\r\n    binds = [identityId, now]\r\n  }\r\n  return await db.prepare(`SELECT * FROM memberships WHERE ${where} AND status = \"active\" AND end_date >= ? ORDER BY end_date DESC LIMIT 1`).bind(...binds).first()\r\n}\r\n\r\n// Fetch pricing/details for a plan from the services table\r\nasync function getServiceForPlan(db, planCode) {\r\n  return await db.prepare('SELECT * FROM services WHERE code = ? AND active = 1 LIMIT 1').bind(planCode).first()\r\n}\r\n\r\n// Obtain SumUp OAuth token to verify payments server-side\r\nasync function sumupToken(env, scopes = 'payments') {\r\n  const body = new URLSearchParams({ grant_type: 'client_credentials', client_id: env.SUMUP_CLIENT_ID, client_secret: env.SUMUP_CLIENT_SECRET, scope: scopes })\r\n  const res = await fetch('https://api.sumup.com/token', { method: 'POST', headers: { 'Content-Type': 'application/x-www-form-urlencoded' }, body })\r\n  if (!res.ok) { const txt = await res.text().catch(()=>{}); throw new Error(`Failed to get SumUp token (${res.status}): ${txt}`) }\r\n  const json = await res.json(); \r\n  const granted = (json.scope||'').split(/\\s+/).filter(Boolean)\r\n  const required = scopes.split(/\\s+/).filter(Boolean)\r\n  const missing = required.filter(s => !granted.includes(s))\r\n  if (missing.length > 0) { throw new Error(`SumUp OAuth token missing required scopes: ${missing.join(', ')} (granted: [${granted.join(', ')}])`) }\r\n  return json\r\n}\r\n\r\n// Create or get SumUp customer for a user\r\nasync function getOrCreateSumUpCustomer(env, user) {\r\n  console.log('getOrCreateSumUpCustomer called with user:', JSON.stringify(user))\r\n  const { access_token } = await sumupToken(env, 'payments payment_instruments')\r\n  const userId = user.user_id || user.id\r\n  console.log('Resolved userId:', userId, 'from user.user_id:', user.user_id, 'or user.id:', user.id)\r\n  const customerId = `USER-${userId}`\r\n  console.log('Customer ID to use:', customerId)\r\n  \r\n  // Try to get existing customer first\r\n  const getRes = await fetch(`https://api.sumup.com/v0.1/customers/${customerId}`, {\r\n    headers: { \r\n      'Authorization': `Bearer ${access_token}`,\r\n      'Content-Type': 'application/json'\r\n    }\r\n  })\r\n  \r\n  if (getRes.ok) {\r\n    const customer = await getRes.json()\r\n    console.log('Found existing SumUp customer:', customerId)\r\n    return customer.customer_id\r\n  }\r\n  \r\n  // Customer doesn't exist, create new one\r\n  console.log('Creating new SumUp customer:', customerId)\r\n  const createRes = await fetch('https://api.sumup.com/v0.1/customers', {\r\n    method: 'POST',\r\n    headers: {\r\n      'Authorization': `Bearer ${access_token}`,\r\n      'Content-Type': 'application/json'\r\n    },\r\n    body: JSON.stringify({\r\n      customer_id: customerId,\r\n      personal_details: {\r\n        email: user.email,\r\n        first_name: user.name ? user.name.split(' ')[0] : 'Customer',\r\n        last_name: user.name ? user.name.split(' ').slice(1).join(' ') || 'Member' : 'Member'\r\n      }\r\n    })\r\n  })\r\n  \r\n  if (!createRes.ok) {\r\n    const txt = await createRes.text()\r\n    console.error('Failed to create SumUp customer:', createRes.status, txt)\r\n    throw new Error(`Failed to create SumUp customer (${createRes.status}): ${txt}`)\r\n  }\r\n  \r\n  const customer = await createRes.json()\r\n  console.log('Created SumUp customer - Full response:', JSON.stringify(customer))\r\n  console.log('Returning customer_id:', customer.customer_id)\r\n  return customer.customer_id\r\n}\r\n\r\nasync function createCheckout(env, { amount, currency, orderRef, title, description, savePaymentInstrument = false, customerId = null }) {\r\n  const { access_token } = await sumupToken(env, savePaymentInstrument ? 'payments payment_instruments' : 'payments')\r\n  const body = { \r\n    amount: Number(amount), \r\n    currency, \r\n    checkout_reference: orderRef, \r\n    merchant_code: env.SUMUP_MERCHANT_CODE, \r\n    description: description || title\r\n  }\r\n  \r\n  // Add return_url if RETURN_URL is configured (for hosted checkout, not needed for widget)\r\n  if (env.RETURN_URL) {\r\n    try {\r\n      const returnUrl = new URL(env.RETURN_URL)\r\n      returnUrl.searchParams.set('orderRef', orderRef)\r\n      body.return_url = returnUrl.toString()\r\n    } catch (e) {\r\n      console.warn('Invalid RETURN_URL, skipping return_url in checkout:', e.message)\r\n    }\r\n  }\r\n  // Request card tokenization using SumUp's recurring payment flow\r\n  if (savePaymentInstrument && customerId) {\r\n    body.purpose = 'SETUP_RECURRING_PAYMENT'\r\n    body.customer_id = customerId\r\n  }\r\n  const res = await fetch('https://api.sumup.com/v0.1/checkouts', { method: 'POST', headers: { 'Authorization': `Bearer ${access_token}`, 'Content-Type': 'application/json' }, body: JSON.stringify(body) })\r\n  if (!res.ok) { const txt = await res.text(); throw new Error(`Create checkout failed: ${txt}`) }\r\n  const json = await res.json()\r\n  if (!json || !json.id) throw new Error('missing_checkout_id')\r\n  return json\r\n}\r\n\r\nasync function fetchPayment(env, paymentId) {\r\n  const { access_token } = await sumupToken(env, 'payments')\r\n  const res = await fetch(`https://api.sumup.com/v0.1/checkouts/${paymentId}`, { headers: { Authorization: `Bearer ${access_token}` } })\r\n  if (!res.ok) throw new Error('Failed to fetch payment')\r\n  return res.json()\r\n}\r\n\r\n// Save payment instrument from a successful payment\r\nasync function savePaymentInstrument(db, userId, checkoutId, env) {\r\n  try {\r\n    const { access_token } = await sumupToken(env, 'payments payment_instruments')\r\n    \r\n    // Get the checkout details\r\n    const checkoutRes = await fetch(`https://api.sumup.com/v0.1/checkouts/${checkoutId}`, {\r\n      headers: { Authorization: `Bearer ${access_token}` }\r\n    })\r\n    if (!checkoutRes.ok) {\r\n      console.error('Failed to fetch checkout:', checkoutRes.status, await checkoutRes.text())\r\n      return null\r\n    }\r\n    const checkout = await checkoutRes.json()\r\n    console.log('Checkout response for tokenization:', JSON.stringify(checkout))\r\n    \r\n    // With purpose=SETUP_RECURRING_PAYMENT, the payment_instrument should be in the response\r\n    if (checkout.payment_instrument) {\r\n      const instrument = checkout.payment_instrument\r\n      console.log('Found payment_instrument:', JSON.stringify(instrument))\r\n      \r\n      const now = toIso(new Date())\r\n      const instrumentId = instrument.token || instrument.id\r\n      \r\n      if (!instrumentId) {\r\n        console.error('Payment instrument missing token/id')\r\n        return null\r\n      }\r\n      \r\n      // Deactivate old instruments\r\n      await db.prepare('UPDATE payment_instruments SET is_active = 0 WHERE user_id = ?').bind(userId).run()\r\n      \r\n      // Save new instrument\r\n      await db.prepare(`\r\n        INSERT INTO payment_instruments (user_id, instrument_id, card_type, last_4, expiry_month, expiry_year, created_at, updated_at, is_active)\r\n        VALUES (?, ?, ?, ?, ?, ?, ?, ?, 1)\r\n        ON CONFLICT(user_id, instrument_id) DO UPDATE SET is_active = 1, updated_at = ?\r\n      `).bind(\r\n        userId,\r\n        instrumentId,\r\n        instrument.type || instrument.card_type || null,\r\n        instrument.last_4_digits || instrument.last_4 || null,\r\n        instrument.expiry_month || null,\r\n        instrument.expiry_year || null,\r\n        now,\r\n        now,\r\n        now\r\n      ).run()\r\n      \r\n      console.log('Successfully saved payment instrument:', instrumentId)\r\n      return instrumentId\r\n    }\r\n    \r\n    console.warn('No payment_instrument found in checkout response')\r\n    console.warn('Ensure purpose=SETUP_RECURRING_PAYMENT and customer_id were set in checkout creation')\r\n    return null\r\n  } catch (e) {\r\n    console.error('Failed to save payment instrument:', e)\r\n    return null\r\n  }\r\n}\r\n\r\n// Charge a saved payment instrument\r\nasync function chargePaymentInstrument(env, userId, instrumentId, amount, currency, orderRef, description) {\r\n  try {\r\n    const { access_token } = await sumupToken(env, 'payments payment_instruments')\r\n    \r\n    // Verify customer exists in SumUp Customer API\r\n    const customerId = `USER-${userId}`\r\n    const customerCheckRes = await fetch(`https://api.sumup.com/v0.1/customers/${customerId}`, {\r\n      headers: {\r\n        'Authorization': `Bearer ${access_token}`,\r\n        'Content-Type': 'application/json'\r\n      }\r\n    })\r\n    \r\n    if (!customerCheckRes.ok) {\r\n      console.error(`Customer ${customerId} not found in SumUp Customer API`)\r\n      throw new Error(`Customer ${customerId} does not exist. Cannot process recurring payment.`)\r\n    }\r\n    \r\n    // Create checkout\r\n    const checkoutBody = {\r\n      amount: Number(amount),\r\n      currency,\r\n      checkout_reference: orderRef,\r\n      merchant_code: env.SUMUP_MERCHANT_CODE,\r\n      description\r\n    }\r\n    \r\n    const checkoutRes = await fetch('https://api.sumup.com/v0.1/checkouts', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${access_token}`,\r\n        'Content-Type': 'application/json'\r\n      },\r\n      body: JSON.stringify(checkoutBody)\r\n    })\r\n    \r\n    if (!checkoutRes.ok) {\r\n      const txt = await checkoutRes.text()\r\n      throw new Error(`Checkout creation failed: ${txt}`)\r\n    }\r\n    \r\n    const checkout = await checkoutRes.json()\r\n    console.log('Created checkout for renewal:', checkout.id)\r\n    \r\n    // Process payment with the saved token\r\n    // Per SumUp documentation: Both token and customer_id fields are required for recurring payments\r\n    // The customer_id must match the customer that was used during SETUP_RECURRING_PAYMENT\r\n    const paymentBody = {\r\n      payment_type: 'card',\r\n      token: instrumentId,\r\n      customer_id: customerId\r\n    }\r\n    \r\n    const paymentRes = await fetch(`https://api.sumup.com/v0.1/checkouts/${checkout.id}`, {\r\n      method: 'PUT',\r\n      headers: {\r\n        'Authorization': `Bearer ${access_token}`,\r\n        'Content-Type': 'application/json'\r\n      },\r\n      body: JSON.stringify(paymentBody)\r\n    })\r\n    \r\n    if (!paymentRes.ok) {\r\n      const txt = await paymentRes.text()\r\n      throw new Error(`Payment processing failed: ${txt}`)\r\n    }\r\n    \r\n    const payment = await paymentRes.json()\r\n    console.log('Processed recurring payment:', payment.id, payment.status)\r\n    return payment\r\n  } catch (e) {\r\n    console.error('Charge payment instrument error:', e)\r\n    throw e\r\n  }\r\n}\r\n\r\n// Get active payment instrument for user\r\nasync function getActivePaymentInstrument(db, userId) {\r\n  return await db.prepare('SELECT * FROM payment_instruments WHERE user_id = ? AND is_active = 1 ORDER BY created_at DESC LIMIT 1')\r\n    .bind(userId).first()\r\n}\r\n\r\n// Process renewal for a single membership\r\nasync function processMembershipRenewal(db, membership, env) {\r\n  const s = await getSchema(db)\r\n  const userId = (typeof membership.user_id !== 'undefined' && membership.user_id !== null) ? membership.user_id : membership.member_id\r\n  \r\n  // Get payment instrument\r\n  const instrument = await getActivePaymentInstrument(db, userId)\r\n  if (!instrument) {\r\n    await db.prepare('UPDATE memberships SET renewal_failed_at = ?, renewal_attempts = renewal_attempts + 1 WHERE id = ?')\r\n      .bind(toIso(new Date()), membership.id).run()\r\n    await db.prepare('INSERT INTO renewal_log (membership_id, attempt_date, status, error_message) VALUES (?, ?, ?, ?)')\r\n      .bind(membership.id, toIso(new Date()), 'failed', 'No active payment instrument').run()\r\n    return { success: false, error: 'no_instrument' }\r\n  }\r\n  \r\n  // Get service details\r\n  const svc = await getServiceForPlan(db, membership.plan)\r\n  if (!svc) {\r\n    return { success: false, error: 'plan_not_found' }\r\n  }\r\n  \r\n  const amount = Number(svc.amount)\r\n  const currency = svc.currency || env.CURRENCY || 'GBP'\r\n  const orderRef = `RENEWAL-${membership.id}-${crypto.randomUUID()}`\r\n  \r\n  try {\r\n    // Charge the payment instrument\r\n    const payment = await chargePaymentInstrument(\r\n      env,\r\n      userId,\r\n      instrument.instrument_id,\r\n      amount,\r\n      currency,\r\n      orderRef,\r\n      `Renewal: Dice Bastion ${membership.plan} membership`\r\n    )\r\n    \r\n    // If successful, extend membership\r\n    if (payment && (payment.status === 'PAID' || payment.status === 'SUCCESSFUL')) {\r\n      const months = Number(svc.months || 0)\r\n      const currentEnd = new Date(membership.end_date)\r\n      const newEnd = addMonths(currentEnd, months)\r\n      \r\n      // Update membership\r\n      await db.prepare(`\r\n        UPDATE memberships \r\n        SET end_date = ?, \r\n            renewal_failed_at = NULL, \r\n            renewal_attempts = 0,\r\n            renewal_warning_sent = 0\r\n        WHERE id = ?\r\n      `).bind(toIso(newEnd), membership.id).run()\r\n      \r\n      // Create transaction record for renewal\r\n      const user = await db.prepare('SELECT email, name FROM users WHERE user_id = ?').bind(userId).first()\r\n      await db.prepare(`\r\n        INSERT INTO transactions (transaction_type, reference_id, user_id, email, name, order_ref,\r\n                                  payment_id, amount, currency, payment_status)\r\n        VALUES ('renewal', ?, ?, ?, ?, ?, ?, ?, ?, 'PAID')\r\n      `).bind(membership.id, userId, user?.email, user?.name, orderRef, payment.id, String(amount), currency).run()\r\n      \r\n      // Log renewal attempt\r\n      await db.prepare('INSERT INTO renewal_log (membership_id, attempt_date, status, payment_id, amount, currency) VALUES (?, ?, ?, ?, ?, ?)')\r\n        .bind(membership.id, toIso(new Date()), 'success', payment.id, String(amount), currency).run()\r\n      \r\n      // Send renewal success email\r\n      if (user) {\r\n        const emailContent = getRenewalSuccessEmail(membership, user, toIso(newEnd))\r\n        await sendEmail(env, { to: user.email, ...emailContent }).catch(err => {\r\n          console.error('Renewal success email error:', err)\r\n        })\r\n      }\r\n      \r\n      return { success: true, newEndDate: toIso(newEnd), paymentId: payment.id }\r\n    } else {\r\n      throw new Error(`Payment not successful: ${payment?.status || 'UNKNOWN'}`)\r\n    }\r\n  } catch (e) {\r\n    const currentAttempts = (membership.renewal_attempts || 0) + 1\r\n    \r\n    await db.prepare('UPDATE memberships SET renewal_failed_at = ?, renewal_attempts = ? WHERE id = ?')\r\n      .bind(toIso(new Date()), currentAttempts, membership.id).run()\r\n    await db.prepare('INSERT INTO renewal_log (membership_id, attempt_date, status, error_message, amount, currency) VALUES (?, ?, ?, ?, ?, ?)')\r\n      .bind(membership.id, toIso(new Date()), 'failed', String(e.message || e), String(amount), currency).run()\r\n    \r\n    // Get user for email notification\r\n    const user = await db.prepare('SELECT * FROM users WHERE user_id = ?').bind(userId).first()\r\n    \r\n    // If this is the 3rd failure, disable auto-renewal and send final notice\r\n    if (currentAttempts >= 3 && user) {\r\n      await db.prepare('UPDATE memberships SET auto_renew = 0 WHERE id = ?').bind(membership.id).run()\r\n      \r\n      const emailContent = getRenewalFailedFinalEmail(membership, user)\r\n      await sendEmail(env, { to: user.email, ...emailContent }).catch(err => {\r\n        console.error('Renewal final failure email error:', err)\r\n      })\r\n    } else if (user) {\r\n      // Send regular failure notification (attempts 1 or 2)\r\n      const emailContent = getRenewalFailedEmail(membership, user, currentAttempts)\r\n      await sendEmail(env, { to: user.email, ...emailContent }).catch(err => {\r\n        console.error('Renewal failed email error:', err)\r\n      })\r\n    }\r\n    \r\n    return { success: false, error: String(e.message || e), attempts: currentAttempts }\r\n  }\r\n}\r\n\r\n// Turnstile verification with optional debug logging\r\nasync function verifyTurnstile(env, token, ip, debug){\r\n  if (!env.TURNSTILE_SECRET) { if (debug) console.log('turnstile: secret missing -> bypass'); return true }\r\n  if (!token) { if (debug) console.log('turnstile: missing token'); return false }\r\n  const form = new URLSearchParams(); form.set('secret', env.TURNSTILE_SECRET); form.set('response', token); if (ip) form.set('remoteip', ip)\r\n  let res, j = {};\r\n  try {\r\n    res = await fetch('https://challenges.cloudflare.com/turnstile/v0/siteverify', { method:'POST', body: form })\r\n    j = await res.json().catch(()=>({}))\r\n  } catch (e) {\r\n    if (debug) console.log('turnstile: siteverify fetch error', String(e))\r\n    return false\r\n  }\r\n  if (debug) console.log('turnstile: siteverify', { status: res?.status, success: j?.['success'], errors: j?.['error-codes'], hostname: j?.hostname })\r\n  return !!j.success\r\n}\r\n\r\nconst EMAIL_RE = /^[^@\\s]+@[^@\\s]+\\.[^@\\s]+$/\r\nconst UUID_RE = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i\r\nconst EVT_UUID_RE = /^EVT-\\d+-[0-9a-f\\-]{36}$/i\r\n\r\nfunction clampStr(v, max){ return (v||'').substring(0, max) }\r\n\r\n// MailerSend email helper\r\nasync function sendEmail(env, { to, subject, html, text }) {\r\n  if (!env.MAILERSEND_API_KEY) {\r\n    console.warn('MAILERSEND_API_KEY not configured, skipping email')\r\n    return { skipped: true }\r\n  }\r\n  \r\n  try {\r\n    const body = {\r\n      from: { email: env.MAILERSEND_FROM_EMAIL || 'noreply@dicebastion.com', name: env.MAILERSEND_FROM_NAME || 'Dice Bastion' },\r\n      to: [{ email: to }],\r\n      subject,\r\n      html,\r\n      text: text || html.replace(/<[^>]*>/g, '')\r\n    }\r\n    \r\n    const res = await fetch('https://api.mailersend.com/v1/email', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${env.MAILERSEND_API_KEY}`,\r\n        'Content-Type': 'application/json'\r\n      },\r\n      body: JSON.stringify(body)\r\n    })\r\n    \r\n    if (!res.ok) {\r\n      const txt = await res.text()\r\n      console.error('MailerSend error:', txt)\r\n      return { success: false, error: txt }\r\n    }\r\n    \r\n    return { success: true }\r\n  } catch (e) {\r\n    console.error('Email send error:', e)\r\n    return { success: false, error: String(e) }\r\n  }\r\n}\r\n\r\n// Generate email templates\r\nfunction getRenewalSuccessEmail(membership, user, newEndDate) {\r\n  const planNames = { monthly: 'Monthly', quarterly: 'Quarterly', annual: 'Annual' }\r\n  const planName = planNames[membership.plan] || membership.plan\r\n  \r\n  return {\r\n    subject: `Your Dice Bastion ${planName} Membership Has Been Renewed`,\r\n    html: `\r\n      <h2>Membership Renewed Successfully</h2>\r\n      <p>Hi ${user.name || 'there'},</p>\r\n      <p>Great news! Your <strong>${planName} Membership</strong> has been automatically renewed.</p>\r\n      <ul>\r\n        <li><strong>Plan:</strong> ${planName}</li>\r\n        <li><strong>Amount:</strong> \u00A3${membership.amount}</li>\r\n        <li><strong>New End Date:</strong> ${new Date(newEndDate).toLocaleDateString('en-GB', { year: 'numeric', month: 'long', day: 'numeric' })}</li>\r\n      </ul>\r\n      <p>Your membership will continue uninterrupted. If you wish to cancel auto-renewal, you can do so from your <a href=\"https://dicebastion.com/account\">account page</a>.</p>\r\n      <p>Thank you for being a valued member!</p>\r\n      <p>\u2014 The Dice Bastion Team</p>\r\n    `\r\n  }\r\n}\r\n\r\nfunction getUpcomingRenewalEmail(membership, user, daysUntil) {\r\n  const planNames = { monthly: 'Monthly', quarterly: 'Quarterly', annual: 'Annual' }\r\n  const planName = planNames[membership.plan] || membership.plan\r\n  const renewalDate = new Date(membership.end_date).toLocaleDateString('en-GB', { \r\n    year: 'numeric', \r\n    month: 'long', \r\n    day: 'numeric' \r\n  })\r\n  \r\n  return {\r\n    subject: `Dice Bastion: Your ${planName} Membership Renews in ${daysUntil} Days`,\r\n    html: `\r\n      <h2>Your Membership Renews Soon</h2>\r\n      <p>Hi ${user.name || 'there'},</p>\r\n      <p>This is a friendly reminder that your <strong>${planName} Membership</strong> will automatically renew on <strong>${renewalDate}</strong>.</p>\r\n      <p><strong>Your membership details:</strong></p>\r\n      <ul>\r\n        <li>Plan: ${planName}</li>\r\n        <li>Renewal Date: ${renewalDate}</li>\r\n        <li>Payment Method: Card ending in ${membership.payment_instrument_last_4 || '\u2022\u2022\u2022\u2022'}</li>\r\n      </ul>\r\n      <p>Your card will be charged automatically, and your membership will continue uninterrupted.</p>\r\n      <p><strong>Need to make changes?</strong></p>\r\n      <ul>\r\n        <li>Update your payment method at <a href=\"https://dicebastion.com/memberships\">dicebastion.com/memberships</a></li>\r\n        <li>Cancel auto-renewal if you don't wish to continue</li>\r\n      </ul>\r\n      <p>Thank you for being part of the Dice Bastion community!</p>\r\n      <p>\u2014 The Dice Bastion Team</p>\r\n    `,\r\n    text: `Hi ${user.name || 'there'},\\n\\nYour ${planName} Membership will automatically renew on ${renewalDate}.\\n\\nYour card will be charged automatically. If you need to update your payment method or cancel auto-renewal, visit dicebastion.com/memberships.\\n\\nThank you!\\n\u2014 The Dice Bastion Team`\r\n  }\r\n}\r\n\r\nfunction getRenewalFailedEmail(membership, user, attemptNumber = 1) {\r\n  const planNames = { monthly: 'Monthly', quarterly: 'Quarterly', annual: 'Annual' }\r\n  const planName = planNames[membership.plan] || membership.plan\r\n  const attemptsRemaining = 3 - attemptNumber\r\n  \r\n  return {\r\n    subject: `Action Required: Dice Bastion Membership Renewal Failed (Attempt ${attemptNumber}/3)`,\r\n    html: `\r\n      <h2>Membership Renewal Payment Failed</h2>\r\n      <p>Hi ${user.name || 'there'},</p>\r\n      <p>We attempted to automatically renew your <strong>${planName} Membership</strong>, but the payment was unsuccessful.</p>\r\n      <p><strong>Important:</strong> Your membership expires on <strong>${new Date(membership.end_date).toLocaleDateString('en-GB', { year: 'numeric', month: 'long', day: 'numeric' })}</strong>.</p>\r\n      ${attemptsRemaining > 0 ? `\r\n        <p>We will automatically retry ${attemptsRemaining} more time${attemptsRemaining > 1 ? 's' : ''} before your expiration date. However, to ensure uninterrupted access, please update your payment method now.</p>\r\n      ` : ''}\r\n      <p><strong>What to do next:</strong></p>\r\n      <ul>\r\n        <li><strong>Recommended:</strong> Update your payment method at <a href=\"https://dicebastion.com/memberships\">dicebastion.com/memberships</a></li>\r\n        <li>Or purchase a new membership at <a href=\"https://dicebastion.com/memberships\">dicebastion.com/memberships</a></li>\r\n        <li>Contact us if you need help: support@dicebastion.com</li>\r\n      </ul>\r\n      <p><strong>Common reasons for payment failure:</strong></p>\r\n      <ul>\r\n        <li>Card expired or was replaced</li>\r\n        <li>Insufficient funds</li>\r\n        <li>Card was reported lost/stolen</li>\r\n        <li>Bank declined the charge</li>\r\n      </ul>\r\n      <p>Thank you for your understanding!</p>\r\n      <p>\u2014 The Dice Bastion Team</p>\r\n    `,\r\n    text: `Hi ${user.name || 'there'},\\n\\nWe attempted to renew your ${planName} Membership, but the payment failed (attempt ${attemptNumber}/3).\\n\\nYour membership expires on ${new Date(membership.end_date).toLocaleDateString('en-GB')}.\\n\\nPlease update your payment method at dicebastion.com/memberships to avoid interruption.\\n\\n\u2014 The Dice Bastion Team`\r\n  }\r\n}\r\n\r\nfunction getRenewalFailedFinalEmail(membership, user) {\r\n  const planNames = { monthly: 'Monthly', quarterly: 'Quarterly', annual: 'Annual' }\r\n  const planName = planNames[membership.plan] || membership.plan\r\n  \r\n  return {\r\n    subject: `Urgent: Dice Bastion Membership Auto-Renewal Disabled`,\r\n    html: `\r\n      <h2>Auto-Renewal Disabled - Action Required</h2>\r\n      <p>Hi ${user.name || 'there'},</p>\r\n      <p>After 3 unsuccessful attempts to charge your payment method, we've <strong>disabled auto-renewal</strong> for your ${planName} Membership.</p>\r\n      <p><strong>Your membership will expire on ${new Date(membership.end_date).toLocaleDateString('en-GB', { year: 'numeric', month: 'long', day: 'numeric' })}</strong> and will not automatically renew.</p>\r\n      <div style=\"background: #fff3cd; border-left: 4px solid #856404; padding: 16px; margin: 20px 0;\">\r\n        <strong>\u26A0\uFE0F To continue your membership:</strong>\r\n        <p style=\"margin: 8px 0 0 0;\">You'll need to purchase a new membership after your current one expires.</p>\r\n      </div>\r\n      <p><strong>What to do now:</strong></p>\r\n      <ul>\r\n        <li><strong>Option 1:</strong> Purchase a new membership at <a href=\"https://dicebastion.com/memberships\">dicebastion.com/memberships</a> (you can do this now or when your current membership expires)</li>\r\n        <li><strong>Option 2:</strong> Update your payment method and contact us to re-enable auto-renewal</li>\r\n        <li><strong>Need help?</strong> Email us at support@dicebastion.com</li>\r\n      </ul>\r\n      <p>We'd love to keep you as a member! If you're experiencing payment issues, please reach out and we'll help resolve them.</p>\r\n      <p>\u2014 The Dice Bastion Team</p>\r\n    `,\r\n    text: `Hi ${user.name || 'there'},\\n\\nAfter 3 unsuccessful payment attempts, we've disabled auto-renewal for your ${planName} Membership.\\n\\nYour membership expires on ${new Date(membership.end_date).toLocaleDateString('en-GB')} and will NOT automatically renew.\\n\\nTo continue your membership, purchase a new one at dicebastion.com/memberships or contact us to re-enable auto-renewal.\\n\\n\u2014 The Dice Bastion Team`\r\n  }\r\n}\r\n\r\nfunction getTicketConfirmationEmail(event, user, transaction) {\r\n  const eventDate = new Date(event.event_date).toLocaleDateString('en-GB', { \r\n    weekday: 'long', \r\n    year: 'numeric', \r\n    month: 'long', \r\n    day: 'numeric' \r\n  })\r\n  const eventTime = event.event_time || 'TBC'\r\n  const amount = transaction.amount || '0.00'\r\n  const currency = transaction.currency || 'GBP'\r\n  const sym = currency === 'GBP' ? '\u00A3' : currency === 'EUR' ? '\u20AC' : '$'\r\n  \r\n  return {\r\n    subject: `Ticket Confirmed: ${event.event_name}`,\r\n    html: `\r\n      <h2>Your Ticket is Confirmed!</h2>\r\n      <p>Hi ${user.name || 'there'},</p>\r\n      <p>Thank you for purchasing a ticket to <strong>${event.event_name}</strong>!</p>\r\n      \r\n      <h3>Event Details:</h3>\r\n      <ul>\r\n        <li><strong>Event:</strong> ${event.event_name}</li>\r\n        <li><strong>Date:</strong> ${eventDate}</li>\r\n        <li><strong>Time:</strong> ${eventTime}</li>\r\n        <li><strong>Location:</strong> ${event.location || 'Dice Bastion'}</li>\r\n        ${event.description ? `<li><strong>Description:</strong> ${event.description}</li>` : ''}\r\n      </ul>\r\n      \r\n      <h3>Payment Details:</h3>\r\n      <ul>\r\n        <li><strong>Amount Paid:</strong> ${sym}${amount}</li>\r\n        <li><strong>Order Reference:</strong> ${transaction.order_ref}</li>\r\n      </ul>\r\n      \r\n      <p>Please bring this email or show your order reference at the event check-in.</p>\r\n      \r\n      ${event.additional_info ? `<p><strong>Important Information:</strong><br>${event.additional_info}</p>` : ''}\r\n      \r\n      <p>Looking forward to seeing you there!</p>\r\n      <p>\u2014 The Dice Bastion Team</p>\r\n    `,\r\n    text: `\r\nYour Ticket is Confirmed!\r\n\r\nHi ${user.name || 'there'},\r\n\r\nThank you for purchasing a ticket to ${event.event_name}!\r\n\r\nEVENT DETAILS:\r\n- Event: ${event.event_name}\r\n- Date: ${eventDate}\r\n- Time: ${eventTime}\r\n- Location: ${event.location || 'Dice Bastion'}\r\n${event.description ? `- Description: ${event.description}` : ''}\r\n\r\nPAYMENT DETAILS:\r\n- Amount Paid: ${sym}${amount}\r\n- Order Reference: ${transaction.order_ref}\r\n\r\nPlease bring this email or show your order reference at the event check-in.\r\n\r\n${event.additional_info ? `Important Information: ${event.additional_info}` : ''}\r\n\r\nLooking forward to seeing you there!\r\n\r\n\u2014 The Dice Bastion Team\r\n    `\r\n  }\r\n}\r\n\r\nfunction getWelcomeEmail(membership, user, autoRenew) {\r\n  const planNames = { monthly: 'Monthly', quarterly: 'Quarterly', annual: 'Annual' }\r\n  const planName = planNames[membership.plan] || membership.plan\r\n  \r\n  return {\r\n    subject: `Welcome to Dice Bastion ${planName} Membership!`,\r\n    html: `\r\n      <h2>Welcome to Dice Bastion!</h2>\r\n      <p>Hi ${user.name || 'there'},</p>\r\n      <p>Thank you for becoming a <strong>${planName} Member</strong>!</p>\r\n      <ul>\r\n        <li><strong>Plan:</strong> ${planName}</li>\r\n        <li><strong>Valid Until:</strong> ${new Date(membership.end_date).toLocaleDateString('en-GB', { year: 'numeric', month: 'long', day: 'numeric' })}</li>\r\n        <li><strong>Auto-Renewal:</strong> ${autoRenew ? 'Enabled \u2713' : 'Disabled'}</li>\r\n      </ul>\r\n      ${autoRenew ? '<p>Your membership will automatically renew before expiration. You can manage this at any time from your <a href=\"https://dicebastion.com/account\">account page</a>.</p>' : '<p>Remember to renew your membership before it expires to continue enjoying member benefits!</p>'}\r\n      <p><strong>Member Benefits:</strong></p>\r\n      <ul>\r\n        <li>Discounted event tickets</li>\r\n        <li>Priority booking for tournaments</li>\r\n        <li>Exclusive member events</li>\r\n        <li>And much more!</li>\r\n      </ul>\r\n      <p>See you at the club!</p>\r\n      <p>\u2014 The Dice Bastion Team</p>\r\n    `\r\n  }\r\n}\r\n\r\n// Membership checkout with idempotency + Turnstile\r\napp.post('/membership/checkout', async (c) => {\r\n  try {\r\n    const ip = c.req.header('CF-Connecting-IP')\r\n    const debugMode = ['1','true','yes'].includes(String(c.req.query('debug') || c.env.DEBUG || '').toLowerCase())\r\n    const idem = c.req.header('Idempotency-Key')?.trim()\r\n    const { email, name, plan, privacyConsent, turnstileToken, autoRenew } = await c.req.json()\r\n    if (!email || !plan) return c.json({ error: 'missing_fields' }, 400)\r\n    if (!EMAIL_RE.test(email) || email.length > 320) return c.json({ error:'invalid_email' },400)\r\n    if (!privacyConsent) return c.json({ error: 'privacy_consent_required' }, 400)\r\n    if (name && name.length > 200) return c.json({ error:'name_too_long' },400)\r\n    const tsOk = await verifyTurnstile(c.env, turnstileToken, ip, debugMode)\r\n    if (!tsOk) return c.json({ error:'turnstile_failed' },403)\r\n\r\n    const ident = await getOrCreateIdentity(c.env.DB, email, clampStr(name,200))\r\n    const svc = await getServiceForPlan(c.env.DB, plan)\r\n    if (!svc) return c.json({ error: 'unknown_plan' }, 400)\r\n    const amount = Number(svc.amount)\r\n    if (!Number.isFinite(amount) || amount <= 0) return c.json({ error:'invalid_amount' },400)\r\n    const currency = svc.currency || c.env.CURRENCY || 'GBP'\r\n    const s = await getSchema(c.env.DB)\r\n\r\n    // Ensure schema is up to date\r\n    await ensureSchema(c.env.DB, s.fkColumn)\r\n    await migrateToTransactions(c.env.DB)\r\n\r\n    // Idempotency check in transactions table\r\n    const order_ref = crypto.randomUUID()\r\n    if (idem){\r\n      const existing = await c.env.DB.prepare(`\r\n        SELECT t.*, m.id as membership_id FROM transactions t\r\n        JOIN memberships m ON m.id = t.reference_id\r\n        WHERE t.transaction_type = 'membership' AND t.user_id = ? AND t.idempotency_key = ?\r\n        ORDER BY t.id DESC LIMIT 1\r\n      `).bind(ident.id, idem).first()\r\n      if (existing && existing.checkout_id){\r\n        return c.json({ orderRef: existing.order_ref, checkoutId: existing.checkout_id, reused: true })\r\n      }\r\n    }\r\n\r\n    const autoRenewValue = autoRenew ? 1 : 0\r\n    \r\n    // Insert minimal membership record (business logic only)\r\n    const mc = await c.env.DB.prepare('PRAGMA table_info(memberships)').all().catch(()=>({ results: [] }))\r\n    const mnames = new Set((mc?.results||[]).map(r => String(r.name||'').toLowerCase()))\r\n    const cols = ['plan','status','auto_renew']\r\n    const vals = [plan,'pending', autoRenewValue]\r\n    if (mnames.has('user_id')) { cols.unshift('user_id'); vals.unshift(ident.id) }\r\n    if (mnames.has('member_id')) { cols.unshift('member_id'); vals.unshift(ident.id) }\r\n    const placeholders = cols.map(()=>'?').join(',')\r\n    const mResult = await c.env.DB.prepare(`INSERT INTO memberships (${cols.join(',')}) VALUES (${placeholders}) RETURNING id`).bind(...vals).first()\r\n    const membershipId = mResult?.id || (await c.env.DB.prepare('SELECT last_insert_rowid() as id').first()).id\r\n\r\n    let checkout\r\n    try {\r\n      // Create or get SumUp customer if auto-renewal enabled\r\n      let customerId = null\r\n      if (autoRenewValue === 1) {\r\n        customerId = await getOrCreateSumUpCustomer(c.env, ident)\r\n        console.log('Using SumUp customer ID for auto-renewal:', customerId)\r\n      }\r\n      \r\n      checkout = await createCheckout(c.env, { \r\n        amount, \r\n        currency, \r\n        orderRef: order_ref, \r\n        title: `Dice Bastion ${plan} membership`, \r\n        description: `Membership for ${plan}`,\r\n        savePaymentInstrument: autoRenewValue === 1,\r\n        customerId\r\n      })\r\n    } catch (err) {\r\n      console.error('sumup checkout error', err)\r\n      return c.json({ error: 'sumup_checkout_failed', message: String(err?.message || err) }, 502)\r\n    }\r\n    if (!checkout.id) {\r\n      console.error('membership checkout missing id', checkout)\r\n      return c.json({ error: 'sumup_missing_id' }, 502)\r\n    }\r\n    \r\n    // Store payment details in transactions table\r\n    await c.env.DB.prepare(`\r\n      INSERT INTO transactions (transaction_type, reference_id, user_id, email, name, order_ref, \r\n                                checkout_id, amount, currency, payment_status, idempotency_key, consent_at)\r\n      VALUES ('membership', ?, ?, ?, ?, ?, ?, ?, ?, 'pending', ?, ?)\r\n    `).bind(membershipId, ident.id, email, clampStr(name,200), order_ref, checkout.id, \r\n            String(amount), currency, idem || null, toIso(new Date())).run()\r\n    \r\n    return c.json({ orderRef: order_ref, checkoutId: checkout.id })\r\n  } catch (e) {\r\n    const debugMode = ['1','true','yes'].includes(String(c.req.query('debug') || c.env.DEBUG || '').toLowerCase())\r\n    console.error('membership checkout error', e)\r\n    return c.json(debugMode ? { error: 'internal_error', detail: String(e), stack: String(e?.stack||'') } : { error: 'internal_error' }, 500)\r\n  }\r\n})\r\n\r\napp.get('/membership/status', async (c) => {\r\n  const email = c.req.query('email')\r\n  if (!email) return c.json({ error: 'email required' }, 400)\r\n  const ident = await findIdentityByEmail(c.env.DB, email)\r\n  if (!ident) return c.json({ active: false })\r\n  const active = await getActiveMembership(c.env.DB, ident.id)\r\n  if (!active) return c.json({ active: false })\r\n  return c.json({ active: true, plan: active.plan, endDate: active.end_date })\r\n})\r\n\r\n// Expose active plans/prices for frontend labeling\r\napp.get('/membership/plans', async (c) => {\r\n  const rows = await c.env.DB.prepare('SELECT code, name, description, amount, currency, months FROM services WHERE active = 1 ORDER BY id').all()\r\n  return c.json({ plans: rows.results || [] })\r\n})\r\n\r\napp.get('/membership/confirm', async (c) => {\r\n  const orderRef = c.req.query('orderRef')\r\n  if (!orderRef || !UUID_RE.test(orderRef)) return c.json({ ok:false, error:'invalid_orderRef' },400)\r\n  \r\n  // Get transaction record\r\n  const transaction = await c.env.DB.prepare('SELECT * FROM transactions WHERE order_ref = ? AND transaction_type = \"membership\"').bind(orderRef).first()\r\n  if (!transaction) return c.json({ ok:false, error:'order_not_found' },404)\r\n  \r\n  // Get membership record\r\n  const pending = await c.env.DB.prepare('SELECT * FROM memberships WHERE id = ?').bind(transaction.reference_id).first()\r\n  if (!pending) return c.json({ ok:false, error:'membership_not_found' },404)\r\n  if (pending.status === 'active') {\r\n    // Get card details if auto-renewal is enabled\r\n    let cardLast4 = null\r\n    if (pending.auto_renew === 1 && pending.payment_instrument_id) {\r\n      const instrument = await c.env.DB.prepare('SELECT last_4 FROM payment_instruments WHERE instrument_id = ?')\r\n        .bind(pending.payment_instrument_id).first()\r\n      cardLast4 = instrument?.last_4 || null\r\n    }\r\n    return c.json({ \r\n      ok: true, \r\n      status: 'already_active',\r\n      plan: pending.plan,\r\n      endDate: pending.end_date,\r\n      amount: transaction.amount,\r\n      currency: transaction.currency || 'GBP',\r\n      autoRenew: pending.auto_renew === 1,\r\n      cardLast4\r\n    })\r\n  }\r\n  \r\n  // Verify payment with SumUp\r\n  let payment; \r\n  try { payment = await fetchPayment(c.env, transaction.checkout_id) } \r\n  catch { return c.json({ ok:false, error:'verify_failed' },400) }\r\n  \r\n  const paid = payment && (payment.status === 'PAID' || payment.status === 'SUCCESSFUL')\r\n  if (!paid) return c.json({ ok:false, status: payment?.status || 'PENDING' })\r\n  \r\n  // Verify amount/currency\r\n  if (payment.amount != Number(transaction.amount) || (transaction.currency && payment.currency !== transaction.currency)) {\r\n    return c.json({ ok:false, error:'payment_mismatch' },400)\r\n  }\r\n  \r\n  const s = await getSchema(c.env.DB)\r\n  const identityId = (typeof pending.user_id !== 'undefined' && pending.user_id !== null) ? pending.user_id : pending.member_id\r\n  const activeExisting = await getActiveMembership(c.env.DB, identityId)\r\n  const svc = await getServiceForPlan(c.env.DB, pending.plan)\r\n  if (!svc) return c.json({ ok:false, error:'plan_not_configured' },400)\r\n  const months = Number(svc.months || 0)\r\n  const baseStart = activeExisting ? new Date(activeExisting.end_date) : new Date()\r\n  const end = addMonths(baseStart, months)\r\n  \r\n  // Save payment instrument for auto-renewal ONLY if auto_renew is enabled\r\n  let instrumentId = null\r\n  if (pending.auto_renew === 1) {\r\n    instrumentId = await savePaymentInstrument(c.env.DB, identityId, transaction.checkout_id, c.env)\r\n  }\r\n  \r\n  // Update membership status\r\n  await c.env.DB.prepare(`\r\n    UPDATE memberships \r\n    SET status = \"active\", \r\n        start_date = ?, \r\n        end_date = ?, \r\n        payment_instrument_id = ?\r\n    WHERE id = ?\r\n  `).bind(toIso(baseStart), toIso(end), instrumentId, pending.id).run()\r\n  \r\n  // Update transaction status\r\n  await c.env.DB.prepare(`\r\n    UPDATE transactions \r\n    SET payment_status = \"PAID\",\r\n        payment_id = ?,\r\n        updated_at = ?\r\n    WHERE id = ?\r\n  `).bind(payment.id, toIso(new Date()), transaction.id).run()\r\n  \r\n  // Get user details and send welcome email\r\n  const user = await c.env.DB.prepare('SELECT * FROM users WHERE user_id = ?').bind(identityId).first()\r\n  if (user) {\r\n    const updatedMembership = { ...pending, end_date: toIso(end) }\r\n    const emailContent = getWelcomeEmail(updatedMembership, user, pending.auto_renew === 1)\r\n    await sendEmail(c.env, { to: user.email, ...emailContent })\r\n  }\r\n  \r\n  // Get payment instrument details for display\r\n  let cardLast4 = null\r\n  if (instrumentId) {\r\n    const instrument = await c.env.DB.prepare('SELECT last_4 FROM payment_instruments WHERE instrument_id = ? AND user_id = ?')\r\n      .bind(instrumentId, identityId).first()\r\n    cardLast4 = instrument?.last_4 || null\r\n  }\r\n  \r\n  return c.json({ \r\n    ok: true, \r\n    status: 'active',\r\n    plan: pending.plan,\r\n    endDate: toIso(end),\r\n    amount: transaction.amount,\r\n    currency: transaction.currency || 'GBP',\r\n    autoRenew: pending.auto_renew === 1,\r\n    cardLast4\r\n  })\r\n})\r\n\r\napp.post('/webhooks/sumup', async (c) => {\r\n  const payload = await c.req.json()\r\n  const { id: paymentId, checkout_reference: orderRef, currency } = payload\r\n  if (!paymentId || !orderRef) return c.json({ ok: false }, 400)\r\n\r\n  let payment\r\n  try { payment = await fetchPayment(c.env, paymentId) } catch (e) { return c.json({ ok: false, error: 'verify_failed' }, 400) }\r\n  if (!payment || payment.status !== 'PAID') return c.json({ ok: true })\r\n\r\n  const pending = await c.env.DB.prepare('SELECT * FROM memberships WHERE order_ref = ?').bind(orderRef).first()\r\n  if (!pending) return c.json({ ok: false, error: 'order_not_found' }, 404)\r\n\r\n  const svc = await getServiceForPlan(c.env.DB, pending.plan)\r\n  if (!svc) return c.json({ ok: false, error: 'plan_not_configured' }, 400)\r\n  if (currency && svc.currency && currency !== svc.currency) return c.json({ ok: false, error: 'currency_mismatch' }, 400)\r\n\r\n  const now = new Date()\r\n  const s = await getSchema(c.env.DB)\r\n  const identityId = (typeof pending.user_id !== 'undefined' && pending.user_id !== null) ? pending.user_id : pending.member_id\r\n  const memberActive = await getActiveMembership(c.env.DB, identityId)\r\n  const baseStart = memberActive ? new Date(memberActive.end_date) : now\r\n  const months = Number(svc.months || 0)\r\n  const start = baseStart\r\n  const end = addMonths(baseStart, months)\r\n\r\n  await c.env.DB.prepare('UPDATE memberships SET status = \"active\", start_date = ?, end_date = ?, payment_id = ? WHERE id = ?').bind(toIso(start), toIso(end), paymentId, pending.id).run()\r\n  \r\n  // Send welcome email (critical - works even if user closed browser)\r\n  const user = await c.env.DB.prepare('SELECT * FROM users WHERE user_id = ?').bind(identityId).first()\r\n  if (user) {\r\n    const updatedMembership = { ...pending, end_date: toIso(end) }\r\n    const emailContent = getWelcomeEmail(updatedMembership, user, pending.auto_renew === 1)\r\n    await sendEmail(c.env, { to: user.email, ...emailContent }).catch(err => {\r\n      console.error('Webhook email failed:', err)\r\n      // Don't fail webhook if email fails\r\n    })\r\n  }\r\n  \r\n  return c.json({ ok: true })\r\n})\r\n\r\n// Get event basic info\r\napp.get('/events/:id', async c => {\r\n  const id = c.req.param('id')\r\n  if (!id || isNaN(Number(id))) return c.json({ error:'invalid_event_id' },400)\r\n  const ev = await c.env.DB.prepare('SELECT event_id,event_name,description,event_datetime,location,membership_price,non_membership_price,capacity,tickets_sold,category,image_url FROM events WHERE event_id = ?').bind(Number(id)).first()\r\n  if (!ev) return c.json({ error:'not_found' },404)\r\n  return c.json({ event: ev })\r\n})\r\n\r\n// Create ticket checkout with idempotency + Turnstile\r\napp.post('/events/:id/checkout', async c => {\r\n  try {\r\n    const id = c.req.param('id')\r\n    if (!id || isNaN(Number(id))) return c.json({ error:'invalid_event_id' },400)\r\n    const evId = Number(id)\r\n    const ip = c.req.header('CF-Connecting-IP')\r\n    const debugMode = ['1','true','yes'].includes(String(c.req.query('debug') || c.env.DEBUG || '').toLowerCase())\r\n    const idem = c.req.header('Idempotency-Key')?.trim()\r\n    const { email, name, privacyConsent, turnstileToken } = await c.req.json()\r\n    if (!email) return c.json({ error:'email_required' },400)\r\n    if (!EMAIL_RE.test(email)) return c.json({ error:'invalid_email' },400)\r\n    if (!privacyConsent) return c.json({ error:'privacy_consent_required' },400)\r\n    if (name && name.length > 200) return c.json({ error:'name_too_long' },400)\r\n    const tsOk = await verifyTurnstile(c.env, turnstileToken, ip, debugMode)\r\n    if (!tsOk) return c.json({ error:'turnstile_failed' },403)\r\n\r\n    const ev = await c.env.DB.prepare('SELECT * FROM events WHERE event_id = ?').bind(evId).first()\r\n    if (!ev) return c.json({ error:'event_not_found' },404)\r\n    if (ev.capacity && ev.tickets_sold >= ev.capacity) return c.json({ error:'sold_out' },409)\r\n\r\n    const ident = await getOrCreateIdentity(c.env.DB, email, clampStr(name,200))\r\n    if (!ident || typeof ident.id === 'undefined' || ident.id === null) {\r\n      console.error('identity missing id', ident)\r\n      return c.json({ error:'identity_error' },500)\r\n    }\r\n    const isActive = !!(await getActiveMembership(c.env.DB, ident.id))\r\n    const amount = Number(isActive ? ev.membership_price : ev.non_membership_price)\r\n    if (!Number.isFinite(amount) || amount <= 0) return c.json({ error:'invalid_amount' },400)\r\n    const currency = c.env.CURRENCY || 'GBP'\r\n\r\n    const s = await getSchema(c.env.DB)\r\n    await ensureSchema(c.env.DB, s.fkColumn)\r\n    await migrateToTransactions(c.env.DB)\r\n\r\n    const order_ref = `EVT-${evId}-${crypto.randomUUID()}`\r\n    \r\n    // Idempotency check in transactions table\r\n    if (idem){\r\n      const existing = await c.env.DB.prepare(`\r\n        SELECT t.*, ti.id as ticket_id FROM transactions t\r\n        JOIN tickets ti ON ti.id = t.reference_id\r\n        WHERE t.transaction_type = 'ticket' AND t.user_id = ? AND t.idempotency_key = ?\r\n        ORDER BY t.id DESC LIMIT 1\r\n      `).bind(ident.id, idem).first()\r\n      if (existing && existing.checkout_id){\r\n        return c.json({ orderRef: existing.order_ref, checkoutId: existing.checkout_id, reused: true })\r\n      }\r\n    }\r\n\r\n    // Insert minimal ticket record (business logic only)\r\n    const tinfo = await c.env.DB.prepare('PRAGMA table_info(tickets)').all().catch(()=>({ results: [] }))\r\n    const tnames = new Set((tinfo?.results||[]).map(r => String(r.name||'').toLowerCase()))\r\n    const hasUser = tnames.has('user_id')\r\n    const hasMember = tnames.has('member_id')\r\n    \r\n    const colParts = ['event_id', 'status']\r\n    const bindVals = [evId, 'pending']\r\n    if (hasUser) { colParts.push('user_id'); bindVals.push(ident.id) }\r\n    if (hasMember) { colParts.push('member_id'); bindVals.push(ident.id) }\r\n    if (tnames.has('created_at')) { colParts.push('created_at'); bindVals.push(toIso(new Date())) }\r\n    \r\n    const placeholders = colParts.map(()=>'?').join(',')\r\n    const ticketResult = await c.env.DB.prepare(`INSERT INTO tickets (${colParts.join(',')}) VALUES (${placeholders}) RETURNING id`).bind(...bindVals).first()\r\n    const ticketId = ticketResult?.id || (await c.env.DB.prepare('SELECT last_insert_rowid() as id').first()).id\r\n\r\n    let checkout\r\n    try {\r\n      checkout = await createCheckout(c.env, { amount, currency, orderRef: order_ref, title: ev.event_name, description: `Ticket for ${ev.event_name}` })\r\n    } catch (e) {\r\n      console.error('SumUp checkout failed for event', evId, e)\r\n      return c.json({ error:'sumup_checkout_failed', message:String(e?.message||e) },502)\r\n    }\r\n    if (!checkout.id) {\r\n      console.error('event checkout missing id', checkout)\r\n      return c.json({ error: 'sumup_missing_id' }, 502)\r\n    }\r\n    \r\n    // Store payment details in transactions table\r\n    await c.env.DB.prepare(`\r\n      INSERT INTO transactions (transaction_type, reference_id, user_id, email, name, order_ref,\r\n                                checkout_id, amount, currency, payment_status, idempotency_key, consent_at)\r\n      VALUES ('ticket', ?, ?, ?, ?, ?, ?, ?, ?, 'pending', ?, ?)\r\n    `).bind(ticketId, ident.id, email, clampStr(name,200), order_ref, checkout.id,\r\n            String(amount), currency, idem || null, toIso(new Date())).run()\r\n    \r\n    return c.json({ orderRef: order_ref, checkoutId: checkout.id })\r\n  } catch (e) {\r\n    const debugMode = ['1','true','yes'].includes(String(c.req.query('debug') || c.env.DEBUG || '').toLowerCase())\r\n    console.error('events checkout error', e)\r\n    return c.json(debugMode ? { error:'internal_error', detail: String(e), stack: String(e?.stack||'') } : { error:'internal_error' },500)\r\n  }\r\n})\r\n\r\n// Confirm ticket purchase with payment verification + capacity race guard\r\napp.get('/events/confirm', async c => {\r\n  const orderRef = c.req.query('orderRef')\r\n  if (!orderRef || !EVT_UUID_RE.test(orderRef)) return c.json({ ok:false, error:'invalid_orderRef' },400)\r\n  \r\n  // Get transaction record\r\n  const transaction = await c.env.DB.prepare('SELECT * FROM transactions WHERE order_ref = ? AND transaction_type = \"ticket\"').bind(orderRef).first()\r\n  if (!transaction) return c.json({ ok:false, error:'order_not_found' },404)\r\n  \r\n  // Get ticket record\r\n  const ticket = await c.env.DB.prepare('SELECT * FROM tickets WHERE id = ?').bind(transaction.reference_id).first()\r\n  if (!ticket) return c.json({ ok:false, error:'ticket_not_found' },404)\r\n  if (ticket.status === 'active') {\r\n    const ev = await c.env.DB.prepare('SELECT event_name, event_datetime FROM events WHERE event_id = ?').bind(ticket.event_id).first()\r\n    return c.json({ \r\n      ok: true, \r\n      status: 'already_active',\r\n      eventName: ev?.event_name,\r\n      eventDate: ev?.event_datetime,\r\n      ticketCount: 1,\r\n      amount: transaction.amount,\r\n      currency: transaction.currency || 'GBP'\r\n    })\r\n  }\r\n  \r\n  // Verify payment with SumUp\r\n  let payment\r\n  try { payment = await fetchPayment(c.env, transaction.checkout_id) } \r\n  catch { return c.json({ ok:false, error:'verify_failed' },400) }\r\n  \r\n  const paid = payment && (payment.status === 'PAID' || payment.status === 'SUCCESSFUL')\r\n  if (!paid) return c.json({ ok:false, status: payment?.status || 'PENDING' })\r\n  \r\n  // Verify amount/currency\r\n  if (payment.amount != Number(transaction.amount) || (transaction.currency && payment.currency !== transaction.currency)) {\r\n    return c.json({ ok:false, error:'payment_mismatch' },400)\r\n  }\r\n\r\n  // Get event details\r\n  const ev = await c.env.DB.prepare('SELECT * FROM events WHERE event_id = ?').bind(ticket.event_id).first()\r\n  if (!ev) return c.json({ ok:false, error:'event_not_found' },404)\r\n  \r\n  // Capacity check\r\n  if (ev.capacity && ev.tickets_sold >= ev.capacity) return c.json({ ok:false, error:'sold_out' },409)\r\n  \r\n  // Update ticket and transaction status\r\n  await c.env.DB.batch([\r\n    c.env.DB.prepare('UPDATE tickets SET status = \"active\" WHERE id = ?').bind(ticket.id),\r\n    c.env.DB.prepare('UPDATE transactions SET payment_status = \"PAID\", payment_id = ?, updated_at = ? WHERE id = ?')\r\n      .bind(payment.id, toIso(new Date()), transaction.id),\r\n    // Increment if not exceeded capacity\r\n    c.env.DB.prepare('UPDATE events SET tickets_sold = tickets_sold + 1 WHERE event_id = ? AND (capacity IS NULL OR tickets_sold < capacity)')\r\n      .bind(ticket.event_id)\r\n  ])\r\n  \r\n  // Send confirmation email\r\n  const user = await c.env.DB.prepare('SELECT * FROM users WHERE user_id = ?').bind(transaction.user_id).first()\r\n  if (user) {\r\n    const emailContent = getTicketConfirmationEmail(ev, user, transaction)\r\n    await sendEmail(c.env, { to: user.email, ...emailContent })\r\n  }\r\n  \r\n  return c.json({ \r\n    ok: true, \r\n    status: 'active',\r\n    eventName: ev.event_name,\r\n    eventDate: ev.event_datetime,\r\n    ticketCount: 1,\r\n    amount: transaction.amount,\r\n    currency: transaction.currency || 'GBP'\r\n  })\r\n})\r\n\r\n// Optional tiny debug endpoint\r\napp.get('/_debug/ping', c => {\r\n  const origin = c.req.header('Origin') || ''\r\n  const allowed = (c.env.ALLOWED_ORIGIN || '').split(',').map(s=>s.trim()).filter(Boolean)\r\n  const allow = allowed.includes(origin) ? origin : (allowed[0] || '')\r\n  return c.json({ ok:true, origin, allow, allowed })\r\n})\r\n\r\n// Debug schema inspector\r\napp.get('/_debug/schema', async c => {\r\n  try {\r\n    const s = await getSchema(c.env.DB)\r\n    const memberships = await c.env.DB.prepare('PRAGMA table_info(memberships)').all().catch(()=>({ results: [] }))\r\n    const tickets = await c.env.DB.prepare('PRAGMA table_info(tickets)').all().catch(()=>({ results: [] }))\r\n    const tables = await c.env.DB.prepare(\"SELECT name FROM sqlite_master WHERE type='table'\").all().catch(()=>({ results: [] }))\r\n    const tnames = new Set((tickets?.results||[]).map(r => String(r.name||'').toLowerCase()))\r\n    const ticketFkCol = tnames.has(s.fkColumn) ? s.fkColumn : (tnames.has('member_id') ? 'member_id' : (tnames.has('user_id') ? 'user_id' : null))\r\n    return c.json({ ok:true, schema: s, ticketFkCol, tables: tables.results||[], memberships: memberships.results||[], tickets: tickets.results||[] })\r\n  } catch (e) {\r\n    return c.json({ ok:false, error: String(e) }, 500)\r\n  }\r\n})\r\n\r\n// Debug SumUp OAuth scopes\r\napp.get('/_debug/sumup-scopes', async c => {\r\n  try {\r\n    // Test with payment_instruments scope\r\n    const result = await sumupToken(c.env, 'payments payment_instruments')\r\n    return c.json({ \r\n      ok: true, \r\n      requestedScopes: 'payments payment_instruments',\r\n      grantedScopes: result.scope,\r\n      scopesArray: (result.scope || '').split(/\\s+/).filter(Boolean),\r\n      hasPaymentInstruments: (result.scope || '').includes('payment_instruments'),\r\n      fullResponse: result\r\n    })\r\n  } catch (e) {\r\n    return c.json({ \r\n      ok: false, \r\n      error: String(e.message || e),\r\n      stack: String(e.stack || '')\r\n    }, 500)\r\n  }\r\n})\r\n\r\n// === Auto-Renewal Management Endpoints ===\r\n\r\n// Get auto-renewal status for a user\r\napp.get('/membership/auto-renewal', async (c) => {\r\n  const email = c.req.query('email')\r\n  if (!email || !EMAIL_RE.test(email)) return c.json({ error: 'invalid_email' }, 400)\r\n  \r\n  const ident = await findIdentityByEmail(c.env.DB, email)\r\n  if (!ident) return c.json({ enabled: false, hasPaymentMethod: false })\r\n  \r\n  const membership = await getActiveMembership(c.env.DB, ident.id)\r\n  if (!membership) return c.json({ enabled: false, hasPaymentMethod: false })\r\n  \r\n  const instrument = await getActivePaymentInstrument(c.env.DB, ident.id)\r\n  \r\n  return c.json({\r\n    enabled: membership.auto_renew === 1,\r\n    hasPaymentMethod: !!instrument,\r\n    paymentMethod: instrument ? {\r\n      cardType: instrument.card_type,\r\n      last4: instrument.last_4,\r\n      expiryMonth: instrument.expiry_month,\r\n      expiryYear: instrument.expiry_year\r\n    } : null,\r\n    membershipEndDate: membership.end_date,\r\n    plan: membership.plan\r\n  })\r\n})\r\n\r\n// Toggle auto-renewal on/off\r\napp.post('/membership/auto-renewal/toggle', async (c) => {\r\n  try {\r\n    const { email, enabled } = await c.req.json()\r\n    if (!email || !EMAIL_RE.test(email)) return c.json({ error: 'invalid_email' }, 400)\r\n    if (typeof enabled !== 'boolean') return c.json({ error: 'enabled must be boolean' }, 400)\r\n    \r\n    const ident = await findIdentityByEmail(c.env.DB, email)\r\n    if (!ident) return c.json({ error: 'user_not_found' }, 404)\r\n    \r\n    const membership = await getActiveMembership(c.env.DB, ident.id)\r\n    if (!membership) return c.json({ error: 'no_active_membership' }, 404)\r\n    \r\n    await c.env.DB.prepare('UPDATE memberships SET auto_renew = ? WHERE id = ?')\r\n      .bind(enabled ? 1 : 0, membership.id).run()\r\n    \r\n    return c.json({ ok: true, enabled })\r\n  } catch (e) {\r\n    console.error('Toggle auto-renewal error:', e)\r\n    return c.json({ error: 'internal_error' }, 500)\r\n  }\r\n})\r\n\r\n// Remove saved payment method (disables auto-renewal)\r\napp.post('/membership/payment-method/remove', async (c) => {\r\n  try {\r\n    const { email } = await c.req.json()\r\n    if (!email || !EMAIL_RE.test(email)) return c.json({ error: 'invalid_email' }, 400)\r\n    \r\n    const ident = await findIdentityByEmail(c.env.DB, email)\r\n    if (!ident) return c.json({ error: 'user_not_found' }, 404)\r\n    \r\n    // Deactivate all payment instruments\r\n    await c.env.DB.prepare('UPDATE payment_instruments SET is_active = 0 WHERE user_id = ?')\r\n      .bind(ident.id).run()\r\n    \r\n    // Disable auto-renewal for active memberships\r\n    await c.env.DB.prepare('UPDATE memberships SET auto_renew = 0, payment_instrument_id = NULL WHERE (user_id = ? OR member_id = ?) AND status = \"active\"')\r\n      .bind(ident.id, ident.id).run()\r\n    \r\n    return c.json({ ok: true })\r\n  } catch (e) {\r\n    console.error('Remove payment method error:', e)\r\n    return c.json({ error: 'internal_error' }, 500)\r\n  }\r\n})\r\n\r\n// Manually retry a failed renewal (useful after user updates payment method)\r\napp.post('/membership/retry-renewal', async (c) => {\r\n  try {\r\n    const { email } = await c.req.json()\r\n    if (!email || !EMAIL_RE.test(email)) return c.json({ error: 'invalid_email' }, 400)\r\n    \r\n    await ensureSchema(c.env.DB, 'user_id')\r\n    \r\n    const ident = await findIdentityByEmail(c.env.DB, email)\r\n    if (!ident) return c.json({ error: 'user_not_found' }, 404)\r\n    \r\n    // Find membership with failed renewal\r\n    const membership = await getActiveMembership(c.env.DB, ident.id)\r\n    if (!membership) return c.json({ error: 'no_active_membership' }, 404)\r\n    \r\n    if (!membership.auto_renew) {\r\n      return c.json({ error: 'auto_renew_disabled', message: 'Auto-renewal is not enabled for this membership' }, 400)\r\n    }\r\n    \r\n    if (!membership.renewal_failed_at && membership.renewal_attempts === 0) {\r\n      return c.json({ error: 'no_failed_renewal', message: 'No failed renewal attempts found' }, 400)\r\n    }\r\n    \r\n    console.log(`Manual retry for membership ${membership.id}`)\r\n    \r\n    // Reset attempts and try renewal\r\n    await c.env.DB.prepare('UPDATE memberships SET renewal_attempts = 0 WHERE id = ?').bind(membership.id).run()\r\n    const result = await processMembershipRenewal(c.env.DB, membership, c.env)\r\n    \r\n    return c.json({ \r\n      ok: true, \r\n      success: result.success,\r\n      message: result.success ? 'Renewal successful' : 'Renewal failed',\r\n      details: result\r\n    })\r\n  } catch (e) {\r\n    console.error('Manual renewal retry error:', e)\r\n    return c.json({ error: 'internal_error', details: String(e) }, 500)\r\n  }\r\n})\r\n\r\n// Test endpoint to manually trigger renewal for a specific user\r\napp.get('/test/renew-user', async (c) => {\r\n  const email = c.req.query('email')\r\n  if (!email) return c.json({ error: 'email required' }, 400)\r\n  \r\n  try {\r\n    await ensureSchema(c.env.DB, 'user_id')\r\n    \r\n    const ident = await findIdentityByEmail(c.env.DB, email)\r\n    if (!ident) return c.json({ error: 'user_not_found' }, 404)\r\n    \r\n    // Check schema for correct column name\r\n    const mc = await c.env.DB.prepare('PRAGMA table_info(memberships)').all()\r\n    const mnames = new Set((mc?.results||[]).map(r => String(r.name||'').toLowerCase()))\r\n    \r\n    let where, binds\r\n    if (mnames.has('user_id') && mnames.has('member_id')) {\r\n      where = '(user_id = ? OR member_id = ?)'\r\n      binds = [ident.id, ident.id]\r\n    } else if (mnames.has('user_id')) {\r\n      where = 'user_id = ?'\r\n      binds = [ident.id]\r\n    } else {\r\n      where = 'member_id = ?'\r\n      binds = [ident.id]\r\n    }\r\n    \r\n    // Find active membership with auto-renewal\r\n    const membership = await c.env.DB.prepare(`\r\n      SELECT * FROM memberships \r\n      WHERE ${where}\r\n        AND status = 'active' \r\n        AND auto_renew = 1\r\n      LIMIT 1\r\n    `).bind(...binds).first()\r\n    \r\n    if (!membership) {\r\n      return c.json({ error: 'no_auto_renew_membership' }, 404)\r\n    }\r\n    \r\n    console.log('Manually triggering renewal for membership:', membership.id)\r\n    const result = await processMembershipRenewal(c.env.DB, membership, c.env)\r\n    \r\n    return c.json({ \r\n      success: result.success, \r\n      membership_id: membership.id,\r\n      result \r\n    })\r\n  } catch (e) {\r\n    console.error('Manual renewal test error:', e)\r\n    return c.json({ error: String(e), stack: String(e.stack || '') }, 500)\r\n  }\r\n})\r\n\r\n// ============================================================================\r\n// PRODUCT & SHOP API ENDPOINTS\r\n// ============================================================================\r\n\r\n// Get all active products (public)\r\napp.get('/products', async (c) => {\r\n  try {\r\n    await ensureSchema(c.env.DB, 'user_id')\r\n    \r\n    const products = await c.env.DB.prepare(`\r\n      SELECT id, name, slug, description, summary, full_description, price, currency, stock_quantity, image_url, category, is_active, created_at\r\n      FROM products\r\n      WHERE is_active = 1\r\n      ORDER BY name ASC\r\n    `).all()\r\n    \r\n    return c.json(products.results || [])\r\n  } catch (e) {\r\n    console.error('Get products error:', e)\r\n    return c.json({ error: 'internal_error' }, 500)\r\n  }\r\n})\r\n\r\n// Get single product by ID or slug (public)\r\napp.get('/products/:id', async (c) => {\r\n  try {\r\n    await ensureSchema(c.env.DB, 'user_id')\r\n    const id = c.req.param('id')\r\n    \r\n    // Try to find by ID first, then by slug\r\n    let product\r\n    if (/^\\d+$/.test(id)) {\r\n      product = await c.env.DB.prepare('SELECT * FROM products WHERE id = ? AND is_active = 1').bind(id).first()\r\n    }\r\n    \r\n    if (!product) {\r\n      product = await c.env.DB.prepare('SELECT * FROM products WHERE slug = ? AND is_active = 1').bind(id).first()\r\n    }\r\n    \r\n    if (!product) {\r\n      return c.json({ error: 'product_not_found' }, 404)\r\n    }\r\n    \r\n    return c.json(product)\r\n  } catch (e) {\r\n    console.error('Get product error:', e)\r\n    return c.json({ error: 'internal_error' }, 500)\r\n  }\r\n})\r\n\r\n// Create new product (admin only - TODO: add authentication)\r\napp.post('/admin/products', requireAdmin, async (c) => {\r\n  try {\r\n    await ensureSchema(c.env.DB, 'user_id')\r\n    \r\n    const { name, slug, description, summary, full_description, price, currency, stock_quantity, image_url, category } = await c.req.json()\r\n    \r\n    if (!name || !slug || price === undefined) {\r\n      return c.json({ error: 'missing_required_fields' }, 400)\r\n    }\r\n    \r\n    const now = toIso(new Date())\r\n    const result = await c.env.DB.prepare(`\r\n      INSERT INTO products (name, slug, description, summary, full_description, price, currency, stock_quantity, image_url, category, created_at, updated_at)\r\n      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\r\n    `).bind(\r\n      name, \r\n      slug, \r\n      description || null,\r\n      summary || null, \r\n      full_description || null,\r\n      price, \r\n      currency || 'GBP', \r\n      stock_quantity || 0, \r\n      image_url || null, \r\n      category || null,\r\n      now,\r\n      now\r\n    ).run()\r\n    \r\n    return c.json({ success: true, product_id: result.meta.last_row_id })\r\n  } catch (e) {\r\n    console.error('Create product error:', e)\r\n    if (e.message?.includes('UNIQUE constraint')) {\r\n      return c.json({ error: 'slug_already_exists' }, 400)\r\n    }\r\n    return c.json({ error: 'internal_error' }, 500)\r\n  }\r\n})\r\n\r\n// Update product (admin only)\r\napp.put('/admin/products/:id', requireAdmin, async (c) => {\r\n  try {\r\n    await ensureSchema(c.env.DB, 'user_id')\r\n    \r\n    const id = c.req.param('id')\r\n    const { name, slug, description, summary, full_description, price, currency, stock_quantity, image_url, category, is_active } = await c.req.json()\r\n    \r\n    const updates = []\r\n    const binds = []\r\n    \r\n    if (name !== undefined) { updates.push('name = ?'); binds.push(name) }\r\n    if (slug !== undefined) { updates.push('slug = ?'); binds.push(slug) }\r\n    if (description !== undefined) { updates.push('description = ?'); binds.push(description) }\r\n    if (summary !== undefined) { updates.push('summary = ?'); binds.push(summary) }\r\n    if (full_description !== undefined) { updates.push('full_description = ?'); binds.push(full_description) }\r\n    if (price !== undefined) { updates.push('price = ?'); binds.push(price) }\r\n    if (currency !== undefined) { updates.push('currency = ?'); binds.push(currency) }\r\n    if (stock_quantity !== undefined) { updates.push('stock_quantity = ?'); binds.push(stock_quantity) }\r\n    if (image_url !== undefined) { updates.push('image_url = ?'); binds.push(image_url) }\r\n    if (category !== undefined) { updates.push('category = ?'); binds.push(category) }\r\n    if (is_active !== undefined) { updates.push('is_active = ?'); binds.push(is_active ? 1 : 0) }\r\n    \r\n    // Handle image update - delete old image if new one provided and different\r\n    if (image_url !== undefined) {\r\n      // Get current product to find old image\r\n      const currentProduct = await c.env.DB.prepare('SELECT image_url FROM products WHERE id = ?')\r\n        .bind(id).first()\r\n      \r\n      if (currentProduct && currentProduct.image_url && currentProduct.image_url !== image_url) {\r\n        const oldKey = extractImageKey(currentProduct.image_url)\r\n        if (oldKey && c.env.IMAGES) {\r\n          try {\r\n            await c.env.IMAGES.delete(oldKey)\r\n            console.log('Deleted old image:', oldKey)\r\n          } catch (err) {\r\n            console.error('Failed to delete old image:', err)\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n    if (updates.length === 0) {\r\n      return c.json({ error: 'no_fields_to_update' }, 400)\r\n    }\r\n    \r\n    updates.push('updated_at = ?')\r\n    binds.push(toIso(new Date()))\r\n    binds.push(id)\r\n    \r\n    await c.env.DB.prepare(`\r\n      UPDATE products SET ${updates.join(', ')} WHERE id = ?\r\n    `).bind(...binds).run()\r\n    \r\n    return c.json({ success: true })\r\n  } catch (e) {\r\n    console.error('Update product error:', e)\r\n    return c.json({ error: 'internal_error' }, 500)\r\n  }\r\n})\r\n\r\n// Delete product (admin only - soft delete by setting is_active = 0)\r\napp.delete('/admin/products/:id', requireAdmin, async (c) => {\r\n  try {\r\n    await ensureSchema(c.env.DB, 'user_id')\r\n    \r\n    const id = c.req.param('id')\r\n    \r\n    // Get product to find image\r\n    const product = await c.env.DB.prepare('SELECT image_url FROM products WHERE id = ?')\r\n      .bind(id).first()\r\n    \r\n    // Delete image from R2\r\n    if (product && product.image_url) {\r\n      const imageKey = extractImageKey(product.image_url)\r\n      if (imageKey && c.env.IMAGES) {\r\n        try {\r\n          await c.env.IMAGES.delete(imageKey)\r\n        } catch (err) {\r\n          console.error('Failed to delete image:', err)\r\n        }\r\n      }\r\n    }\r\n    \r\n    await c.env.DB.prepare('UPDATE products SET is_active = 0, updated_at = ? WHERE id = ?')\r\n      .bind(toIso(new Date()), id)\r\n      .run()\r\n    \r\n    return c.json({ success: true })\r\n  } catch (e) {\r\n    console.error('Delete product error:', e)\r\n    return c.json({ error: 'internal_error' }, 500)\r\n  }\r\n})\r\n\r\n// Get all orders (admin only)\r\napp.get('/admin/orders', async (c) => {\r\n  try {\r\n    await ensureSchema(c.env.DB, 'user_id')\r\n    \r\n    const adminKey = c.req.header('X-Admin-Key')\r\n    if (adminKey !== c.env.ADMIN_KEY) {\r\n      return c.json({ error: 'unauthorized' }, 401)\r\n    }\r\n    \r\n    const orders = await c.env.DB.prepare(`\r\n      SELECT * FROM orders \r\n      ORDER BY created_at DESC\r\n      LIMIT 100\r\n    `).all()\r\n    \r\n    return c.json(orders.results || [])\r\n  } catch (e) {\r\n    console.error('Get orders error:', e)\r\n    return c.json({ error: 'internal_error' }, 500)\r\n  }\r\n})\r\n\r\n// Get order details with items (admin only or order owner)\r\napp.get('/orders/:orderNumber', async (c) => {\r\n  try {\r\n    await ensureSchema(c.env.DB, 'user_id')\r\n    \r\n    const orderNumber = c.req.param('orderNumber')\r\n    const email = c.req.query('email')\r\n    \r\n    const order = await c.env.DB.prepare('SELECT * FROM orders WHERE order_number = ?')\r\n      .bind(orderNumber)\r\n      .first()\r\n    \r\n    if (!order) {\r\n      return c.json({ error: 'order_not_found' }, 404)\r\n    }\r\n    \r\n    // Check authorization (admin or order owner)\r\n    const adminKey = c.req.header('X-Admin-Key')\r\n    if (adminKey !== c.env.ADMIN_KEY && order.email !== email) {\r\n      return c.json({ error: 'unauthorized' }, 401)\r\n    }\r\n    \r\n    // Get order items\r\n    const items = await c.env.DB.prepare('SELECT * FROM order_items WHERE order_id = ?')\r\n      .bind(order.id)\r\n      .all()\r\n    \r\n    return c.json({\r\n      ...order,\r\n      items: items.results || []\r\n    })\r\n  } catch (e) {\r\n    console.error('Get order error:', e)\r\n    return c.json({ error: 'internal_error' }, 500)\r\n  }\r\n})\r\n\r\n// ============================================================================\r\n// SHOP CHECKOUT ENDPOINT\r\n// ============================================================================\r\n\r\n// Create order and SumUp checkout for shop purchases\r\napp.post('/shop/checkout', async (c) => {\r\n  try {\r\n    await ensureSchema(c.env.DB, 'user_id')\r\n    \r\n    const { email, name, items, shipping_address, delivery_method, notes, consent_at } = await c.req.json()\r\n    \r\n    if (!email || !name || !items || items.length === 0 || !consent_at) {\r\n      return c.json({ error: 'missing_required_fields' }, 400)\r\n    }\r\n\r\n    if (!delivery_method || !['collection', 'delivery'].includes(delivery_method)) {\r\n      return c.json({ error: 'invalid_delivery_method' }, 400)\r\n    }\r\n\r\n    // Validate shipping address if delivery is selected\r\n    if (delivery_method === 'delivery' && !shipping_address) {\r\n      return c.json({ error: 'shipping_address_required_for_delivery' }, 400)\r\n    }\r\n    \r\n    if (!EMAIL_RE.test(email)) {\r\n      return c.json({ error: 'invalid_email' }, 400)\r\n    }\r\n    \r\n    // Fetch product details and calculate total\r\n    let subtotal = 0\r\n    const orderItems = []\r\n    \r\n    for (const item of items) {\r\n      const product = await c.env.DB.prepare('SELECT * FROM products WHERE id = ? AND is_active = 1')\r\n        .bind(item.product_id)\r\n        .first()\r\n      \r\n      if (!product) {\r\n        return c.json({ error: `product_not_found: ${item.product_id}` }, 400)\r\n      }\r\n      \r\n      if (product.stock_quantity < item.quantity) {\r\n        return c.json({ error: `insufficient_stock: ${product.name}` }, 400)\r\n      }\r\n      \r\n      const itemSubtotal = product.price * item.quantity\r\n      subtotal += itemSubtotal\r\n      \r\n      orderItems.push({\r\n        product_id: product.id,\r\n        product_name: product.name,\r\n        quantity: item.quantity,\r\n        unit_price: product.price,\r\n        subtotal: itemSubtotal\r\n      })\r\n    }\r\n    \r\n    // Calculate shipping: \u00A34 for delivery, \u00A30 for collection\r\n    const shipping = delivery_method === 'delivery' ? 400 : 0 // \u00A34.00 in pence\r\n    const tax = 0 // No VAT in Gibraltar\r\n    const total = subtotal + shipping + tax\r\n    \r\n    // Generate unique order number\r\n    const orderNumber = 'ORD-' + Date.now() + '-' + Math.random().toString(36).substr(2, 6).toUpperCase()\r\n    \r\n    // Create order in database (without checkout_id initially)\r\n    const now = toIso(new Date())\r\n    const orderResult = await c.env.DB.prepare(`\r\n      INSERT INTO orders (\r\n        order_number, email, name, status, \r\n        subtotal, tax, shipping, total, currency,\r\n        payment_status,\r\n        shipping_address, billing_address, notes,\r\n        created_at, updated_at\r\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\r\n    `).bind(\r\n      orderNumber, email, name, 'pending',\r\n      subtotal, tax, shipping, total, 'GBP',\r\n      'pending',\r\n      shipping_address ? JSON.stringify(shipping_address) : null,\r\n      shipping_address ? JSON.stringify(shipping_address) : null,\r\n      notes || null,\r\n      now, now\r\n    ).run()\r\n    \r\n    const orderId = orderResult.meta.last_row_id\r\n    \r\n    // Insert order items\r\n    for (const item of orderItems) {\r\n      await c.env.DB.prepare(`\r\n        INSERT INTO order_items (order_id, product_id, product_name, quantity, unit_price, subtotal)\r\n        VALUES (?, ?, ?, ?, ?, ?)\r\n      `).bind(\r\n        orderId,\r\n        item.product_id,\r\n        item.product_name,\r\n        item.quantity,\r\n        item.unit_price,\r\n        item.subtotal\r\n      ).run()\r\n    }\r\n    \r\n    // Create SumUp checkout\r\n    let checkout\r\n    try {\r\n      checkout = await createCheckout(c.env, {\r\n        amount: total / 100, // Convert pence to pounds\r\n        currency: 'GBP',\r\n        orderRef: orderNumber,\r\n        title: `Order ${orderNumber}`,\r\n        description: `Shop order - ${orderItems.length} item(s)`\r\n      })\r\n    } catch (err) {\r\n      console.error('SumUp checkout error:', err)\r\n      return c.json({ error: 'sumup_checkout_failed', message: String(err?.message || err) }, 502)\r\n    }\r\n    \r\n    if (!checkout.id) {\r\n      console.error('SumUp checkout missing id', checkout)\r\n      return c.json({ error: 'sumup_missing_id' }, 502)\r\n    }\r\n    \r\n    // Update order with checkout_id\r\n    await c.env.DB.prepare('UPDATE orders SET checkout_id = ? WHERE id = ?')\r\n      .bind(checkout.id, orderId)\r\n      .run()\r\n    \r\n    // Return checkoutId for widget (same pattern as membership checkout)\r\n    return c.json({\r\n      success: true,\r\n      order_number: orderNumber,\r\n      checkoutId: checkout.id\r\n    })\r\n    \r\n  } catch (e) {\r\n    console.error('Shop checkout error:', e)\r\n    return c.json({ error: 'internal_error', details: String(e) }, 500)\r\n  }\r\n})\r\n\r\n// Webhook endpoint for SumUp payment notifications\r\napp.post('/webhooks/sumup/shop-payment', async (c) => {\r\n  try {\r\n    const payload = await c.req.json()\r\n    console.log('SumUp shop payment webhook:', JSON.stringify(payload))\r\n    \r\n    // Extract checkout reference (order number)\r\n    const checkoutReference = payload.checkout_reference || payload.id\r\n    \r\n    if (!checkoutReference) {\r\n      return c.json({ error: 'missing_checkout_reference' }, 400)\r\n    }\r\n    \r\n    // Find order by checkout reference\r\n    const order = await c.env.DB.prepare(\r\n      'SELECT * FROM orders WHERE order_number = ? OR checkout_id = ?'\r\n    ).bind(checkoutReference, checkoutReference).first()\r\n    \r\n    if (!order) {\r\n      console.error('Order not found for checkout reference:', checkoutReference)\r\n      return c.json({ error: 'order_not_found' }, 404)\r\n    }\r\n    \r\n    // Only process if payment is successful\r\n    if (payload.status === 'PAID' || payload.status === 'paid') {\r\n      await processShopOrderPayment(c.env.DB, order.id, payload.id, c.env)\r\n    }\r\n    \r\n    return c.json({ success: true })\r\n  } catch (e) {\r\n    console.error('Shop payment webhook error:', e)\r\n    return c.json({ error: 'internal_error' }, 500)\r\n  }\r\n})\r\n\r\n// Manual payment confirmation endpoint (called from order confirmation page)\r\napp.post('/shop/confirm-payment/:orderNumber', async (c) => {\r\n  try {\r\n    const orderNumber = c.req.param('orderNumber')\r\n    \r\n    // Find order\r\n    const order = await c.env.DB.prepare(\r\n      'SELECT * FROM orders WHERE order_number = ?'\r\n    ).bind(orderNumber).first()\r\n    \r\n    if (!order) {\r\n      return c.json({ error: 'order_not_found' }, 404)\r\n    }\r\n    \r\n    // If already completed, return success\r\n    if (order.status === 'completed') {\r\n      return c.json({ success: true, status: 'completed', order })\r\n    }\r\n    \r\n    // Check payment status with SumUp (using checkout_reference which is the order_number)\r\n    try {\r\n      const { access_token } = await sumupToken(c.env, 'payments')\r\n      \r\n      // Try to find the checkout by order number (checkout_reference)\r\n      const checkoutsRes = await fetch(\r\n        `https://api.sumup.com/v0.1/checkouts?checkout_reference=${orderNumber}`,\r\n        { headers: { Authorization: `Bearer ${access_token}` } }\r\n      )\r\n      \r\n      if (checkoutsRes.ok) {\r\n        const checkouts = await checkoutsRes.json()\r\n        const checkout = checkouts.find(c => c.checkout_reference === orderNumber)\r\n        \r\n        if (checkout && (checkout.status === 'PAID' || checkout.status === 'paid')) {\r\n          // Payment confirmed! Process the order\r\n          await processShopOrderPayment(c.env.DB, order.id, checkout.id, c.env)\r\n          \r\n          // Fetch updated order\r\n          const updatedOrder = await c.env.DB.prepare(\r\n            'SELECT * FROM orders WHERE id = ?'\r\n          ).bind(order.id).first()\r\n          \r\n          return c.json({ success: true, status: 'completed', order: updatedOrder })\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.error('Error checking payment status:', e)\r\n    }\r\n    \r\n    // Payment not yet confirmed\r\n    return c.json({ success: true, status: 'pending', order })\r\n  } catch (e) {\r\n    console.error('Confirm payment error:', e)\r\n    return c.json({ error: 'internal_error' }, 500)\r\n  }\r\n})\r\n\r\n// Helper function to process shop order payment and reduce stock\r\nasync function processShopOrderPayment(db, orderId, checkoutId, env) {\r\n  const now = toIso(new Date())\r\n  \r\n  // Update order status\r\n  await db.prepare(`\r\n    UPDATE orders \r\n    SET status = 'completed', \r\n        payment_status = 'paid',\r\n        checkout_id = ?,\r\n        completed_at = ?,\r\n        updated_at = ?\r\n    WHERE id = ?\r\n  `).bind(checkoutId, now, now, orderId).run()\r\n  \r\n  // Get order items\r\n  const items = await db.prepare(\r\n    'SELECT * FROM order_items WHERE order_id = ?'\r\n  ).bind(orderId).all()\r\n  \r\n  // Reduce stock for each item\r\n  for (const item of items.results || []) {\r\n    await db.prepare(`\r\n      UPDATE products \r\n      SET stock_quantity = CASE \r\n        WHEN stock_quantity >= ? THEN stock_quantity - ?\r\n        ELSE 0\r\n      END,\r\n      updated_at = ?\r\n      WHERE id = ?\r\n    `).bind(item.quantity, item.quantity, now, item.product_id).run()\r\n    \r\n    console.log(`Reduced stock for product ${item.product_id} by ${item.quantity}`)\r\n  }\r\n  \r\n  console.log(`Order ${orderId} completed, stock reduced`)\r\n  \r\n  // Get full order details with items for email\r\n  const order = await db.prepare('SELECT * FROM orders WHERE id = ?').bind(orderId).first()\r\n  \r\n  if (order && order.email) {\r\n    try {\r\n      const emailContent = generateShopOrderEmail(order, items.results || [])\r\n      await sendEmail(env, { to: order.email, ...emailContent })\r\n      console.log(`Order confirmation email sent to ${order.email}`)\r\n    } catch (emailError) {\r\n      console.error('Failed to send order confirmation email:', emailError)\r\n      // Don't fail the entire operation if email fails\r\n    }\r\n  }\r\n}\r\n\r\n// Generate shop order confirmation email with invoice\r\nfunction generateShopOrderEmail(order, items) {\r\n  const formatPrice = (pence) => `\u00A3${(pence / 100).toFixed(2)}`\r\n  const orderDate = new Date(order.created_at).toLocaleDateString('en-GB', { \r\n    year: 'numeric', month: 'long', day: 'numeric' \r\n  })\r\n  \r\n  const deliveryMethod = order.shipping_address ? 'Local Delivery' : 'Collection'\r\n  const shippingCost = order.shipping || 0\r\n  \r\n  // Parse shipping address if available\r\n  let shippingAddress = ''\r\n  if (order.shipping_address) {\r\n    try {\r\n      const addr = typeof order.shipping_address === 'string' \r\n        ? JSON.parse(order.shipping_address) \r\n        : order.shipping_address\r\n      shippingAddress = `\r\n        <p style=\"margin: 0.25rem 0; color: #4b5563;\">\r\n          ${addr.line1}<br>\r\n          ${addr.line2 ? addr.line2 + '<br>' : ''}\r\n          ${addr.city}, ${addr.postcode}<br>\r\n          ${addr.country}\r\n        </p>\r\n      `\r\n    } catch (e) {\r\n      console.error('Error parsing shipping address:', e)\r\n    }\r\n  }\r\n  \r\n  const itemsHtml = items.map(item => `\r\n    <tr>\r\n      <td style=\"padding: 1rem; border-bottom: 1px solid #e5e7eb;\">\r\n        <strong style=\"color: #1f2937;\">${item.product_name}</strong>\r\n      </td>\r\n      <td style=\"padding: 1rem; border-bottom: 1px solid #e5e7eb; text-align: center; color: #4b5563;\">\r\n        ${item.quantity}\r\n      </td>\r\n      <td style=\"padding: 1rem; border-bottom: 1px solid #e5e7eb; text-align: right; color: #1f2937;\">\r\n        ${formatPrice(item.unit_price)}\r\n      </td>\r\n      <td style=\"padding: 1rem; border-bottom: 1px solid #e5e7eb; text-align: right; color: #1f2937; font-weight: 600;\">\r\n        ${formatPrice(item.subtotal)}\r\n      </td>\r\n    </tr>\r\n  `).join('')\r\n  \r\n  const html = `\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <meta charset=\"utf-8\">\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n  <title>Order Confirmation - ${order.order_number}</title>\r\n</head>\r\n<body style=\"margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background-color: #f3f4f6; line-height: 1.6;\">\r\n  <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color: #f3f4f6; padding: 2rem 1rem;\">\r\n    <tr>\r\n      <td align=\"center\">\r\n        <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color: #ffffff; border-radius: 12px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); overflow: hidden;\">\r\n          \r\n          <!-- Header -->\r\n          <tr>\r\n            <td style=\"background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); padding: 2.5rem 2rem; text-align: center;\">\r\n              <h1 style=\"margin: 0 0 0.5rem; color: #ffffff; font-size: 1.75rem; font-weight: 700;\">\r\n                Order Confirmed!\r\n              </h1>\r\n              <p style=\"margin: 0; color: #dbeafe; font-size: 0.95rem;\">\r\n                Thank you for your purchase from Dice Bastion Shop\r\n              </p>\r\n            </td>\r\n          </tr>\r\n          \r\n          <!-- Order Details -->\r\n          <tr>\r\n            <td style=\"padding: 2rem;\">\r\n              <p style=\"margin: 0 0 1.5rem; color: #4b5563; font-size: 1rem;\">\r\n                Hi <strong>${order.name}</strong>,\r\n              </p>\r\n              <p style=\"margin: 0 0 1.5rem; color: #4b5563; font-size: 1rem;\">\r\n                Your order has been confirmed and ${deliveryMethod === 'Collection' ? 'is being prepared for collection' : 'will be delivered soon'}. \r\n                Below is your order invoice for your records.\r\n              </p>\r\n              \r\n              <!-- Invoice Box -->\r\n              <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 2rem;\">\r\n                <tr>\r\n                  <td style=\"padding: 1.5rem;\">\r\n                    <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\">\r\n                      <tr>\r\n                        <td style=\"padding-bottom: 1rem;\">\r\n                          <p style=\"margin: 0; color: #6b7280; font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600;\">\r\n                            Invoice\r\n                          </p>\r\n                        </td>\r\n                      </tr>\r\n                      <tr>\r\n                        <td width=\"50%\" style=\"vertical-align: top;\">\r\n                          <p style=\"margin: 0 0 0.5rem; color: #9ca3af; font-size: 0.875rem;\">Order Number</p>\r\n                          <p style=\"margin: 0 0 1rem; color: #1f2937; font-size: 1.125rem; font-weight: 700; font-family: 'Courier New', monospace;\">\r\n                            ${order.order_number}\r\n                          </p>\r\n                          <p style=\"margin: 0 0 0.5rem; color: #9ca3af; font-size: 0.875rem;\">Order Date</p>\r\n                          <p style=\"margin: 0; color: #4b5563; font-weight: 600;\">\r\n                            ${orderDate}\r\n                          </p>\r\n                        </td>\r\n                        <td width=\"50%\" style=\"vertical-align: top; text-align: right;\">\r\n                          <p style=\"margin: 0 0 0.5rem; color: #9ca3af; font-size: 0.875rem;\">Bill To</p>\r\n                          <p style=\"margin: 0 0 0.25rem; color: #1f2937; font-weight: 600;\">${order.name}</p>\r\n                          <p style=\"margin: 0; color: #4b5563; font-size: 0.875rem;\">${order.email}</p>\r\n                        </td>\r\n                      </tr>\r\n                    </table>\r\n                  </td>\r\n                </tr>\r\n              </table>\r\n              \r\n              <!-- Items Table -->\r\n              <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; margin-bottom: 1.5rem;\">\r\n                <thead>\r\n                  <tr style=\"background-color: #f9fafb;\">\r\n                    <th style=\"padding: 1rem; text-align: left; font-weight: 600; color: #6b7280; font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 2px solid #e5e7eb;\">\r\n                      Item\r\n                    </th>\r\n                    <th style=\"padding: 1rem; text-align: center; font-weight: 600; color: #6b7280; font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 2px solid #e5e7eb;\">\r\n                      Qty\r\n                    </th>\r\n                    <th style=\"padding: 1rem; text-align: right; font-weight: 600; color: #6b7280; font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 2px solid #e5e7eb;\">\r\n                      Price\r\n                    </th>\r\n                    <th style=\"padding: 1rem; text-align: right; font-weight: 600; color: #6b7280; font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 2px solid #e5e7eb;\">\r\n                      Total\r\n                    </th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  ${itemsHtml}\r\n                </tbody>\r\n              </table>\r\n              \r\n              <!-- Totals -->\r\n              <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"margin-bottom: 2rem;\">\r\n                <tr>\r\n                  <td width=\"60%\"></td>\r\n                  <td width=\"40%\">\r\n                    <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\">\r\n                      <tr>\r\n                        <td style=\"padding: 0.5rem 0; color: #4b5563;\">Subtotal:</td>\r\n                        <td style=\"padding: 0.5rem 0; text-align: right; color: #1f2937; font-weight: 600;\">\r\n                          ${formatPrice(order.subtotal)}\r\n                        </td>\r\n                      </tr>\r\n                      <tr>\r\n                        <td style=\"padding: 0.5rem 0; color: #4b5563;\">Shipping:</td>\r\n                        <td style=\"padding: 0.5rem 0; text-align: right; color: #1f2937; font-weight: 600;\">\r\n                          ${shippingCost > 0 ? formatPrice(shippingCost) : 'FREE'}\r\n                        </td>\r\n                      </tr>\r\n                      <tr style=\"border-top: 2px solid #e5e7eb;\">\r\n                        <td style=\"padding: 1rem 0 0; color: #1f2937; font-size: 1.125rem; font-weight: 700;\">\r\n                          Total:\r\n                        </td>\r\n                        <td style=\"padding: 1rem 0 0; text-align: right; color: #2563eb; font-size: 1.25rem; font-weight: 700;\">\r\n                          ${formatPrice(order.total)}\r\n                        </td>\r\n                      </tr>\r\n                    </table>\r\n                  </td>\r\n                </tr>\r\n              </table>\r\n              \r\n              <!-- Delivery Information -->\r\n              <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color: #eff6ff; border-left: 4px solid #2563eb; border-radius: 6px; padding: 1.5rem; margin-bottom: 2rem;\">\r\n                <tr>\r\n                  <td>\r\n                    <p style=\"margin: 0 0 0.75rem; color: #1e40af; font-weight: 700; font-size: 1rem;\">\r\n                      ${deliveryMethod === 'Collection' ? '\uD83D\uDCE6 Collection Information' : '\uD83D\uDE9A Delivery Information'}\r\n                    </p>\r\n                    ${deliveryMethod === 'Collection' ? `\r\n                      <p style=\"margin: 0 0 0.5rem; color: #1e3a8a; font-weight: 600;\">\r\n                        Gibraltar Warhammer Club\r\n                      </p>\r\n                      <p style=\"margin: 0 0 0.5rem; color: #3b82f6;\">\r\n                        <a href=\"https://maps.app.goo.gl/xRVr1Jq58ANZ9DLY6\" style=\"color: #2563eb; text-decoration: none;\">\r\n                          View Location on Map \u2192\r\n                        </a>\r\n                      </p>\r\n                      <p style=\"margin: 0 0 0.5rem; color: #4b5563;\">\r\n                        <strong>Collection Hours:</strong><br>\r\n                        Thursdays: 6pm - 10pm<br>\r\n                        Saturdays: 2pm - 8pm\r\n                      </p>\r\n                      <p style=\"margin: 0.75rem 0 0; color: #6b7280; font-size: 0.875rem;\">\r\n                        We'll email you within 24 hours when your order is ready for collection.\r\n                      </p>\r\n                    ` : `\r\n                      <p style=\"margin: 0 0 0.5rem; color: #1e3a8a; font-weight: 600;\">\r\n                        Delivery Address:\r\n                      </p>\r\n                      ${shippingAddress}\r\n                      <p style=\"margin: 0.75rem 0 0; color: #6b7280; font-size: 0.875rem;\">\r\n                        Expected delivery: 2-3 business days\r\n                      </p>\r\n                    `}\r\n                  </td>\r\n                </tr>\r\n              </table>\r\n              \r\n              ${order.notes ? `\r\n              <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color: #f9fafb; border: 1px solid #e5e7eb; border-radius: 6px; padding: 1rem; margin-bottom: 2rem;\">\r\n                <tr>\r\n                  <td>\r\n                    <p style=\"margin: 0 0 0.5rem; color: #6b7280; font-size: 0.875rem; font-weight: 600;\">\r\n                      Order Notes:\r\n                    </p>\r\n                    <p style=\"margin: 0; color: #4b5563; font-size: 0.9rem;\">\r\n                      ${order.notes}\r\n                    </p>\r\n                  </td>\r\n                </tr>\r\n              </table>\r\n              ` : ''}\r\n              \r\n              <p style=\"margin: 0 0 1rem; color: #4b5563; font-size: 0.95rem;\">\r\n                If you have any questions about your order, please reply to this email or contact us at \r\n                <a href=\"mailto:support@dicebastion.com\" style=\"color: #2563eb; text-decoration: none;\">support@dicebastion.com</a>\r\n              </p>\r\n              \r\n              <p style=\"margin: 0; color: #4b5563; font-size: 0.95rem;\">\r\n                Thank you for supporting your local gaming community!\r\n              </p>\r\n            </td>\r\n          </tr>\r\n          \r\n          <!-- Footer -->\r\n          <tr>\r\n            <td style=\"background-color: #f9fafb; padding: 1.5rem 2rem; text-align: center; border-top: 1px solid #e5e7eb;\">\r\n              <p style=\"margin: 0 0 0.5rem; color: #6b7280; font-size: 0.875rem;\">\r\n                <strong>Dice Bastion Shop</strong>\r\n              </p>\r\n              <p style=\"margin: 0 0 1rem; color: #9ca3af; font-size: 0.8rem;\">\r\n                Gibraltar's Premier Gaming Store\r\n              </p>\r\n              <p style=\"margin: 0; color: #9ca3af; font-size: 0.75rem;\">\r\n                <a href=\"https://shop.dicebastion.com\" style=\"color: #2563eb; text-decoration: none; margin: 0 0.5rem;\">Shop</a> |\r\n                <a href=\"https://dicebastion.com\" style=\"color: #2563eb; text-decoration: none; margin: 0 0.5rem;\">Main Site</a> |\r\n                <a href=\"https://dicebastion.com/privacy-policy\" style=\"color: #2563eb; text-decoration: none; margin: 0 0.5rem;\">Privacy Policy</a>\r\n              </p>\r\n            </td>\r\n          </tr>\r\n          \r\n        </table>\r\n      </td>\r\n    </tr>\r\n  </table>\r\n</body>\r\n</html>\r\n  `.trim()\r\n  \r\n  const text = `\r\nOrder Confirmation - ${order.order_number}\r\n\r\nHi ${order.name},\r\n\r\nThank you for your order! Your order has been confirmed and ${deliveryMethod === 'Collection' ? 'is being prepared for collection' : 'will be delivered soon'}.\r\n\r\nORDER DETAILS\r\nOrder Number: ${order.order_number}\r\nOrder Date: ${orderDate}\r\nPayment Status: Paid\r\n\r\nITEMS ORDERED\r\n${items.map(item => `${item.product_name} x ${item.quantity} - ${formatPrice(item.subtotal)}`).join('\\n')}\r\n\r\nSUMMARY\r\nSubtotal: ${formatPrice(order.subtotal)}\r\nShipping: ${shippingCost > 0 ? formatPrice(shippingCost) : 'FREE'}\r\nTotal: ${formatPrice(order.total)}\r\n\r\n${deliveryMethod === 'Collection' ? `\r\nCOLLECTION INFORMATION\r\nLocation: Gibraltar Warhammer Club\r\nView on map: https://maps.app.goo.gl/xRVr1Jq58ANZ9DLY6\r\nCollection Hours:\r\n- Thursdays: 6pm - 10pm\r\n- Saturdays: 2pm - 8pm\r\n\r\nWe'll email you within 24 hours when your order is ready for collection.\r\n` : `\r\nDELIVERY INFORMATION\r\nYour order will be delivered to the address provided within 2-3 business days.\r\n`}\r\n\r\n${order.notes ? `Order Notes: ${order.notes}\\n` : ''}\r\n\r\nIf you have any questions, please contact us at support@dicebastion.com\r\n\r\nThank you for supporting your local gaming community!\r\n\r\nDice Bastion Shop\r\nhttps://shop.dicebastion.com\r\n  `.trim()\r\n  \r\n  return {\r\n    subject: `Order Confirmation - ${order.order_number}`,\r\n    html,\r\n    text\r\n  }\r\n}\r\n\r\n// Cron trigger for processing renewals and warnings (runs daily at 2 AM UTC)\r\nasync function handleScheduled(event, env, ctx) {\r\n  console.log('Starting membership cron job: renewals + pre-renewal warnings')\r\n  \r\n  try {\r\n    await ensureSchema(env.DB, 'user_id')\r\n    \r\n    const now = new Date()\r\n    const sevenDaysFromNow = toIso(addMonths(now, 0.23)) // ~7 days\r\n    const twoDaysFromNow = toIso(addMonths(now, 0.067)) // ~2 days\r\n    const nowIso = toIso(now)\r\n    \r\n    // 1. Find memberships expiring in 7 days or less (ready for renewal)\r\n    const expiringMemberships = await env.DB.prepare(`\r\n      SELECT * FROM memberships \r\n      WHERE status = 'active' \r\n        AND auto_renew = 1 \r\n        AND end_date <= ? \r\n        AND end_date >= ?\r\n        AND (renewal_attempts IS NULL OR renewal_attempts < 3)\r\n      ORDER BY end_date ASC\r\n    `).bind(sevenDaysFromNow, nowIso).all()\r\n    \r\n    console.log(`Found ${expiringMemberships.results?.length || 0} memberships to renew`)\r\n    \r\n    // 2. Find memberships expiring in ~2 days (send warning email)\r\n    const upcomingRenewals = await env.DB.prepare(`\r\n      SELECT m.*, u.user_id, u.email, u.name\r\n      FROM memberships m\r\n      JOIN users u ON (m.user_id = u.user_id OR m.member_id = u.user_id)\r\n      WHERE m.status = 'active' \r\n        AND m.auto_renew = 1 \r\n        AND m.end_date <= ?\r\n        AND m.end_date > ?\r\n        AND (m.renewal_warning_sent IS NULL OR m.renewal_warning_sent = 0)\r\n      ORDER BY m.end_date ASC\r\n    `).bind(twoDaysFromNow, nowIso).all()\r\n    \r\n    console.log(`Found ${upcomingRenewals.results?.length || 0} memberships needing pre-renewal warning`)\r\n    \r\n    const renewalResults = []\r\n    const warningResults = []\r\n    \r\n    // Process renewals\r\n    for (const membership of (expiringMemberships.results || [])) {\r\n      console.log(`Processing renewal for membership ${membership.id}`)\r\n      const result = await processMembershipRenewal(env.DB, membership, env)\r\n      renewalResults.push({ membershipId: membership.id, ...result })\r\n      await new Promise(resolve => setTimeout(resolve, 100))\r\n    }\r\n    \r\n    // Send pre-renewal warnings\r\n    for (const row of (upcomingRenewals.results || [])) {\r\n      try {\r\n        const daysUntil = Math.ceil((new Date(row.end_date) - now) / (1000 * 60 * 60 * 24))\r\n        console.log(`Sending pre-renewal warning for membership ${row.id} (${daysUntil} days until renewal)`)\r\n        \r\n        // Get payment instrument last 4 digits\r\n        let last4 = null\r\n        if (row.payment_instrument_id) {\r\n          const instrument = await env.DB.prepare('SELECT last_4 FROM payment_instruments WHERE instrument_id = ?')\r\n            .bind(row.payment_instrument_id).first()\r\n          last4 = instrument?.last_4\r\n        }\r\n        \r\n        const membership = { ...row, payment_instrument_last_4: last4 }\r\n        const user = { user_id: row.user_id, email: row.email, name: row.name }\r\n        const emailContent = getUpcomingRenewalEmail(membership, user, daysUntil)\r\n        \r\n        await sendEmail(env, { to: user.email, ...emailContent })\r\n        \r\n        // Mark warning as sent\r\n        await env.DB.prepare('UPDATE memberships SET renewal_warning_sent = 1 WHERE id = ?')\r\n          .bind(row.id).run()\r\n        \r\n        warningResults.push({ membershipId: row.id, success: true, daysUntil })\r\n      } catch (e) {\r\n        console.error(`Pre-renewal warning failed for membership ${row.id}:`, e)\r\n        warningResults.push({ membershipId: row.id, success: false, error: String(e) })\r\n      }\r\n      await new Promise(resolve => setTimeout(resolve, 100))\r\n    }\r\n    \r\n    console.log('Cron job completed', { \r\n      renewals: { processed: renewalResults.length, successful: renewalResults.filter(r => r.success).length },\r\n      warnings: { sent: warningResults.length, successful: warningResults.filter(r => r.success).length }\r\n    })\r\n    \r\n    return { \r\n      success: true, \r\n      renewals: renewalResults, \r\n      warnings: warningResults \r\n    }\r\n  } catch (e) {\r\n    console.error('Cron job error:', e)\r\n    return { success: false, error: String(e) }\r\n  }\r\n}\r\n\r\n// Debug endpoint\r\napp.get('/debug/auth', (c) => {\r\n  const adminKey = c.req.header('X-Admin-Key')\r\n  const envKey = c.env.ADMIN_KEY\r\n  return c.json({ \r\n    receivedKey: adminKey, \r\n    hasEnvKey: !!envKey,\r\n    match: adminKey === envKey,\r\n    envKeyLength: envKey?.length\r\n  })\r\n})\r\n\r\n// ===== ADMIN AUTHENTICATION ENDPOINTS =====\r\n\r\n// Helper: Generate secure session token\r\nfunction generateSessionToken() {\r\n  const array = new Uint8Array(32)\r\n  crypto.getRandomValues(array)\r\n  return Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('')\r\n}\r\n\r\n// Helper: Verify admin session\r\nasync function verifyAdminSession(db, sessionToken) {\r\n  if (!sessionToken) return null\r\n  \r\n  const now = toIso(new Date())\r\n  const session = await db.prepare(`\r\n    SELECT s.*, u.email, u.name, u.is_admin, u.is_active\r\n    FROM user_sessions s\r\n    JOIN users u ON s.user_id = u.user_id\r\n    WHERE s.session_token = ? AND s.expires_at > ? AND u.is_active = 1 AND u.is_admin = 1\r\n  `).bind(sessionToken, now).first()\r\n  \r\n  return session\r\n}\r\n\r\n// Admin Login\r\napp.post('/admin/login', async (c) => {\r\n  try {\r\n    const { email, password } = await c.req.json()\r\n    \r\n    if (!email || !password) {\r\n      return c.json({ error: 'email_and_password_required' }, 400)\r\n    }\r\n    \r\n    // Find user\r\n    const user = await c.env.DB.prepare(\r\n      'SELECT * FROM users WHERE email = ? AND is_active = 1'\r\n    ).bind(email.toLowerCase()).first()\r\n    \r\n    if (!user) {\r\n      return c.json({ error: 'invalid_credentials' }, 401)\r\n    }\r\n    \r\n    // Verify password\r\n    const validPassword = await bcrypt.compare(password, user.password_hash)\r\n    if (!validPassword) {\r\n      return c.json({ error: 'invalid_credentials' }, 401)\r\n    }\r\n    \r\n    // Check admin role\r\n    if (!user.is_admin) {\r\n      return c.json({ error: 'insufficient_permissions' }, 403)\r\n    }\r\n    \r\n    // Create session (expires in 7 days)\r\n    const sessionToken = generateSessionToken()\r\n    const expiresAt = toIso(new Date(Date.now() + 7 * 24 * 60 * 60 * 1000))\r\n    const now = toIso(new Date())\r\n    \r\n    await c.env.DB.prepare(`\r\n      INSERT INTO user_sessions (user_id, session_token, expires_at, created_at)\r\n      VALUES (?, ?, ?, ?)\r\n    `).bind(user.user_id, sessionToken, expiresAt, now).run()\r\n    \r\n    // Update last login\r\n    await c.env.DB.prepare(\r\n      'UPDATE users SET last_login_at = ? WHERE user_id = ?'\r\n    ).bind(now, user.user_id).run()\r\n    \r\n    return c.json({\r\n      success: true,\r\n      session_token: sessionToken,\r\n      expires_at: expiresAt,\r\n      user: {\r\n        id: user.user_id,\r\n        email: user.email,\r\n        name: user.name\r\n      }\r\n    })\r\n  } catch (err) {\r\n    console.error('Admin login error:', err)\r\n    return c.json({ error: 'login_failed' }, 500)\r\n  }\r\n})\r\n\r\n// Admin Logout\r\napp.post('/admin/logout', async (c) => {\r\n  const sessionToken = c.req.header('X-Session-Token')\r\n  \r\n  if (sessionToken) {\r\n    await c.env.DB.prepare(\r\n      'DELETE FROM user_sessions WHERE session_token = ?'\r\n    ).bind(sessionToken).run()\r\n  }\r\n  \r\n  return c.json({ success: true })\r\n})\r\n\r\n// Verify Admin Session\r\napp.get('/admin/verify', async (c) => {\r\n  const sessionToken = c.req.header('X-Session-Token')\r\n  const session = await verifyAdminSession(c.env.DB, sessionToken)\r\n  \r\n  if (!session) {\r\n    return c.json({ error: 'invalid_session' }, 401)\r\n  }\r\n  \r\n  return c.json({\r\n    valid: true,\r\n    user: {\r\n      id: session.user_id,\r\n      email: session.email,\r\n      name: session.name\r\n    }\r\n  })\r\n})\r\n\r\n// Middleware: Require admin session\r\nasync function requireAdminSession(c, next) {\r\n  const sessionToken = c.req.header('X-Session-Token')\r\n  const session = await verifyAdminSession(c.env.DB, sessionToken)\r\n  \r\n  if (!session) {\r\n    return c.json({ error: 'unauthorized' }, 401)\r\n  }\r\n  \r\n  c.set('adminUser', { id: session.user_id, email: session.email, name: session.name })\r\n  await next()\r\n}\r\n\r\n// Update existing admin endpoints to use session-based auth OR fallback to admin key\r\nasync function requireAdmin(c, next) {\r\n  // Try session-based auth first\r\n  const sessionToken = c.req.header('X-Session-Token')\r\n  if (sessionToken) {\r\n    const session = await verifyAdminSession(c.env.DB, sessionToken)\r\n    if (session) {\r\n      c.set('adminUser', { id: session.user_id, email: session.email, name: session.name })\r\n      return await next()\r\n    }\r\n  }\r\n  \r\n  // Fallback to legacy admin key (for backward compatibility)\r\n  const adminKey = c.req.header('X-Admin-Key')\r\n  if (adminKey && adminKey === c.env.ADMIN_KEY) {\r\n    c.set('adminUser', { legacy: true })\r\n    return await next()\r\n  }\r\n  \r\n  return c.json({ error: 'unauthorized' }, 401)\r\n}\r\n\r\n// ============================================================================\r\n// Image Management (R2)\r\n// ============================================================================\r\n\r\n// Helper: Extract old image filename from URL\r\nfunction extractImageKey(imageUrl) {\r\n  if (!imageUrl || imageUrl.startsWith('data:')) return null\r\n  try {\r\n    const url = new URL(imageUrl)\r\n    // Extract path after domain\r\n    const path = url.pathname\r\n    // Remove leading slash and 'images/' prefix if present\r\n    return path.replace(/^\\//, '').replace(/^images\\//, '')\r\n  } catch {\r\n    return null\r\n  }\r\n}\r\n\r\n// Upload image to R2\r\napp.post('/admin/images', requireAdmin, async (c) => {\r\n  try {\r\n    const { image, filename } = await c.req.json()\r\n    \r\n    if (!image) {\r\n      return c.json({ error: 'image_required' }, 400)\r\n    }\r\n    \r\n    // Extract base64 data\r\n    let base64Data = image\r\n    if (image.startsWith('data:')) {\r\n      base64Data = image.split(',')[1]\r\n    }\r\n    \r\n    // Convert base64 to binary\r\n    const binaryString = atob(base64Data)\r\n    const bytes = new Uint8Array(binaryString.length)\r\n    for (let i = 0; i < binaryString.length; i++) {\r\n      bytes[i] = binaryString.charCodeAt(i)\r\n    }\r\n    \r\n    // Generate unique filename\r\n    const timestamp = Date.now()\r\n    const randomStr = Math.random().toString(36).substring(2, 8)\r\n    const ext = filename ? filename.split('.').pop() : 'jpg'\r\n    const key = `${timestamp}-${randomStr}.${ext}`\r\n    \r\n    // Upload to R2\r\n    await c.env.IMAGES.put(key, bytes, {\r\n      httpMetadata: {\r\n        contentType: 'image/jpeg',\r\n      },\r\n    })\r\n    \r\n    // Return public URL\r\n    const imageUrl = `https://pub-631ca6f207ca4661ac9cb2ba9371ba31.r2.dev/${key}`\r\n    \r\n    return c.json({ \r\n      success: true, \r\n      url: imageUrl,\r\n      key: key\r\n    })\r\n  } catch (err) {\r\n    console.error('Image upload error:', err)\r\n    return c.json({ error: 'upload_failed' }, 500)\r\n  }\r\n})\r\n\r\n// Delete image from R2\r\napp.delete('/admin/images/:key', requireAdmin, async (c) => {\r\n  try {\r\n    const key = c.req.param('key')\r\n    await c.env.IMAGES.delete(key)\r\n    return c.json({ success: true })\r\n  } catch (err) {\r\n    console.error('Image delete error:', err)\r\n    return c.json({ error: 'delete_failed' }, 500)\r\n  }\r\n})\r\n\r\nexport default {\r\n  fetch: app.fetch,\r\n  scheduled: handleScheduled\r\n}\r\n"],
  "mappings": "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AAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAChE;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAChE;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAChE;AAAA,QAAG;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAC/D;AAAA,QAAI;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QAAG;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAChE;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAChE;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAChE;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,QAAI;AAAA,MAAE;AAM9C,UAAI,qBAAqB,OAAO;AAShC,eAAS,cAAc,GAAG,KAAK;AAC3B,YAAI,MAAM,GACN,KAAK,CAAC,GACN,IAAI;AACR,YAAI,OAAO,KAAK,MAAM,EAAE;AACpB,gBAAM,MAAM,kBAAgB,GAAG;AACnC,eAAO,MAAM,KAAK;AACd,eAAK,EAAE,KAAK,IAAI;AAChB,aAAG,KAAK,YAAa,MAAM,IAAK,EAAI,CAAC;AACrC,gBAAM,KAAK,MAAS;AACpB,cAAI,OAAO,KAAK;AACZ,eAAG,KAAK,YAAY,KAAK,EAAI,CAAC;AAC9B;AAAA,UACJ;AACA,eAAK,EAAE,KAAK,IAAI;AAChB,gBAAO,MAAM,IAAK;AAClB,aAAG,KAAK,YAAY,KAAK,EAAI,CAAC;AAC9B,gBAAM,KAAK,OAAS;AACpB,cAAI,OAAO,KAAK;AACZ,eAAG,KAAK,YAAY,KAAK,EAAI,CAAC;AAC9B;AAAA,UACJ;AACA,eAAK,EAAE,KAAK,IAAI;AAChB,gBAAO,MAAM,IAAK;AAClB,aAAG,KAAK,YAAY,KAAK,EAAI,CAAC;AAC9B,aAAG,KAAK,YAAY,KAAK,EAAI,CAAC;AAAA,QAClC;AACA,eAAO,GAAG,KAAK,EAAE;AAAA,MACrB;AA5BS;AAqCT,eAAS,cAAc,GAAG,KAAK;AAC3B,YAAI,MAAM,GACN,OAAO,EAAE,QACT,OAAO,GACP,KAAK,CAAC,GACN,IAAI,IAAI,IAAI,IAAI,GAAG;AACvB,YAAI,OAAO;AACP,gBAAM,MAAM,kBAAgB,GAAG;AACnC,eAAO,MAAM,OAAO,KAAK,OAAO,KAAK;AACjC,iBAAO,EAAE,WAAW,KAAK;AACzB,eAAK,OAAO,aAAa,SAAS,aAAa,IAAI,IAAI;AACvD,iBAAO,EAAE,WAAW,KAAK;AACzB,eAAK,OAAO,aAAa,SAAS,aAAa,IAAI,IAAI;AACvD,cAAI,MAAM,MAAM,MAAM;AAClB;AACJ,cAAK,MAAM,MAAO;AAClB,gBAAM,KAAK,OAAS;AACpB,aAAG,KAAK,mBAAmB,CAAC,CAAC;AAC7B,cAAI,EAAE,QAAQ,OAAO,OAAO;AACxB;AACJ,iBAAO,EAAE,WAAW,KAAK;AACzB,eAAK,OAAO,aAAa,SAAS,aAAa,IAAI,IAAI;AACvD,cAAI,MAAM;AACN;AACJ,eAAM,KAAK,OAAS,MAAO;AAC3B,gBAAM,KAAK,OAAS;AACpB,aAAG,KAAK,mBAAmB,CAAC,CAAC;AAC7B,cAAI,EAAE,QAAQ,OAAO,OAAO;AACxB;AACJ,iBAAO,EAAE,WAAW,KAAK;AACzB,eAAK,OAAO,aAAa,SAAS,aAAa,IAAI,IAAI;AACvD,eAAM,KAAK,MAAS,MAAO;AAC3B,eAAK;AACL,aAAG,KAAK,mBAAmB,CAAC,CAAC;AAC7B,YAAE;AAAA,QACN;AACA,YAAI,MAAM,CAAC;AACX,aAAK,MAAM,GAAG,MAAI,MAAM;AACpB,cAAI,KAAK,GAAG,GAAG,EAAE,WAAW,CAAC,CAAC;AAClC,eAAO;AAAA,MACX;AAxCS;AA+CT,UAAI,OAAO,WAAW;AAClB;AAOA,YAAII,QAAO,CAAC;AAOZ,QAAAA,MAAK,gBAAgB;AAQrB,QAAAA,MAAK,aAAa,SAAS,KAAK,KAAK;AACjC,cAAI,KAAK;AACT,cAAI,OAAO,QAAQ;AACf,iBAAK,KACL,MAAM,kCAAW;AAAE,qBAAO;AAAA,YAAM,GAA1B;AACV,iBAAO,OAAO,SAAS,KAAK,IAAI,OAAO,MAAM;AACzC,gBAAI,KAAK;AACL,kBAAI,KAAG,GAAI;AAAA,qBACN,KAAK;AACV,kBAAM,MAAI,IAAG,KAAM,GAAI,GACvB,IAAK,KAAG,KAAM,GAAI;AAAA,qBACb,KAAK;AACV,kBAAM,MAAI,KAAI,KAAM,GAAI,GACxB,IAAM,MAAI,IAAG,KAAM,GAAI,GACvB,IAAK,KAAG,KAAM,GAAI;AAAA;AAElB,kBAAM,MAAI,KAAI,IAAM,GAAI,GACxB,IAAM,MAAI,KAAI,KAAM,GAAI,GACxB,IAAM,MAAI,IAAG,KAAM,GAAI,GACvB,IAAK,KAAG,KAAM,GAAI;AACtB,iBAAK;AAAA,UACT;AAAA,QACJ;AAWA,QAAAA,MAAK,aAAa,SAAS,KAAK,KAAK;AACjC,cAAI,GAAG,GAAG,GAAG,GAAG,OAAO,gCAASC,IAAG;AAC/B,YAAAA,KAAIA,GAAE,MAAM,GAAGA,GAAE,QAAQ,IAAI,CAAC;AAC9B,gBAAI,MAAM,MAAMA,GAAE,SAAS,CAAC;AAC5B,gBAAI,OAAO;AACX,gBAAI,OAAO,IAAIA;AACf,kBAAM;AAAA,UACV,GANuB;AAOvB,kBAAQ,IAAI,IAAI,OAAO,MAAM;AACzB,iBAAK,IAAE,SAAU;AACb,kBAAI,CAAC;AAAA,sBACC,IAAE,SAAU;AAClB,eAAE,IAAI,IAAI,OAAO,QAAS,KAAK,CAAC,GAAG,CAAC,CAAC,GACrC,KAAM,IAAE,OAAO,IAAM,IAAE,EAAK;AAAA,sBACtB,IAAE,SAAU;AAClB,gBAAE,IAAE,IAAI,OAAO,SAAS,IAAE,IAAI,OAAO,SAAS,KAAK,CAAC,GAAG,GAAG,CAAC,CAAC,GAC5D,KAAM,IAAE,OAAO,MAAQ,IAAE,OAAO,IAAM,IAAE,EAAK;AAAA,sBACvC,IAAE,SAAU;AAClB,gBAAE,IAAE,IAAI,OAAO,SAAS,IAAE,IAAI,OAAO,SAAS,IAAE,IAAI,OAAO,SAAS,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC,GACrF,KAAM,IAAE,MAAO,MAAQ,IAAE,OAAO,MAAQ,IAAE,OAAO,IAAM,IAAE,EAAK;AAAA;AAC7D,oBAAM,WAAW,4BAA0B,CAAC;AAAA,UACrD;AAAA,QACJ;AASA,QAAAD,MAAK,cAAc,SAAS,KAAK,KAAK;AAClC,cAAI,IAAI,KAAK;AACb,iBAAO,MAAM;AACT,iBAAK,KAAK,OAAO,OAAO,KAAK,IAAI,OAAO;AACpC;AACJ,gBAAI,MAAM,SAAU,MAAM,OAAQ;AAC9B,mBAAK,KAAK,IAAI,OAAO,MAAM;AACvB,oBAAI,MAAM,SAAU,MAAM,OAAQ;AAC9B,uBAAK,KAAG,SAAQ,OAAM,KAAG,QAAO,KAAO;AACvC,uBAAK;AAAM;AAAA,gBACf;AAAA,cACJ;AAAA,YACJ;AACA,gBAAI,EAAE;AAAA,UACV;AACA,cAAI,OAAO;AAAM,gBAAI,EAAE;AAAA,QAC3B;AASA,QAAAA,MAAK,cAAc,SAAS,KAAK,KAAK;AAClC,cAAI,KAAK;AACT,cAAI,OAAO,QAAQ;AACf,iBAAK,KAAK,MAAM,kCAAW;AAAE,qBAAO;AAAA,YAAM,GAA1B;AACpB,iBAAO,OAAO,SAAS,KAAK,IAAI,OAAO,MAAM;AACzC,gBAAI,MAAM;AACN,kBAAI,EAAE;AAAA;AAEN,oBAAM,OACN,KAAK,MAAI,MAAI,KAAM,GACnB,IAAK,KAAG,OAAO,KAAM;AACzB,iBAAK;AAAA,UACT;AAAA,QACJ;AAQA,QAAAA,MAAK,oBAAoB,SAAS,KAAK,KAAK;AACxC,UAAAA,MAAK,YAAY,KAAK,SAAS,IAAI;AAC/B,YAAAA,MAAK,WAAW,IAAI,GAAG;AAAA,UAC3B,CAAC;AAAA,QACL;AAUA,QAAAA,MAAK,oBAAoB,SAAS,KAAK,KAAK;AACxC,UAAAA,MAAK,WAAW,KAAK,SAAS,IAAI;AAC9B,YAAAA,MAAK,YAAY,IAAI,GAAG;AAAA,UAC5B,CAAC;AAAA,QACL;AAOA,QAAAA,MAAK,qBAAqB,SAAS,IAAI;AACnC,iBAAQ,KAAK,MAAQ,IAAK,KAAK,OAAS,IAAK,KAAK,QAAW,IAAI;AAAA,QACrE;AAQA,QAAAA,MAAK,gBAAgB,SAAS,KAAK;AAC/B,cAAI,IAAI,IAAE;AACV,kBAAQ,KAAK,IAAI,OAAO;AACpB,iBAAKA,MAAK,mBAAmB,EAAE;AACnC,iBAAO;AAAA,QACX;AAQA,QAAAA,MAAK,uBAAuB,SAAS,KAAK;AACtC,cAAI,IAAE,GAAG,IAAE;AACX,UAAAA,MAAK,YAAY,KAAK,SAAS,IAAI;AAC/B,cAAE;AAAG,iBAAKA,MAAK,mBAAmB,EAAE;AAAA,UACxC,CAAC;AACD,iBAAO,CAAC,GAAE,CAAC;AAAA,QACf;AAEA,eAAOA;AAAA,MACX,EAAE;AAEF,WAAK,MAAM,KAAK,OAAO,WAAW;AAAE,eAAO,CAAC,oBAAI;AAAA,MAAM;AAOtD,UAAI,kBAAkB;AAOtB,UAAI,8BAA8B;AAOlC,UAAI,sBAAsB;AAO1B,UAAI,qBAAqB;AAOzB,UAAI,SAAS;AAAA,QACT;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,MAC5B;AAOA,UAAI,SAAS;AAAA,QACT;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAAY;AAAA,QAChD;AA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",
  "names": ["bcrypt", "random", "callback", "salt", "utfx", "b", "err", "match", "raw", "app", "Node", "Node", "Hono", "Hono", "customer", "savePaymentInstrument", "cardLast4", "ev", "c", "bcrypt"]
}
