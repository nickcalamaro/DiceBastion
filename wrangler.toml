name = "dicebastion-memberships"
main = "worker/src/index.js"
compatibility_date = "2024-10-23"
compatibility_flags = ["nodejs_compat"]

# Production routes (uncomment when ready)
# routes = [ { pattern = "dicebastion.com/api/*", zone_name = "dicebastion.com" } ]

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "dicebastion"
database_id = "9abc9bae-236a-4237-aa88-78cf161ba9d1"

# R2 Object Storage (for image uploads)
[[r2_buckets]]
binding = "IMAGES"
bucket_name = "dicebastion-images"
# Note: After enabling public access in Cloudflare dashboard, set R2_PUBLIC_URL:
# R2_PUBLIC_URL = "https://pub-xxxxx.r2.dev"  # or your custom domain

# Service Bindings (Worker-to-Worker Communication)
[[services]]
binding = "PAYMENTS"
service = "dicebastion-payments"

# Environment Variables
[vars]
DEBUG = "false"
ALLOWED_ORIGIN = "http://localhost:1313,http://localhost:1314,http://localhost:8000,https://dicebastion.com,https://www.dicebastion.com,https://shop.dicebastion.com,https://dicebastion-shop.pages.dev"
RETURN_URL = "https://dicebastion.com/thank-you"
CURRENCY = "GBP"
SUMUP_REGION = "UK"
SUMUP_MERCHANT_CODE = "MUZHYEAH"
TURNSTILE_SITE_KEY = "0x4AAAAAACAB4xlOnW3S8K0k"
TURNSTILE_SECRET = "0x4AAAAAACAB41xceooY522cbKNKGVTP-iA"
MAILERSEND_FROM_NAME = "Dice Bastion"
MAILERSEND_FROM_EMAIL = "noreply@dicebastion.com"
ALLOW_TEST_BYPASS = "true"
PAYMENTS_WORKER_URL = "https://dicebastion-payments.ncalamaro.workers.dev"
R2_PUBLIC_URL = "https://pub-631ca6f207ca4661ac9cb2ba9371ba31.r2.dev"
BUNNY_DB_URL = "https://your-bunny-db-api-url"  # Update with your bunny.net database API URL

# Production secrets (set via: wrangler secret put SECRET_NAME)
# - INTERNAL_SECRET (must match payments worker)
# - MAILERSEND_API_KEY
# - ADMIN_KEY (for admin endpoints)
# - BUNNY_DB_TOKEN (for bunny.net database access)
# Legacy SumUp secrets (no longer used, calls go through payments worker):
# - SUMUP_CLIENT_ID (can be deleted)
# - SUMUP_CLIENT_SECRET (can be deleted)

# Observability & Logging
[observability]
[observability.logs]
enabled = true
invocation_logs = true

# Cron trigger for membership renewals (runs daily at 2 AM UTC)
[triggers]
crons = ["0 2 * * *"]